<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Poglavje 10 P4.3 Preverjanje istovetnosti uporabnika | Spletno programiranje 2023/2024</title>
  <meta name="description" content="Skripta za pomoč pri predmetu Spletno programiranje 2022/2023" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Poglavje 10 P4.3 Preverjanje istovetnosti uporabnika | Spletno programiranje 2023/2024" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Skripta za pomoč pri predmetu Spletno programiranje 2022/2023" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Poglavje 10 P4.3 Preverjanje istovetnosti uporabnika | Spletno programiranje 2023/2024" />
  
  <meta name="twitter:description" content="Skripta za pomoč pri predmetu Spletno programiranje 2022/2023" />
  

<meta name="author" content="izr. prof. dr. Dejan Lavbič" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Angular-SPA.html"/>
<link rel="next" href="DApps-pametne-pogodbe.html"/>
<script src="assets/lib/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/lib/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/lib/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/lib/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/lib/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/lib/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/lib/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/lib/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/lib/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/lib/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/lib/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="assets/lib/kePrint-0.0.1/kePrint.js"></script>
<link href="assets/lib/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style/stil.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#terminski-plan-izvajanja-predmeta">SP 2023/2024 terminski plan</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Uvod</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#splošne-informacije"><i class="fa fa-check"></i>Splošne informacije</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#predavatelj"><i class="fa fa-check"></i>Predavatelj</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#asistent"><i class="fa fa-check"></i>Asistent</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#terminski-plan-izvajanja-predmeta"><i class="fa fa-check"></i>Terminski plan izvajanja predmeta</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pravila-igre"><i class="fa fa-check"></i>Pravila igre</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#predavanja"><i class="fa fa-check"></i>Predavanja</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#vaje"><i class="fa fa-check"></i>Vaje</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ocenjevanje"><i class="fa fa-check"></i>Ocenjevanje</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pisni-izpiti"><i class="fa fa-check"></i>Pisni izpiti</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#priporočena-literatura"><i class="fa fa-check"></i>Priporočena literatura</a></li>
</ul></li>
<li class="part"><span><b>I sklop: Uvod v spletno programiranje</b></span></li>
<li class="chapter" data-level="1" data-path="P11.html"><a href="P11.html"><i class="fa fa-check"></i><b>1</b> <span class="sklop1 oznaka">P1.1</span> Svetovni splet in celostni razvoj programske opreme</a>
<ul>
<li class="chapter" data-level="1.1" data-path="P11.html"><a href="P11.html#infrastrukturni-in-arhitekturni-pogled-na-svetovni-splet"><i class="fa fa-check"></i><b>1.1</b> Infrastrukturni in arhitekturni pogled na svetovni splet</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="P11.html"><a href="P11.html#moorov-zakon"><i class="fa fa-check"></i><b>1.1.1</b> Moorov zakon</a></li>
<li class="chapter" data-level="1.1.2" data-path="P11.html"><a href="P11.html#internet-vs.-svetovni-splet"><i class="fa fa-check"></i><b>1.1.2</b> Internet vs. (svetovni) splet</a></li>
<li class="chapter" data-level="1.1.3" data-path="P11.html"><a href="P11.html#razvoj-interneta"><i class="fa fa-check"></i><b>1.1.3</b> Razvoj interneta</a></li>
<li class="chapter" data-level="1.1.4" data-path="P11.html"><a href="P11.html#razvoj-WWW"><i class="fa fa-check"></i><b>1.1.4</b> Razvoj (svetovnega) spleta</a></li>
<li class="chapter" data-level="1.1.5" data-path="P11.html"><a href="P11.html#arhitektura-odjemalecstrežnik"><i class="fa fa-check"></i><b>1.1.5</b> Arhitektura odjemalec/strežnik</a></li>
<li class="chapter" data-level="1.1.6" data-path="P11.html"><a href="P11.html#večnivojska-arhitektura"><i class="fa fa-check"></i><b>1.1.6</b> Večnivojska arhitektura</a></li>
<li class="chapter" data-level="1.1.7" data-path="P11.html"><a href="P11.html#pomembni-mejniki-in-akterji"><i class="fa fa-check"></i><b>1.1.7</b> Pomembni mejniki in akterji</a></li>
<li class="chapter" data-level="1.1.8" data-path="P11.html"><a href="P11.html#trenutno-stanje-na-trgu"><i class="fa fa-check"></i><b>1.1.8</b> Trenutno stanje na trgu</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="P11.html"><a href="P11.html#uporabljen-pristop-pri-predmetu"><i class="fa fa-check"></i><b>1.2</b> Uporabljen pristop pri predmetu</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="P11.html"><a href="P11.html#tehnologije-ki-jih-bomo-uporabljali"><i class="fa fa-check"></i><b>1.2.1</b> Tehnologije, ki jih bomo uporabljali</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="P11.html"><a href="P11.html#celostni-razvoj-programske-opreme-z-mean-arhitekturo"><i class="fa fa-check"></i><b>1.3</b> Celostni razvoj programske opreme z MEAN arhitekturo</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="P11.html"><a href="P11.html#Node-js-niti"><i class="fa fa-check"></i><b>1.3.1</b> Node.js</a></li>
<li class="chapter" data-level="1.3.2" data-path="P11.html"><a href="P11.html#express"><i class="fa fa-check"></i><b>1.3.2</b> Express</a></li>
<li class="chapter" data-level="1.3.3" data-path="P11.html"><a href="P11.html#MongoDB-uvod"><i class="fa fa-check"></i><b>1.3.3</b> MongoDB</a></li>
<li class="chapter" data-level="1.3.4" data-path="P11.html"><a href="P11.html#angular"><i class="fa fa-check"></i><b>1.3.4</b> Angular</a></li>
<li class="chapter" data-level="1.3.5" data-path="P11.html"><a href="P11.html#podporna-orodja-ogrodja-in-knjižnice"><i class="fa fa-check"></i><b>1.3.5</b> Podporna orodja, ogrodja in knjižnice</a></li>
<li class="chapter" data-level="1.3.6" data-path="P11.html"><a href="P11.html#git"><i class="fa fa-check"></i><b>1.3.6</b> Git</a></li>
<li class="chapter" data-level="1.3.7" data-path="P11.html"><a href="P11.html#heroku"><i class="fa fa-check"></i><b>1.3.7</b> Heroku</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="P11.html"><a href="P11.html#razvoj-dejanske-aplikacije"><i class="fa fa-check"></i><b>1.4</b> Razvoj dejanske aplikacije</a></li>
<li class="chapter" data-level="1.5" data-path="P11.html"><a href="P11.html#nacrtovanje-aplikacije-po-mean-arhitekturi"><i class="fa fa-check"></i><b>1.5</b> Načrtovanje aplikacije po MEAN arhitekturi</a></li>
<li class="chapter" data-level="1.6" data-path="P11.html"><a href="P11.html#dobre-prakse-pri-načrtovanju-in-implementaciji-aplikacije"><i class="fa fa-check"></i><b>1.6</b> Dobre prakse pri načrtovanju in implementaciji aplikacije</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="P11.html"><a href="P11.html#uporaba-api-ja-za-dostop-do-podatkovne-ravni"><i class="fa fa-check"></i><b>1.6.1</b> Uporaba API-ja za dostop do podatkovne ravni</a></li>
<li class="chapter" data-level="1.6.2" data-path="P11.html"><a href="P11.html#koraki-pri-nacrtovanju-nove-spletne-aplikacije"><i class="fa fa-check"></i><b>1.6.2</b> Koraki pri načrtovanju nove spletne aplikacije</a></li>
<li class="chapter" data-level="1.6.3" data-path="P11.html"><a href="P11.html#koraki-pri-implementaciji-nove-spletne-aplikacije"><i class="fa fa-check"></i><b>1.6.3</b> Koraki pri implementaciji nove spletne aplikacije</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="P11.html"><a href="P11.html#okolje"><i class="fa fa-check"></i><b>1.7</b> Okolje</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="P11.html"><a href="P11.html#razvojno-okolje"><i class="fa fa-check"></i><b>1.7.1</b> Razvojno okolje</a></li>
<li class="chapter" data-level="1.7.2" data-path="P11.html"><a href="P11.html#produkcijsko-okolje"><i class="fa fa-check"></i><b>1.7.2</b> Produkcijsko okolje</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="P11.html"><a href="P11.html#git-1"><i class="fa fa-check"></i><b>1.8</b> Git</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="P11.html"><a href="P11.html#osnovne-operacije-vcs"><i class="fa fa-check"></i><b>1.8.1</b> Osnovne operacije VCS</a></li>
<li class="chapter" data-level="1.8.2" data-path="P11.html"><a href="P11.html#posebnosti-porazdeljenih-sistemov-za-obvladovanje-verzij-dvcs"><i class="fa fa-check"></i><b>1.8.2</b> Posebnosti porazdeljenih sistemov za obvladovanje verzij (DVCS)</a></li>
<li class="chapter" data-level="1.8.3" data-path="P11.html"><a href="P11.html#dobre-prakse-uporabe-git"><i class="fa fa-check"></i><b>1.8.3</b> Dobre prakse uporabe Git</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="LP1.html"><a href="LP1.html"><i class="fa fa-check"></i><b>2</b> <span class="sklop4 oznaka">1. LP</span> Dinamična spletna aplikacija na strani strežnika in odjemalca</a>
<ul>
<li class="chapter" data-level="2.1" data-path="LP1.html"><a href="LP1.html#pravila-zahteve-in-omejitve"><i class="fa fa-check"></i><b>2.1</b> Pravila, zahteve in omejitve</a></li>
<li class="chapter" data-level="2.2" data-path="LP1.html"><a href="LP1.html#LP11"><i class="fa fa-check"></i><b>2.2</b> <span class="sklop1 oznaka">1. del</span> Osnutek aplikacije in wireframe model</a></li>
<li class="chapter" data-level="2.3" data-path="LP1.html"><a href="LP1.html#LP12"><i class="fa fa-check"></i><b>2.3</b> <span class="sklop2 oznaka">2. del</span> Arhitektura aplikacije in različna razvojna okolja</a></li>
<li class="chapter" data-level="2.4" data-path="LP1.html"><a href="LP1.html#LP13"><i class="fa fa-check"></i><b>2.4</b> <span class="sklop3 oznaka">3. del</span> Zaledni del in dostop do podatkovne baze</a></li>
<li class="chapter" data-level="2.5" data-path="LP1.html"><a href="LP1.html#LP14"><i class="fa fa-check"></i><b>2.5</b> <span class="sklop4 oznaka">4. del</span> Uporabniški vmesnik, SPA in avtentikacija</a></li>
<li class="chapter" data-level="2.6" data-path="LP1.html"><a href="LP1.html#kriteriji-vrednotenja"><i class="fa fa-check"></i><b>2.6</b> Kriteriji vrednotenja</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="HTML-CSS.html"><a href="HTML-CSS.html"><i class="fa fa-check"></i><b>3</b> <span class="sklop1 oznaka">P1.2</span> Osnovna spletna standarda HTML in CSS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="HTML-CSS.html"><a href="HTML-CSS.html#html-tehnologija"><i class="fa fa-check"></i><b>3.1</b> HTML</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="HTML-CSS.html"><a href="HTML-CSS.html#enostaven-primer-html5-dokumenta"><i class="fa fa-check"></i><b>3.1.1</b> Enostaven primer HTML5 dokumenta</a></li>
<li class="chapter" data-level="3.1.2" data-path="HTML-CSS.html"><a href="HTML-CSS.html#ustreznost-html5-dokumenta"><i class="fa fa-check"></i><b>3.1.2</b> Ustreznost HTML5 dokumenta</a></li>
<li class="chapter" data-level="3.1.3" data-path="HTML-CSS.html"><a href="HTML-CSS.html#naslovi"><i class="fa fa-check"></i><b>3.1.3</b> Naslovi</a></li>
<li class="chapter" data-level="3.1.4" data-path="HTML-CSS.html"><a href="HTML-CSS.html#povezave"><i class="fa fa-check"></i><b>3.1.4</b> Povezave</a></li>
<li class="chapter" data-level="3.1.5" data-path="HTML-CSS.html"><a href="HTML-CSS.html#slike"><i class="fa fa-check"></i><b>3.1.5</b> Slike</a></li>
<li class="chapter" data-level="3.1.6" data-path="HTML-CSS.html"><a href="HTML-CSS.html#posebni-znaki-in-vodoravne-črte"><i class="fa fa-check"></i><b>3.1.6</b> Posebni znaki in vodoravne črte</a></li>
<li class="chapter" data-level="3.1.7" data-path="HTML-CSS.html"><a href="HTML-CSS.html#seznami"><i class="fa fa-check"></i><b>3.1.7</b> Seznami</a></li>
<li class="chapter" data-level="3.1.8" data-path="HTML-CSS.html"><a href="HTML-CSS.html#tabele"><i class="fa fa-check"></i><b>3.1.8</b> Tabele</a></li>
<li class="chapter" data-level="3.1.9" data-path="HTML-CSS.html"><a href="HTML-CSS.html#Spletni-obrazci-HTML"><i class="fa fa-check"></i><b>3.1.9</b> Spletni obrazci</a></li>
<li class="chapter" data-level="3.1.10" data-path="HTML-CSS.html"><a href="HTML-CSS.html#interne-povezave"><i class="fa fa-check"></i><b>3.1.10</b> Interne povezave</a></li>
<li class="chapter" data-level="3.1.11" data-path="HTML-CSS.html"><a href="HTML-CSS.html#meta-elementi"><i class="fa fa-check"></i><b>3.1.11</b> Meta elementi</a></li>
<li class="chapter" data-level="3.1.12" data-path="HTML-CSS.html"><a href="HTML-CSS.html#napredni-gradniki-spletnih-obrazcev"><i class="fa fa-check"></i><b>3.1.12</b> Napredni gradniki spletnih obrazcev</a></li>
<li class="chapter" data-level="3.1.13" data-path="HTML-CSS.html"><a href="HTML-CSS.html#samodejno-dopolnjevanje-vrednosti-pri-vnosnih-poljih"><i class="fa fa-check"></i><b>3.1.13</b> Samodejno dopolnjevanje vrednosti pri vnosnih poljih</a></li>
<li class="chapter" data-level="3.1.14" data-path="HTML-CSS.html"><a href="HTML-CSS.html#elementi-za-opredelitev-strukture-strani"><i class="fa fa-check"></i><b>3.1.14</b> Elementi za opredelitev strukture strani</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="HTML-CSS.html"><a href="HTML-CSS.html#prekrivni-slogi-css"><i class="fa fa-check"></i><b>3.2</b> Prekrivni slogi (CSS)</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="HTML-CSS.html"><a href="HTML-CSS.html#uvod-1"><i class="fa fa-check"></i><b>3.2.1</b> Uvod</a></li>
<li class="chapter" data-level="3.2.2" data-path="HTML-CSS.html"><a href="HTML-CSS.html#neposredno-opredeljeni-slogi"><i class="fa fa-check"></i><b>3.2.2</b> Neposredno opredeljeni slogi</a></li>
<li class="chapter" data-level="3.2.3" data-path="HTML-CSS.html"><a href="HTML-CSS.html#vgrajeni-slogi"><i class="fa fa-check"></i><b>3.2.3</b> Vgrajeni slogi</a></li>
<li class="chapter" data-level="3.2.4" data-path="HTML-CSS.html"><a href="HTML-CSS.html#konfliktni-slogi"><i class="fa fa-check"></i><b>3.2.4</b> Konfliktni slogi</a></li>
<li class="chapter" data-level="3.2.5" data-path="HTML-CSS.html"><a href="HTML-CSS.html#zunanji-slogi"><i class="fa fa-check"></i><b>3.2.5</b> Zunanji slogi</a></li>
<li class="chapter" data-level="3.2.6" data-path="HTML-CSS.html"><a href="HTML-CSS.html#pozicioniranje-elementov"><i class="fa fa-check"></i><b>3.2.6</b> Pozicioniranje elementov</a></li>
<li class="chapter" data-level="3.2.7" data-path="HTML-CSS.html"><a href="HTML-CSS.html#ozadje"><i class="fa fa-check"></i><b>3.2.7</b> Ozadje</a></li>
<li class="chapter" data-level="3.2.8" data-path="HTML-CSS.html"><a href="HTML-CSS.html#dimenzije-elementa"><i class="fa fa-check"></i><b>3.2.8</b> Dimenzije elementa</a></li>
<li class="chapter" data-level="3.2.9" data-path="HTML-CSS.html"><a href="HTML-CSS.html#model-škatle"><i class="fa fa-check"></i><b>3.2.9</b> Model škatle</a></li>
<li class="chapter" data-level="3.2.10" data-path="HTML-CSS.html"><a href="HTML-CSS.html#plavajoči-elementi"><i class="fa fa-check"></i><b>3.2.10</b> Plavajoči elementi</a></li>
<li class="chapter" data-level="3.2.11" data-path="HTML-CSS.html"><a href="HTML-CSS.html#vrste-medijev"><i class="fa fa-check"></i><b>3.2.11</b> Vrste medijev</a></li>
<li class="chapter" data-level="3.2.12" data-path="HTML-CSS.html"><a href="HTML-CSS.html#spustni-meniji"><i class="fa fa-check"></i><b>3.2.12</b> Spustni meniji</a></li>
<li class="chapter" data-level="3.2.13" data-path="HTML-CSS.html"><a href="HTML-CSS.html#senca-na-besedilu"><i class="fa fa-check"></i><b>3.2.13</b> Senca na besedilu</a></li>
<li class="chapter" data-level="3.2.14" data-path="HTML-CSS.html"><a href="HTML-CSS.html#zaobljeni-robovi"><i class="fa fa-check"></i><b>3.2.14</b> Zaobljeni robovi</a></li>
<li class="chapter" data-level="3.2.15" data-path="HTML-CSS.html"><a href="HTML-CSS.html#barva"><i class="fa fa-check"></i><b>3.2.15</b> Barva</a></li>
<li class="chapter" data-level="3.2.16" data-path="HTML-CSS.html"><a href="HTML-CSS.html#senca-na-modelu-škatle"><i class="fa fa-check"></i><b>3.2.16</b> Senca na modelu škatle</a></li>
<li class="chapter" data-level="3.2.17" data-path="HTML-CSS.html"><a href="HTML-CSS.html#uporaba-pisav-s-spleta"><i class="fa fa-check"></i><b>3.2.17</b> Uporaba pisav s spleta</a></li>
<li class="chapter" data-level="3.2.18" data-path="HTML-CSS.html"><a href="HTML-CSS.html#prilagodljiv-model-škatle-in-izbira-poljubnega-ugnezdenega-elementa"><i class="fa fa-check"></i><b>3.2.18</b> Prilagodljiv model škatle in izbira poljubnega ugnezdenega elementa</a></li>
<li class="chapter" data-level="3.2.19" data-path="HTML-CSS.html"><a href="HTML-CSS.html#postavitev-v-več-stolpcev"><i class="fa fa-check"></i><b>3.2.19</b> Postavitev v več stolpcev</a></li>
<li class="chapter" data-level="3.2.20" data-path="HTML-CSS.html"><a href="HTML-CSS.html#poizvedovanje-po-medijih"><i class="fa fa-check"></i><b>3.2.20</b> Poizvedovanje po medijih</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="HTML-CSS.html"><a href="HTML-CSS.html#bootstrap-1"><i class="fa fa-check"></i><b>3.3</b> Bootstrap</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="HTML-CSS.html"><a href="HTML-CSS.html#uvod-in-način-uporabe"><i class="fa fa-check"></i><b>3.3.1</b> Uvod in način uporabe</a></li>
<li class="chapter" data-level="3.3.2" data-path="HTML-CSS.html"><a href="HTML-CSS.html#enostavni-primer"><i class="fa fa-check"></i><b>3.3.2</b> Enostavni primer</a></li>
<li class="chapter" data-level="3.3.3" data-path="HTML-CSS.html"><a href="HTML-CSS.html#prilagajanje-vsebine-z-mrežnim-sistemom"><i class="fa fa-check"></i><b>3.3.3</b> Prilagajanje vsebine z mrežnim sistemom</a></li>
<li class="chapter" data-level="3.3.4" data-path="HTML-CSS.html"><a href="HTML-CSS.html#tipografija"><i class="fa fa-check"></i><b>3.3.4</b> Tipografija</a></li>
<li class="chapter" data-level="3.3.5" data-path="HTML-CSS.html"><a href="HTML-CSS.html#tabele-1"><i class="fa fa-check"></i><b>3.3.5</b> Tabele</a></li>
<li class="chapter" data-level="3.3.6" data-path="HTML-CSS.html"><a href="HTML-CSS.html#slike-1"><i class="fa fa-check"></i><b>3.3.6</b> Slike</a></li>
<li class="chapter" data-level="3.3.7" data-path="HTML-CSS.html"><a href="HTML-CSS.html#opozorila"><i class="fa fa-check"></i><b>3.3.7</b> Opozorila</a></li>
<li class="chapter" data-level="3.3.8" data-path="HTML-CSS.html"><a href="HTML-CSS.html#gumbi"><i class="fa fa-check"></i><b>3.3.8</b> Gumbi</a></li>
<li class="chapter" data-level="3.3.9" data-path="HTML-CSS.html"><a href="HTML-CSS.html#ikone"><i class="fa fa-check"></i><b>3.3.9</b> Ikone</a></li>
<li class="chapter" data-level="3.3.10" data-path="HTML-CSS.html"><a href="HTML-CSS.html#oznake"><i class="fa fa-check"></i><b>3.3.10</b> Oznake</a></li>
<li class="chapter" data-level="3.3.11" data-path="HTML-CSS.html"><a href="HTML-CSS.html#kazalnik-poteka"><i class="fa fa-check"></i><b>3.3.11</b> Kazalnik poteka</a></li>
<li class="chapter" data-level="3.3.12" data-path="HTML-CSS.html"><a href="HTML-CSS.html#prehodi-po-straneh"><i class="fa fa-check"></i><b>3.3.12</b> Prehodi po straneh</a></li>
<li class="chapter" data-level="3.3.13" data-path="HTML-CSS.html"><a href="HTML-CSS.html#plošča"><i class="fa fa-check"></i><b>3.3.13</b> Plošča</a></li>
<li class="chapter" data-level="3.3.14" data-path="HTML-CSS.html"><a href="HTML-CSS.html#spustni-meni"><i class="fa fa-check"></i><b>3.3.14</b> Spustni meni</a></li>
<li class="chapter" data-level="3.3.15" data-path="HTML-CSS.html"><a href="HTML-CSS.html#spletni-obrazci"><i class="fa fa-check"></i><b>3.3.15</b> Spletni obrazci</a></li>
<li class="chapter" data-level="3.3.16" data-path="HTML-CSS.html"><a href="HTML-CSS.html#modalno-okno"><i class="fa fa-check"></i><b>3.3.16</b> Modalno okno</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="HTML-CSS.html"><a href="HTML-CSS.html#praktični-prikaz-uporabe-css"><i class="fa fa-check"></i><b>3.4</b> Praktični prikaz uporabe CSS</a></li>
</ul></li>
<li class="part"><span><b>II sklop: JavaScript - programski jezik na strani odjemalca in strežnika</b></span></li>
<li class="chapter" data-level="4" data-path="JavaScript.html"><a href="JavaScript.html"><i class="fa fa-check"></i><b>4</b> <span class="sklop2 oznaka">P2.1</span> JavaScript, jezik svetovnega spleta</a>
<ul>
<li class="chapter" data-level="4.1" data-path="JavaScript.html"><a href="JavaScript.html#razvoj-jezika"><i class="fa fa-check"></i><b>4.1</b> Razvoj jezika</a></li>
<li class="chapter" data-level="4.2" data-path="JavaScript.html"><a href="JavaScript.html#vrednosti-podatkovni-tipi-in-operatorji"><i class="fa fa-check"></i><b>4.2</b> Vrednosti, podatkovni tipi in operatorji</a></li>
<li class="chapter" data-level="4.3" data-path="JavaScript.html"><a href="JavaScript.html#struktura-programa"><i class="fa fa-check"></i><b>4.3</b> Struktura programa</a></li>
<li class="chapter" data-level="4.4" data-path="JavaScript.html"><a href="JavaScript.html#kontrolni-stavki"><i class="fa fa-check"></i><b>4.4</b> Kontrolni stavki</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="JavaScript.html"><a href="JavaScript.html#if-stavek"><i class="fa fa-check"></i><b>4.4.1</b> <code>if</code> stavek</a></li>
<li class="chapter" data-level="4.4.2" data-path="JavaScript.html"><a href="JavaScript.html#if...else-stavek"><i class="fa fa-check"></i><b>4.4.2</b> <code>if...else</code> stavek</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="JavaScript.html"><a href="JavaScript.html#operatorji"><i class="fa fa-check"></i><b>4.5</b> Operatorji</a></li>
<li class="chapter" data-level="4.6" data-path="JavaScript.html"><a href="JavaScript.html#struktura-ponavljanja"><i class="fa fa-check"></i><b>4.6</b> Struktura ponavljanja</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="JavaScript.html"><a href="JavaScript.html#while-stavek"><i class="fa fa-check"></i><b>4.6.1</b> <code>while</code> stavek</a></li>
<li class="chapter" data-level="4.6.2" data-path="JavaScript.html"><a href="JavaScript.html#for-stavek"><i class="fa fa-check"></i><b>4.6.2</b> <code>for</code> stavek</a></li>
<li class="chapter" data-level="4.6.3" data-path="JavaScript.html"><a href="JavaScript.html#do...while-stavek"><i class="fa fa-check"></i><b>4.6.3</b> <code>do...while</code> stavek</a></li>
<li class="chapter" data-level="4.6.4" data-path="JavaScript.html"><a href="JavaScript.html#break-in-continue"><i class="fa fa-check"></i><b>4.6.4</b> <code>break</code> in <code>continue</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="JavaScript.html"><a href="JavaScript.html#funkcije"><i class="fa fa-check"></i><b>4.7</b> Funkcije</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="JavaScript.html"><a href="JavaScript.html#opredelitev-funkcije"><i class="fa fa-check"></i><b>4.7.1</b> Opredelitev funkcije</a></li>
<li class="chapter" data-level="4.7.2" data-path="JavaScript.html"><a href="JavaScript.html#parametri-in-kontekst"><i class="fa fa-check"></i><b>4.7.2</b> Parametri in kontekst</a></li>
<li class="chapter" data-level="4.7.3" data-path="JavaScript.html"><a href="JavaScript.html#zaprtje"><i class="fa fa-check"></i><b>4.7.3</b> Zaprtje</a></li>
<li class="chapter" data-level="4.7.4" data-path="JavaScript.html"><a href="JavaScript.html#rekurzija"><i class="fa fa-check"></i><b>4.7.4</b> Rekurzija</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="JavaScript.html"><a href="JavaScript.html#podatkovne-strukture"><i class="fa fa-check"></i><b>4.8</b> Podatkovne strukture</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="JavaScript.html"><a href="JavaScript.html#nizi-in-njihove-lastnosti"><i class="fa fa-check"></i><b>4.8.1</b> Nizi in njihove lastnosti</a></li>
<li class="chapter" data-level="4.8.2" data-path="JavaScript.html"><a href="JavaScript.html#objekt-argumentov-funkcije"><i class="fa fa-check"></i><b>4.8.2</b> Objekt argumentov funkcije</a></li>
<li class="chapter" data-level="4.8.3" data-path="JavaScript.html"><a href="JavaScript.html#json"><i class="fa fa-check"></i><b>4.8.3</b> JSON</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="JavaScript.html"><a href="JavaScript.html#funkcije-višjega-reda"><i class="fa fa-check"></i><b>4.9</b> Funkcije višjega reda</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="JavaScript.html"><a href="JavaScript.html#abstrakcija"><i class="fa fa-check"></i><b>4.9.1</b> Abstrakcija</a></li>
<li class="chapter" data-level="4.9.2" data-path="JavaScript.html"><a href="JavaScript.html#funkcije-višjega-reda-1"><i class="fa fa-check"></i><b>4.9.2</b> Funkcije višjega reda</a></li>
<li class="chapter" data-level="4.9.3" data-path="JavaScript.html"><a href="JavaScript.html#posredovanje-argumentov"><i class="fa fa-check"></i><b>4.9.3</b> Posredovanje argumentov</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="JavaScript.html"><a href="JavaScript.html#objekti"><i class="fa fa-check"></i><b>4.10</b> Objekti</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="JavaScript.html"><a href="JavaScript.html#metode"><i class="fa fa-check"></i><b>4.10.1</b> Metode</a></li>
<li class="chapter" data-level="4.10.2" data-path="JavaScript.html"><a href="JavaScript.html#prototipi"><i class="fa fa-check"></i><b>4.10.2</b> Prototipi</a></li>
<li class="chapter" data-level="4.10.3" data-path="JavaScript.html"><a href="JavaScript.html#konstruktorji"><i class="fa fa-check"></i><b>4.10.3</b> Konstruktorji</a></li>
<li class="chapter" data-level="4.10.4" data-path="JavaScript.html"><a href="JavaScript.html#razredna-notacija"><i class="fa fa-check"></i><b>4.10.4</b> Razredna notacija</a></li>
<li class="chapter" data-level="4.10.5" data-path="JavaScript.html"><a href="JavaScript.html#prekrivanje-lastnosti"><i class="fa fa-check"></i><b>4.10.5</b> Prekrivanje lastnosti</a></li>
<li class="chapter" data-level="4.10.6" data-path="JavaScript.html"><a href="JavaScript.html#get-in-set-metode"><i class="fa fa-check"></i><b>4.10.6</b> <code>Get</code> in <code>set</code> metode</a></li>
<li class="chapter" data-level="4.10.7" data-path="JavaScript.html"><a href="JavaScript.html#primerek"><i class="fa fa-check"></i><b>4.10.7</b> Primerek</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="JavaScript.html"><a href="JavaScript.html#hrošči-in-obvladovanje-napak"><i class="fa fa-check"></i><b>4.11</b> Hrošči in obvladovanje napak</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="JavaScript.html"><a href="JavaScript.html#strog-način-delovanja"><i class="fa fa-check"></i><b>4.11.1</b> Strog način delovanja</a></li>
<li class="chapter" data-level="4.11.2" data-path="JavaScript.html"><a href="JavaScript.html#testiranje"><i class="fa fa-check"></i><b>4.11.2</b> Testiranje</a></li>
<li class="chapter" data-level="4.11.3" data-path="JavaScript.html"><a href="JavaScript.html#obvladovanje-izjem"><i class="fa fa-check"></i><b>4.11.3</b> Obvladovanje izjem</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="JavaScript.html"><a href="JavaScript.html#regularni-izrazi"><i class="fa fa-check"></i><b>4.12</b> Regularni izrazi</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="JavaScript.html"><a href="JavaScript.html#kreiranje-regularnega-izraza"><i class="fa fa-check"></i><b>4.12.1</b> Kreiranje regularnega izraza</a></li>
<li class="chapter" data-level="4.12.2" data-path="JavaScript.html"><a href="JavaScript.html#testiranje-ujemanja"><i class="fa fa-check"></i><b>4.12.2</b> Testiranje ujemanja</a></li>
<li class="chapter" data-level="4.12.3" data-path="JavaScript.html"><a href="JavaScript.html#testiranje-ujemanja-množice-znakov"><i class="fa fa-check"></i><b>4.12.3</b> Testiranje ujemanja množice znakov</a></li>
<li class="chapter" data-level="4.12.4" data-path="JavaScript.html"><a href="JavaScript.html#ponavljanje-delov-vzorca"><i class="fa fa-check"></i><b>4.12.4</b> Ponavljanje delov vzorca</a></li>
<li class="chapter" data-level="4.12.5" data-path="JavaScript.html"><a href="JavaScript.html#združevanje-delov-vzorca"><i class="fa fa-check"></i><b>4.12.5</b> Združevanje delov vzorca</a></li>
<li class="chapter" data-level="4.12.6" data-path="JavaScript.html"><a href="JavaScript.html#ujemanje-in-grupiranje"><i class="fa fa-check"></i><b>4.12.6</b> Ujemanje in grupiranje</a></li>
<li class="chapter" data-level="4.12.7" data-path="JavaScript.html"><a href="JavaScript.html#omejevanje-besed"><i class="fa fa-check"></i><b>4.12.7</b> Omejevanje besed</a></li>
<li class="chapter" data-level="4.12.8" data-path="JavaScript.html"><a href="JavaScript.html#vzorci-z-več-možnostmi"><i class="fa fa-check"></i><b>4.12.8</b> Vzorci z več možnostmi</a></li>
<li class="chapter" data-level="4.12.9" data-path="JavaScript.html"><a href="JavaScript.html#zamenjava-podnizov"><i class="fa fa-check"></i><b>4.12.9</b> Zamenjava podnizov</a></li>
<li class="chapter" data-level="4.12.10" data-path="JavaScript.html"><a href="JavaScript.html#požrešna-metoda-ujemanja"><i class="fa fa-check"></i><b>4.12.10</b> Požrešna metoda ujemanja</a></li>
<li class="chapter" data-level="4.12.11" data-path="JavaScript.html"><a href="JavaScript.html#dinamično-kreiranje-regexp-objektov"><i class="fa fa-check"></i><b>4.12.11</b> Dinamično kreiranje <code>RegExp</code> objektov</a></li>
<li class="chapter" data-level="4.12.12" data-path="JavaScript.html"><a href="JavaScript.html#sprehod-po-zadetkih-ujemanja"><i class="fa fa-check"></i><b>4.12.12</b> Sprehod po zadetkih ujemanja</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="JavaScript.html"><a href="JavaScript.html#moduli"><i class="fa fa-check"></i><b>4.13</b> Moduli</a>
<ul>
<li class="chapter" data-level="4.13.1" data-path="JavaScript.html"><a href="JavaScript.html#uporaba-funkcij-v-vlogi-imenskega-prostora"><i class="fa fa-check"></i><b>4.13.1</b> Uporaba funkcij v vlogi imenskega prostora</a></li>
<li class="chapter" data-level="4.13.2" data-path="JavaScript.html"><a href="JavaScript.html#objekti-kot-vmesniki"><i class="fa fa-check"></i><b>4.13.2</b> Objekti kot vmesniki</a></li>
<li class="chapter" data-level="4.13.3" data-path="JavaScript.html"><a href="JavaScript.html#izvajanje-podatkov-v-obliki-kode"><i class="fa fa-check"></i><b>4.13.3</b> Izvajanje podatkov v obliki kode</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="JavaScript.html"><a href="JavaScript.html#javascript-in-spletni-brskalnik"><i class="fa fa-check"></i><b>4.14</b> JavaScript in spletni brskalnik</a>
<ul>
<li class="chapter" data-level="4.14.1" data-path="JavaScript.html"><a href="JavaScript.html#html-in-javascript"><i class="fa fa-check"></i><b>4.14.1</b> HTML in JavaScript</a></li>
<li class="chapter" data-level="4.14.2" data-path="JavaScript.html"><a href="JavaScript.html#zaščiteno-okolje"><i class="fa fa-check"></i><b>4.14.2</b> Zaščiteno okolje</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="JavaScript.html"><a href="JavaScript.html#objektni-model-dokumenta"><i class="fa fa-check"></i><b>4.15</b> Objektni model dokumenta</a>
<ul>
<li class="chapter" data-level="4.15.1" data-path="JavaScript.html"><a href="JavaScript.html#struktura-dokumenta-in-predstavitev-v-obliki-drevesa"><i class="fa fa-check"></i><b>4.15.1</b> Struktura dokumenta in predstavitev v obliki drevesa</a></li>
<li class="chapter" data-level="4.15.2" data-path="JavaScript.html"><a href="JavaScript.html#iskanje-elementov"><i class="fa fa-check"></i><b>4.15.2</b> Iskanje elementov</a></li>
<li class="chapter" data-level="4.15.3" data-path="JavaScript.html"><a href="JavaScript.html#spreminjanje-dokumenta"><i class="fa fa-check"></i><b>4.15.3</b> Spreminjanje dokumenta</a></li>
<li class="chapter" data-level="4.15.4" data-path="JavaScript.html"><a href="JavaScript.html#dodajanje-elementov"><i class="fa fa-check"></i><b>4.15.4</b> Dodajanje elementov</a></li>
<li class="chapter" data-level="4.15.5" data-path="JavaScript.html"><a href="JavaScript.html#uporaba-lastnih-atributov"><i class="fa fa-check"></i><b>4.15.5</b> Uporaba lastnih atributov</a></li>
<li class="chapter" data-level="4.15.6" data-path="JavaScript.html"><a href="JavaScript.html#postavitev-na-strani"><i class="fa fa-check"></i><b>4.15.6</b> Postavitev na strani</a></li>
<li class="chapter" data-level="4.15.7" data-path="JavaScript.html"><a href="JavaScript.html#oblikovanje-in-prekrivni-slogi"><i class="fa fa-check"></i><b>4.15.7</b> Oblikovanje in prekrivni slogi</a></li>
</ul></li>
<li class="chapter" data-level="4.16" data-path="JavaScript.html"><a href="JavaScript.html#obvladovanje-dogodkov"><i class="fa fa-check"></i><b>4.16</b> Obvladovanje dogodkov</a>
<ul>
<li class="chapter" data-level="4.16.1" data-path="JavaScript.html"><a href="JavaScript.html#dogodki-na-html-gradnikih"><i class="fa fa-check"></i><b>4.16.1</b> Dogodki na HTML gradnikih</a></li>
<li class="chapter" data-level="4.16.2" data-path="JavaScript.html"><a href="JavaScript.html#objekt-dogodka"><i class="fa fa-check"></i><b>4.16.2</b> Objekt dogodka</a></li>
<li class="chapter" data-level="4.16.3" data-path="JavaScript.html"><a href="JavaScript.html#širjenje-obvladovanja-dogodkov"><i class="fa fa-check"></i><b>4.16.3</b> Širjenje obvladovanja dogodkov</a></li>
<li class="chapter" data-level="4.16.4" data-path="JavaScript.html"><a href="JavaScript.html#privzete-akcije"><i class="fa fa-check"></i><b>4.16.4</b> Privzete akcije</a></li>
<li class="chapter" data-level="4.16.5" data-path="JavaScript.html"><a href="JavaScript.html#pritisk-tipke-na-tipkovnici"><i class="fa fa-check"></i><b>4.16.5</b> Pritisk tipke na tipkovnici</a></li>
<li class="chapter" data-level="4.16.6" data-path="JavaScript.html"><a href="JavaScript.html#dogodki-z-miško"><i class="fa fa-check"></i><b>4.16.6</b> Dogodki z miško</a></li>
<li class="chapter" data-level="4.16.7" data-path="JavaScript.html"><a href="JavaScript.html#fokusiranje"><i class="fa fa-check"></i><b>4.16.7</b> Fokusiranje</a></li>
<li class="chapter" data-level="4.16.8" data-path="JavaScript.html"><a href="JavaScript.html#dogodek-nalaganja"><i class="fa fa-check"></i><b>4.16.8</b> Dogodek nalaganja</a></li>
<li class="chapter" data-level="4.16.9" data-path="JavaScript.html"><a href="JavaScript.html#časovniki"><i class="fa fa-check"></i><b>4.16.9</b> Časovniki</a></li>
<li class="chapter" data-level="4.16.10" data-path="JavaScript.html"><a href="JavaScript.html#čas-poteka"><i class="fa fa-check"></i><b>4.16.10</b> Čas poteka</a></li>
</ul></li>
<li class="chapter" data-level="4.17" data-path="JavaScript.html"><a href="JavaScript.html#http"><i class="fa fa-check"></i><b>4.17</b> HTTP</a>
<ul>
<li class="chapter" data-level="4.17.1" data-path="JavaScript.html"><a href="JavaScript.html#spletni-brskalniki-in-http"><i class="fa fa-check"></i><b>4.17.1</b> Spletni brskalniki in HTTP</a></li>
<li class="chapter" data-level="4.17.2" data-path="JavaScript.html"><a href="JavaScript.html#posredovanje-zahteve"><i class="fa fa-check"></i><b>4.17.2</b> Posredovanje zahteve</a></li>
<li class="chapter" data-level="4.17.3" data-path="JavaScript.html"><a href="JavaScript.html#http-peskovnik"><i class="fa fa-check"></i><b>4.17.3</b> HTTP peskovnik</a></li>
<li class="chapter" data-level="4.17.4" data-path="JavaScript.html"><a href="JavaScript.html#abstrakcija-zahtev"><i class="fa fa-check"></i><b>4.17.4</b> Abstrakcija zahtev</a></li>
<li class="chapter" data-level="4.17.5" data-path="JavaScript.html"><a href="JavaScript.html#promises"><i class="fa fa-check"></i><b>4.17.5</b> Promises</a></li>
</ul></li>
<li class="chapter" data-level="4.18" data-path="JavaScript.html"><a href="JavaScript.html#spletni-obrazci-in-vnosna-polja"><i class="fa fa-check"></i><b>4.18</b> Spletni obrazci in vnosna polja</a>
<ul>
<li class="chapter" data-level="4.18.1" data-path="JavaScript.html"><a href="JavaScript.html#vnosna-polja"><i class="fa fa-check"></i><b>4.18.1</b> Vnosna polja</a></li>
<li class="chapter" data-level="4.18.2" data-path="JavaScript.html"><a href="JavaScript.html#fokus-vnosa-s-tipkovnico"><i class="fa fa-check"></i><b>4.18.2</b> Fokus vnosa s tipkovnico</a></li>
<li class="chapter" data-level="4.18.3" data-path="JavaScript.html"><a href="JavaScript.html#onemogočeni-elementi-spletnega-obrazca"><i class="fa fa-check"></i><b>4.18.3</b> Onemogočeni elementi spletnega obrazca</a></li>
<li class="chapter" data-level="4.18.4" data-path="JavaScript.html"><a href="JavaScript.html#spletni-obrazec-kot-celota"><i class="fa fa-check"></i><b>4.18.4</b> Spletni obrazec kot celota</a></li>
<li class="chapter" data-level="4.18.5" data-path="JavaScript.html"><a href="JavaScript.html#besedilna-vnosna-polja"><i class="fa fa-check"></i><b>4.18.5</b> Besedilna vnosna polja</a></li>
<li class="chapter" data-level="4.18.6" data-path="JavaScript.html"><a href="JavaScript.html#gradniki-večkratne-izbire"><i class="fa fa-check"></i><b>4.18.6</b> Gradniki (večkratne) izbire</a></li>
<li class="chapter" data-level="4.18.7" data-path="JavaScript.html"><a href="JavaScript.html#izbirna-polja"><i class="fa fa-check"></i><b>4.18.7</b> Izbirna polja</a></li>
<li class="chapter" data-level="4.18.8" data-path="JavaScript.html"><a href="JavaScript.html#vnosno-polje-datoteke"><i class="fa fa-check"></i><b>4.18.8</b> Vnosno polje datoteke</a></li>
<li class="chapter" data-level="4.18.9" data-path="JavaScript.html"><a href="JavaScript.html#shranjevanje-podatkov-na-odjemalcu"><i class="fa fa-check"></i><b>4.18.9</b> Shranjevanje podatkov na odjemalcu</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Node-js.html"><a href="Node-js.html"><i class="fa fa-check"></i><b>5</b> <span class="sklop2 oznaka">P2.2</span> Node.js, MVC in različna okolja</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Node-js.html"><a href="Node-js.html#node.js"><i class="fa fa-check"></i><b>5.1</b> Node.js</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="Node-js.html"><a href="Node-js.html#ozadje-1"><i class="fa fa-check"></i><b>5.1.1</b> Ozadje</a></li>
<li class="chapter" data-level="5.1.2" data-path="Node-js.html"><a href="Node-js.html#asinhronost"><i class="fa fa-check"></i><b>5.1.2</b> Asinhronost</a></li>
<li class="chapter" data-level="5.1.3" data-path="Node-js.html"><a href="Node-js.html#ukaz-node"><i class="fa fa-check"></i><b>5.1.3</b> Ukaz <code>node</code></a></li>
<li class="chapter" data-level="5.1.4" data-path="Node-js.html"><a href="Node-js.html#moduli-1"><i class="fa fa-check"></i><b>5.1.4</b> Moduli</a></li>
<li class="chapter" data-level="5.1.5" data-path="Node-js.html"><a href="Node-js.html#nameščanje-z-npm"><i class="fa fa-check"></i><b>5.1.5</b> Nameščanje z <code>npm</code></a></li>
<li class="chapter" data-level="5.1.6" data-path="Node-js.html"><a href="Node-js.html#modul-za-dostop-do-datotečnega-sistema"><i class="fa fa-check"></i><b>5.1.6</b> Modul za dostop do datotečnega sistema</a></li>
<li class="chapter" data-level="5.1.7" data-path="Node-js.html"><a href="Node-js.html#modul-http"><i class="fa fa-check"></i><b>5.1.7</b> Modul <code>http</code></a></li>
<li class="chapter" data-level="5.1.8" data-path="Node-js.html"><a href="Node-js.html#tok-podatkov"><i class="fa fa-check"></i><b>5.1.8</b> Tok podatkov</a></li>
<li class="chapter" data-level="5.1.9" data-path="Node-js.html"><a href="Node-js.html#enostavni-datotečni-strežnik"><i class="fa fa-check"></i><b>5.1.9</b> Enostavni datotečni strežnik</a></li>
<li class="chapter" data-level="5.1.10" data-path="Node-js.html"><a href="Node-js.html#obvladovanje-napak"><i class="fa fa-check"></i><b>5.1.10</b> Obvladovanje napak</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="Node-js.html"><a href="Node-js.html#vzpostavitev-in-nastavitev-projekta"><i class="fa fa-check"></i><b>5.2</b> Vzpostavitev in nastavitev projekta</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="Node-js.html"><a href="Node-js.html#pregled-uporabljenih-orodij-express-node-in-npm"><i class="fa fa-check"></i><b>5.2.1</b> Pregled uporabljenih orodij Express, Node in <code>npm</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="Node-js.html"><a href="Node-js.html#kreiranje-projekta-express"><i class="fa fa-check"></i><b>5.2.2</b> Kreiranje projekta Express</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="Node-js.html"><a href="Node-js.html#gradnja-aplikacije-z-mvc"><i class="fa fa-check"></i><b>5.3</b> Gradnja aplikacije z MVC</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Node-js.html"><a href="Node-js.html#kratek-pregled-mvc-arhitekture"><i class="fa fa-check"></i><b>5.3.1</b> Kratek pregled MVC arhitekture</a></li>
<li class="chapter" data-level="5.3.2" data-path="Node-js.html"><a href="Node-js.html#kako-express-obdela-zahteve"><i class="fa fa-check"></i><b>5.3.2</b> Kako Express obdela zahteve?</a></li>
<li class="chapter" data-level="5.3.3" data-path="Node-js.html"><a href="Node-js.html#gradnja-statične-aplikacije-z-node-in-express"><i class="fa fa-check"></i><b>5.3.3</b> Gradnja statične aplikacije z Node in Express</a></li>
<li class="chapter" data-level="5.3.4" data-path="Node-js.html"><a href="Node-js.html#prilagoditev-ogrodja-express-za-mvc"><i class="fa fa-check"></i><b>5.3.4</b> Prilagoditev ogrodja Express za MVC</a></li>
<li class="chapter" data-level="5.3.5" data-path="Node-js.html"><a href="Node-js.html#dodajanje-zunanjih-knjižnic-za-prilagoditev-izgleda-strani"><i class="fa fa-check"></i><b>5.3.5</b> Dodajanje zunanjih knjižnic za prilagoditev izgleda strani</a></li>
<li class="chapter" data-level="5.3.6" data-path="Node-js.html"><a href="Node-js.html#opredelitev-usmerjevalnikov-v-express"><i class="fa fa-check"></i><b>5.3.6</b> Opredelitev usmerjevalnikov v Express</a></li>
<li class="chapter" data-level="5.3.7" data-path="Node-js.html"><a href="Node-js.html#izdelava-osnovnih-krmilnikov"><i class="fa fa-check"></i><b>5.3.7</b> Izdelava osnovnih krmilnikov</a></li>
<li class="chapter" data-level="5.3.8" data-path="Node-js.html"><a href="Node-js.html#dopolnitev-pogledov"><i class="fa fa-check"></i><b>5.3.8</b> Dopolnitev pogledov</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="Node-js.html"><a href="Node-js.html#strežba-aplikacije-v-različnih-okoljih"><i class="fa fa-check"></i><b>5.4</b> Strežba aplikacije v različnih okoljih</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="Node-js.html"><a href="Node-js.html#docker"><i class="fa fa-check"></i><b>5.4.1</b> Strežba aplikacije v okolju Docker</a></li>
<li class="chapter" data-level="5.4.2" data-path="Node-js.html"><a href="Node-js.html#strežba-aplikacije-na-fly"><i class="fa fa-check"></i><b>5.4.2</b> Strežba aplikacije na Fly</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III sklop: Zaledni del in dostop do podatkov</b></span></li>
<li class="chapter" data-level="6" data-path="PB-REST-API.html"><a href="PB-REST-API.html"><i class="fa fa-check"></i><b>6</b> <span class="sklop3 oznaka">P3.1</span> Podatkovna baza in REST API</a>
<ul>
<li class="chapter" data-level="6.1" data-path="PB-REST-API.html"><a href="PB-REST-API.html#priprava-podatkovnega-modela-za-mongodb-z-mongoose"><i class="fa fa-check"></i><b>6.1</b> Priprava podatkovnega modela za MongoDB z Mongoose</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="PB-REST-API.html"><a href="PB-REST-API.html#Povezovanje-Express-aplikacije-in-MongoDB-z-Mongoose"><i class="fa fa-check"></i><b>6.1.1</b> Povezovanje Express aplikacije in MongoDB z Mongoose</a></li>
<li class="chapter" data-level="6.1.2" data-path="PB-REST-API.html"><a href="PB-REST-API.html#zakaj-je-treba-modelirati-podatke"><i class="fa fa-check"></i><b>6.1.2</b> Zakaj je treba modelirati podatke?</a></li>
<li class="chapter" data-level="6.1.3" data-path="PB-REST-API.html"><a href="PB-REST-API.html#podatki-iz-registra"><i class="fa fa-check"></i><b>6.1.3</b> Podatki iz registra kulturne dediščine</a></li>
<li class="chapter" data-level="6.1.4" data-path="PB-REST-API.html"><a href="PB-REST-API.html#opredelitev-sheme-z-mongoose"><i class="fa fa-check"></i><b>6.1.4</b> Opredelitev sheme z Mongoose</a></li>
<li class="chapter" data-level="6.1.5" data-path="PB-REST-API.html"><a href="PB-REST-API.html#Uporaba-MongoDB-ukazne-lupine-za-dodajanje-podatkov"><i class="fa fa-check"></i><b>6.1.5</b> Uporaba MongoDB ukazne lupine za dodajanje podatkov</a></li>
<li class="chapter" data-level="6.1.6" data-path="PB-REST-API.html"><a href="PB-REST-API.html#uvoz-testnih-podatkov"><i class="fa fa-check"></i><b>6.1.6</b> Uvoz testnih podatkov</a></li>
<li class="chapter" data-level="6.1.7" data-path="PB-REST-API.html"><a href="PB-REST-API.html#vključitev-podatkovne-baze"><i class="fa fa-check"></i><b>6.1.7</b> Vključitev podatkovne baze</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="PB-REST-API.html"><a href="PB-REST-API.html#priprava-rest-api-ja-za-dostop-do-mongodb-podatkovne-baze"><i class="fa fa-check"></i><b>6.2</b> Priprava REST API-ja za dostop do MongoDB podatkovne baze</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="PB-REST-API.html"><a href="PB-REST-API.html#rest-api"><i class="fa fa-check"></i><b>6.2.1</b> REST API</a></li>
<li class="chapter" data-level="6.2.2" data-path="PB-REST-API.html"><a href="PB-REST-API.html#url-zahteva"><i class="fa fa-check"></i><b>6.2.2</b> URL zahteva</a></li>
<li class="chapter" data-level="6.2.3" data-path="PB-REST-API.html"><a href="PB-REST-API.html#metoda-zahteve"><i class="fa fa-check"></i><b>6.2.3</b> Metoda zahteve</a></li>
<li class="chapter" data-level="6.2.4" data-path="PB-REST-API.html"><a href="PB-REST-API.html#odgovor-podatek-in-status-api-ja"><i class="fa fa-check"></i><b>6.2.4</b> Odgovor (podatek in status) API-ja</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="PB-REST-API.html"><a href="PB-REST-API.html#Implementacija-API-ja-z-ogrodjem-Express"><i class="fa fa-check"></i><b>6.3</b> Implementacija API-ja z ogrodjem Express</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="PB-REST-API.html"><a href="PB-REST-API.html#priprava-usmerjevalnika"><i class="fa fa-check"></i><b>6.3.1</b> Priprava usmerjevalnika</a></li>
<li class="chapter" data-level="6.3.2" data-path="PB-REST-API.html"><a href="PB-REST-API.html#priprava-osnutka-krmilnika"><i class="fa fa-check"></i><b>6.3.2</b> Priprava osnutka krmilnika</a></li>
<li class="chapter" data-level="6.3.3" data-path="PB-REST-API.html"><a href="PB-REST-API.html#testiranje-osnutka-api-ja"><i class="fa fa-check"></i><b>6.3.3</b> Testiranje osnutka API-ja</a></li>
<li class="chapter" data-level="6.3.4" data-path="PB-REST-API.html"><a href="PB-REST-API.html#vključitev-modela"><i class="fa fa-check"></i><b>6.3.4</b> Vključitev modela</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="PB-REST-API.html"><a href="PB-REST-API.html#get-metode-za-branje-podatkov-iz-mongodb"><i class="fa fa-check"></i><b>6.4</b> GET metode za branje podatkov iz MongoDB</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="PB-REST-API.html"><a href="PB-REST-API.html#iskanje-dokumenta"><i class="fa fa-check"></i><b>6.4.1</b> Iskanje dokumenta</a></li>
<li class="chapter" data-level="6.4.2" data-path="PB-REST-API.html"><a href="PB-REST-API.html#iskanje-odvisnega-dokumenta"><i class="fa fa-check"></i><b>6.4.2</b> Iskanje odvisnega dokumenta</a></li>
<li class="chapter" data-level="6.4.3" data-path="PB-REST-API.html"><a href="PB-REST-API.html#geografsko-iskanje"><i class="fa fa-check"></i><b>6.4.3</b> Geografsko iskanje več dokumentov</a></li>
<li class="chapter" data-level="6.4.4" data-path="PB-REST-API.html"><a href="PB-REST-API.html#napredno-iskanje"><i class="fa fa-check"></i><b>6.4.4</b> Napredno iskanje</a></li>
<li class="chapter" data-level="6.4.5" data-path="PB-REST-API.html"><a href="PB-REST-API.html#seznami-sifrantov"><i class="fa fa-check"></i><b>6.4.5</b> Seznami šifrantov</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Swagger.html"><a href="Swagger.html"><i class="fa fa-check"></i><b>7</b> <span class="sklop3 oznaka">P3.2</span> Načrtovanje s Swagger in OpenAPI</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Swagger.html"><a href="Swagger.html#dokumentiranje-rest-api-ja-z-openapi-specifikacijo"><i class="fa fa-check"></i><b>7.1</b> Dokumentiranje REST API-ja z OpenAPI specifikacijo</a></li>
<li class="chapter" data-level="7.2" data-path="Swagger.html"><a href="Swagger.html#post-metode-za-dodajanje-podatkov-v-mongodb"><i class="fa fa-check"></i><b>7.2</b> POST metode za dodajanje podatkov v MongoDB</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="Swagger.html"><a href="Swagger.html#dodajanje-novih-dokumentov-v-mongodb"><i class="fa fa-check"></i><b>7.2.1</b> Dodajanje novih dokumentov v MongoDB</a></li>
<li class="chapter" data-level="7.2.2" data-path="Swagger.html"><a href="Swagger.html#dodajanje-odvisnih-dokumentov-v-mongodb"><i class="fa fa-check"></i><b>7.2.2</b> Dodajanje odvisnih dokumentov v MongoDB</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="Swagger.html"><a href="Swagger.html#put-metode-za-ažuriranje-podatkov-v-mongodb"><i class="fa fa-check"></i><b>7.3</b> PUT metode za ažuriranje podatkov v MongoDB</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Swagger.html"><a href="Swagger.html#posodobitev-obstoječega-dokumenta-v-mongodb"><i class="fa fa-check"></i><b>7.3.1</b> Posodobitev obstoječega dokumenta v MongoDB</a></li>
<li class="chapter" data-level="7.3.2" data-path="Swagger.html"><a href="Swagger.html#PUT-odvisni-dokument"><i class="fa fa-check"></i><b>7.3.2</b> Posodobitev obstoječega odvisnega dokumenta v MongoDB</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="Swagger.html"><a href="Swagger.html#delete-metode-za-brisanje-podatkov-iz-mongodb"><i class="fa fa-check"></i><b>7.4</b> DELETE metode za brisanje podatkov iz MongoDB</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="Swagger.html"><a href="Swagger.html#DELETE-comment"><i class="fa fa-check"></i><b>7.4.1</b> Brisanje obstoječega komentarja</a></li>
<li class="chapter" data-level="7.4.2" data-path="Swagger.html"><a href="Swagger.html#brisanje-dokumentov"><i class="fa fa-check"></i><b>7.4.2</b> Brisanje dokumentov</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="Swagger.html"><a href="Swagger.html#uporaba-rest-api-ja-v-express-aplikaciji"><i class="fa fa-check"></i><b>7.5</b> Uporaba REST API-ja v Express aplikaciji</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="Swagger.html"><a href="Swagger.html#priprava-na-api-klic-iz-express-aplikacije"><i class="fa fa-check"></i><b>7.5.1</b> Priprava na API klic iz Express aplikacije</a></li>
<li class="chapter" data-level="7.5.2" data-path="Swagger.html"><a href="Swagger.html#pridobitev-seznama-lokacij-preko-api-ja"><i class="fa fa-check"></i><b>7.5.2</b> Pridobitev seznama lokacij preko API-ja</a></li>
<li class="chapter" data-level="7.5.3" data-path="Swagger.html"><a href="Swagger.html#priprava-novega-pogleda-seznama"><i class="fa fa-check"></i><b>7.5.3</b> Priprava novega pogleda seznama</a></li>
<li class="chapter" data-level="7.5.4" data-path="Swagger.html"><a href="Swagger.html#axios-zunanji-viri"><i class="fa fa-check"></i><b>7.5.4</b> Vključitev ostalih podatkov iz zunanjih virov</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="Swagger.html"><a href="Swagger.html#izboljšanje-zmogljivosti-api-ja"><i class="fa fa-check"></i><b>7.6</b> Izboljšanje zmogljivosti API-ja</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="Swagger.html"><a href="Swagger.html#porazdelitev-po-straneh"><i class="fa fa-check"></i><b>7.6.1</b> Porazdelitev po straneh</a></li>
<li class="chapter" data-level="7.6.2" data-path="Swagger.html"><a href="Swagger.html#asinhrono-beleženje"><i class="fa fa-check"></i><b>7.6.2</b> Asinhrono beleženje</a></li>
<li class="chapter" data-level="7.6.3" data-path="Swagger.html"><a href="Swagger.html#predpomnjenje"><i class="fa fa-check"></i><b>7.6.3</b> Predpomnjenje</a></li>
<li class="chapter" data-level="7.6.4" data-path="Swagger.html"><a href="Swagger.html#stiskanje-koristne-vsebine"><i class="fa fa-check"></i><b>7.6.4</b> Stiskanje koristne vsebine</a></li>
<li class="chapter" data-level="7.6.5" data-path="Swagger.html"><a href="Swagger.html#bazen-povezav"><i class="fa fa-check"></i><b>7.6.5</b> Bazen povezav</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV sklop: Uporabniški vmesnik</b></span></li>
<li class="chapter" data-level="8" data-path="Angular.html"><a href="Angular.html"><i class="fa fa-check"></i><b>8</b> <span class="sklop4 oznaka">P4.1</span> TypeScript in Angular</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Angular.html"><a href="Angular.html#Dodajanje-Angular-komponent-v-Express-aplikacijo"><i class="fa fa-check"></i><b>8.1</b> Dodajanje Angular komponent v Express aplikacijo</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="Angular.html"><a href="Angular.html#namestitev-ogrodja-angular"><i class="fa fa-check"></i><b>8.1.1</b> Namestitev ogrodja Angular</a></li>
<li class="chapter" data-level="8.1.2" data-path="Angular.html"><a href="Angular.html#jezik-typescript"><i class="fa fa-check"></i><b>8.1.2</b> Jezik TypeScript</a></li>
<li class="chapter" data-level="8.1.3" data-path="Angular.html"><a href="Angular.html#kreiranje-in-zagon-angular-aplikacije"><i class="fa fa-check"></i><b>8.1.3</b> Kreiranje in zagon Angular aplikacije</a></li>
<li class="chapter" data-level="8.1.4" data-path="Angular.html"><a href="Angular.html#Izvorna-koda-Angular-aplikacije"><i class="fa fa-check"></i><b>8.1.4</b> Izvorna koda Angular aplikacije</a></li>
<li class="chapter" data-level="8.1.5" data-path="Angular.html"><a href="Angular.html#generiranje-angular-aplikacije-v-jeziku-javascript"><i class="fa fa-check"></i><b>8.1.5</b> Generiranje Angular aplikacije v jeziku JavaScript</a></li>
<li class="chapter" data-level="8.1.6" data-path="Angular.html"><a href="Angular.html#komponenta-za-prikaz-podatkov"><i class="fa fa-check"></i><b>8.1.6</b> Komponenta za prikaz podatkov</a></li>
<li class="chapter" data-level="8.1.7" data-path="Angular.html"><a href="Angular.html#Pridobivanje-podatkov-preko-REST-API-ja"><i class="fa fa-check"></i><b>8.1.7</b> Pridobivanje podatkov preko REST API-ja</a></li>
<li class="chapter" data-level="8.1.8" data-path="Angular.html"><a href="Angular.html#prenos-angular-aplikacije-v-produkcijsko-okolje"><i class="fa fa-check"></i><b>8.1.8</b> Prenos Angular aplikacije v produkcijsko okolje</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="Angular.html"><a href="Angular.html#izdelava-angular-spa-aplikacije-na-eni-strani"><i class="fa fa-check"></i><b>8.2</b> Izdelava Angular SPA aplikacije na eni strani</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="Angular.html"><a href="Angular.html#Prehod-iz-Express-usmerjanja-na-Angular-usmerjanje"><i class="fa fa-check"></i><b>8.2.1</b> Prehod iz Express usmerjanja na Angular usmerjanje</a></li>
<li class="chapter" data-level="8.2.2" data-path="Angular.html"><a href="Angular.html#navigacija-med-stranmi"><i class="fa fa-check"></i><b>8.2.2</b> Navigacija med stranmi</a></li>
<li class="chapter" data-level="8.2.3" data-path="Angular.html"><a href="Angular.html#modularna-zasnova-aplikacije-z-vgnezdenimi-komponentami"><i class="fa fa-check"></i><b>8.2.3</b> Modularna zasnova aplikacije z vgnezdenimi komponentami</a></li>
<li class="chapter" data-level="8.2.4" data-path="Angular.html"><a href="Angular.html#dodajanje-html-geolokacije-za-iskanje-bližnjih-lokacij"><i class="fa fa-check"></i><b>8.2.4</b> Dodajanje HTML geolokacije za iskanje bližnjih lokacij</a></li>
<li class="chapter" data-level="8.2.5" data-path="Angular.html"><a href="Angular.html#prikaz-zvezdic-v-obliki-ponovno-uporabne-komponente"><i class="fa fa-check"></i><b>8.2.5</b> Prikaz zvezdic v obliki ponovno uporabne komponente</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Angular-SPA.html"><a href="Angular-SPA.html"><i class="fa fa-check"></i><b>9</b> <span class="sklop4 oznaka">P4.2</span> Angular SPA</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Angular-SPA.html"><a href="Angular-SPA.html#kompleksnejši-pogledi-s-parametri-usmerjevanja"><i class="fa fa-check"></i><b>9.1</b> Kompleksnejši pogledi s parametri usmerjevanja</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Angular-SPA.html"><a href="Angular-SPA.html#sprememba-strukture-strani"><i class="fa fa-check"></i><b>9.1.1</b> Sprememba strukture strani</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="Angular-SPA.html"><a href="Angular-SPA.html#dodajanje-usmerjanja-z-url-parametri"><i class="fa fa-check"></i><b>9.2</b> Dodajanje usmerjanja z URL parametri</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="Angular-SPA.html"><a href="Angular-SPA.html#prenos-podatkov-do-komponente-s-podrobnostmi-lokacije"><i class="fa fa-check"></i><b>9.2.1</b> Prenos podatkov do komponente s podrobnostmi lokacije</a></li>
<li class="chapter" data-level="9.2.2" data-path="Angular-SPA.html"><a href="Angular-SPA.html#pogled-podrobnosti-lokacije"><i class="fa fa-check"></i><b>9.2.2</b> Pogled podrobnosti lokacije</a></li>
<li class="chapter" data-level="9.2.3" data-path="Angular-SPA.html"><a href="Angular-SPA.html#varnostne-izjeme-pri-prikazovanju-zunanjih-podatkov"><i class="fa fa-check"></i><b>9.2.3</b> Varnostne izjeme pri prikazovanju zunanjih podatkov</a></li>
<li class="chapter" data-level="9.2.4" data-path="Angular-SPA.html"><a href="Angular-SPA.html#sprememba-vrstnega-reda-prikaza-komentarjev"><i class="fa fa-check"></i><b>9.2.4</b> Sprememba vrstnega reda prikaza komentarjev</a></li>
<li class="chapter" data-level="9.2.5" data-path="Angular-SPA.html"><a href="Angular-SPA.html#formatiranje-datuma"><i class="fa fa-check"></i><b>9.2.5</b> Formatiranje datuma</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="Angular-SPA.html"><a href="Angular-SPA.html#delo-s-spletnimi-obrazci-in-pošiljanje-podatkov"><i class="fa fa-check"></i><b>9.3</b> Delo s spletnimi obrazci in pošiljanje podatkov</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="Angular-SPA.html"><a href="Angular-SPA.html#priprava-modalnega-okna"><i class="fa fa-check"></i><b>9.3.1</b> Priprava modalnega okna</a></li>
<li class="chapter" data-level="9.3.2" data-path="Angular-SPA.html"><a href="Angular-SPA.html#dodajanje-spletnega-obrazca"><i class="fa fa-check"></i><b>9.3.2</b> Dodajanje spletnega obrazca</a></li>
<li class="chapter" data-level="9.3.3" data-path="Angular-SPA.html"><a href="Angular-SPA.html#povezovanje-podatkov-in-vnosnih-polj-obrazca"><i class="fa fa-check"></i><b>9.3.3</b> Povezovanje podatkov in vnosnih polj obrazca</a></li>
<li class="chapter" data-level="9.3.4" data-path="Angular-SPA.html"><a href="Angular-SPA.html#posredovanje-podatkov-spletnega-obrazca-na-rest-api"><i class="fa fa-check"></i><b>9.3.4</b> Posredovanje podatkov spletnega obrazca na REST API</a></li>
<li class="chapter" data-level="9.3.5" data-path="Angular-SPA.html"><a href="Angular-SPA.html#brisanje-komentarjev"><i class="fa fa-check"></i><b>9.3.5</b> Brisanje komentarjev</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="Angular-SPA.html"><a href="Angular-SPA.html#izboljšava-arhitekture"><i class="fa fa-check"></i><b>9.4</b> Izboljšava arhitekture</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="Angular-SPA.html"><a href="Angular-SPA.html#locitev-usmerjanja"><i class="fa fa-check"></i><b>9.4.1</b> Ločitev usmerjanja</a></li>
<li class="chapter" data-level="9.4.2" data-path="Angular-SPA.html"><a href="Angular-SPA.html#opredelitev-razredov"><i class="fa fa-check"></i><b>9.4.2</b> Opredelitev razredov</a></li>
<li class="chapter" data-level="9.4.3" data-path="Angular-SPA.html"><a href="Angular-SPA.html#Organizacija-izvorne-kode-v-mape"><i class="fa fa-check"></i><b>9.4.3</b> Organizacija izvorne kode v mape</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="Angular-SPA.html"><a href="Angular-SPA.html#zamenjava-strežniške-aplikacije-s-spa-aplikacijo"><i class="fa fa-check"></i><b>9.5</b> Zamenjava strežniške aplikacije s SPA aplikacijo</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="Angular-SPA.html"><a href="Angular-SPA.html#preusmeritev-zahtev-na-angular-spa"><i class="fa fa-check"></i><b>9.5.1</b> Preusmeritev zahtev na Angular SPA</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="Angular-SPA.html"><a href="Angular-SPA.html#dodatni-gradniki-angular-aplikacije"><i class="fa fa-check"></i><b>9.6</b> Dodatni gradniki Angular aplikacije</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Avtentikacija.html"><a href="Avtentikacija.html"><i class="fa fa-check"></i><b>10</b> <span class="sklop4 oznaka">P4.3</span> Preverjanje istovetnosti uporabnika</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#način-avtentikacije-z-uporabo-mean-sklada-tehnologij"><i class="fa fa-check"></i><b>10.1</b> Način avtentikacije z uporabo MEAN sklada tehnologij</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#klasični-pristop-avtentikacije-pri-strežniški-aplikaciji"><i class="fa fa-check"></i><b>10.1.1</b> Klasični pristop avtentikacije pri strežniški aplikaciji</a></li>
<li class="chapter" data-level="10.1.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#avtentikacija-z-mean-skladom-tehnologij"><i class="fa fa-check"></i><b>10.1.2</b> Avtentikacija z MEAN skladom tehnologij</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#kreiranje-sheme-uporabnikov-v-mongodb"><i class="fa fa-check"></i><b>10.2</b> Kreiranje sheme uporabnikov v MongoDB</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#enosmerno-šifriranje-gesel"><i class="fa fa-check"></i><b>10.2.1</b> Enosmerno šifriranje gesel</a></li>
<li class="chapter" data-level="10.2.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#Kreiranje-sheme-z-Mongoose"><i class="fa fa-check"></i><b>10.2.2</b> Kreiranje sheme z Mongoose</a></li>
<li class="chapter" data-level="10.2.3" data-path="Avtentikacija.html"><a href="Avtentikacija.html#šifriranje-uporabniškega-gesla"><i class="fa fa-check"></i><b>10.2.3</b> Šifriranje uporabniškega gesla</a></li>
<li class="chapter" data-level="10.2.4" data-path="Avtentikacija.html"><a href="Avtentikacija.html#preverjanje-ustreznosti-podanega-gesla"><i class="fa fa-check"></i><b>10.2.4</b> Preverjanje ustreznosti podanega gesla</a></li>
<li class="chapter" data-level="10.2.5" data-path="Avtentikacija.html"><a href="Avtentikacija.html#generiranje-json-spletnega-žetona-jwt"><i class="fa fa-check"></i><b>10.2.5</b> Generiranje JSON spletnega žetona (JWT)</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="Avtentikacija.html"><a href="Avtentikacija.html#Priprava-API-ja-za-avtentikacijo"><i class="fa fa-check"></i><b>10.3</b> Priprava API-ja za avtentikacijo</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#namestitev-in-konfiguracija-passporta"><i class="fa fa-check"></i><b>10.3.1</b> Namestitev in konfiguracija Passporta</a></li>
<li class="chapter" data-level="10.3.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt"><i class="fa fa-check"></i><b>10.3.2</b> Kreiranje API dostopne točke in vračanje JSON spletnih žetonov (JWT)</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="Avtentikacija.html"><a href="Avtentikacija.html#Varnostna-zascita-izbranih-API-dostopnih-tock"><i class="fa fa-check"></i><b>10.4</b> Varnostna zaščita izbranih API dostopnih točk</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju"><i class="fa fa-check"></i><b>10.4.1</b> Dodajanje vmesne avtentikacijske ravni pri Express usmerjanju</a></li>
<li class="chapter" data-level="10.4.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#uporaba-informacij-iz-jwt-v-express-krmilniku"><i class="fa fa-check"></i><b>10.4.2</b> Uporaba informacij iz JWT v Express krmilniku</a></li>
<li class="chapter" data-level="10.4.3" data-path="Avtentikacija.html"><a href="Avtentikacija.html#avtorizacija-azuriranje"><i class="fa fa-check"></i><b>10.4.3</b> Avtorizacija pri ažuriranju komentarja</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="Avtentikacija.html"><a href="Avtentikacija.html#Priprava-storitve-avtentikacije-v-Angular"><i class="fa fa-check"></i><b>10.5</b> Priprava storitve avtentikacije v Angular</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#obvladovanje-seje-uporabnika-v-angular"><i class="fa fa-check"></i><b>10.5.1</b> Obvladovanje seje uporabnika v Angular</a></li>
<li class="chapter" data-level="10.5.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#omogočanje-registracije-prijave-in-odjave-uporabnikov"><i class="fa fa-check"></i><b>10.5.2</b> Omogočanje registracije, prijave in odjave uporabnikov</a></li>
<li class="chapter" data-level="10.5.3" data-path="Avtentikacija.html"><a href="Avtentikacija.html#uporaba-podatkov-iz-jwt-v-angular-storitvi"><i class="fa fa-check"></i><b>10.5.3</b> Uporaba podatkov iz JWT v Angular storitvi</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="Avtentikacija.html"><a href="Avtentikacija.html#Priprava-strani-za-registracijo-in-prijavo-uporabnika"><i class="fa fa-check"></i><b>10.6</b> Priprava strani za registracijo in prijavo uporabnika</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#priprava-strani-za-registracijo"><i class="fa fa-check"></i><b>10.6.1</b> Priprava strani za registracijo</a></li>
<li class="chapter" data-level="10.6.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#priprava-strani-za-prijavo"><i class="fa fa-check"></i><b>10.6.2</b> Priprava strani za prijavo</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="Avtentikacija.html"><a href="Avtentikacija.html#uporaba-avtentikacije-v-angular-aplikaciji"><i class="fa fa-check"></i><b>10.7</b> Uporaba avtentikacije v Angular aplikaciji</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#posodobitev-navigacije"><i class="fa fa-check"></i><b>10.7.1</b> Posodobitev navigacije</a></li>
<li class="chapter" data-level="10.7.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#podpora-zgodovini-brskanja"><i class="fa fa-check"></i><b>10.7.2</b> Podpora zgodovini brskanja</a></li>
<li class="chapter" data-level="10.7.3" data-path="Avtentikacija.html"><a href="Avtentikacija.html#dodajanje-uporabnika-v-komentar"><i class="fa fa-check"></i><b>10.7.3</b> Dodajanje uporabniških podatkov v komentar</a></li>
<li class="chapter" data-level="10.7.4" data-path="Avtentikacija.html"><a href="Avtentikacija.html#brisanje-lastnih-komentarjev"><i class="fa fa-check"></i><b>10.7.4</b> Brisanje lastnih komentarjev</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="Avtentikacija.html"><a href="Avtentikacija.html#nastavitve-v-brskalniku"><i class="fa fa-check"></i><b>10.8</b> Shranjevanje uporabniških nastavitev v brskalniku</a></li>
<li class="chapter" data-level="10.9" data-path="Avtentikacija.html"><a href="Avtentikacija.html#auth-guard"><i class="fa fa-check"></i><b>10.9</b> Auth Guard</a>
<ul>
<li class="chapter" data-level="10.9.1" data-path="Avtentikacija.html"><a href="Avtentikacija.html#vrste"><i class="fa fa-check"></i><b>10.9.1</b> Vrste</a></li>
<li class="chapter" data-level="10.9.2" data-path="Avtentikacija.html"><a href="Avtentikacija.html#canRegister"><i class="fa fa-check"></i><b>10.9.2</b> Onemogočenje registracije prijavljenim uporabnikom</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V sklop: Decentralizirane aplikacije in veriga blokov</b></span></li>
<li class="chapter" data-level="11" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html"><i class="fa fa-check"></i><b>11</b> <span class="sklop5 oznaka">P5.1</span> DApps, pametne pogodbe in Solidity</a>
<ul>
<li class="chapter" data-level="11.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#decentralizirane-aplikacije"><i class="fa fa-check"></i><b>11.1</b> Decentralizirane aplikacije</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#kaj-je-decentralizirana-aplikacija-dapp"><i class="fa fa-check"></i><b>11.1.1</b> Kaj je decentralizirana aplikacija (DApp)?</a></li>
<li class="chapter" data-level="11.1.2" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#omrežje-ethereum"><i class="fa fa-check"></i><b>11.1.2</b> Omrežje Ethereum</a></li>
<li class="chapter" data-level="11.1.3" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#terminologija-dapp"><i class="fa fa-check"></i><b>11.1.3</b> Terminologija DApp</a></li>
<li class="chapter" data-level="11.1.4" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#decentralizirane-in-porazdeljene-aplikacije"><i class="fa fa-check"></i><b>11.1.4</b> Decentralizirane in porazdeljene aplikacije</a></li>
<li class="chapter" data-level="11.1.5" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#primeri-dobrih-praks"><i class="fa fa-check"></i><b>11.1.5</b> Primeri dobrih praks</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#veriga-blokov"><i class="fa fa-check"></i><b>11.2</b> Veriga blokov</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#sklad-tehnologij-za-podporo-dapp"><i class="fa fa-check"></i><b>11.2.1</b> Sklad tehnologij za podporo DApp</a></li>
<li class="chapter" data-level="11.2.2" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#podrobnosti-vozlišča-ethereum"><i class="fa fa-check"></i><b>11.2.2</b> Podrobnosti vozlišča Ethereum</a></li>
<li class="chapter" data-level="11.2.3" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#življenjski-cikel-transakcije"><i class="fa fa-check"></i><b>11.2.3</b> Življenjski cikel transakcije</a></li>
<li class="chapter" data-level="11.2.4" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#razvijalski-pogled-na-postavitev-pametne-pogodbe"><i class="fa fa-check"></i><b>11.2.4</b> Razvijalski pogled na postavitev pametne pogodbe</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#platforma-ethereum"><i class="fa fa-check"></i><b>11.3</b> Platforma Ethereum</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#pametne-pogodbe-kot-osnova-dapp"><i class="fa fa-check"></i><b>11.3.1</b> Pametne pogodbe kot osnova DApp</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#programiranje-pametnih-pogodb-s-solidity"><i class="fa fa-check"></i><b>11.4</b> Programiranje pametnih pogodb s Solidity</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#Struktura-pogodbe"><i class="fa fa-check"></i><b>11.4.1</b> Struktura pogodbe</a></li>
<li class="chapter" data-level="11.4.2" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#razvoj-enostavne-pogodbe"><i class="fa fa-check"></i><b>11.4.2</b> Razvoj enostavne pogodbe</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#razvoj-kompleksnih-pametnih-pogodb"><i class="fa fa-check"></i><b>11.5</b> Razvoj kompleksnih pametnih pogodb</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#spremenljivke-stanja"><i class="fa fa-check"></i><b>11.5.1</b> Spremenljivke stanja</a></li>
<li class="chapter" data-level="11.5.2" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#konstruktor"><i class="fa fa-check"></i><b>11.5.2</b> Konstruktor</a></li>
<li class="chapter" data-level="11.5.3" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#funkcije-za-podporo-množični-prodaji"><i class="fa fa-check"></i><b>11.5.3</b> Funkcije za podporo množični prodaji</a></li>
<li class="chapter" data-level="11.5.4" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#testiranje-množične-prodaje"><i class="fa fa-check"></i><b>11.5.4</b> Testiranje množične prodaje</a></li>
<li class="chapter" data-level="11.5.5" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#večkratno-dedovanje"><i class="fa fa-check"></i><b>11.5.5</b> Večkratno dedovanje</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#objektno-usmerjene-lastnosti-pametnih-pogodb"><i class="fa fa-check"></i><b>11.6</b> Objektno usmerjene lastnosti pametnih pogodb</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#dedovanje"><i class="fa fa-check"></i><b>11.6.1</b> Dedovanje</a></li>
<li class="chapter" data-level="11.6.2" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#abstraktne-pogodbe"><i class="fa fa-check"></i><b>11.6.2</b> Abstraktne pogodbe</a></li>
<li class="chapter" data-level="11.6.3" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#vmesniki"><i class="fa fa-check"></i><b>11.6.3</b> Vmesniki</a></li>
<li class="chapter" data-level="11.6.4" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#knjižnice"><i class="fa fa-check"></i><b>11.6.4</b> Knjižnice</a></li>
<li class="chapter" data-level="11.6.5" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#skladnost-s-standardom-erc20"><i class="fa fa-check"></i><b>11.6.5</b> Skladnost s standardom <code>ERC20</code></a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="DApps-pametne-pogodbe.html"><a href="DApps-pametne-pogodbe.html#ekosistem-ethereum"><i class="fa fa-check"></i><b>11.7</b> Ekosistem Ethereum</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LP2.html"><a href="LP2.html"><i class="fa fa-check"></i><b>12</b> <span class="sklop5 oznaka">2. LP</span> Decentralizirana aplikacija na verigi blokov</a>
<ul>
<li class="chapter" data-level="12.1" data-path="LP2.html"><a href="LP2.html#pravila-zahteve-in-omejitve-1"><i class="fa fa-check"></i><b>12.1</b> Pravila, zahteve in omejitve</a></li>
<li class="chapter" data-level="12.2" data-path="LP2.html"><a href="LP2.html#kriteriji-vrednotenja-1"><i class="fa fa-check"></i><b>12.2</b> Kriteriji vrednotenja</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html"><i class="fa fa-check"></i><b>13</b> <span class="sklop5 oznaka">P5.2</span> Truffle in Web3</a>
<ul>
<li class="chapter" data-level="13.1" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#izdelava-decentralizirane-aplikacije"><i class="fa fa-check"></i><b>13.1</b> Izdelava decentralizirane aplikacije</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#opredelitev-zahtev-decentralizirane-aplikacije-za-glasovanje"><i class="fa fa-check"></i><b>13.1.1</b> Opredelitev zahtev decentralizirane aplikacije za glasovanje</a></li>
<li class="chapter" data-level="13.1.2" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#razvojni-načrt"><i class="fa fa-check"></i><b>13.1.2</b> Razvojni načrt</a></li>
<li class="chapter" data-level="13.1.3" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#Truffle-projekt"><i class="fa fa-check"></i><b>13.1.3</b> Truffle projekt</a></li>
<li class="chapter" data-level="13.1.4" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#razvoj-pametne-pogodbe"><i class="fa fa-check"></i><b>13.1.4</b> Razvoj pametne pogodbe</a></li>
<li class="chapter" data-level="13.1.5" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#lastna-privatna-veriga-blokov"><i class="fa fa-check"></i><b>13.1.5</b> Lastna privatna veriga blokov</a></li>
<li class="chapter" data-level="13.1.6" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#prevajanje-in-postavitev-pametne-pogodbe"><i class="fa fa-check"></i><b>13.1.6</b> Prevajanje in postavitev pametne pogodbe</a></li>
<li class="chapter" data-level="13.1.7" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#testi-enot"><i class="fa fa-check"></i><b>13.1.7</b> Testi enot</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#uporabniški-vmesnik"><i class="fa fa-check"></i><b>13.2</b> Uporabniški vmesnik</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#priprava-odvisnosti"><i class="fa fa-check"></i><b>13.2.1</b> Priprava odvisnosti</a></li>
<li class="chapter" data-level="13.2.2" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#spletna-stran"><i class="fa fa-check"></i><b>13.2.2</b> Spletna stran</a></li>
<li class="chapter" data-level="13.2.3" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#web3-aplikacija-kot-angular-komponenta"><i class="fa fa-check"></i><b>13.2.3</b> Web3 aplikacija kot Angular komponenta</a></li>
<li class="chapter" data-level="13.2.4" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#opredelitev-izgleda"><i class="fa fa-check"></i><b>13.2.4</b> Opredelitev izgleda</a></li>
<li class="chapter" data-level="13.2.5" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#povezava-na-verigo-blokov"><i class="fa fa-check"></i><b>13.2.5</b> Povezava na verigo blokov</a></li>
<li class="chapter" data-level="13.2.6" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#podpora-funkcionalnostim-neregistriranega-volivca"><i class="fa fa-check"></i><b>13.2.6</b> Podpora funkcionalnostim neregistriranega volivca</a></li>
<li class="chapter" data-level="13.2.7" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#podpora-funkcionalnostim-registriranega-volivca"><i class="fa fa-check"></i><b>13.2.7</b> Podpora funkcionalnostim registriranega volivca</a></li>
<li class="chapter" data-level="13.2.8" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#podpora-funkcionalnostim-skrbnika"><i class="fa fa-check"></i><b>13.2.8</b> Podpora funkcionalnostim skrbnika</a></li>
<li class="chapter" data-level="13.2.9" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#obvladovanje-dogodkov-v-okviru-dapp"><i class="fa fa-check"></i><b>13.2.9</b> Obvladovanje dogodkov v okviru DApp</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#testiranje-decentralizirane-aplikacije-za-glasovanje"><i class="fa fa-check"></i><b>13.3</b> Testiranje decentralizirane aplikacije za glasovanje</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#zagon-osebne-verige-blokov-ganache"><i class="fa fa-check"></i><b>13.3.1</b> Zagon osebne verige blokov Ganache</a></li>
<li class="chapter" data-level="13.3.2" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#dostop-do-racunov-metamask"><i class="fa fa-check"></i><b>13.3.2</b> Dostop do računov preko MetaMask</a></li>
<li class="chapter" data-level="13.3.3" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#postavitev-pametne-pogodbe-na-verigo-blokov"><i class="fa fa-check"></i><b>13.3.3</b> Postavitev pametne pogodbe na verigo blokov</a></li>
<li class="chapter" data-level="13.3.4" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#povezovanje-metamask-z-dapp"><i class="fa fa-check"></i><b>13.3.4</b> Povezovanje MetaMask z DApp</a></li>
<li class="chapter" data-level="13.3.5" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#faza-registracije-volivcev"><i class="fa fa-check"></i><b>13.3.5</b> Faza registracije volivcev</a></li>
<li class="chapter" data-level="13.3.6" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#faza-začetka-sprejemanja-predlogov"><i class="fa fa-check"></i><b>13.3.6</b> Faza začetka sprejemanja predlogov</a></li>
<li class="chapter" data-level="13.3.7" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#faza-konca-sprejemanja-predlogov"><i class="fa fa-check"></i><b>13.3.7</b> Faza konca sprejemanja predlogov</a></li>
<li class="chapter" data-level="13.3.8" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#faza-začetka-glasovanja"><i class="fa fa-check"></i><b>13.3.8</b> Faza začetka glasovanja</a></li>
<li class="chapter" data-level="13.3.9" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#faza-konca-glasovanja"><i class="fa fa-check"></i><b>13.3.9</b> Faza konca glasovanja</a></li>
<li class="chapter" data-level="13.3.10" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#zaključna-faza-preštetih-glasov"><i class="fa fa-check"></i><b>13.3.10</b> Zaključna faza preštetih glasov</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#varna-postavitev"><i class="fa fa-check"></i><b>13.4</b> Postavitev pametne pogodbe na zaščiteno verigo blokov</a></li>
<li class="chapter" data-level="13.5" data-path="Truffle-Web3.html"><a href="Truffle-Web3.html#postavitev-pametne-pogodbe-s-pomočjo-metamask"><i class="fa fa-check"></i><b>13.5</b> Postavitev pametne pogodbe s pomočjo MetaMask</a></li>
</ul></li>
<li class="part"><span><b>VI sklop: Dodatne funkcionalnosti</b></span></li>
<li class="chapter" data-level="14" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html"><i class="fa fa-check"></i><b>14</b> <span class="sklop6 oznaka">P6.1</span> Varnost spletnih aplikacij, testiranje in progresivne spletne aplikacije</a>
<ul>
<li class="chapter" data-level="14.1" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#odprtokodni-projekt-varnosti-spletnih-aplikacij-owasp"><i class="fa fa-check"></i><b>14.1</b> Odprtokodni projekt varnosti spletnih aplikacij OWASP</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#uvod-2"><i class="fa fa-check"></i><b>14.1.1</b> Uvod</a></li>
<li class="chapter" data-level="14.1.2" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#trend-največjih-varnostnih-tveganj-spletnih-aplikacij"><i class="fa fa-check"></i><b>14.1.2</b> Trend največjih varnostnih tveganj spletnih aplikacij</a></li>
<li class="chapter" data-level="14.1.3" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#ovrednotenje-varnostnih-tveganj-aplikacije"><i class="fa fa-check"></i><b>14.1.3</b> Ovrednotenje varnostnih tveganj aplikacije</a></li>
<li class="chapter" data-level="14.1.4" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A1-2021"><i class="fa fa-check"></i><b>14.1.4</b> A1:2021 - Neustrezen nadzor dostopa</a></li>
<li class="chapter" data-level="14.1.5" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A2-2021"><i class="fa fa-check"></i><b>14.1.5</b> A2:2021 - Kriptografske napake</a></li>
<li class="chapter" data-level="14.1.6" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A3-2021"><i class="fa fa-check"></i><b>14.1.6</b> A3:2021 - Vrivanje zlonamerne kode</a></li>
<li class="chapter" data-level="14.1.7" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A4-2021"><i class="fa fa-check"></i><b>14.1.7</b> A4:2021 - Nevaren načrt</a></li>
<li class="chapter" data-level="14.1.8" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A5-2021"><i class="fa fa-check"></i><b>14.1.8</b> A5:2021 - Napačna varnostna konfiguracija</a></li>
<li class="chapter" data-level="14.1.9" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A6-2021"><i class="fa fa-check"></i><b>14.1.9</b> A6:2021 - Ranljive in zastarele komponente</a></li>
<li class="chapter" data-level="14.1.10" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A7-2021"><i class="fa fa-check"></i><b>14.1.10</b> A7:2021 - Napake pri identifikaciji in avtentikaciji</a></li>
<li class="chapter" data-level="14.1.11" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A8-2021"><i class="fa fa-check"></i><b>14.1.11</b> A8:2021 - Napake v programski opremi in integriteti podatkov</a></li>
<li class="chapter" data-level="14.1.12" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A9-2021"><i class="fa fa-check"></i><b>14.1.12</b> A9:2021 - Varnostno beleženje in spremljanje napak</a></li>
<li class="chapter" data-level="14.1.13" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#A10-2021"><i class="fa fa-check"></i><b>14.1.13</b> A10:2021 - Ponarejanje zahtev na strani strežnika (SSRF)</a></li>
<li class="chapter" data-level="14.1.14" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#priporočila-za-razvijalce"><i class="fa fa-check"></i><b>14.1.14</b> Priporočila za razvijalce</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#osnovni-varnostni-pregled-demo-aplikacije-z-owasp-zap"><i class="fa fa-check"></i><b>14.2</b> Osnovni varnostni pregled Demo aplikacije z OWASP ZAP</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#priprava-demo-aplikacije-v-lokalnem-okolju"><i class="fa fa-check"></i><b>14.2.1</b> Priprava Demo aplikacije v lokalnem okolju</a></li>
<li class="chapter" data-level="14.2.2" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#podpora-ssl"><i class="fa fa-check"></i><b>14.2.2</b> Podpora SSL</a></li>
<li class="chapter" data-level="14.2.3" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#zagon-aplikacije"><i class="fa fa-check"></i><b>14.2.3</b> Zagon aplikacije</a></li>
<li class="chapter" data-level="14.2.4" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#konfiguracija-orodja-owasp-zap"><i class="fa fa-check"></i><b>14.2.4</b> Konfiguracija orodja OWASP ZAP</a></li>
<li class="chapter" data-level="14.2.5" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#tezave-http-odgovori"><i class="fa fa-check"></i><b>14.2.5</b> Odprava težav s HTTP odgovori</a></li>
<li class="chapter" data-level="14.2.6" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#tezave-z-registracijo-in-prijavo"><i class="fa fa-check"></i><b>14.2.6</b> Odprava težav z registracijo in prijavo</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#osnovni-funkcionalni-testi-aplikacije-demo-s-selenium"><i class="fa fa-check"></i><b>14.3</b> Osnovni funkcionalni testi aplikacije Demo s Selenium</a></li>
<li class="chapter" data-level="14.4" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#Progresivne-spletne-aplikacije"><i class="fa fa-check"></i><b>14.4</b> Progresivne spletne aplikacije</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#uvod-3"><i class="fa fa-check"></i><b>14.4.1</b> Uvod</a></li>
<li class="chapter" data-level="14.4.2" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#Lighthouse"><i class="fa fa-check"></i><b>14.4.2</b> Pregled obstoječe aplikacije s pomočjo Lighthouse</a></li>
<li class="chapter" data-level="14.4.3" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#nadgradnja-angular"><i class="fa fa-check"></i><b>14.4.3</b> Nadgradnja Angular</a></li>
<li class="chapter" data-level="14.4.4" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#vključitev-podpore-za-pwa"><i class="fa fa-check"></i><b>14.4.4</b> Vključitev podpore za PWA</a></li>
<li class="chapter" data-level="14.4.5" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#Brskanje-brez-povezave"><i class="fa fa-check"></i><b>14.4.5</b> Brskanje brez povezave</a></li>
<li class="chapter" data-level="14.4.6" data-path="Varnost-testiranje-PWA.html"><a href="Varnost-testiranje-PWA.html#končno-testiranje"><i class="fa fa-check"></i><b>14.4.6</b> Končno testiranje</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="literatura.html"><a href="literatura.html"><i class="fa fa-check"></i>Literatura</a></li>
<li class="divider"></li>
<li><a href="https://ucilnica.fri.uni-lj.si/course/view.php?id=74">eUčilnica</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="index.html">Spletno programiranje 2023/2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Avtentikacija" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Poglavje 10</span> <span class="sklop4 oznaka">P4.3</span> Preverjanje istovetnosti uporabnika<a href="Avtentikacija.html#Avtentikacija" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="vrstica">
<img src="assets/img/ninja/ninja_03_go_right.png">
<h3>
<span class="sklop4 oznaka">P4.3</span>
</h3>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>
<script>
  var options_dodaj = {acrossElements: true, element: "dodaj"};
  var options_izbrisi = {acrossElements: true, element: "izbrisi"};
</script>
<p><a href="https://unilj-my.sharepoint.com/:wb:/g/personal/dejanl_fri1_uni-lj_si/EYEeUiAlMGVPtlN0jXxlMx0BT5aii-y4YMyt6nudvH6PIA?e=i7KYl1"><i class="fa-solid fa-chalkboard-user"></i>Sodelovalna <strong>tabla</strong></a>, ki jo bomo uporabljali pred in med predavanji ter je namenjena odložišču za vprašanja in komentarje.</p>
<div id="način-avtentikacije-z-uporabo-mean-sklada-tehnologij" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Način avtentikacije z uporabo MEAN sklada tehnologij<a href="Avtentikacija.html#način-avtentikacije-z-uporabo-mean-sklada-tehnologij" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Obstoječo aplikacijo želimo nadgraditi s funkcionalnostjo prijave uporabnikov pred možnostjo komentiranja izbrane lokacije. To je pomemben vidik spletnih aplikacij, saj je <strong>obvladovanje uporabnikov</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/Identity_management"><i class="fa-brands fa-wikipedia-w"></i>Identity Management</a>)</em> in njihovih <strong>sej</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/Session_(computer_science)"><i class="fa-brands fa-wikipedia-w"></i>session</a>)</em> pogosta zahteva. Kot prikazuje slika <a href="Avtentikacija.html#fig:slika-Avtentikacija-aplikacije-na-razlicnih-ravneh">10.1</a>, se bomo v kontekstu uporabe MEAN tehnologij omenjenega problema lotili s pristopom od spodaj navzgor. Najprej bomo <strong>posodobili shemo podatkovne baze</strong>, potem sledi <strong>posodobitev API-ja</strong> in na koncu še <strong>prilagoditev uporabniškega vmesnika</strong>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-aplikacije-na-razlicnih-ravneh"></span>
<img src="assets/img/Avtentikacije_aplikacije_na_razlicnih_ravneh.png" alt="Dodajanje sloja avtentikacije na različnih ravneh obstoječe aplikacije - podatkovna baza, API in odjemalska SPA aplikacija" width="500" />
<p class="caption">
Slika 10.1: Dodajanje sloja avtentikacije na različnih ravneh obstoječe aplikacije - podatkovna baza, API in odjemalska SPA aplikacija
</p>
</div>
<p>Mogoče se nam na začetku zdi vpeljava avtentikacije z uporabo MEAN sklada tehnologij nemogoča oz. težka, saj je večji del izvorne kode v aplikaciji SPA, ki se posreduje spletnemu brskalniku in se tam tudi izvaja. Zato bomo v nadaljevanju postopoma prikazali način, ki ga bomo uporabili.</p>
<div id="klasični-pristop-avtentikacije-pri-strežniški-aplikaciji" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Klasični pristop avtentikacije pri strežniški aplikaciji<a href="Avtentikacija.html#klasični-pristop-avtentikacije-pri-strežniški-aplikaciji" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pri klasičnem pristopu <strong>preverjanja istovetnosti identitete uporabnika</strong> oz. <strong>avtentikacija</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/Authentication"><i class="fa-brands fa-wikipedia-w"></i>Authentication</a>)</em> s strežniško aplikacijo se celotna funkcionalnost nahaja v programski kodi na strani strežnika. Ko se uporabnik prijavi v sistem, se uporabniško ime in geslo posredujeta na strežnik, ki ju le-ta preveri v podatkovni bazi. Če sta podatka ustrezna, strežnik nastavi ustrezno zastavico oz. parameter v uporabniški seji na strani strežnika, s čimer določi, da je uporabnik uspešno prijavljen.</p>
<p>Strežnik lahko nastavi tudi <strong>piškotek</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/HTTP_cookie"><i class="fa-brands fa-wikipedia-w"></i>cookie</a>)</em> v uporabniškem brskalniku s podatki o seji. To je pogosta praksa, ki pa tehnično ni potrebna za obvladovanje sej prijavljenih uporabnikov, saj je strežnik tisti, ki vzdržuje vse pomembne podatke. Takšen proces <strong>vzpostavitve seje</strong> je prikazan na sliki <a href="Avtentikacija.html#fig:slika-Avtentikacija-klasicni-pristop-vzpostavitev-seje">10.2</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-klasicni-pristop-vzpostavitev-seje"></span>
<img src="assets/img/Avtentikacija_klasicni_pristop_vzpostavitev_seje.png" alt="**Vzpostavitev seje** pri klasičnem pristopu avtentikacije" width="610" />
<p class="caption">
Slika 10.2: <strong>Vzpostavitev seje</strong> pri klasičnem pristopu avtentikacije
</p>
</div>
<p>Ko uporabnik zahteva zaščiteno vsebino ali poskuša posredovati podatke na strežnik, mora strežnik preveriti veljavnost uporabniške seje in se odločiti, ali uporabniku dovoli izvesti zahtevano akcijo.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-klasicni-pristop-preverjanje-veljavnosti-seje-zahteva-podatkov"></span>
<img src="assets/img/Avtentikacija_klasicni_pristop_preverjanje_veljavnosti_seje_zahteva_podatkov.png" alt="**Preverjanje veljavnosti seje ob zahtevi podatkov** pri klasičnem pristopu avtentikacije" width="500" />
<p class="caption">
Slika 10.3: <strong>Preverjanje veljavnosti seje ob zahtevi podatkov</strong> pri klasičnem pristopu avtentikacije
</p>
</div>
<p><strong>Preverjanje veljavnosti seje</strong> ob zahtevi podatkov in ob shranjevanju podatkov je prikazano na slikah <a href="Avtentikacija.html#fig:slika-Avtentikacija-klasicni-pristop-preverjanje-veljavnosti-seje-zahteva-podatkov">10.3</a> in <a href="Avtentikacija.html#fig:slika-Avtentikacija-klasicni-pristop-preverjanje-veljavnosti-seje-shranjevanje-podatkov">10.4</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-klasicni-pristop-preverjanje-veljavnosti-seje-shranjevanje-podatkov"></span>
<img src="assets/img/Avtentikacija_klasicni_pristop_preverjanje_veljavnosti_seje_shranjevanje_podatkov.png" alt="**Preverjanje veljavnosti seje ob shranjevanju podatkov** pri klasičnem pristopu avtentikacije" width="610" />
<p class="caption">
Slika 10.4: <strong>Preverjanje veljavnosti seje ob shranjevanju podatkov</strong> pri klasičnem pristopu avtentikacije
</p>
</div>
<p>Klasični pristop avtentikacije ni najbolj primeren za MEAN sklad tehnologij. Težava je predvsem v odvisnosti od rezervacije strežniških virov za vsakega uporabnika z namenom vzdrževanja seje. Že v uvodnih predavanjih smo omenili, da Node.js in Express ne vzdržujeta seje za vsakega uporabnika posebej, saj se celotna aplikacija za vse uporabnike izvaja v 1 niti.</p>
<p>V nadaljevanju bomo zato predstavili bolj kompleksen scenarij z dodajanjem avtentikacije na SPA aplikacijo na eni strani, ki dostopa do podatkov preko REST API-ja.</p>
</div>
<div id="avtentikacija-z-mean-skladom-tehnologij" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Avtentikacija z MEAN skladom tehnologij<a href="Avtentikacija.html#avtentikacija-z-mean-skladom-tehnologij" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pri avtentikaciji z MEAN skladom tehnologij imamo naslednji težavi:</p>
<ul>
<li><strong>API je brez stanja</strong>, saj Express in Node.js ne poznata koncepta uporabniških sej,</li>
<li><strong>aplikacijska logika se nahaja na strani odjemalca</strong> in se izvaja v brskalniku, tako da kode, ki se posreduje odjemalcu, ne moremo enostavno omejiti.</li>
</ul>
<p>Dobra praksa pri obvladovanju te težave je uporaba <strong>JSON spletnega žetona</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/JSON_Web_Token"><i class="fa-brands fa-wikipedia-w"></i>JSON Web Token (<strong>JWT</strong>)</a>)</em>. JWT je JSON objekt, šifriran v obliki niza, kjer uporabnik neposredno ne more razbrati njegove vsebine, lahko pa ga dekodira strežnik ter ga uporabi v aplikaciji.</p>
<p>Slika <a href="Avtentikacija.html#fig:slika-Avtentikacija-MEAN-pristop-generiranje-zetona">10.5</a> prikazuje <strong>proces prijave</strong> oz. <strong>generiranje JWT</strong>. Uporabnik najprej posreduje svoje prijavne podatke strežniku preko API-ja, nato strežnik preveri veljavnost v podatkovni bazi in vrne žeton nazaj brskalniku. Brskalnik pridobljeni žeton shrani za ponovno uporabo. Postopek je zelo podoben klasičnemu pristopu, kjer namesto shranjevanja uporabniške seje na strežniku shranimo žeton na odjemalcu.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-MEAN-pristop-generiranje-zetona"></span>
<img src="assets/img/Avtentikacija_MEAN_pristop_generiranje_zetona.png" alt="**Generiranje JSON spletnega žetona** pri MEAN pristopu avtentikacije" width="610" />
<p class="caption">
Slika 10.5: <strong>Generiranje JSON spletnega žetona</strong> pri MEAN pristopu avtentikacije
</p>
</div>
<p>Ko uporabnik uporablja aplikacijo, mora imeti možnost <strong>spreminjanja pogleda</strong> oz. <strong>strani</strong> in aplikacija se mora zavedati, ali mu je zahtevana akcija dovoljena ali ne. Kot prikazuje slika <a href="Avtentikacija.html#fig:slika-Avtentikacija-MEAN-pristop-preverjanje-veljavnosti-zetona-zahteva-podatkov">10.6</a>, aplikacija dekodira JWT in uporabi rezultat za prikaz ustreznih podatkov uporabniku. Na tem mestu se kaže jasna razlika s tradicionalnim pristopom, saj se strežnik ne zaveda, kaj uporabnik počne, vse dokler ne zahteva dostopa do podatkov preko API-ja.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-MEAN-pristop-preverjanje-veljavnosti-zetona-zahteva-podatkov"></span>
<img src="assets/img/Avtentikacija_MEAN_pristop_preverjanje_veljavnosti_zetona_zahteva_podatkov.png" alt="**Preverjanje veljavnosti žetona ob zahtevi podatkov** pri MEAN pristopu avtentikacije" width="500" />
<p class="caption">
Slika 10.6: <strong>Preverjanje veljavnosti žetona ob zahtevi podatkov</strong> pri MEAN pristopu avtentikacije
</p>
</div>
<p>Če je posamezen del aplikacije zaščiten in je dostop dovoljen le prijavljenim uporabnikom, potem je velika verjetnost, da je s tem povezan dostop do podatkovne baze, ki ga lahko izvedejo le prijavljeni uporabniki. Glede na to, da je API brez stanja, se le-ta ne zaveda, kdo je klic zahteval, razen če tega podatka eksplicitno ne posredujemo. Na tem mestu pa zopet pride v uporabo JWT. Kot prikazuje slika <a href="Avtentikacija.html#fig:slika-Avtentikacija-MEAN-pristop-preverjanje-veljavnosti-zetona-shranjevanje-podatkov">10.7</a>, se žeton posreduje na API dostopno točko, ki žeton dekodira, še preden preveri, ali ima uporabnik pravico zahtevati to funkcionalnost.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Avtentikacija-MEAN-pristop-preverjanje-veljavnosti-zetona-shranjevanje-podatkov"></span>
<img src="assets/img/Avtentikacija_MEAN_pristop_preverjanje_veljavnosti_zetona_shranjevanje_podatkov.png" alt="**Preverjanje veljavnosti žetona ob shranjevanju podatkov** pri MEAN pristopu avtentikacije" width="610" />
<p class="caption">
Slika 10.7: <strong>Preverjanje veljavnosti žetona ob shranjevanju podatkov</strong> pri MEAN pristopu avtentikacije
</p>
</div>
</div>
</div>
<div id="kreiranje-sheme-uporabnikov-v-mongodb" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Kreiranje sheme uporabnikov v MongoDB<a href="Avtentikacija.html#kreiranje-sheme-uporabnikov-v-mongodb" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Uporabniška imena in gesla je smiselno shranjevati v podatkovno bazo. Za ta namen bomo uporabili kar obstoječo podatkovno bazo MongoDB, kjer bomo kreirali novo shemo za uporabnike.</p>
<blockquote>
<p><strong>Namig</strong>: <strong>Gesla</strong> v podatkovni bazi ne smemo <strong>nikoli shranjevati v obliki navadnega besedila</strong>, saj to predstavlja veliko varnostno tveganje, če kdo pridobi nepooblaščen dostop do podatkovne baze.</p>
</blockquote>
<div id="enosmerno-šifriranje-gesel" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Enosmerno šifriranje gesel<a href="Avtentikacija.html#enosmerno-šifriranje-gesel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>V primeru naše aplikacije lahko izvedemo enosmerno šifriranje gesel. S tem dosežemo enostavno preverjanje ustreznosti gesla in onemogočimo ostalim, da na enostaven način dešifrirajo geslo. Ob prijavi uporabnika lahko aplikacija šifrira podano geslo in preveri, ali se ujema s shranjeno vrednostjo.</p>
<p>Vendar samo šifriranje ni dovolj. Če bi npr. več uporabnikov uporabilo “geslo” za njihovo geslo (kar se dogaja), potem bi bila šifrirana vrednost vsakega gesla enaka. Vsak napadalec, ki bi dobil dostop do podatkovne baze, bi lahko opazil vzorec in identificiral potencialna šibka gesla.</p>
<p>Zato pri šifriranju uporabljamo koncept <strong>naključne vrednosti</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/Salt_(cryptography)"><i class="fa-brands fa-wikipedia-w"></i>salt</a>)</em> s predstavitvijo naključnih znakov, ki jih aplikacija generira za vsakega uporabnika ter jih pred postopkom šifriranja združi z dejanskim geslom. Rezultat šifriranja je <strong>zgoščena vrednost</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/Hash_function"><i class="fa-brands fa-wikipedia-w"></i>hash</a>)</em>, kot to prikazuje slika <a href="Avtentikacija.html#fig:slika-Zgoscena-vrednost">10.8</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Zgoscena-vrednost"></span>
<img src="assets/img/Zgoscena_vrednost.png" alt="Zgoščena vrednost nastane v postopku šifriranja na podlagi uporabniškega gesla in naključne vrednosti" width="450" />
<p class="caption">
Slika 10.8: Zgoščena vrednost nastane v postopku šifriranja na podlagi uporabniškega gesla in naključne vrednosti
</p>
</div>
<p>V podatkovni bazi namesto shranjevanja gesla raje hranimo naključno vrednost in zgoščeno vrednost. S tem pristopom zagotavljamo, da so vse zgoščene vrednosti enolične in gesla ustrezno zaščitena.</p>
</div>
<div id="Kreiranje-sheme-z-Mongoose" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Kreiranje sheme z Mongoose<a href="Avtentikacija.html#Kreiranje-sheme-z-Mongoose" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Shemo bomo opredelili v ločeni datoteki <code>api/models/users.js</code> in jo najprej vključili v <code>api/models/db.js</code>, ki v okviru implementacije API-ja skrbi za povezavo s podatkovno bazo.</p>
<p><code>api/models/db.js</code></p>
<div class="sourceCode" id="cb670"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb670-1"><a href="Avtentikacija.html#cb670-1" tabindex="-1"></a><span class="pp">require</span>(<span class="st">&quot;./locations&quot;</span>)<span class="op">;</span></span>
<span id="cb670-2"><a href="Avtentikacija.html#cb670-2" tabindex="-1"></a><span class="pp">require</span>(<span class="st">&quot;./users&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Pri opredelitvi sheme v <code>api/models/users.js</code> zahtevamo elektronski naslov, ime, zgoščeno in naključno vrednost. Za elektronski naslov zahtevamo, da je enoličen in obvezen, ime je obvezno, medtem ko sta zgoščena in naključna vrednost podatkovnega tipa niz in ravno tako obvezni.</p>
<p>Poskrbimo tudi za povezovanje sheme z modelom.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb671"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb671-1"><a href="Avtentikacija.html#cb671-1" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;mongoose&quot;</span>)<span class="op">;</span></span>
<span id="cb671-2"><a href="Avtentikacija.html#cb671-2" tabindex="-1"></a></span>
<span id="cb671-3"><a href="Avtentikacija.html#cb671-3" tabindex="-1"></a><span class="kw">const</span> usersSchema <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb671-4"><a href="Avtentikacija.html#cb671-4" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Email is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb671-5"><a href="Avtentikacija.html#cb671-5" tabindex="-1"></a>  <span class="dt">name</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Name is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb671-6"><a href="Avtentikacija.html#cb671-6" tabindex="-1"></a>  <span class="dt">hash</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Hash is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb671-7"><a href="Avtentikacija.html#cb671-7" tabindex="-1"></a>  <span class="dt">salt</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Salt is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb671-8"><a href="Avtentikacija.html#cb671-8" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb671-9"><a href="Avtentikacija.html#cb671-9" tabindex="-1"></a></span>
<span id="cb671-10"><a href="Avtentikacija.html#cb671-10" tabindex="-1"></a>mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&quot;User&quot;</span><span class="op">,</span> usersSchema<span class="op">,</span> <span class="st">&quot;Users&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Elektronski naslov in ime bomo pridobili iz registracijskega obrazca uporabnika, zgoščeno in naključno vrednost pa bo kreirala aplikacija na podlagi podanega uporabniškega gesla, ki ga bo uporabnik tudi vnesel na registracijski obrazec.</p>
<script>
  $(document).ready(function() {
    $("#Kreiranje-sheme-z-Mongoose code.javascript:eq(0)").markRegExp(/.+users.+/, options_dodaj);
    $("#Kreiranje-sheme-z-Mongoose code:eq(5)").markRegExp(/users.+/, options_dodaj);
    $("#Kreiranje-sheme-z-Mongoose code.javascript:eq(1)").markRegExp(/.+/, options_dodaj);
  });
</script>
</div>
<div id="šifriranje-uporabniškega-gesla" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Šifriranje uporabniškega gesla<a href="Avtentikacija.html#šifriranje-uporabniškega-gesla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ker je šifriranje podatkov pogosta zahteva, je v Node.js vgrajen modul <a href="https://nodejs.org/api/crypto.html"><i class="fa-brands fa-node-js"></i><code>crypto</code></a>, ki ga bomo uporabili tudi mi.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb672"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb672-1"><a href="Avtentikacija.html#cb672-1" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;mongoose&quot;</span>)<span class="op">;</span></span>
<span id="cb672-2"><a href="Avtentikacija.html#cb672-2" tabindex="-1"></a><span class="kw">const</span> crypto <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;crypto&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Mongoose nam omogoča dodajanje metod neposredno v shemo in metode so izpostavljene kot metode modela. S pomočjo teh metod pridobimo neposredni dostop do atributov modela. Za naše potrebe bomo pripravili metodo <code>setPassword</code>. Pri šifriranju uporabniškega gesla bomo najprej generirali naključno vrednost s pomočjo metode <a href="https://nodejs.org/api/crypto.html#cryptorandombytessize-callback"><span class="skupaj"><i class="fa-brands fa-node-js"></i><code>randomBytes</code></span></a>, ki generira kriptografsko močan naključen niz podatkov. Nato bomo na podlagi gesla in naključne vrednosti s pomočjo metode <a href="https://nodejs.org/api/crypto.html#cryptopbkdf2syncpassword-salt-iterations-keylen-digest"><i class="fa-brands fa-node-js"></i><code>pbkdf2Sync</code></a> generirali zgoščeno vrednost (dolžina ključa je <span class="math inline">\(64\)</span> pri <span class="math inline">\(1000\)</span> iteracijah).</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb673"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb673-1"><a href="Avtentikacija.html#cb673-1" tabindex="-1"></a>usersSchema<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">setPassword</span> <span class="op">=</span> <span class="kw">function</span> (password) {</span>
<span id="cb673-2"><a href="Avtentikacija.html#cb673-2" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">salt</span> <span class="op">=</span> crypto<span class="op">.</span><span class="fu">randomBytes</span>(<span class="dv">16</span>)<span class="op">.</span><span class="fu">toString</span>(<span class="st">&quot;hex&quot;</span>)<span class="op">;</span></span>
<span id="cb673-3"><a href="Avtentikacija.html#cb673-3" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">hash</span> <span class="op">=</span> crypto</span>
<span id="cb673-4"><a href="Avtentikacija.html#cb673-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">pbkdf2Sync</span>(password<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">salt</span><span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> <span class="st">&quot;sha512&quot;</span>)</span>
<span id="cb673-5"><a href="Avtentikacija.html#cb673-5" tabindex="-1"></a>    <span class="op">.</span><span class="fu">toString</span>(<span class="st">&quot;hex&quot;</span>)<span class="op">;</span></span>
<span id="cb673-6"><a href="Avtentikacija.html#cb673-6" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>S tem dosežemo, da gesla nikjer ne shranimo neposredno, tudi v pomnilniku ne.</p>
<script>
  $(document).ready(function() {
    $("#šifriranje-uporabniškega-gesla code.javascript:eq(0)").markRegExp(/.+crypto.+/, options_dodaj);
    $("#šifriranje-uporabniškega-gesla code.javascript:eq(1)").markRegExp(/.+/, options_dodaj);
  });
</script>
</div>
<div id="preverjanje-ustreznosti-podanega-gesla" class="section level3 hasAnchor" number="10.2.4">
<h3><span class="header-section-number">10.2.4</span> Preverjanje ustreznosti podanega gesla<a href="Avtentikacija.html#preverjanje-ustreznosti-podanega-gesla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pomembno je podpreti tudi funkcionalnost preverjanja ustreznosti podanega gesla, ko se uporabnik poskuša prijaviti v sistem. Ker smo geslo šifrirali, ga ne moremo dešifrirati, ampak ponovno uporabimo isti postopek šifriranja s podanim geslom in naključno vrednostjo iz podatkovne baze za podanega uporabnika. To funkcionalnost implementiramo v obliki metode <code>validPassword</code>.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb674"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb674-1"><a href="Avtentikacija.html#cb674-1" tabindex="-1"></a>usersSchema<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">validPassword</span> <span class="op">=</span> <span class="kw">function</span> (password) {</span>
<span id="cb674-2"><a href="Avtentikacija.html#cb674-2" tabindex="-1"></a>  <span class="kw">const</span> hash <span class="op">=</span> crypto</span>
<span id="cb674-3"><a href="Avtentikacija.html#cb674-3" tabindex="-1"></a>    <span class="op">.</span><span class="fu">pbkdf2Sync</span>(password<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">salt</span><span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> <span class="st">&quot;sha512&quot;</span>)</span>
<span id="cb674-4"><a href="Avtentikacija.html#cb674-4" tabindex="-1"></a>    <span class="op">.</span><span class="fu">toString</span>(<span class="st">&quot;hex&quot;</span>)<span class="op">;</span></span>
<span id="cb674-5"><a href="Avtentikacija.html#cb674-5" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">hash</span> <span class="op">===</span> hash<span class="op">;</span></span>
<span id="cb674-6"><a href="Avtentikacija.html#cb674-6" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#preverjanje-ustreznosti-podanega-gesla code.javascript:eq(0)").markRegExp(/.+/, options_dodaj);
  });
</script>
</div>
<div id="generiranje-json-spletnega-žetona-jwt" class="section level3 hasAnchor" number="10.2.5">
<h3><span class="header-section-number">10.2.5</span> Generiranje JSON spletnega žetona (JWT)<a href="Avtentikacija.html#generiranje-json-spletnega-žetona-jwt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>JWT se uporablja za posredovanje podatkov, v našem primeru med API-jem na strežniku in SPA aplikacijo v brskalniku. JWT lahko uporabimo tudi na strežniku, ki je JWT zgeneriral, da avtenticira uporabnika ob njegovih dodatnih zahtevah na strežnik.</p>
<p>JWT je sestavljen iz <a href="https://jwt.io/introduction/"><i class="fa-solid fa-earth-europe"></i>3 delov</a>, na videz naključnih nizov, ki so ločeni s piko (<code>.</code>). Takšen niz je lahko zelo dolg, kot prikazuje naslednji primer.</p>
<pre><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfaWQiOiI1NTZiZWRmNDhmOTUzOTViMTlhNjc1ODgiLCJlbWFpbCI6InNpbW9uQGZ1bGxz
dGFja3RyYWluaW5nLmNvbSIsIm5hbWUiOiJTaW1vbiBIb2xtZXMiLCJleHAiOjE0MzUwNDA0MTgsImlhdCI6MTQzNDQzNTYxOH0.GD7UrfnLk
295rwvIrCikbkAKctFFoRCHotLYZwZpdlE</code></pre>
<p>JWT vsebinsko sestavljajo naslednji <a href="https://en.wikipedia.org/wiki/JSON_Web_Token"><i class="fa-brands fa-wikipedia-w"></i>deli</a>:</p>
<ul>
<li><strong>glava</strong><a href="Avtentikacija.html#fn139" class="footnote-ref" id="fnref139"><sup>139</sup></a> je kodiran JSON objekt, ki vsebuje tip in uporabljen šifrirni algoritem,</li>
<li><strong>koristna vsebina</strong><a href="Avtentikacija.html#fn140" class="footnote-ref" id="fnref140"><sup>140</sup></a> je kodiran JSON objekt, ki vsebuje dejanske podatke,</li>
<li><strong>podpis</strong><a href="Avtentikacija.html#fn141" class="footnote-ref" id="fnref141"><sup>141</sup></a> je šifrirana zgoščena vrednost glave in koristne vsebine z uporabo “skritega gesla”, ki ga pozna le strežnik.</li>
</ul>
<p>Pomembno je izpostaviti, da <strong>glava</strong> in <strong>koristna vsebina</strong> nista šifrirani, ampak <strong>kodirani</strong>. To pomeni, da jih lahko brskalnik ali kakšna druga aplikacija relativno enostavno dekodira. Večina novejših brskalnikov ima vgrajeno funkcijo <a href="https://developer.mozilla.org/en-US/docs/Web/API/atob"><span class="skupaj"><i class="fa-brands fa-square-js"></i><code>atob()</code></span></a>, ki poskrbi za dekodiranje niza iz <a href="https://en.wikipedia.org/wiki/Base64"><i class="fa-brands fa-wikipedia-w"></i><code>Base64</code></a>. Inverzna funkcija <a href="https://developer.mozilla.org/en-US/docs/Web/API/btoa"><i class="fa-brands fa-square-js"></i><code>btoa()</code></a> pa poskrbi za kodiranje v <code>Base64</code> niz.</p>
<p>Zadnji del, <strong>podpis</strong>, je <strong>šifriran</strong>. Za uspešno dešifriranje moramo poznati skrito geslo na strani strežnika, ki mora ostati skrito in nedostopno javnosti.</p>
<p>Za celoten proces generiranja JWT so na voljo knjižnice, ki nam to opravilo olajšajo. Najprej bomo poskrbeli za namestitev knjižnice <a href="https://www.npmjs.com/package/jsonwebtoken"><i class="fa-brands fa-node-js"></i><code>jsonwebtoken</code></a>.</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb676-1"><a href="Avtentikacija.html#cb676-1" tabindex="-1"></a><span class="ex">$</span> npm install jsonwebtoken <span class="at">--save</span></span></code></pre></div>
<p>Modul uvozimo v naš model <code>api/models/users.js</code>.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb677"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb677-1"><a href="Avtentikacija.html#cb677-1" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;mongoose&quot;</span>)<span class="op">;</span></span>
<span id="cb677-2"><a href="Avtentikacija.html#cb677-2" tabindex="-1"></a><span class="kw">const</span> crypto <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;crypto&quot;</span>)<span class="op">;</span></span>
<span id="cb677-3"><a href="Avtentikacija.html#cb677-3" tabindex="-1"></a><span class="kw">const</span> jwt <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;jsonwebtoken&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Sedaj bomo implementirali funkcijo <code>generateJwt</code>, ki bo poskrbela za generiranje žetona JWT. Pri generiranju JWT-ja bomo potrebovali koristno vsebino (t.j. podatki o uporabniku - <code>_id</code>, <code>email</code> in <code>name</code>) in skrito geslo. Med koristno vsebino bomo vključili tudi datum poteka JSON spletnega žetona, in sicer ga bomo nastavili na 7 dni. Za dejansko generiranje JWT uporabimo metodo <a href="https://www.npmjs.com/package/jsonwebtoken#jwtsignpayload-secretorprivatekey-options-callback"><i class="fa-brands fa-node-js"></i><code>sign</code></a>.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb678"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb678-1"><a href="Avtentikacija.html#cb678-1" tabindex="-1"></a>usersSchema<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">generateJwt</span> <span class="op">=</span> <span class="kw">function</span> () {</span>
<span id="cb678-2"><a href="Avtentikacija.html#cb678-2" tabindex="-1"></a>  <span class="kw">const</span> expiry <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb678-3"><a href="Avtentikacija.html#cb678-3" tabindex="-1"></a>  expiry<span class="op">.</span><span class="fu">setDate</span>(expiry<span class="op">.</span><span class="fu">getDate</span>() <span class="op">+</span> <span class="dv">7</span>)<span class="op">;</span></span>
<span id="cb678-4"><a href="Avtentikacija.html#cb678-4" tabindex="-1"></a>  <span class="cf">return</span> jwt<span class="op">.</span><span class="fu">sign</span>(</span>
<span id="cb678-5"><a href="Avtentikacija.html#cb678-5" tabindex="-1"></a>    {</span>
<span id="cb678-6"><a href="Avtentikacija.html#cb678-6" tabindex="-1"></a>      <span class="dt">_id</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">_id</span><span class="op">,</span></span>
<span id="cb678-7"><a href="Avtentikacija.html#cb678-7" tabindex="-1"></a>      <span class="dt">email</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb678-8"><a href="Avtentikacija.html#cb678-8" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb678-9"><a href="Avtentikacija.html#cb678-9" tabindex="-1"></a>      <span class="dt">exp</span><span class="op">:</span> <span class="pp">parseInt</span>(expiry<span class="op">.</span><span class="fu">getTime</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">,</span></span>
<span id="cb678-10"><a href="Avtentikacija.html#cb678-10" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb678-11"><a href="Avtentikacija.html#cb678-11" tabindex="-1"></a>    <span class="st">&quot;superSecretPassword&quot;</span></span>
<span id="cb678-12"><a href="Avtentikacija.html#cb678-12" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb678-13"><a href="Avtentikacija.html#cb678-13" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#generiranje-json-spletnega-žetona-jwt code:eq(1)").markRegExp(/\./, options_dodaj);
    $("#generiranje-json-spletnega-žetona-jwt code:eq(7)").markRegExp(/npm.+/, options_dodaj);
    $("#generiranje-json-spletnega-žetona-jwt code.javascript:eq(0)").markRegExp(/.+jwt.+/, options_dodaj);
    $("#generiranje-json-spletnega-žetona-jwt code.javascript:eq(1)").markRegExp(/.+/, options_dodaj);    
  });
</script>
<div id="hramba-skritega-gesla-v-okoljski-spremenljivki" class="section level4 hasAnchor" number="10.2.5.1">
<h4><span class="header-section-number">10.2.5.1</span> Hramba skritega gesla v okoljski spremenljivki<a href="Avtentikacija.html#hramba-skritega-gesla-v-okoljski-spremenljivki" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Vključevanje skritega gesla v kodi na strani strežnika ni priporočljivo, saj v primeru posredovanja kode v oddaljene repozitorije posredujemo tudi skrito geslo, kar pa zagotovo ni namen. Zato je <strong>dobra praksa shranjevanje skritega gesla v okoljski spremenljivki</strong>.</p>
<p>Okoljske spremenljivke znotraj projekta najlažje obvladujemo z datoteko <code>.env</code> v korenski mapi. Na tem mestu že imamo shranjeno spremenljivko <code>MONGODB_ATLAS_URI</code> in sedaj dodajmo še <code>JWT_SECRET</code>.</p>
<p><code>.env</code></p>
<div class="sourceCode" id="cb679"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb679-1"><a href="Avtentikacija.html#cb679-1" tabindex="-1"></a><span class="co"># MongoDB Atlas</span></span>
<span id="cb679-2"><a href="Avtentikacija.html#cb679-2" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb679-3"><a href="Avtentikacija.html#cb679-3" tabindex="-1"></a><span class="co"># JWT</span></span>
<span id="cb679-4"><a href="Avtentikacija.html#cb679-4" tabindex="-1"></a><span class="va">JWT_SECRET</span><span class="op">=</span>superSecretPassword</span></code></pre></div>
<p>Sedaj lahko okoljsko spremenljivko <code>JWT_SECRET</code> vključimo v našo aplikacijo.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb680"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb680-1"><a href="Avtentikacija.html#cb680-1" tabindex="-1"></a>usersSchema<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">generateJwt</span> <span class="op">=</span> <span class="kw">function</span> () {</span>
<span id="cb680-2"><a href="Avtentikacija.html#cb680-2" tabindex="-1"></a>  <span class="kw">const</span> expiry <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb680-3"><a href="Avtentikacija.html#cb680-3" tabindex="-1"></a>  expiry<span class="op">.</span><span class="fu">setDate</span>(expiry<span class="op">.</span><span class="fu">getDate</span>() <span class="op">+</span> <span class="dv">7</span>)<span class="op">;</span></span>
<span id="cb680-4"><a href="Avtentikacija.html#cb680-4" tabindex="-1"></a>  <span class="cf">return</span> jwt<span class="op">.</span><span class="fu">sign</span>(</span>
<span id="cb680-5"><a href="Avtentikacija.html#cb680-5" tabindex="-1"></a>    {</span>
<span id="cb680-6"><a href="Avtentikacija.html#cb680-6" tabindex="-1"></a>      <span class="dt">_id</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">_id</span><span class="op">,</span></span>
<span id="cb680-7"><a href="Avtentikacija.html#cb680-7" tabindex="-1"></a>      <span class="dt">email</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb680-8"><a href="Avtentikacija.html#cb680-8" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb680-9"><a href="Avtentikacija.html#cb680-9" tabindex="-1"></a>      <span class="dt">exp</span><span class="op">:</span> <span class="pp">parseInt</span>(expiry<span class="op">.</span><span class="fu">getTime</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">,</span></span>
<span id="cb680-10"><a href="Avtentikacija.html#cb680-10" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb680-11"><a href="Avtentikacija.html#cb680-11" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">JWT_SECRET</span><span class="st">&quot;superSecretPassword&quot;</span></span>
<span id="cb680-12"><a href="Avtentikacija.html#cb680-12" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb680-13"><a href="Avtentikacija.html#cb680-13" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Prav tako moramo nastaviti tudi okoljsko spremenljivko v produkcijskem okolju.</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb681-1"><a href="Avtentikacija.html#cb681-1" tabindex="-1"></a><span class="ex">$</span> fly secrets set JWT_SECRET=superSecretPassword</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#hramba-skritega-gesla-v-okoljski-spremenljivki code.bash:eq(0)").markRegExp(/# JWT/, options_dodaj);
    $("#hramba-skritega-gesla-v-okoljski-spremenljivki code.bash:eq(0)").markRegExp(/JWT_SECRET.+/, options_dodaj);
    $("#hramba-skritega-gesla-v-okoljski-spremenljivki code.javascript:eq(0)").markRegExp(/process\.env\.JWT_SECRET/, options_dodaj);
    $("#hramba-skritega-gesla-v-okoljski-spremenljivki code.javascript:eq(0)").markRegExp(/".+?"/, options_izbrisi);
    $("#hramba-skritega-gesla-v-okoljski-spremenljivki code.bash:eq(1)").markRegExp(/fly.+/, options_dodaj);
  });
</script>
</div>
</div>
</div>
<div id="Priprava-API-ja-za-avtentikacijo" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Priprava API-ja za avtentikacijo<a href="Avtentikacija.html#Priprava-API-ja-za-avtentikacijo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Za implementacijo API-ja za avtentikacijo bomo uporabili Node.js modul <a href="http://www.passportjs.org/"><i class="fa-brands fa-node-js"></i><strong>Passport</strong></a>. Ključna prednost omenjenega modula je možnost uporabe različnih <strong>metod avtentikacije</strong>, ki se imenujejo <a href="https://www.passportjs.org/concepts/authentication/strategies/"><i class="fa-solid fa-earth-europe"></i><strong>strategije</strong></a>:</p>
<ul>
<li><a href="https://github.com/jaredhanson/passport-google-oauth#readme"><i class="fa-brands fa-node-js"></i>Google</a>,</li>
<li><a href="https://github.com/jaredhanson/passport-facebook#readme"><i class="fa-brands fa-node-js"></i>Facebook</a>,</li>
<li><a href="https://github.com/jaredhanson/passport-twitter#readme"><i class="fa-brands fa-node-js"></i>Twitter</a>,</li>
<li><a href="https://github.com/auth0/passport-auth0#readme"><i class="fa-brands fa-node-js"></i>OAuth</a>,</li>
<li>lokalno uporabniško ime in geslo.</li>
</ul>
<p>S pomočjo Passporta lahko uporabite enega ali več načinov za prijavo vaših uporabnikov. V primeru naše aplikacije bomo uporabili <a href="http://www.passportjs.org/packages/passport-local/"><i class="fa-brands fa-node-js"></i><strong>lokalno strategijo</strong></a>, ker bomo uporabniška imena in zgoščene vrednosti gesel shranjevali v podatkovno bazo.</p>
<div id="namestitev-in-konfiguracija-passporta" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Namestitev in konfiguracija Passporta<a href="Avtentikacija.html#namestitev-in-konfiguracija-passporta" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Passport je zgrajen modularno, in sicer v obliki osrednjega modula ter dodatnih modulov za vsako strategijo. V našem primeru smo se odločili za uporabo lokalne strategije, zato bomo namestili osrednji modul <a href="https://www.npmjs.com/package/passport"><i class="fa-brands fa-node-js"></i><code>passport</code></a> in lokalno strategijo <a href="https://www.npmjs.com/package/passport-local"><i class="fa-brands fa-node-js"></i><code>passport-local</code></a>.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb682-1"><a href="Avtentikacija.html#cb682-1" tabindex="-1"></a><span class="ex">$</span> npm install passport passport-local <span class="at">--save</span></span></code></pre></div>
<p>Za konfiguracijo ogrodja Passport bomo kreirali novo mapo <code>config</code> znotraj mape <code>api</code>.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb683-1"><a href="Avtentikacija.html#cb683-1" tabindex="-1"></a><span class="ex">$</span> cd api</span>
<span id="cb683-2"><a href="Avtentikacija.html#cb683-2" tabindex="-1"></a><span class="ex">$</span> mkdir config</span></code></pre></div>
<p>Konfiguracija ogrodja Passport bo implementirana v datoteki <code>api/config/passport.js</code>, kjer najprej poskrbimo za uvoz vseh knjižnic, ki jih potrebujemo.</p>
<p><code>api/config/passport.js</code></p>
<div class="sourceCode" id="cb684"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb684-1"><a href="Avtentikacija.html#cb684-1" tabindex="-1"></a><span class="kw">const</span> passport <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;passport&quot;</span>)<span class="op">;</span></span>
<span id="cb684-2"><a href="Avtentikacija.html#cb684-2" tabindex="-1"></a><span class="kw">const</span> LocalStrategy <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;passport-local&quot;</span>)<span class="op">.</span><span class="at">Strategy</span><span class="op">;</span></span>
<span id="cb684-3"><a href="Avtentikacija.html#cb684-3" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;mongoose&quot;</span>)<span class="op">;</span></span>
<span id="cb684-4"><a href="Avtentikacija.html#cb684-4" tabindex="-1"></a><span class="kw">const</span> User <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&quot;User&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Sledi <strong>konfiguracija lokalne strategije</strong>. Passport lokalna strategija pričakuje in uporablja privzeta atributa <code>username</code> in <code>password</code>, ki jih lahko ustrezno prilagodimo. Najprej bomo dostopali do modela <code>User</code> v podatkovni bazi in poiskali uporabnika s podanim elektronskim naslovom. Če uporabnika ne najdemo, vrnemo napako, sicer preverimo njegovo geslo. Če je geslo napačno, zopet vrnemo napako. Če je bila avtentikacija uporabnika uspešna, vrnemo objekt s podatki o uporabniku v podatkovni bazi.</p>
<p><code>api/config/passport.js</code></p>
<div class="sourceCode" id="cb685"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb685-1"><a href="Avtentikacija.html#cb685-1" tabindex="-1"></a>passport<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb685-2"><a href="Avtentikacija.html#cb685-2" tabindex="-1"></a>  <span class="kw">new</span> <span class="fu">LocalStrategy</span>(</span>
<span id="cb685-3"><a href="Avtentikacija.html#cb685-3" tabindex="-1"></a>    {</span>
<span id="cb685-4"><a href="Avtentikacija.html#cb685-4" tabindex="-1"></a>      <span class="dt">usernameField</span><span class="op">:</span> <span class="st">&quot;email&quot;</span><span class="op">,</span></span>
<span id="cb685-5"><a href="Avtentikacija.html#cb685-5" tabindex="-1"></a>      <span class="dt">passwordField</span><span class="op">:</span> <span class="st">&quot;password&quot;</span><span class="op">,</span></span>
<span id="cb685-6"><a href="Avtentikacija.html#cb685-6" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb685-7"><a href="Avtentikacija.html#cb685-7" tabindex="-1"></a>    <span class="kw">async</span> (username<span class="op">,</span> password<span class="op">,</span> cbDone) <span class="kw">=&gt;</span> {</span>
<span id="cb685-8"><a href="Avtentikacija.html#cb685-8" tabindex="-1"></a>      <span class="cf">try</span> {</span>
<span id="cb685-9"><a href="Avtentikacija.html#cb685-9" tabindex="-1"></a>        <span class="kw">let</span> user <span class="op">=</span> <span class="cf">await</span> User<span class="op">.</span><span class="fu">findOne</span>({ <span class="dt">email</span><span class="op">:</span> username })<span class="op">;</span></span>
<span id="cb685-10"><a href="Avtentikacija.html#cb685-10" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>user)</span>
<span id="cb685-11"><a href="Avtentikacija.html#cb685-11" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">cbDone</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> { <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Incorrect username.&quot;</span> })<span class="op">;</span></span>
<span id="cb685-12"><a href="Avtentikacija.html#cb685-12" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>user<span class="op">.</span><span class="fu">validPassword</span>(password))</span>
<span id="cb685-13"><a href="Avtentikacija.html#cb685-13" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">cbDone</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> { <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Incorrect password.&quot;</span> })<span class="op">;</span></span>
<span id="cb685-14"><a href="Avtentikacija.html#cb685-14" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">return</span> <span class="fu">cbDone</span>(<span class="kw">null</span><span class="op">,</span> user)<span class="op">;</span></span>
<span id="cb685-15"><a href="Avtentikacija.html#cb685-15" tabindex="-1"></a>      } <span class="cf">catch</span> (err) {</span>
<span id="cb685-16"><a href="Avtentikacija.html#cb685-16" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">cbDone</span>(err)<span class="op">;</span></span>
<span id="cb685-17"><a href="Avtentikacija.html#cb685-17" tabindex="-1"></a>      }</span>
<span id="cb685-18"><a href="Avtentikacija.html#cb685-18" tabindex="-1"></a>    }</span>
<span id="cb685-19"><a href="Avtentikacija.html#cb685-19" tabindex="-1"></a>  )</span>
<span id="cb685-20"><a href="Avtentikacija.html#cb685-20" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>V osrednjo aplikacijo moramo dodati odvisnost od Passporta, kjer je pomembno, da jo vključimo za shemo podatkovne baze.</p>
<p><code>server.js</code></p>
<div class="sourceCode" id="cb686"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb686-1"><a href="Avtentikacija.html#cb686-1" tabindex="-1"></a><span class="pp">require</span>(<span class="st">&quot;dotenv&quot;</span>)<span class="op">.</span><span class="fu">config</span>()<span class="op">;</span></span>
<span id="cb686-2"><a href="Avtentikacija.html#cb686-2" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;express&quot;</span>)<span class="op">;</span></span>
<span id="cb686-3"><a href="Avtentikacija.html#cb686-3" tabindex="-1"></a><span class="kw">const</span> path <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;path&quot;</span>)<span class="op">;</span></span>
<span id="cb686-4"><a href="Avtentikacija.html#cb686-4" tabindex="-1"></a><span class="kw">const</span> bodyParser <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;body-parser&quot;</span>)<span class="op">;</span></span>
<span id="cb686-5"><a href="Avtentikacija.html#cb686-5" tabindex="-1"></a><span class="kw">const</span> cors <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;cors&quot;</span>)<span class="op">;</span></span>
<span id="cb686-6"><a href="Avtentikacija.html#cb686-6" tabindex="-1"></a><span class="kw">const</span> passport <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;passport&quot;</span>)<span class="op">;</span></span>
<span id="cb686-7"><a href="Avtentikacija.html#cb686-7" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb686-8"><a href="Avtentikacija.html#cb686-8" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb686-9"><a href="Avtentikacija.html#cb686-9" tabindex="-1"></a><span class="co"> * Database connection</span></span>
<span id="cb686-10"><a href="Avtentikacija.html#cb686-10" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb686-11"><a href="Avtentikacija.html#cb686-11" tabindex="-1"></a><span class="pp">require</span>(<span class="st">&quot;./api/models/db.js&quot;</span>)<span class="op">;</span></span>
<span id="cb686-12"><a href="Avtentikacija.html#cb686-12" tabindex="-1"></a><span class="pp">require</span>(<span class="st">&quot;./api/config/passport&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Passport moramo tudi inicializirati, in sicer po delu kode, kjer so opredeljene statične poti.</p>
<p><code>server.js</code></p>
<div class="sourceCode" id="cb687"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb687-1"><a href="Avtentikacija.html#cb687-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb687-2"><a href="Avtentikacija.html#cb687-2" tabindex="-1"></a><span class="co"> * Static pages</span></span>
<span id="cb687-3"><a href="Avtentikacija.html#cb687-3" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb687-4"><a href="Avtentikacija.html#cb687-4" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">static</span>(path<span class="op">.</span><span class="fu">join</span>(<span class="bu">__dirname</span><span class="op">,</span> <span class="st">&quot;angular&quot;</span><span class="op">,</span> <span class="st">&quot;build&quot;</span>)))<span class="op">;</span></span>
<span id="cb687-5"><a href="Avtentikacija.html#cb687-5" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb687-6"><a href="Avtentikacija.html#cb687-6" tabindex="-1"></a><span class="co"> * Passport</span></span>
<span id="cb687-7"><a href="Avtentikacija.html#cb687-7" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb687-8"><a href="Avtentikacija.html#cb687-8" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(passport<span class="op">.</span><span class="fu">initialize</span>())<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#namestitev-in-konfiguracija-passporta code:eq(2)").markRegExp(/npm.+/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code:eq(3)").markRegExp(/.+/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code:eq(5)").markRegExp(/mkdir config/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code:eq(6)").markRegExp(/passport\.js/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code:eq(7)").markRegExp(/passport\.js/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code:eq(8)").markRegExp(/.+/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code.javascript:eq(1)").markRegExp(/.+/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code.javascript:eq(2)").markRegExp(/.+passport.+/, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code.javascript:eq(3)").markRegExp(/\s+?\/\*\*[^\*]+?\* Passport[\s\S]+?\//, options_dodaj);
    $("#namestitev-in-konfiguracija-passporta code.javascript:eq(3)").markRegExp(/.+initialize.+/, options_dodaj);
  });
</script>
</div>
<div id="kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt" class="section level3 hasAnchor" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Kreiranje API dostopne točke in vračanje JSON spletnih žetonov (JWT)<a href="Avtentikacija.html#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Če želimo uporabnikom omogočiti prijavo in registracijo, bo treba dodati 2 API dostopni točki. Najprej bomo v <code>api/routes/api.js</code> opredelili usmerjevalnik, ki bo implementiran v datoteki <code>app_api/controllers/authentication.js</code>.</p>
<p><code>api/routes/api.js</code></p>
<div class="sourceCode" id="cb688"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb688-1"><a href="Avtentikacija.html#cb688-1" tabindex="-1"></a><span class="kw">const</span> ctrlLocations <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;../controllers/locations&quot;</span>)<span class="op">;</span></span>
<span id="cb688-2"><a href="Avtentikacija.html#cb688-2" tabindex="-1"></a><span class="kw">const</span> ctrlComments <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;../controllers/comments&quot;</span>)<span class="op">;</span></span>
<span id="cb688-3"><a href="Avtentikacija.html#cb688-3" tabindex="-1"></a><span class="kw">const</span> ctrlAuthentication <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;../controllers/authentication&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Kot že omenjeno, bomo ponudili 2 funkcionalnosti: <strong>registracijo</strong> na naslovu <code>/api/register</code> in <strong>prijavo</strong> na naslovu <code>/api/login</code>.</p>
<p><code>api/routes/api.js</code></p>
<div class="sourceCode" id="cb689"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb689-1"><a href="Avtentikacija.html#cb689-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb689-2"><a href="Avtentikacija.html#cb689-2" tabindex="-1"></a><span class="co"> * Authentication</span></span>
<span id="cb689-3"><a href="Avtentikacija.html#cb689-3" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb689-4"><a href="Avtentikacija.html#cb689-4" tabindex="-1"></a>router<span class="op">.</span><span class="fu">post</span>(<span class="st">&quot;/register&quot;</span><span class="op">,</span> ctrlAuthentication<span class="op">.</span><span class="at">register</span>)<span class="op">;</span></span>
<span id="cb689-5"><a href="Avtentikacija.html#cb689-5" tabindex="-1"></a>router<span class="op">.</span><span class="fu">post</span>(<span class="st">&quot;/login&quot;</span><span class="op">,</span> ctrlAuthentication<span class="op">.</span><span class="at">login</span>)<span class="op">;</span></span></code></pre></div>
<p>Ker krmilnika še nismo opredelili, kreirajmo datoteko <code>api/controllers/authentication.js</code>, kjer najprej poskrbimo za odvisnosti.</p>
<p><code>api/controllers/authentication.js</code></p>
<div class="sourceCode" id="cb690"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb690-1"><a href="Avtentikacija.html#cb690-1" tabindex="-1"></a><span class="kw">const</span> passport <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;passport&quot;</span>)<span class="op">;</span></span>
<span id="cb690-2"><a href="Avtentikacija.html#cb690-2" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;mongoose&quot;</span>)<span class="op">;</span></span>
<span id="cb690-3"><a href="Avtentikacija.html#cb690-3" tabindex="-1"></a><span class="kw">const</span> User <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&quot;User&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Sledi <strong>implementacija metode za registracijo uporabnika</strong> <code>register</code>, kjer najprej preverimo, ali je uporabnik posredoval vse zahtevane podatke. Nato kreiramo nov dokument in nastavimo posredovane podatke s strani uporabnika ter nastavimo geslo, ki poskrbi za generiranje naključne in zgoščene vrednosti. Na koncu uporabnika shranimo v podatkovno bazo in v odgovoru odjemalcu vrnemo JWT žeton.</p>
<p><code>api/controllers/authentication.js</code></p>
<div class="sourceCode" id="cb691"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb691-1"><a href="Avtentikacija.html#cb691-1" tabindex="-1"></a><span class="kw">const</span> register <span class="op">=</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb691-2"><a href="Avtentikacija.html#cb691-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">email</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">password</span>)</span>
<span id="cb691-3"><a href="Avtentikacija.html#cb691-3" tabindex="-1"></a>    <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;All fields required.&quot;</span> })<span class="op">;</span></span>
<span id="cb691-4"><a href="Avtentikacija.html#cb691-4" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="kw">new</span> <span class="fu">User</span>()<span class="op">;</span></span>
<span id="cb691-5"><a href="Avtentikacija.html#cb691-5" tabindex="-1"></a>  user<span class="op">.</span><span class="at">name</span> <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb691-6"><a href="Avtentikacija.html#cb691-6" tabindex="-1"></a>  user<span class="op">.</span><span class="at">email</span> <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">email</span><span class="op">;</span></span>
<span id="cb691-7"><a href="Avtentikacija.html#cb691-7" tabindex="-1"></a>  user<span class="op">.</span><span class="fu">setPassword</span>(req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">password</span>)<span class="op">;</span></span>
<span id="cb691-8"><a href="Avtentikacija.html#cb691-8" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb691-9"><a href="Avtentikacija.html#cb691-9" tabindex="-1"></a>    <span class="cf">await</span> user<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb691-10"><a href="Avtentikacija.html#cb691-10" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">token</span><span class="op">:</span> user<span class="op">.</span><span class="fu">generateJwt</span>() })<span class="op">;</span></span>
<span id="cb691-11"><a href="Avtentikacija.html#cb691-11" tabindex="-1"></a>  } <span class="cf">catch</span> (err) {</span>
<span id="cb691-12"><a href="Avtentikacija.html#cb691-12" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb691-13"><a href="Avtentikacija.html#cb691-13" tabindex="-1"></a>  }</span>
<span id="cb691-14"><a href="Avtentikacija.html#cb691-14" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb691-15"><a href="Avtentikacija.html#cb691-15" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> {</span>
<span id="cb691-16"><a href="Avtentikacija.html#cb691-16" tabindex="-1"></a>  register<span class="op">,</span></span>
<span id="cb691-17"><a href="Avtentikacija.html#cb691-17" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Pri <strong>implementaciji metode za prijavo</strong> <code>login</code> dostopamo do passport avtentikacije, kjer se v ozadju ponovno izračuna zgoščena vrednost na podlagi naključne vrednosti in gesla ter se preveri ujemanje. Če ujemanje obstaja, potem uporabniku vrnemo JWT žeton. Pozorni moramo biti tudi na vrstico <code>...})(req, res)</code>, kjer je treba okolju passport omogočiti dostop do zahteve in odgovora.</p>
<p><code>api/controllers/authentication.js</code></p>
<div class="sourceCode" id="cb692"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb692-1"><a href="Avtentikacija.html#cb692-1" tabindex="-1"></a><span class="kw">const</span> login <span class="op">=</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb692-2"><a href="Avtentikacija.html#cb692-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">email</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">password</span>)</span>
<span id="cb692-3"><a href="Avtentikacija.html#cb692-3" tabindex="-1"></a>    <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;All fields required.&quot;</span> })<span class="op">;</span></span>
<span id="cb692-4"><a href="Avtentikacija.html#cb692-4" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb692-5"><a href="Avtentikacija.html#cb692-5" tabindex="-1"></a>    passport<span class="op">.</span><span class="fu">authenticate</span>(<span class="st">&quot;local&quot;</span><span class="op">,</span> (err<span class="op">,</span> user<span class="op">,</span> info) <span class="kw">=&gt;</span> {</span>
<span id="cb692-6"><a href="Avtentikacija.html#cb692-6" tabindex="-1"></a>      <span class="cf">if</span> (err) <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb692-7"><a href="Avtentikacija.html#cb692-7" tabindex="-1"></a>      <span class="cf">if</span> (user) <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">token</span><span class="op">:</span> user<span class="op">.</span><span class="fu">generateJwt</span>() })<span class="op">;</span></span>
<span id="cb692-8"><a href="Avtentikacija.html#cb692-8" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">401</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> info<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb692-9"><a href="Avtentikacija.html#cb692-9" tabindex="-1"></a>    })(req<span class="op">,</span> res)<span class="op">;</span></span>
<span id="cb692-10"><a href="Avtentikacija.html#cb692-10" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb692-11"><a href="Avtentikacija.html#cb692-11" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> {</span>
<span id="cb692-12"><a href="Avtentikacija.html#cb692-12" tabindex="-1"></a>  register<span class="op">,</span></span>
<span id="cb692-13"><a href="Avtentikacija.html#cb692-13" tabindex="-1"></a>  login<span class="op">,</span></span>
<span id="cb692-14"><a href="Avtentikacija.html#cb692-14" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Če želimo preveriti delovanje naših novih storitev, lahko za to uporabimo program <code>curl</code>. Za registracijo posredujemo <code>POST</code> zahtevo na URL naslov <code>/api/register</code>. Poskrbeti moramo, da so v telesu zahteve (<code>x-www-form-urlencoded</code>) podatki <code>name</code>, <code>email</code> in <code>password</code>. Kot rezultat nam storitev vrne JWT žeton.</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb693-1"><a href="Avtentikacija.html#cb693-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb693-2"><a href="Avtentikacija.html#cb693-2" tabindex="-1"></a>       <span class="at">-d</span> <span class="st">&quot;name=Dejan Lavbič&amp;email=dejan@lavbic.net&amp;password=test&quot;</span> <span class="dt">\</span></span>
<span id="cb693-3"><a href="Avtentikacija.html#cb693-3" tabindex="-1"></a>       <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb693-4"><a href="Avtentikacija.html#cb693-4" tabindex="-1"></a>       http://localhost:3000/api/register</span>
<span id="cb693-5"><a href="Avtentikacija.html#cb693-5" tabindex="-1"></a></span>
<span id="cb693-6"><a href="Avtentikacija.html#cb693-6" tabindex="-1"></a><span class="ex">{</span><span class="st">&quot;token&quot;</span><span class="ex">:</span><span class="st">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2Mzc2MzY5YmY3ZTYxMzY0ZGRkZTQ0NDMiLCJlbWFpbCI6ImRlamFuQGxhdmJpYy5uZXQiLCJuYW1lIjoiRGVqYW4gTGF2YmnEjSIsImV4cCI6MTY2OTI5NjQxMSwiaWF0IjoxNjY4NjkxNjExfQ.c5_VjSWsQfyE7QS2-y01GF5ip3sF8yQ-ivS7WN6DZII&quot;</span><span class="ex">}</span></span></code></pre></div>
<p>Preverimo lahko tudi stanje v podatkovni bazi, kjer opazimo, da se v zbirki <code>Users</code> nahaja nov uporabnik z elektronskim naslovom <code>dejan@lavbic.net</code>.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb694-1"><a href="Avtentikacija.html#cb694-1" tabindex="-1"></a><span class="ex">$</span> docker exec <span class="at">-it</span> sp-mongo-db bash <span class="at">-c</span> <span class="st">&quot;mongosh Demo --eval </span><span class="dt">\</span></span>
<span id="cb694-2"><a href="Avtentikacija.html#cb694-2" tabindex="-1"></a><span class="st">    &#39;db.Users.findOne({</span><span class="dt">\&quot;</span><span class="st">email</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">dejan@lavbic.net</span><span class="dt">\&quot;</span><span class="st">})&#39;&quot;</span></span>
<span id="cb694-3"><a href="Avtentikacija.html#cb694-3" tabindex="-1"></a></span>
<span id="cb694-4"><a href="Avtentikacija.html#cb694-4" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb694-5"><a href="Avtentikacija.html#cb694-5" tabindex="-1"></a>  <span class="ex">_id:</span> ObjectId<span class="er">(</span><span class="st">&quot;6376369bf7e61364ddde4443&quot;</span><span class="kw">)</span><span class="ex">,</span></span>
<span id="cb694-6"><a href="Avtentikacija.html#cb694-6" tabindex="-1"></a>  <span class="ex">name:</span> <span class="st">&#39;Dejan Lavbič&#39;</span>,</span>
<span id="cb694-7"><a href="Avtentikacija.html#cb694-7" tabindex="-1"></a>  <span class="ex">email:</span> <span class="st">&#39;dejan@lavbic.net&#39;</span>,</span>
<span id="cb694-8"><a href="Avtentikacija.html#cb694-8" tabindex="-1"></a>  <span class="ex">salt:</span> <span class="st">&#39;9b07b3e57ed9201ef02f35719c0f48f1&#39;</span>,</span>
<span id="cb694-9"><a href="Avtentikacija.html#cb694-9" tabindex="-1"></a>  <span class="ex">hash:</span> <span class="st">&#39;1c98e0af3924f84a13e7be1c4d7628c8646c931967c8878f1f475b65602eaf86236a6df7940af7ad15618f97509876cf83bc2b68cab6d513c4298f7a18d047d3&#39;</span>,</span>
<span id="cb694-10"><a href="Avtentikacija.html#cb694-10" tabindex="-1"></a>  <span class="ex">__v:</span> 0</span>
<span id="cb694-11"><a href="Avtentikacija.html#cb694-11" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Ravno tako lahko preverimo prijavo uporabnika, kjer posredujemo <code>POST</code> zahtevo na URL naslov <code>/api/login</code>. Poskrbeti moramo, da sta v telesu zahteve (<code>x-www-form-urlencoded</code>) podatka <code>email</code> in <code>password</code>.</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb695-1"><a href="Avtentikacija.html#cb695-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb695-2"><a href="Avtentikacija.html#cb695-2" tabindex="-1"></a>       <span class="at">-d</span> <span class="st">&quot;email=dejan@lavbic.net&amp;password=test&quot;</span> <span class="dt">\</span></span>
<span id="cb695-3"><a href="Avtentikacija.html#cb695-3" tabindex="-1"></a>       <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb695-4"><a href="Avtentikacija.html#cb695-4" tabindex="-1"></a>       http://localhost:3000/api/login</span>
<span id="cb695-5"><a href="Avtentikacija.html#cb695-5" tabindex="-1"></a>       </span>
<span id="cb695-6"><a href="Avtentikacija.html#cb695-6" tabindex="-1"></a><span class="ex">{</span><span class="st">&quot;token&quot;</span><span class="ex">:</span><span class="st">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2Mzc2MzY5YmY3ZTYxMzY0ZGRkZTQ0NDMiLCJlbWFpbCI6ImRlamFuQGxhdmJpYy5uZXQiLCJuYW1lIjoiRGVqYW4gTGF2YmnEjSIsImV4cCI6MTY2OTI5NjgxNywiaWF0IjoxNjY4NjkyMDE3fQ.OMrnlGp3ZE3LCZvdyPBcE6K5mQpAAlcxDv52oveufGo&quot;</span><span class="ex">}</span></span></code></pre></div>
<p>V primeru uspešne prijave na storitev nam vrne JWT žeton, medtem ko v primeru napake dobimo sporočilo z opisom napake.</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb696-1"><a href="Avtentikacija.html#cb696-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb696-2"><a href="Avtentikacija.html#cb696-2" tabindex="-1"></a>       <span class="at">-d</span> <span class="st">&quot;email=dejan@lavbic.net&amp;password=test123&quot;</span> <span class="dt">\</span></span>
<span id="cb696-3"><a href="Avtentikacija.html#cb696-3" tabindex="-1"></a>       <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb696-4"><a href="Avtentikacija.html#cb696-4" tabindex="-1"></a>       http://localhost:3000/api/login</span>
<span id="cb696-5"><a href="Avtentikacija.html#cb696-5" tabindex="-1"></a></span>
<span id="cb696-6"><a href="Avtentikacija.html#cb696-6" tabindex="-1"></a><span class="ex">{</span><span class="st">&quot;message&quot;</span><span class="ex">:</span><span class="st">&quot;Incorrect password.&quot;</span><span class="ex">}</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.javascript:eq(0)").markRegExp(/.+ctrlAuthentication.+/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.javascript:eq(1)").markRegExp(/.+/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code:eq(8)").markRegExp(/authentication.+/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code:eq(9)").markRegExp(/authentication.+/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.javascript:eq(2)").markRegExp(/.+/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.javascript:eq(3)").markRegExp(/.+/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.javascript:eq(4)").markRegExp(/const login[\s\S]+?};/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.javascript:eq(4)").markRegExp(/,[\s|\n]+?login/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.bash:eq(0)").markRegExp(/curl[\s\S]+?api\/register/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.bash:eq(1)").markRegExp(/docker[\s\S]+?'"/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.bash:eq(2)").markRegExp(/curl[\s\S]+?api\/login/, options_dodaj);
    $("#kreiranje-api-dostopne-točke-in-vračanje-json-spletnih-žetonov-jwt code.bash:eq(3)").markRegExp(/curl[\s\S]+?api\/login/, options_dodaj);
  });
</script>
</div>
</div>
<div id="Varnostna-zascita-izbranih-API-dostopnih-tock" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Varnostna zaščita izbranih API dostopnih točk<a href="Avtentikacija.html#Varnostna-zascita-izbranih-API-dostopnih-tock" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>V produkcijskem okolju je pogosta funkcionalna zahteva zaščita API dostopnih točk ter omogočanje dostopa zgolj prijavljenim uporabnikom. V primeru naše aplikacije želimo dodajanje komentarjev omogočiti zgolj registriranim uporabnikom, kar bomo dosegli z naslednjimi koraki:</p>
<ul>
<li>klic API-ja za dodajanje novega komentarja bomo dovolili zgolj uporabnikom, ki bodo poleg zahteve posredovali tudi veljaven žeton JWT,</li>
<li>že v krmilniku bomo preverili, ali uporabnik obstaja in ima tako posledično pravico dodajanja novega komentarja.</li>
</ul>
<div id="dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Dodajanje vmesne avtentikacijske ravni pri Express usmerjanju<a href="Avtentikacija.html#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>V Expressu lahko s pomočjo <strong>vmesnih ravni</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/Middleware"><i class="fa-brands fa-wikipedia-w"></i>middleware</a>)</em> dosežemo obvladovanje uporabniških zahtev med usmerjevalnikom in krmilnikom. To pomeni, da se omenjena funkcionalnost izvede še pred izvajanjem kode v krmilniku in tako lahko onemogoči izvajanje določenih funkcij.</p>
<p><strong>Vmesni sloj</strong> želimo v našem primeru uporabiti za <strong>preverjanje veljavnosti JWT žetona</strong>, <strong>pridobivanje podatkov iz žetona</strong> in <strong>dodajanje pridobljenih podatkov v objekt zahteve</strong>, da lahko do njih dostopa tudi krmilnik. Za ta namen bomo uporabili knjižnico <a href="https://www.npmjs.com/package/express-jwt"><i class="fa-brands fa-node-js"></i><code>express-jwt</code></a>.</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb697-1"><a href="Avtentikacija.html#cb697-1" tabindex="-1"></a><span class="ex">$</span> npm install express-jwt <span class="at">--save</span></span></code></pre></div>
<p>Knjižnico <code>express-jwt</code> vključimo v usmerjevalnik implementacije REST API-ja v datoteki <code>api/routes/api.js</code>. Prav tako poskrbimo za parametre avtentikacije, kjer opredelimo geslo, ki se nahaja v okoljski spremenljivki <code>JWT_SECRET</code>, in koristno vsebino <code>payload</code> ter algoritem, s katerim je bila vsebina JWT žetona podpisana.</p>
<p><code>api/routes/api.js</code></p>
<div class="sourceCode" id="cb698"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb698-1"><a href="Avtentikacija.html#cb698-1" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;express&quot;</span>)<span class="op">;</span></span>
<span id="cb698-2"><a href="Avtentikacija.html#cb698-2" tabindex="-1"></a><span class="kw">const</span> router <span class="op">=</span> express<span class="op">.</span><span class="fu">Router</span>()<span class="op">;</span></span>
<span id="cb698-3"><a href="Avtentikacija.html#cb698-3" tabindex="-1"></a><span class="kw">const</span> { <span class="dt">expressjwt</span><span class="op">:</span> jwt } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;express-jwt&quot;</span>)<span class="op">;</span></span>
<span id="cb698-4"><a href="Avtentikacija.html#cb698-4" tabindex="-1"></a><span class="kw">const</span> auth <span class="op">=</span> <span class="fu">jwt</span>({</span>
<span id="cb698-5"><a href="Avtentikacija.html#cb698-5" tabindex="-1"></a>  <span class="dt">secret</span><span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">JWT_SECRET</span><span class="op">,</span></span>
<span id="cb698-6"><a href="Avtentikacija.html#cb698-6" tabindex="-1"></a>  <span class="dt">userProperty</span><span class="op">:</span> <span class="st">&quot;payload&quot;</span><span class="op">,</span></span>
<span id="cb698-7"><a href="Avtentikacija.html#cb698-7" tabindex="-1"></a>  <span class="dt">algorithms</span><span class="op">:</span> [<span class="st">&quot;HS256&quot;</span>]<span class="op">,</span></span>
<span id="cb698-8"><a href="Avtentikacija.html#cb698-8" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb698-9"><a href="Avtentikacija.html#cb698-9" tabindex="-1"></a><span class="kw">const</span> ctrlLocations <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;../controllers/locations&quot;</span>)<span class="op">;</span></span>
<span id="cb698-10"><a href="Avtentikacija.html#cb698-10" tabindex="-1"></a><span class="kw">const</span> ctrlComments <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;../controllers/comments&quot;</span>)<span class="op">;</span></span>
<span id="cb698-11"><a href="Avtentikacija.html#cb698-11" tabindex="-1"></a><span class="kw">const</span> ctrlAuthentication <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;../controllers/authentication&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>Opredelitev avtentikacije vključimo kot dodatni parameter vmesnega sloja, ki se tudi <strong>pri vrstnem redu parametrov metode usmerjevalnika nahaja na sredini</strong>. Zaščitili bomo zgolj <code>POST</code>, <code>PUT</code> in <code>DELETE</code> metode.</p>
<p><code>api/routes/api.js</code></p>
<div class="sourceCode" id="cb699"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb699-1"><a href="Avtentikacija.html#cb699-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb699-2"><a href="Avtentikacija.html#cb699-2" tabindex="-1"></a><span class="co"> * Comments</span></span>
<span id="cb699-3"><a href="Avtentikacija.html#cb699-3" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb699-4"><a href="Avtentikacija.html#cb699-4" tabindex="-1"></a>router<span class="op">.</span><span class="fu">post</span>(</span>
<span id="cb699-5"><a href="Avtentikacija.html#cb699-5" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments&quot;</span><span class="op">,</span></span>
<span id="cb699-6"><a href="Avtentikacija.html#cb699-6" tabindex="-1"></a>  auth<span class="op">,</span></span>
<span id="cb699-7"><a href="Avtentikacija.html#cb699-7" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsCreate</span></span>
<span id="cb699-8"><a href="Avtentikacija.html#cb699-8" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb699-9"><a href="Avtentikacija.html#cb699-9" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span>(</span>
<span id="cb699-10"><a href="Avtentikacija.html#cb699-10" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span><span class="op">,</span></span>
<span id="cb699-11"><a href="Avtentikacija.html#cb699-11" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsReadOne</span></span>
<span id="cb699-12"><a href="Avtentikacija.html#cb699-12" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb699-13"><a href="Avtentikacija.html#cb699-13" tabindex="-1"></a>router<span class="op">.</span><span class="fu">put</span>(</span>
<span id="cb699-14"><a href="Avtentikacija.html#cb699-14" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span><span class="op">,</span></span>
<span id="cb699-15"><a href="Avtentikacija.html#cb699-15" tabindex="-1"></a>  auth<span class="op">,</span></span>
<span id="cb699-16"><a href="Avtentikacija.html#cb699-16" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsUpdateOne</span></span>
<span id="cb699-17"><a href="Avtentikacija.html#cb699-17" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb699-18"><a href="Avtentikacija.html#cb699-18" tabindex="-1"></a>router<span class="op">.</span><span class="fu">delete</span>(</span>
<span id="cb699-19"><a href="Avtentikacija.html#cb699-19" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span><span class="op">,</span></span>
<span id="cb699-20"><a href="Avtentikacija.html#cb699-20" tabindex="-1"></a>  auth<span class="op">,</span></span>
<span id="cb699-21"><a href="Avtentikacija.html#cb699-21" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsDeleteOne</span></span>
<span id="cb699-22"><a href="Avtentikacija.html#cb699-22" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>Na tem mestu lahko tudi izpopolnimo usmerjevalno tabelo, da bo le-ta bolj pregledna, kjer so HTTP metode združene na posamezni poti.</p>
<p>Če je avtentikacija uspešna, bo <code>express-jwt</code> vmesni sloj poskrbel, da bo v parametru <code>auth</code> pri zahtevi <code>req</code> an voljo koristna vsebina (<code>payload</code>) žetona JWT.</p>
<p><code>api/routes/api.js</code></p>
<div class="sourceCode" id="cb700"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb700-1"><a href="Avtentikacija.html#cb700-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb700-2"><a href="Avtentikacija.html#cb700-2" tabindex="-1"></a><span class="co"> * Comments</span></span>
<span id="cb700-3"><a href="Avtentikacija.html#cb700-3" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb700-4"><a href="Avtentikacija.html#cb700-4" tabindex="-1"></a>router<span class="op">.</span><span class="fu">post</span>(</span>
<span id="cb700-5"><a href="Avtentikacija.html#cb700-5" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments&quot;</span><span class="op">,</span></span>
<span id="cb700-6"><a href="Avtentikacija.html#cb700-6" tabindex="-1"></a>  auth<span class="op">,</span></span>
<span id="cb700-7"><a href="Avtentikacija.html#cb700-7" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsCreate</span></span>
<span id="cb700-8"><a href="Avtentikacija.html#cb700-8" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb700-9"><a href="Avtentikacija.html#cb700-9" tabindex="-1"></a>router</span>
<span id="cb700-10"><a href="Avtentikacija.html#cb700-10" tabindex="-1"></a>  <span class="op">.</span><span class="fu">route</span>(<span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span>)</span>
<span id="cb700-11"><a href="Avtentikacija.html#cb700-11" tabindex="-1"></a>  <span class="op">.</span><span class="fu">get</span>(ctrlComments<span class="op">.</span><span class="at">commentsReadOne</span>)</span>
<span id="cb700-12"><a href="Avtentikacija.html#cb700-12" tabindex="-1"></a>  <span class="op">.</span><span class="fu">put</span>(auth<span class="op">,</span> ctrlComments<span class="op">.</span><span class="at">commentsUpdateOne</span>)</span>
<span id="cb700-13"><a href="Avtentikacija.html#cb700-13" tabindex="-1"></a>  <span class="op">.</span><span class="fu">delete</span>(auth<span class="op">,</span> ctrlComments<span class="op">.</span><span class="at">commentsDeleteOne</span>)<span class="op">;</span></span>
<span id="cb700-14"><a href="Avtentikacija.html#cb700-14" tabindex="-1"></a>router<span class="op">.</span><span class="fu">get</span>(</span>
<span id="cb700-15"><a href="Avtentikacija.html#cb700-15" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span><span class="op">,</span></span>
<span id="cb700-16"><a href="Avtentikacija.html#cb700-16" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsReadOne</span></span>
<span id="cb700-17"><a href="Avtentikacija.html#cb700-17" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb700-18"><a href="Avtentikacija.html#cb700-18" tabindex="-1"></a>router<span class="op">.</span><span class="fu">put</span>(</span>
<span id="cb700-19"><a href="Avtentikacija.html#cb700-19" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span><span class="op">,</span></span>
<span id="cb700-20"><a href="Avtentikacija.html#cb700-20" tabindex="-1"></a>  auth<span class="op">,</span></span>
<span id="cb700-21"><a href="Avtentikacija.html#cb700-21" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsUpdateOne</span></span>
<span id="cb700-22"><a href="Avtentikacija.html#cb700-22" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb700-23"><a href="Avtentikacija.html#cb700-23" tabindex="-1"></a>router<span class="op">.</span><span class="fu">delete</span>(</span>
<span id="cb700-24"><a href="Avtentikacija.html#cb700-24" tabindex="-1"></a>  <span class="st">&quot;/locations/:locationId/comments/:commentId&quot;</span><span class="op">,</span></span>
<span id="cb700-25"><a href="Avtentikacija.html#cb700-25" tabindex="-1"></a>  auth<span class="op">,</span></span>
<span id="cb700-26"><a href="Avtentikacija.html#cb700-26" tabindex="-1"></a>  ctrlComments<span class="op">.</span><span class="at">commentsDeleteOne</span></span>
<span id="cb700-27"><a href="Avtentikacija.html#cb700-27" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p>Prav tako moramo poskrbeti za obvladovanje napak, kjer detektiramo dogodek nepooblaščenega dostopa <code>UnauthorizedError</code> in v tem primeru vrnemo napako <span class="math inline">\(401\)</span>.</p>
<p><code>server.js</code></p>
<div class="sourceCode" id="cb701"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb701-1"><a href="Avtentikacija.html#cb701-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb701-2"><a href="Avtentikacija.html#cb701-2" tabindex="-1"></a><span class="co"> * Authorization error handler</span></span>
<span id="cb701-3"><a href="Avtentikacija.html#cb701-3" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb701-4"><a href="Avtentikacija.html#cb701-4" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>((err<span class="op">,</span> req<span class="op">,</span> res<span class="op">,</span> next) <span class="kw">=&gt;</span> {</span>
<span id="cb701-5"><a href="Avtentikacija.html#cb701-5" tabindex="-1"></a>  <span class="cf">if</span> (err<span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">&quot;UnauthorizedError&quot;</span>)</span>
<span id="cb701-6"><a href="Avtentikacija.html#cb701-6" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">401</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb701-7"><a href="Avtentikacija.html#cb701-7" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb701-8"><a href="Avtentikacija.html#cb701-8" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb701-9"><a href="Avtentikacija.html#cb701-9" tabindex="-1"></a><span class="co"> * Start server</span></span>
<span id="cb701-10"><a href="Avtentikacija.html#cb701-10" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb701-11"><a href="Avtentikacija.html#cb701-11" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(port<span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb701-12"><a href="Avtentikacija.html#cb701-12" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb701-13"><a href="Avtentikacija.html#cb701-13" tabindex="-1"></a>    <span class="vs">`Demo app started in &#39;</span><span class="sc">${</span></span>
<span id="cb701-14"><a href="Avtentikacija.html#cb701-14" tabindex="-1"></a>      <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span> <span class="op">||</span> <span class="st">&quot;development&quot;</span></span>
<span id="cb701-15"><a href="Avtentikacija.html#cb701-15" tabindex="-1"></a>    <span class="sc">}</span><span class="vs"> mode&#39; listening on port </span><span class="sc">${</span>port<span class="sc">}</span><span class="vs">!`</span></span>
<span id="cb701-16"><a href="Avtentikacija.html#cb701-16" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb701-17"><a href="Avtentikacija.html#cb701-17" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Če želimo sedaj s pomočjo POST zahteve dodati nov komentar, nam REST API vrne napako, saj za dostop potrebujemo JWT žeton.</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb702-1"><a href="Avtentikacija.html#cb702-1" tabindex="-1"></a><span class="ex">$</span> LOCATION_ID=<span class="va">$(</span><span class="ex">docker</span> exec <span class="at">-it</span> sp-mongo-db bash <span class="at">-c</span> <span class="st">&quot;mongosh Demo --eval </span><span class="dt">\</span></span>
<span id="cb702-2"><a href="Avtentikacija.html#cb702-2" tabindex="-1"></a><span class="st">    &#39;db.Locations.findOne(</span><span class="dt">\</span></span>
<span id="cb702-3"><a href="Avtentikacija.html#cb702-3" tabindex="-1"></a><span class="st">      {</span><span class="dt">\&quot;</span><span class="st">name</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">Ljubljana - Viško pokopališče</span><span class="dt">\&quot;</span><span class="st">}, { _id: 1 })&#39;&quot;</span><span class="dt">\</span></span>
<span id="cb702-4"><a href="Avtentikacija.html#cb702-4" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&#39;ObjectId&#39;</span> <span class="dt">\</span></span>
<span id="cb702-5"><a href="Avtentikacija.html#cb702-5" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/.*&quot;\(.*\)&quot;.*/\1/&#39;</span><span class="va">)</span></span>
<span id="cb702-6"><a href="Avtentikacija.html#cb702-6" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb702-7"><a href="Avtentikacija.html#cb702-7" tabindex="-1"></a>       <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments&quot;</span> <span class="dt">\</span></span>
<span id="cb702-8"><a href="Avtentikacija.html#cb702-8" tabindex="-1"></a>       <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb702-9"><a href="Avtentikacija.html#cb702-9" tabindex="-1"></a>       <span class="at">-d</span> <span class="st">&quot;author=Dejan%20Lavbi%C4%8D&amp;rating=3&amp;comment=Srednja%20%C5%BEalost.&quot;</span></span>
<span id="cb702-10"><a href="Avtentikacija.html#cb702-10" tabindex="-1"></a></span>
<span id="cb702-11"><a href="Avtentikacija.html#cb702-11" tabindex="-1"></a><span class="ex">{</span><span class="st">&quot;message&quot;</span><span class="ex">:</span><span class="st">&quot;No authorization token was found&quot;</span><span class="ex">}</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.bash:eq(0)").markRegExp(/npm.+/, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.javascript:eq(0)").markRegExp(/.+jwt.+/i, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.javascript:eq(0)").markRegExp(/const auth[\s\S]+?\}\);/, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.javascript:eq(1)").markRegExp(/\s+?auth,/, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.javascript:eq(2)").markRegExp(/router[^\.]*?\.route[\s\S]+?(commentReadOne|commentsUpdateOne|commentsDeleteOne)\);/, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.javascript:eq(2)").markRegExp(/router[^\.]*?\.(get|put|delete)[\s\S]+?\);/, options_izbrisi);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.javascript:eq(3)").markRegExp(/\/\*\*[^\*]+?\* Authorization[\s\S]+?}\);[\s\S]+?}\);/, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.bash:eq(1)").markRegExp(/LOCATION_ID=[\s\S]+?'\)/, options_dodaj);
    $("#dodajanje-vmesne-avtentikacijske-ravni-pri-express-usmerjanju code.bash:eq(1)").markRegExp(/curl -X POST [\s\S]+?\."/, options_dodaj);
  });
</script>
</div>
<div id="uporaba-informacij-iz-jwt-v-express-krmilniku" class="section level3 hasAnchor" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Uporaba informacij iz JWT v Express krmilniku<a href="Avtentikacija.html#uporaba-informacij-iz-jwt-v-express-krmilniku" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="prijavljen-uporabnik-kot-avtor-komentarja" class="section level4 hasAnchor" number="10.4.2.1">
<h4><span class="header-section-number">10.4.2.1</span> Prijavljen uporabnik kot avtor komentarja<a href="Avtentikacija.html#prijavljen-uporabnik-kot-avtor-komentarja" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Najprej se bomo posvetili metodi <code>commentsCreate</code> v krmilniku <code>api/controllers/comments.js</code>, kjer bomo dodali nov klic funkcije <code>getAuthor</code>. S tem <strong>želimo preveriti uporabnika</strong> (če sploh obstaja v podatkovni bazi) in kot odgovor v povratnem klicu vrnemo njegovo ime <code>author</code>, ki ga bomo posredovali naprej za uporabo v spletnem obrazcu.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb703"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb703-1"><a href="Avtentikacija.html#cb703-1" tabindex="-1"></a><span class="kw">const</span> commentsCreate <span class="op">=</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb703-2"><a href="Avtentikacija.html#cb703-2" tabindex="-1"></a>  <span class="fu">getAuthor</span>(req<span class="op">,</span> res<span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res<span class="op">,</span> author) <span class="kw">=&gt;</span> {</span>
<span id="cb703-3"><a href="Avtentikacija.html#cb703-3" tabindex="-1"></a>    <span class="kw">const</span> locationId <span class="op">=</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">locationId</span><span class="op">;</span></span>
<span id="cb703-4"><a href="Avtentikacija.html#cb703-4" tabindex="-1"></a>    <span class="cf">if</span> (locationId) {</span>
<span id="cb703-5"><a href="Avtentikacija.html#cb703-5" tabindex="-1"></a>      <span class="bu">Location</span><span class="op">.</span><span class="fu">findById</span>(locationId)</span>
<span id="cb703-6"><a href="Avtentikacija.html#cb703-6" tabindex="-1"></a>        <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;comments&quot;</span>)</span>
<span id="cb703-7"><a href="Avtentikacija.html#cb703-7" tabindex="-1"></a>        <span class="op">.</span><span class="fu">exec</span>((err<span class="op">,</span> location) <span class="kw">=&gt;</span> {</span>
<span id="cb703-8"><a href="Avtentikacija.html#cb703-8" tabindex="-1"></a>          <span class="cf">if</span> (err) res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb703-9"><a href="Avtentikacija.html#cb703-9" tabindex="-1"></a>          <span class="cf">else</span> <span class="fu">doAddComment</span>(req<span class="op">,</span> res<span class="op">,</span> location<span class="op">,</span> author<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb703-10"><a href="Avtentikacija.html#cb703-10" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb703-11"><a href="Avtentikacija.html#cb703-11" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb703-12"><a href="Avtentikacija.html#cb703-12" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb703-13"><a href="Avtentikacija.html#cb703-13" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Path parameter &#39;locationId&#39; is required.&quot;</span><span class="op">,</span></span>
<span id="cb703-14"><a href="Avtentikacija.html#cb703-14" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb703-15"><a href="Avtentikacija.html#cb703-15" tabindex="-1"></a>    }</span>
<span id="cb703-16"><a href="Avtentikacija.html#cb703-16" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb703-17"><a href="Avtentikacija.html#cb703-17" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Pri validaciji uporabnika bomo morali dostopati do podatkovne baze s poizvedbo po njegovem elektronskem naslovu. Ob izvajanju <strong>povratnega klica</strong> zraven <strong>posredujemo</strong> še <strong>uporabnikovo ime</strong>, ki ga bomo uporabili na obrazcu.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb704"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb704-1"><a href="Avtentikacija.html#cb704-1" tabindex="-1"></a><span class="kw">const</span> mongoose <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;mongoose&quot;</span>)<span class="op">;</span></span>
<span id="cb704-2"><a href="Avtentikacija.html#cb704-2" tabindex="-1"></a><span class="kw">const</span> <span class="bu">Location</span> <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&quot;Location&quot;</span>)<span class="op">;</span></span>
<span id="cb704-3"><a href="Avtentikacija.html#cb704-3" tabindex="-1"></a><span class="kw">const</span> User <span class="op">=</span> mongoose<span class="op">.</span><span class="fu">model</span>(<span class="st">&quot;User&quot;</span>)<span class="op">;</span></span>
<span id="cb704-4"><a href="Avtentikacija.html#cb704-4" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb704-5"><a href="Avtentikacija.html#cb704-5" tabindex="-1"></a><span class="kw">const</span> getAuthor <span class="op">=</span> <span class="kw">async</span> (req<span class="op">,</span> res<span class="op">,</span> cbResult) <span class="kw">=&gt;</span> {</span>
<span id="cb704-6"><a href="Avtentikacija.html#cb704-6" tabindex="-1"></a>  <span class="cf">if</span> (req<span class="op">.</span><span class="at">auth</span><span class="op">?.</span><span class="at">email</span>) {</span>
<span id="cb704-7"><a href="Avtentikacija.html#cb704-7" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb704-8"><a href="Avtentikacija.html#cb704-8" tabindex="-1"></a>      <span class="kw">let</span> user <span class="op">=</span> <span class="cf">await</span> User<span class="op">.</span><span class="fu">findOne</span>({ <span class="dt">email</span><span class="op">:</span> req<span class="op">.</span><span class="at">auth</span><span class="op">.</span><span class="at">email</span> })<span class="op">.</span><span class="fu">exec</span>()<span class="op">;</span></span>
<span id="cb704-9"><a href="Avtentikacija.html#cb704-9" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>user) res<span class="op">.</span><span class="fu">status</span>(<span class="dv">401</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;User not found.&quot;</span> })<span class="op">;</span></span>
<span id="cb704-10"><a href="Avtentikacija.html#cb704-10" tabindex="-1"></a>      <span class="cf">else</span> <span class="fu">cbResult</span>(req<span class="op">,</span> res<span class="op">,</span> user)<span class="op">;</span></span>
<span id="cb704-11"><a href="Avtentikacija.html#cb704-11" tabindex="-1"></a>    } <span class="cf">catch</span> (err) {</span>
<span id="cb704-12"><a href="Avtentikacija.html#cb704-12" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb704-13"><a href="Avtentikacija.html#cb704-13" tabindex="-1"></a>    }</span>
<span id="cb704-14"><a href="Avtentikacija.html#cb704-14" tabindex="-1"></a>  }</span>
<span id="cb704-15"><a href="Avtentikacija.html#cb704-15" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Na koncu moramo poskrbeti še za <strong>uporabo pridobljenega imena uporabnika pri shranjevanju komentarja v podatkovno bazo</strong>, saj bomo v nadaljevanju ime uporabnika iz spletnega obrazca odstranili.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb705"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb705-1"><a href="Avtentikacija.html#cb705-1" tabindex="-1"></a><span class="kw">const</span> doAddComment <span class="op">=</span> (req<span class="op">,</span> res<span class="op">,</span> location<span class="op">,</span> author) <span class="kw">=&gt;</span> {</span>
<span id="cb705-2"><a href="Avtentikacija.html#cb705-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>location) {</span>
<span id="cb705-3"><a href="Avtentikacija.html#cb705-3" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb705-4"><a href="Avtentikacija.html#cb705-4" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Location with id &#39;&quot;</span> <span class="op">+</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">locationId</span> <span class="op">+</span> <span class="st">&quot;&#39; not found.&quot;</span><span class="op">,</span></span>
<span id="cb705-5"><a href="Avtentikacija.html#cb705-5" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb705-6"><a href="Avtentikacija.html#cb705-6" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb705-7"><a href="Avtentikacija.html#cb705-7" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">author</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">rating</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">comment</span>) {</span>
<span id="cb705-8"><a href="Avtentikacija.html#cb705-8" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb705-9"><a href="Avtentikacija.html#cb705-9" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span></span>
<span id="cb705-10"><a href="Avtentikacija.html#cb705-10" tabindex="-1"></a>          <span class="st">&quot;Body parameters &#39;author&#39;, &#39;rating&#39; and &#39;comment&#39; are required.&quot;</span><span class="op">,</span></span>
<span id="cb705-11"><a href="Avtentikacija.html#cb705-11" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb705-12"><a href="Avtentikacija.html#cb705-12" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb705-13"><a href="Avtentikacija.html#cb705-13" tabindex="-1"></a>      location<span class="op">.</span><span class="at">comments</span><span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb705-14"><a href="Avtentikacija.html#cb705-14" tabindex="-1"></a>        <span class="dt">author</span><span class="op">:</span> author<span class="op">,</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">author</span><span class="op">,</span></span>
<span id="cb705-15"><a href="Avtentikacija.html#cb705-15" tabindex="-1"></a>        <span class="dt">rating</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">rating</span><span class="op">,</span></span>
<span id="cb705-16"><a href="Avtentikacija.html#cb705-16" tabindex="-1"></a>        <span class="dt">comment</span><span class="op">:</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">comment</span><span class="op">,</span></span>
<span id="cb705-17"><a href="Avtentikacija.html#cb705-17" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb705-18"><a href="Avtentikacija.html#cb705-18" tabindex="-1"></a>      location<span class="op">.</span><span class="fu">save</span>((err<span class="op">,</span> location) <span class="kw">=&gt;</span> {</span>
<span id="cb705-19"><a href="Avtentikacija.html#cb705-19" tabindex="-1"></a>        <span class="cf">if</span> (err) res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb705-20"><a href="Avtentikacija.html#cb705-20" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb705-21"><a href="Avtentikacija.html#cb705-21" tabindex="-1"></a>          <span class="fu">updateAverageRating</span>(location<span class="op">.</span><span class="at">_id</span>)<span class="op">;</span></span>
<span id="cb705-22"><a href="Avtentikacija.html#cb705-22" tabindex="-1"></a>          res<span class="op">.</span><span class="fu">status</span>(<span class="dv">201</span>)<span class="op">.</span><span class="fu">json</span>(location<span class="op">.</span><span class="at">comments</span><span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">pop</span>())<span class="op">;</span></span>
<span id="cb705-23"><a href="Avtentikacija.html#cb705-23" tabindex="-1"></a>        }</span>
<span id="cb705-24"><a href="Avtentikacija.html#cb705-24" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb705-25"><a href="Avtentikacija.html#cb705-25" tabindex="-1"></a>    }</span>
<span id="cb705-26"><a href="Avtentikacija.html#cb705-26" tabindex="-1"></a>  }</span>
<span id="cb705-27"><a href="Avtentikacija.html#cb705-27" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(0)").markRegExp(/\s+?getAuthor.+/, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(0)").markRegExp(/, author\.name/, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(0)").markRegExp(/^\s{2}\}\);/m, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(1)").markRegExp(/const User.+/, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(1)").markRegExp(/const getAuthor[\s\S]+?};/, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(2)").markRegExp(/, author/, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(2)").markRegExp(/author, /, options_dodaj);
    $("#prijavljen-uporabnik-kot-avtor-komentarja code.javascript:eq(2)").markRegExp(/(req\.body\.author|\!req\.body\.author \|\| |'author', )/, options_izbrisi);
  });
</script>
</div>
</div>
<div id="avtorizacija-azuriranje" class="section level3 hasAnchor" number="10.4.3">
<h3><span class="header-section-number">10.4.3</span> Avtorizacija pri ažuriranju komentarja<a href="Avtentikacija.html#avtorizacija-azuriranje" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pri trenutni implementaciji vsakemu prijavljenemu uporabniku dovolimo spreminjanje in brisanje poljubnega komentarja. V nadaljevanju bi to funkcionalnost omogočili zgolj nad uporabniku lastnimi komentarji.</p>
<p>Najprej poskrbimo, da pri urejanju obstoječega komentarja v okviru metode <code>commentsUpdateOne</code> preverimo ali je uporabnik, ki želi izvesti spremembo dejanski avtor komentarja.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb706"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb706-1"><a href="Avtentikacija.html#cb706-1" tabindex="-1"></a><span class="kw">const</span> commentsUpdateOne <span class="op">=</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb706-2"><a href="Avtentikacija.html#cb706-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">locationId</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">commentId</span>)</span>
<span id="cb706-3"><a href="Avtentikacija.html#cb706-3" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb706-4"><a href="Avtentikacija.html#cb706-4" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Path parameters &#39;locationId&#39; and &#39;commentId&#39; are required.&quot;</span><span class="op">,</span></span>
<span id="cb706-5"><a href="Avtentikacija.html#cb706-5" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb706-6"><a href="Avtentikacija.html#cb706-6" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb706-7"><a href="Avtentikacija.html#cb706-7" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb706-8"><a href="Avtentikacija.html#cb706-8" tabindex="-1"></a>      <span class="kw">let</span> location <span class="op">=</span> <span class="cf">await</span> <span class="bu">Location</span><span class="op">.</span><span class="fu">findById</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">locationId</span>)</span>
<span id="cb706-9"><a href="Avtentikacija.html#cb706-9" tabindex="-1"></a>        <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;comments&quot;</span>)</span>
<span id="cb706-10"><a href="Avtentikacija.html#cb706-10" tabindex="-1"></a>        <span class="op">.</span><span class="fu">exec</span>()<span class="op">;</span></span>
<span id="cb706-11"><a href="Avtentikacija.html#cb706-11" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>location)</span>
<span id="cb706-12"><a href="Avtentikacija.html#cb706-12" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb706-13"><a href="Avtentikacija.html#cb706-13" tabindex="-1"></a>          <span class="dt">message</span><span class="op">:</span> <span class="vs">`Location with id &#39;</span><span class="sc">${</span>req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">locationId</span><span class="sc">}</span><span class="vs">&#39; not found.`</span><span class="op">,</span></span>
<span id="cb706-14"><a href="Avtentikacija.html#cb706-14" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb706-15"><a href="Avtentikacija.html#cb706-15" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb706-16"><a href="Avtentikacija.html#cb706-16" tabindex="-1"></a>        <span class="kw">const</span> comment <span class="op">=</span> location<span class="op">.</span><span class="at">comments</span><span class="op">.</span><span class="fu">id</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">commentId</span>)<span class="op">;</span></span>
<span id="cb706-17"><a href="Avtentikacija.html#cb706-17" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>comment)</span>
<span id="cb706-18"><a href="Avtentikacija.html#cb706-18" tabindex="-1"></a>          res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb706-19"><a href="Avtentikacija.html#cb706-19" tabindex="-1"></a>            <span class="dt">message</span><span class="op">:</span></span>
<span id="cb706-20"><a href="Avtentikacija.html#cb706-20" tabindex="-1"></a>              <span class="st">&quot;Comment with id &#39;&quot;</span> <span class="op">+</span> req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">commentId</span> <span class="op">+</span> <span class="st">&quot;&#39; not found.&quot;</span><span class="op">,</span></span>
<span id="cb706-21"><a href="Avtentikacija.html#cb706-21" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb706-22"><a href="Avtentikacija.html#cb706-22" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb706-23"><a href="Avtentikacija.html#cb706-23" tabindex="-1"></a>          <span class="fu">getAuthor</span>(req<span class="op">,</span> res<span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res<span class="op">,</span> author) <span class="kw">=&gt;</span> {</span>
<span id="cb706-24"><a href="Avtentikacija.html#cb706-24" tabindex="-1"></a>            <span class="cf">if</span> (comment<span class="op">.</span><span class="at">author</span> <span class="op">!=</span> author<span class="op">.</span><span class="at">name</span>) {</span>
<span id="cb706-25"><a href="Avtentikacija.html#cb706-25" tabindex="-1"></a>              res<span class="op">.</span><span class="fu">status</span>(<span class="dv">403</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb706-26"><a href="Avtentikacija.html#cb706-26" tabindex="-1"></a>                <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Not authorized to update this comment.&quot;</span><span class="op">,</span></span>
<span id="cb706-27"><a href="Avtentikacija.html#cb706-27" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb706-28"><a href="Avtentikacija.html#cb706-28" tabindex="-1"></a>            } <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">rating</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">comment</span>) {</span>
<span id="cb706-29"><a href="Avtentikacija.html#cb706-29" tabindex="-1"></a>              res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb706-30"><a href="Avtentikacija.html#cb706-30" tabindex="-1"></a>                <span class="dt">message</span><span class="op">:</span></span>
<span id="cb706-31"><a href="Avtentikacija.html#cb706-31" tabindex="-1"></a>                  <span class="st">&quot;At least one of body parameters &#39;rating&#39; or &#39;comment&#39; is required.&quot;</span><span class="op">,</span></span>
<span id="cb706-32"><a href="Avtentikacija.html#cb706-32" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb706-33"><a href="Avtentikacija.html#cb706-33" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb706-34"><a href="Avtentikacija.html#cb706-34" tabindex="-1"></a>              <span class="cf">if</span> (req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">rating</span>) comment<span class="op">.</span><span class="at">rating</span> <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">rating</span><span class="op">;</span></span>
<span id="cb706-35"><a href="Avtentikacija.html#cb706-35" tabindex="-1"></a>              <span class="cf">if</span> (req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">comment</span>) comment<span class="op">.</span><span class="at">comment</span> <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">comment</span><span class="op">;</span></span>
<span id="cb706-36"><a href="Avtentikacija.html#cb706-36" tabindex="-1"></a>              <span class="cf">await</span> location<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb706-37"><a href="Avtentikacija.html#cb706-37" tabindex="-1"></a>              <span class="cf">await</span> <span class="fu">updateAverageRating</span>(location<span class="op">.</span><span class="at">_id</span>)<span class="op">;</span></span>
<span id="cb706-38"><a href="Avtentikacija.html#cb706-38" tabindex="-1"></a>              res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>(comment)<span class="op">;</span></span>
<span id="cb706-39"><a href="Avtentikacija.html#cb706-39" tabindex="-1"></a>            }</span>
<span id="cb706-40"><a href="Avtentikacija.html#cb706-40" tabindex="-1"></a>          })<span class="op">;</span> </span>
<span id="cb706-41"><a href="Avtentikacija.html#cb706-41" tabindex="-1"></a>        }</span>
<span id="cb706-42"><a href="Avtentikacija.html#cb706-42" tabindex="-1"></a>      }</span>
<span id="cb706-43"><a href="Avtentikacija.html#cb706-43" tabindex="-1"></a>    } <span class="cf">catch</span> (err) {</span>
<span id="cb706-44"><a href="Avtentikacija.html#cb706-44" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb706-45"><a href="Avtentikacija.html#cb706-45" tabindex="-1"></a>    }</span>
<span id="cb706-46"><a href="Avtentikacija.html#cb706-46" tabindex="-1"></a>  }</span>
<span id="cb706-47"><a href="Avtentikacija.html#cb706-47" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Podobno v metodi <code>commentsDeleteOne</code> preverimo tudi ali je komentar, ki ga uporabnik želi izbrisati, res njegov.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb707"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb707-1"><a href="Avtentikacija.html#cb707-1" tabindex="-1"></a><span class="kw">const</span> commentsDeleteOne <span class="op">=</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb707-2"><a href="Avtentikacija.html#cb707-2" tabindex="-1"></a>  <span class="kw">const</span> { locationId<span class="op">,</span> commentId } <span class="op">=</span> req<span class="op">.</span><span class="at">params</span><span class="op">;</span></span>
<span id="cb707-3"><a href="Avtentikacija.html#cb707-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>locationId <span class="op">||</span> <span class="op">!</span>commentId)</span>
<span id="cb707-4"><a href="Avtentikacija.html#cb707-4" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb707-5"><a href="Avtentikacija.html#cb707-5" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Path parameters &#39;locationId&#39; and &#39;commentId&#39; are required.&quot;</span><span class="op">,</span></span>
<span id="cb707-6"><a href="Avtentikacija.html#cb707-6" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb707-7"><a href="Avtentikacija.html#cb707-7" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb707-8"><a href="Avtentikacija.html#cb707-8" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb707-9"><a href="Avtentikacija.html#cb707-9" tabindex="-1"></a>      <span class="kw">let</span> location <span class="op">=</span> <span class="cf">await</span> <span class="bu">Location</span><span class="op">.</span><span class="fu">findById</span>(locationId)</span>
<span id="cb707-10"><a href="Avtentikacija.html#cb707-10" tabindex="-1"></a>        <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;comments&quot;</span>)</span>
<span id="cb707-11"><a href="Avtentikacija.html#cb707-11" tabindex="-1"></a>        <span class="op">.</span><span class="fu">exec</span>()<span class="op">;</span></span>
<span id="cb707-12"><a href="Avtentikacija.html#cb707-12" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>location)</span>
<span id="cb707-13"><a href="Avtentikacija.html#cb707-13" tabindex="-1"></a>        res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb707-14"><a href="Avtentikacija.html#cb707-14" tabindex="-1"></a>          <span class="dt">message</span><span class="op">:</span> <span class="vs">`Location with id &#39;</span><span class="sc">${</span>locationId<span class="sc">}</span><span class="vs">&#39; not found.`</span><span class="op">,</span></span>
<span id="cb707-15"><a href="Avtentikacija.html#cb707-15" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb707-16"><a href="Avtentikacija.html#cb707-16" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span> (location<span class="op">.</span><span class="at">comments</span> <span class="op">&amp;&amp;</span> location<span class="op">.</span><span class="at">comments</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb707-17"><a href="Avtentikacija.html#cb707-17" tabindex="-1"></a>        <span class="kw">const</span> comment <span class="op">=</span> location<span class="op">.</span><span class="at">comments</span><span class="op">.</span><span class="fu">id</span>(commentId)<span class="op">;</span></span>
<span id="cb707-18"><a href="Avtentikacija.html#cb707-18" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>comment)</span>
<span id="cb707-19"><a href="Avtentikacija.html#cb707-19" tabindex="-1"></a>          res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb707-20"><a href="Avtentikacija.html#cb707-20" tabindex="-1"></a>            <span class="dt">message</span><span class="op">:</span> <span class="vs">`Comment with id &#39;</span><span class="sc">${</span>commentId<span class="sc">}</span><span class="vs">&#39; not found.`</span><span class="op">,</span></span>
<span id="cb707-21"><a href="Avtentikacija.html#cb707-21" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb707-22"><a href="Avtentikacija.html#cb707-22" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb707-23"><a href="Avtentikacija.html#cb707-23" tabindex="-1"></a>          <span class="fu">getAuthor</span>(req<span class="op">,</span> res<span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res<span class="op">,</span> author) <span class="kw">=&gt;</span> {</span>
<span id="cb707-24"><a href="Avtentikacija.html#cb707-24" tabindex="-1"></a>            <span class="cf">if</span> (comment<span class="op">.</span><span class="at">author</span> <span class="op">!=</span> author<span class="op">.</span><span class="at">name</span>) {</span>
<span id="cb707-25"><a href="Avtentikacija.html#cb707-25" tabindex="-1"></a>              res<span class="op">.</span><span class="fu">status</span>(<span class="dv">403</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb707-26"><a href="Avtentikacija.html#cb707-26" tabindex="-1"></a>                <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;Not authorized to delete this comment.&quot;</span><span class="op">,</span></span>
<span id="cb707-27"><a href="Avtentikacija.html#cb707-27" tabindex="-1"></a>              })<span class="op">;</span></span>
<span id="cb707-28"><a href="Avtentikacija.html#cb707-28" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb707-29"><a href="Avtentikacija.html#cb707-29" tabindex="-1"></a>              comment<span class="op">.</span><span class="fu">deleteOne</span>()<span class="op">;</span></span>
<span id="cb707-30"><a href="Avtentikacija.html#cb707-30" tabindex="-1"></a>              <span class="cf">await</span> location<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb707-31"><a href="Avtentikacija.html#cb707-31" tabindex="-1"></a>              <span class="cf">await</span> <span class="fu">updateAverageRating</span>(location<span class="op">.</span><span class="at">_id</span>)<span class="op">;</span></span>
<span id="cb707-32"><a href="Avtentikacija.html#cb707-32" tabindex="-1"></a>              res<span class="op">.</span><span class="fu">status</span>(<span class="dv">204</span>)<span class="op">.</span><span class="fu">send</span>()<span class="op">;</span></span>
<span id="cb707-33"><a href="Avtentikacija.html#cb707-33" tabindex="-1"></a>            }</span>
<span id="cb707-34"><a href="Avtentikacija.html#cb707-34" tabindex="-1"></a>          })<span class="op">;</span> </span>
<span id="cb707-35"><a href="Avtentikacija.html#cb707-35" tabindex="-1"></a>        }</span>
<span id="cb707-36"><a href="Avtentikacija.html#cb707-36" tabindex="-1"></a>      } <span class="cf">else</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">404</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;No comments found.&quot;</span> })<span class="op">;</span></span>
<span id="cb707-37"><a href="Avtentikacija.html#cb707-37" tabindex="-1"></a>    } <span class="cf">catch</span> (err) {</span>
<span id="cb707-38"><a href="Avtentikacija.html#cb707-38" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb707-39"><a href="Avtentikacija.html#cb707-39" tabindex="-1"></a>    }</span>
<span id="cb707-40"><a href="Avtentikacija.html#cb707-40" tabindex="-1"></a>  }</span>
<span id="cb707-41"><a href="Avtentikacija.html#cb707-41" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#avtorizacija-azuriranje code.javascript:eq(0)").markRegExp(/\s+?getAuthor[\s\S]+?} else /, options_dodaj);
    $("#avtorizacija-azuriranje code.javascript:eq(0)").markRegExp(/\s+?}\); /, options_dodaj);
    $("#avtorizacija-azuriranje code.javascript:eq(1)").markRegExp(/\s+?getAuthor[\s\S]+?} else /, options_dodaj);
    $("#avtorizacija-azuriranje code.javascript:eq(1)").markRegExp(/\s+?}\); /, options_dodaj);
  });
</script>
<div id="podpora-avtentikaciji-pri-openapi-dokumentaciji" class="section level4 hasAnchor" number="10.4.3.1">
<h4><span class="header-section-number">10.4.3.1</span> Podpora avtentikaciji pri OpenAPI dokumentaciji<a href="Avtentikacija.html#podpora-avtentikaciji-pri-openapi-dokumentaciji" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ker bomo imeli sedaj dokumentacijo v večini datotek modela in krmilnika, to spremembo izvedemo v opredelitvi dokumenta Swagger v začetni datoteki strežnika.</p>
<p><code>server.js</code></p>
<div class="sourceCode" id="cb708"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb708-1"><a href="Avtentikacija.html#cb708-1" tabindex="-1"></a><span class="kw">const</span> swaggerDocument <span class="op">=</span> <span class="fu">swaggerJsDoc</span>({</span>
<span id="cb708-2"><a href="Avtentikacija.html#cb708-2" tabindex="-1"></a>  <span class="op">...,</span></span>
<span id="cb708-3"><a href="Avtentikacija.html#cb708-3" tabindex="-1"></a>  <span class="dt">apis</span><span class="op">:</span> [<span class="st">&quot;./api/models/* locations.js&quot;</span><span class="op">,</span> <span class="st">&quot;./api/controllers/*.js&quot;</span>]<span class="op">,</span></span>
<span id="cb708-4"><a href="Avtentikacija.html#cb708-4" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Najprej poskrbimo za opredelitve <strong>sheme uporabnika <code>User</code></strong> in v primeru <strong>uspešne avtentikacije</strong> še <strong>shemo <code>Authentication</code></strong>.</p>
<p><code>api/models/users.js</code></p>
<div class="sourceCode" id="cb709"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb709-1"><a href="Avtentikacija.html#cb709-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb709-2"><a href="Avtentikacija.html#cb709-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb709-3"><a href="Avtentikacija.html#cb709-3" tabindex="-1"></a><span class="co"> *  components:</span></span>
<span id="cb709-4"><a href="Avtentikacija.html#cb709-4" tabindex="-1"></a><span class="co"> *   schemas:</span></span>
<span id="cb709-5"><a href="Avtentikacija.html#cb709-5" tabindex="-1"></a><span class="co"> *    User:</span></span>
<span id="cb709-6"><a href="Avtentikacija.html#cb709-6" tabindex="-1"></a><span class="co"> *     type: object</span></span>
<span id="cb709-7"><a href="Avtentikacija.html#cb709-7" tabindex="-1"></a><span class="co"> *     description: User of the application.</span></span>
<span id="cb709-8"><a href="Avtentikacija.html#cb709-8" tabindex="-1"></a><span class="co"> *     properties:</span></span>
<span id="cb709-9"><a href="Avtentikacija.html#cb709-9" tabindex="-1"></a><span class="co"> *      email:</span></span>
<span id="cb709-10"><a href="Avtentikacija.html#cb709-10" tabindex="-1"></a><span class="co"> *       type: string</span></span>
<span id="cb709-11"><a href="Avtentikacija.html#cb709-11" tabindex="-1"></a><span class="co"> *       format: email</span></span>
<span id="cb709-12"><a href="Avtentikacija.html#cb709-12" tabindex="-1"></a><span class="co"> *       description: email of the user</span></span>
<span id="cb709-13"><a href="Avtentikacija.html#cb709-13" tabindex="-1"></a><span class="co"> *       example: dejan</span><span class="an">@lavbic.net</span></span>
<span id="cb709-14"><a href="Avtentikacija.html#cb709-14" tabindex="-1"></a><span class="co"> *      name:</span></span>
<span id="cb709-15"><a href="Avtentikacija.html#cb709-15" tabindex="-1"></a><span class="co"> *       type: string</span></span>
<span id="cb709-16"><a href="Avtentikacija.html#cb709-16" tabindex="-1"></a><span class="co"> *       description: name and surname of the user</span></span>
<span id="cb709-17"><a href="Avtentikacija.html#cb709-17" tabindex="-1"></a><span class="co"> *       example: Dejan Lavbič</span></span>
<span id="cb709-18"><a href="Avtentikacija.html#cb709-18" tabindex="-1"></a><span class="co"> *       writeOnly: true</span></span>
<span id="cb709-19"><a href="Avtentikacija.html#cb709-19" tabindex="-1"></a><span class="co"> *      password:</span></span>
<span id="cb709-20"><a href="Avtentikacija.html#cb709-20" tabindex="-1"></a><span class="co"> *       type: string</span></span>
<span id="cb709-21"><a href="Avtentikacija.html#cb709-21" tabindex="-1"></a><span class="co"> *       description: password of the user</span></span>
<span id="cb709-22"><a href="Avtentikacija.html#cb709-22" tabindex="-1"></a><span class="co"> *       example: test</span></span>
<span id="cb709-23"><a href="Avtentikacija.html#cb709-23" tabindex="-1"></a><span class="co"> *     required:</span></span>
<span id="cb709-24"><a href="Avtentikacija.html#cb709-24" tabindex="-1"></a><span class="co"> *      - email</span></span>
<span id="cb709-25"><a href="Avtentikacija.html#cb709-25" tabindex="-1"></a><span class="co"> *      - name</span></span>
<span id="cb709-26"><a href="Avtentikacija.html#cb709-26" tabindex="-1"></a><span class="co"> *      - password</span></span>
<span id="cb709-27"><a href="Avtentikacija.html#cb709-27" tabindex="-1"></a><span class="co"> *    Authentication:</span></span>
<span id="cb709-28"><a href="Avtentikacija.html#cb709-28" tabindex="-1"></a><span class="co"> *     type: object</span></span>
<span id="cb709-29"><a href="Avtentikacija.html#cb709-29" tabindex="-1"></a><span class="co"> *     description: Authentication token of the user.</span></span>
<span id="cb709-30"><a href="Avtentikacija.html#cb709-30" tabindex="-1"></a><span class="co"> *     properties:</span></span>
<span id="cb709-31"><a href="Avtentikacija.html#cb709-31" tabindex="-1"></a><span class="co"> *      token:</span></span>
<span id="cb709-32"><a href="Avtentikacija.html#cb709-32" tabindex="-1"></a><span class="co"> *       type: string</span></span>
<span id="cb709-33"><a href="Avtentikacija.html#cb709-33" tabindex="-1"></a><span class="co"> *       description: JWT token</span></span>
<span id="cb709-34"><a href="Avtentikacija.html#cb709-34" tabindex="-1"></a><span class="co"> *       example: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfaWQiOiI1NTZiZWRmNDhmOTUzOTViMTlhNjc1ODgiLCJlbWFpbCI6InNpbW9uQGZ1bGxzdGFja3RyYWluaW5nLmNvbSIsIm5hbWUiOiJTaW1vbiBIb2xtZXMiLCJleHAiOjE0MzUwNDA0MTgsImlhdCI6MTQzNDQzNTYxOH0.GD7UrfnLk295rwvIrCikbkAKctFFoRCHotLYZwZpdlE</span></span>
<span id="cb709-35"><a href="Avtentikacija.html#cb709-35" tabindex="-1"></a><span class="co"> *     required:</span></span>
<span id="cb709-36"><a href="Avtentikacija.html#cb709-36" tabindex="-1"></a><span class="co"> *      - token</span></span>
<span id="cb709-37"><a href="Avtentikacija.html#cb709-37" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb709-38"><a href="Avtentikacija.html#cb709-38" tabindex="-1"></a><span class="kw">const</span> usersSchema <span class="op">=</span> <span class="kw">new</span> mongoose<span class="op">.</span><span class="fu">Schema</span>({</span>
<span id="cb709-39"><a href="Avtentikacija.html#cb709-39" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">unique</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Email is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb709-40"><a href="Avtentikacija.html#cb709-40" tabindex="-1"></a>  <span class="dt">name</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Name is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb709-41"><a href="Avtentikacija.html#cb709-41" tabindex="-1"></a>  <span class="dt">hash</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Hash is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb709-42"><a href="Avtentikacija.html#cb709-42" tabindex="-1"></a>  <span class="dt">salt</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="bu">String</span><span class="op">,</span> <span class="dt">required</span><span class="op">:</span> [<span class="kw">true</span><span class="op">,</span> <span class="st">&quot;Salt is required!&quot;</span>] }<span class="op">,</span></span>
<span id="cb709-43"><a href="Avtentikacija.html#cb709-43" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb709-44"><a href="Avtentikacija.html#cb709-44" tabindex="-1"></a>usersSchema<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">setPassword</span> <span class="op">=</span> <span class="kw">function</span> (password) {</span>
<span id="cb709-45"><a href="Avtentikacija.html#cb709-45" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">salt</span> <span class="op">=</span> crypto<span class="op">.</span><span class="fu">randomBytes</span>(<span class="dv">16</span>)<span class="op">.</span><span class="fu">toString</span>(<span class="st">&quot;hex&quot;</span>)<span class="op">;</span></span>
<span id="cb709-46"><a href="Avtentikacija.html#cb709-46" tabindex="-1"></a>  <span class="kw">this</span><span class="op">.</span><span class="at">hash</span> <span class="op">=</span> crypto</span>
<span id="cb709-47"><a href="Avtentikacija.html#cb709-47" tabindex="-1"></a>    <span class="op">.</span><span class="fu">pbkdf2Sync</span>(password<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">salt</span><span class="op">,</span> <span class="dv">1000</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> <span class="st">&quot;sha512&quot;</span>)</span>
<span id="cb709-48"><a href="Avtentikacija.html#cb709-48" tabindex="-1"></a>    <span class="op">.</span><span class="fu">toString</span>(<span class="st">&quot;hex&quot;</span>)<span class="op">;</span></span>
<span id="cb709-49"><a href="Avtentikacija.html#cb709-49" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Obvladovanje uporabnikov je tudi nova kategorija metod, zato dodamo <strong>novo oznako <code>Authentication</code></strong>, kjer bosta na voljo metodi za prijavo in registracijo uporabnika.</p>
<p><code>server.js</code></p>
<div class="sourceCode" id="cb710"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb710-1"><a href="Avtentikacija.html#cb710-1" tabindex="-1"></a><span class="kw">const</span> swaggerDocument <span class="op">=</span> <span class="fu">swaggerJsDoc</span>({</span>
<span id="cb710-2"><a href="Avtentikacija.html#cb710-2" tabindex="-1"></a>  <span class="dt">definition</span><span class="op">:</span> {</span>
<span id="cb710-3"><a href="Avtentikacija.html#cb710-3" tabindex="-1"></a>    <span class="op">...,</span></span>
<span id="cb710-4"><a href="Avtentikacija.html#cb710-4" tabindex="-1"></a>    <span class="dt">tags</span><span class="op">:</span> [</span>
<span id="cb710-5"><a href="Avtentikacija.html#cb710-5" tabindex="-1"></a>      {</span>
<span id="cb710-6"><a href="Avtentikacija.html#cb710-6" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Locations&quot;</span><span class="op">,</span></span>
<span id="cb710-7"><a href="Avtentikacija.html#cb710-7" tabindex="-1"></a>        <span class="dt">description</span><span class="op">:</span> <span class="st">&quot;Cultural heritage &lt;b&gt;locations&lt;/b&gt; in Slovenia.&quot;</span><span class="op">,</span></span>
<span id="cb710-8"><a href="Avtentikacija.html#cb710-8" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb710-9"><a href="Avtentikacija.html#cb710-9" tabindex="-1"></a>      {</span>
<span id="cb710-10"><a href="Avtentikacija.html#cb710-10" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Comments&quot;</span><span class="op">,</span></span>
<span id="cb710-11"><a href="Avtentikacija.html#cb710-11" tabindex="-1"></a>        <span class="dt">description</span><span class="op">:</span></span>
<span id="cb710-12"><a href="Avtentikacija.html#cb710-12" tabindex="-1"></a>          <span class="st">&quot;&lt;b&gt;Comments&lt;/b&gt; for cultural heritage locations in Slovenia.&quot;</span><span class="op">,</span></span>
<span id="cb710-13"><a href="Avtentikacija.html#cb710-13" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb710-14"><a href="Avtentikacija.html#cb710-14" tabindex="-1"></a>      {</span>
<span id="cb710-15"><a href="Avtentikacija.html#cb710-15" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Authentication&quot;</span><span class="op">,</span></span>
<span id="cb710-16"><a href="Avtentikacija.html#cb710-16" tabindex="-1"></a>        <span class="dt">description</span><span class="op">:</span> <span class="st">&quot;&lt;b&gt;User management&lt;/b&gt; and authentication.&quot;</span><span class="op">,</span></span>
<span id="cb710-17"><a href="Avtentikacija.html#cb710-17" tabindex="-1"></a>      }</span>
<span id="cb710-18"><a href="Avtentikacija.html#cb710-18" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb710-19"><a href="Avtentikacija.html#cb710-19" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb710-20"><a href="Avtentikacija.html#cb710-20" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb710-21"><a href="Avtentikacija.html#cb710-21" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb710-22"><a href="Avtentikacija.html#cb710-22" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Razvijalcem, ki bodo pregledovali OpenAPI dokumentacijo, želimo že kar neposredno pri pregledu omogočiti prijavo in testiranje metod z vključenim žetonom JWT, zato dodamo <a href="https://swagger.io/docs/specification/authentication/"><i class="fa-solid fa-earth-europe"></i><strong>varnostno shemo dostopa</strong></a>. V našem primeru bomo uporabili varnostno shemo <a href="https://swagger.io/docs/specification/authentication/bearer-authentication/"><i class="fa-solid fa-earth-europe"></i>tipa <code>http</code>, sheme <code>bearer</code> in formatom <code>JWT</code></a>.</p>
<p><code>server.js</code></p>
<div class="sourceCode" id="cb711"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb711-1"><a href="Avtentikacija.html#cb711-1" tabindex="-1"></a><span class="kw">const</span> swaggerDocument <span class="op">=</span> <span class="fu">swaggerJsDoc</span>({</span>
<span id="cb711-2"><a href="Avtentikacija.html#cb711-2" tabindex="-1"></a>  <span class="dt">definition</span><span class="op">:</span> {</span>
<span id="cb711-3"><a href="Avtentikacija.html#cb711-3" tabindex="-1"></a>    <span class="op">...,</span></span>
<span id="cb711-4"><a href="Avtentikacija.html#cb711-4" tabindex="-1"></a>    <span class="dt">components</span><span class="op">:</span> {</span>
<span id="cb711-5"><a href="Avtentikacija.html#cb711-5" tabindex="-1"></a>      <span class="dt">securitySchemes</span><span class="op">:</span> {</span>
<span id="cb711-6"><a href="Avtentikacija.html#cb711-6" tabindex="-1"></a>        <span class="dt">jwt</span><span class="op">:</span> {</span>
<span id="cb711-7"><a href="Avtentikacija.html#cb711-7" tabindex="-1"></a>          <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;http&quot;</span><span class="op">,</span></span>
<span id="cb711-8"><a href="Avtentikacija.html#cb711-8" tabindex="-1"></a>          <span class="dt">scheme</span><span class="op">:</span> <span class="st">&quot;bearer&quot;</span><span class="op">,</span></span>
<span id="cb711-9"><a href="Avtentikacija.html#cb711-9" tabindex="-1"></a>          <span class="kw">in</span><span class="op">:</span> <span class="st">&quot;header&quot;</span><span class="op">,</span></span>
<span id="cb711-10"><a href="Avtentikacija.html#cb711-10" tabindex="-1"></a>          <span class="dt">bearerFormat</span><span class="op">:</span> <span class="st">&quot;JWT&quot;</span><span class="op">,</span></span>
<span id="cb711-11"><a href="Avtentikacija.html#cb711-11" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb711-12"><a href="Avtentikacija.html#cb711-12" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb711-13"><a href="Avtentikacija.html#cb711-13" tabindex="-1"></a>      <span class="op">...,</span></span>
<span id="cb711-14"><a href="Avtentikacija.html#cb711-14" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb711-15"><a href="Avtentikacija.html#cb711-15" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb711-16"><a href="Avtentikacija.html#cb711-16" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb711-17"><a href="Avtentikacija.html#cb711-17" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Sedaj pa varnostno shemo vključimo v dokumentacijo <code>POST</code>, <code>PUT</code> in <code>DELETE</code> metod za ažuriranje komentarjev. Dopolnili bomo tudi dodatne tipe odgovorov, in sicer <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401"><i class="fa-solid fa-earth-europe"></i><code>401 Unauthorized</code></a> (uporabnik ni prijavljen) ter <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403"><span class="skupaj"><i class="fa-solid fa-earth-europe"></i><code>403 Forbidden</code></span></a> (uporabnik nima pravice dostopa).</p>
<p>Najprej poskrbimo za opis metode <code>commentsCreate</code>, kjer <strong>dodajamo nov komentar</strong>. Funkcionalnost naj bo na voljo le <strong>za prijavljene uporabnike</strong>, med odgovori je tudi <strong>status <code>401</code></strong> ter <strong>odstranimo zahtevani parameter <code>author</code></strong>, saj se uporabi podatek prijavljenega uporabnika.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb712"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb712-1"><a href="Avtentikacija.html#cb712-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb712-2"><a href="Avtentikacija.html#cb712-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb712-3"><a href="Avtentikacija.html#cb712-3" tabindex="-1"></a><span class="co"> * /locations/{locationId}/comments:</span></span>
<span id="cb712-4"><a href="Avtentikacija.html#cb712-4" tabindex="-1"></a><span class="co"> *  post:</span></span>
<span id="cb712-5"><a href="Avtentikacija.html#cb712-5" tabindex="-1"></a><span class="co"> *   ...</span></span>
<span id="cb712-6"><a href="Avtentikacija.html#cb712-6" tabindex="-1"></a><span class="co"> *   tags: [Comments]</span></span>
<span id="cb712-7"><a href="Avtentikacija.html#cb712-7" tabindex="-1"></a><span class="co"> *   security:</span></span>
<span id="cb712-8"><a href="Avtentikacija.html#cb712-8" tabindex="-1"></a><span class="co"> *    - jwt: []</span></span>
<span id="cb712-9"><a href="Avtentikacija.html#cb712-9" tabindex="-1"></a><span class="co"> *   parameters:</span></span>
<span id="cb712-10"><a href="Avtentikacija.html#cb712-10" tabindex="-1"></a><span class="co"> *    - name: locationId</span></span>
<span id="cb712-11"><a href="Avtentikacija.html#cb712-11" tabindex="-1"></a><span class="co"> *      ...</span></span>
<span id="cb712-12"><a href="Avtentikacija.html#cb712-12" tabindex="-1"></a><span class="co"> *   requestBody:</span></span>
<span id="cb712-13"><a href="Avtentikacija.html#cb712-13" tabindex="-1"></a><span class="co"> *    ...</span></span>
<span id="cb712-14"><a href="Avtentikacija.html#cb712-14" tabindex="-1"></a><span class="co"> *    content:</span></span>
<span id="cb712-15"><a href="Avtentikacija.html#cb712-15" tabindex="-1"></a><span class="co"> *     application/x-www-form-urlencoded:</span></span>
<span id="cb712-16"><a href="Avtentikacija.html#cb712-16" tabindex="-1"></a><span class="co"> *      schema:</span></span>
<span id="cb712-17"><a href="Avtentikacija.html#cb712-17" tabindex="-1"></a><span class="co"> *       type: object</span></span>
<span id="cb712-18"><a href="Avtentikacija.html#cb712-18" tabindex="-1"></a><span class="co"> *       properties:</span></span>
<span id="cb712-19"><a href="Avtentikacija.html#cb712-19" tabindex="-1"></a><span class="co"> *        author:</span></span>
<span id="cb712-20"><a href="Avtentikacija.html#cb712-20" tabindex="-1"></a><span class="co"> *         type: string</span></span>
<span id="cb712-21"><a href="Avtentikacija.html#cb712-21" tabindex="-1"></a><span class="co"> *         description: </span><span class="kw">&lt;b&gt;</span><span class="co">author</span><span class="kw">&lt;/b&gt;</span><span class="co"> of comment</span></span>
<span id="cb712-22"><a href="Avtentikacija.html#cb712-22" tabindex="-1"></a><span class="co"> *         example: Dejan Lavbič</span></span>
<span id="cb712-23"><a href="Avtentikacija.html#cb712-23" tabindex="-1"></a><span class="co"> *        rating:</span></span>
<span id="cb712-24"><a href="Avtentikacija.html#cb712-24" tabindex="-1"></a><span class="co"> *         ...</span></span>
<span id="cb712-25"><a href="Avtentikacija.html#cb712-25" tabindex="-1"></a><span class="co"> *        comment:</span></span>
<span id="cb712-26"><a href="Avtentikacija.html#cb712-26" tabindex="-1"></a><span class="co"> *         ...</span></span>
<span id="cb712-27"><a href="Avtentikacija.html#cb712-27" tabindex="-1"></a><span class="co"> *       required:</span></span>
<span id="cb712-28"><a href="Avtentikacija.html#cb712-28" tabindex="-1"></a><span class="co"> *        - author</span></span>
<span id="cb712-29"><a href="Avtentikacija.html#cb712-29" tabindex="-1"></a><span class="co"> *        - rating</span></span>
<span id="cb712-30"><a href="Avtentikacija.html#cb712-30" tabindex="-1"></a><span class="co"> *        - comment</span></span>
<span id="cb712-31"><a href="Avtentikacija.html#cb712-31" tabindex="-1"></a><span class="co"> *   responses:</span></span>
<span id="cb712-32"><a href="Avtentikacija.html#cb712-32" tabindex="-1"></a><span class="co"> *    &#39;201&#39;:</span></span>
<span id="cb712-33"><a href="Avtentikacija.html#cb712-33" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb712-34"><a href="Avtentikacija.html#cb712-34" tabindex="-1"></a><span class="co"> *    &#39;400&#39;:</span></span>
<span id="cb712-35"><a href="Avtentikacija.html#cb712-35" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb712-36"><a href="Avtentikacija.html#cb712-36" tabindex="-1"></a><span class="co"> *    &#39;401&#39;:</span></span>
<span id="cb712-37"><a href="Avtentikacija.html#cb712-37" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Unauthorized</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb712-38"><a href="Avtentikacija.html#cb712-38" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb712-39"><a href="Avtentikacija.html#cb712-39" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb712-40"><a href="Avtentikacija.html#cb712-40" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb712-41"><a href="Avtentikacija.html#cb712-41" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb712-42"><a href="Avtentikacija.html#cb712-42" tabindex="-1"></a><span class="co"> *       examples:</span></span>
<span id="cb712-43"><a href="Avtentikacija.html#cb712-43" tabindex="-1"></a><span class="co"> *        no token provided:</span></span>
<span id="cb712-44"><a href="Avtentikacija.html#cb712-44" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb712-45"><a href="Avtentikacija.html#cb712-45" tabindex="-1"></a><span class="co"> *          message: No authorization token was found.</span></span>
<span id="cb712-46"><a href="Avtentikacija.html#cb712-46" tabindex="-1"></a><span class="co"> *        user not found:</span></span>
<span id="cb712-47"><a href="Avtentikacija.html#cb712-47" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb712-48"><a href="Avtentikacija.html#cb712-48" tabindex="-1"></a><span class="co"> *          message: User not found.</span></span>
<span id="cb712-49"><a href="Avtentikacija.html#cb712-49" tabindex="-1"></a><span class="co"> *        malformed token:</span></span>
<span id="cb712-50"><a href="Avtentikacija.html#cb712-50" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb712-51"><a href="Avtentikacija.html#cb712-51" tabindex="-1"></a><span class="co"> *          message: jwt malformed</span></span>
<span id="cb712-52"><a href="Avtentikacija.html#cb712-52" tabindex="-1"></a><span class="co"> *        invalid token signature:</span></span>
<span id="cb712-53"><a href="Avtentikacija.html#cb712-53" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb712-54"><a href="Avtentikacija.html#cb712-54" tabindex="-1"></a><span class="co"> *          message: invalid signature</span></span>
<span id="cb712-55"><a href="Avtentikacija.html#cb712-55" tabindex="-1"></a><span class="co"> *    &#39;404&#39;:</span></span>
<span id="cb712-56"><a href="Avtentikacija.html#cb712-56" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb712-57"><a href="Avtentikacija.html#cb712-57" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb712-58"><a href="Avtentikacija.html#cb712-58" tabindex="-1"></a><span class="kw">const</span> commentsCreate <span class="op">=</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb712-59"><a href="Avtentikacija.html#cb712-59" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb712-60"><a href="Avtentikacija.html#cb712-60" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Posodobimo tudi za opis metode <code>commentsUpdateOne</code>, kjer lahko <strong>prijavljen uporabnik spreminja svoj lastni komentar</strong>. Med odgovori sta sedaj na voljo <strong>statusa <code>401</code></strong> in <strong><code>403</code></strong>.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb713"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb713-1"><a href="Avtentikacija.html#cb713-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb713-2"><a href="Avtentikacija.html#cb713-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb713-3"><a href="Avtentikacija.html#cb713-3" tabindex="-1"></a><span class="co"> * /locations/{locationId}/comments/{commentId}:</span></span>
<span id="cb713-4"><a href="Avtentikacija.html#cb713-4" tabindex="-1"></a><span class="co"> *  put:</span></span>
<span id="cb713-5"><a href="Avtentikacija.html#cb713-5" tabindex="-1"></a><span class="co"> *   ...</span></span>
<span id="cb713-6"><a href="Avtentikacija.html#cb713-6" tabindex="-1"></a><span class="co"> *   tags: [Comments]</span></span>
<span id="cb713-7"><a href="Avtentikacija.html#cb713-7" tabindex="-1"></a><span class="co"> *   security:</span></span>
<span id="cb713-8"><a href="Avtentikacija.html#cb713-8" tabindex="-1"></a><span class="co"> *    - jwt: []</span></span>
<span id="cb713-9"><a href="Avtentikacija.html#cb713-9" tabindex="-1"></a><span class="co"> *   parameters:</span></span>
<span id="cb713-10"><a href="Avtentikacija.html#cb713-10" tabindex="-1"></a><span class="co"> *    ...</span></span>
<span id="cb713-11"><a href="Avtentikacija.html#cb713-11" tabindex="-1"></a><span class="co"> *   requestBody:</span></span>
<span id="cb713-12"><a href="Avtentikacija.html#cb713-12" tabindex="-1"></a><span class="co"> *    ...</span></span>
<span id="cb713-13"><a href="Avtentikacija.html#cb713-13" tabindex="-1"></a><span class="co"> *   responses:</span></span>
<span id="cb713-14"><a href="Avtentikacija.html#cb713-14" tabindex="-1"></a><span class="co"> *    &#39;200&#39;:</span></span>
<span id="cb713-15"><a href="Avtentikacija.html#cb713-15" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb713-16"><a href="Avtentikacija.html#cb713-16" tabindex="-1"></a><span class="co"> *    &#39;400&#39;:</span></span>
<span id="cb713-17"><a href="Avtentikacija.html#cb713-17" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb713-18"><a href="Avtentikacija.html#cb713-18" tabindex="-1"></a><span class="co"> *    &#39;401&#39;:</span></span>
<span id="cb713-19"><a href="Avtentikacija.html#cb713-19" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Unauthorized</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb713-20"><a href="Avtentikacija.html#cb713-20" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb713-21"><a href="Avtentikacija.html#cb713-21" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb713-22"><a href="Avtentikacija.html#cb713-22" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb713-23"><a href="Avtentikacija.html#cb713-23" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb713-24"><a href="Avtentikacija.html#cb713-24" tabindex="-1"></a><span class="co"> *       examples:</span></span>
<span id="cb713-25"><a href="Avtentikacija.html#cb713-25" tabindex="-1"></a><span class="co"> *        no token provided:</span></span>
<span id="cb713-26"><a href="Avtentikacija.html#cb713-26" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb713-27"><a href="Avtentikacija.html#cb713-27" tabindex="-1"></a><span class="co"> *          message: No authorization token was found.</span></span>
<span id="cb713-28"><a href="Avtentikacija.html#cb713-28" tabindex="-1"></a><span class="co"> *        user not found:</span></span>
<span id="cb713-29"><a href="Avtentikacija.html#cb713-29" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb713-30"><a href="Avtentikacija.html#cb713-30" tabindex="-1"></a><span class="co"> *          message: User not found.</span></span>
<span id="cb713-31"><a href="Avtentikacija.html#cb713-31" tabindex="-1"></a><span class="co"> *        malformed token:</span></span>
<span id="cb713-32"><a href="Avtentikacija.html#cb713-32" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb713-33"><a href="Avtentikacija.html#cb713-33" tabindex="-1"></a><span class="co"> *          message: jwt malformed</span></span>
<span id="cb713-34"><a href="Avtentikacija.html#cb713-34" tabindex="-1"></a><span class="co"> *        invalid token signature:</span></span>
<span id="cb713-35"><a href="Avtentikacija.html#cb713-35" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb713-36"><a href="Avtentikacija.html#cb713-36" tabindex="-1"></a><span class="co"> *          message: invalid signature</span></span>
<span id="cb713-37"><a href="Avtentikacija.html#cb713-37" tabindex="-1"></a><span class="co"> *    &#39;403&#39;:</span></span>
<span id="cb713-38"><a href="Avtentikacija.html#cb713-38" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Forbidden</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb713-39"><a href="Avtentikacija.html#cb713-39" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb713-40"><a href="Avtentikacija.html#cb713-40" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb713-41"><a href="Avtentikacija.html#cb713-41" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb713-42"><a href="Avtentikacija.html#cb713-42" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb713-43"><a href="Avtentikacija.html#cb713-43" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb713-44"><a href="Avtentikacija.html#cb713-44" tabindex="-1"></a><span class="co"> *        message: Not authorized to update this comment.</span></span>
<span id="cb713-45"><a href="Avtentikacija.html#cb713-45" tabindex="-1"></a><span class="co"> *    &#39;404&#39;:</span></span>
<span id="cb713-46"><a href="Avtentikacija.html#cb713-46" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb713-47"><a href="Avtentikacija.html#cb713-47" tabindex="-1"></a><span class="co"> *    &#39;500&#39;:</span></span>
<span id="cb713-48"><a href="Avtentikacija.html#cb713-48" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb713-49"><a href="Avtentikacija.html#cb713-49" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb713-50"><a href="Avtentikacija.html#cb713-50" tabindex="-1"></a><span class="kw">const</span> commentsUpdateOne <span class="op">=</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb713-51"><a href="Avtentikacija.html#cb713-51" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb713-52"><a href="Avtentikacija.html#cb713-52" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>S podobnimi funkcionalnimi zahtevami kot pri spreminjanju komentarja, dopolnimo še opis metode <code>commentsDeleteOne</code>, kjer lahko <strong>prijavljen uporabnik izbriše svoj lastni komentar</strong>.</p>
<p><code>api/controllers/comments.js</code></p>
<div class="sourceCode" id="cb714"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb714-1"><a href="Avtentikacija.html#cb714-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb714-2"><a href="Avtentikacija.html#cb714-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb714-3"><a href="Avtentikacija.html#cb714-3" tabindex="-1"></a><span class="co"> * /locations/{locationId}/comments/{commentId}:</span></span>
<span id="cb714-4"><a href="Avtentikacija.html#cb714-4" tabindex="-1"></a><span class="co"> *  delete:</span></span>
<span id="cb714-5"><a href="Avtentikacija.html#cb714-5" tabindex="-1"></a><span class="co"> *   ...</span></span>
<span id="cb714-6"><a href="Avtentikacija.html#cb714-6" tabindex="-1"></a><span class="co"> *   tags: [Comments]</span></span>
<span id="cb714-7"><a href="Avtentikacija.html#cb714-7" tabindex="-1"></a><span class="co"> *   security:</span></span>
<span id="cb714-8"><a href="Avtentikacija.html#cb714-8" tabindex="-1"></a><span class="co"> *    - jwt: []</span></span>
<span id="cb714-9"><a href="Avtentikacija.html#cb714-9" tabindex="-1"></a><span class="co"> *   parameters:</span></span>
<span id="cb714-10"><a href="Avtentikacija.html#cb714-10" tabindex="-1"></a><span class="co"> *    ...</span></span>
<span id="cb714-11"><a href="Avtentikacija.html#cb714-11" tabindex="-1"></a><span class="co"> *   responses:</span></span>
<span id="cb714-12"><a href="Avtentikacija.html#cb714-12" tabindex="-1"></a><span class="co"> *    &#39;204&#39;:</span></span>
<span id="cb714-13"><a href="Avtentikacija.html#cb714-13" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb714-14"><a href="Avtentikacija.html#cb714-14" tabindex="-1"></a><span class="co"> *    &#39;400&#39;:</span></span>
<span id="cb714-15"><a href="Avtentikacija.html#cb714-15" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb714-16"><a href="Avtentikacija.html#cb714-16" tabindex="-1"></a><span class="co"> *    &#39;401&#39;:</span></span>
<span id="cb714-17"><a href="Avtentikacija.html#cb714-17" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Unauthorized</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb714-18"><a href="Avtentikacija.html#cb714-18" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb714-19"><a href="Avtentikacija.html#cb714-19" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb714-20"><a href="Avtentikacija.html#cb714-20" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb714-21"><a href="Avtentikacija.html#cb714-21" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb714-22"><a href="Avtentikacija.html#cb714-22" tabindex="-1"></a><span class="co"> *       examples:</span></span>
<span id="cb714-23"><a href="Avtentikacija.html#cb714-23" tabindex="-1"></a><span class="co"> *        no token provided:</span></span>
<span id="cb714-24"><a href="Avtentikacija.html#cb714-24" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb714-25"><a href="Avtentikacija.html#cb714-25" tabindex="-1"></a><span class="co"> *          message: No authorization token was found.</span></span>
<span id="cb714-26"><a href="Avtentikacija.html#cb714-26" tabindex="-1"></a><span class="co"> *        user not found:</span></span>
<span id="cb714-27"><a href="Avtentikacija.html#cb714-27" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb714-28"><a href="Avtentikacija.html#cb714-28" tabindex="-1"></a><span class="co"> *          message: User not found.</span></span>
<span id="cb714-29"><a href="Avtentikacija.html#cb714-29" tabindex="-1"></a><span class="co"> *        malformed token:</span></span>
<span id="cb714-30"><a href="Avtentikacija.html#cb714-30" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb714-31"><a href="Avtentikacija.html#cb714-31" tabindex="-1"></a><span class="co"> *          message: jwt malformed</span></span>
<span id="cb714-32"><a href="Avtentikacija.html#cb714-32" tabindex="-1"></a><span class="co"> *        invalid token signature:</span></span>
<span id="cb714-33"><a href="Avtentikacija.html#cb714-33" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb714-34"><a href="Avtentikacija.html#cb714-34" tabindex="-1"></a><span class="co"> *          message: invalid signature</span></span>
<span id="cb714-35"><a href="Avtentikacija.html#cb714-35" tabindex="-1"></a><span class="co"> *    &#39;403&#39;:</span></span>
<span id="cb714-36"><a href="Avtentikacija.html#cb714-36" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Forbidden</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb714-37"><a href="Avtentikacija.html#cb714-37" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb714-38"><a href="Avtentikacija.html#cb714-38" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb714-39"><a href="Avtentikacija.html#cb714-39" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb714-40"><a href="Avtentikacija.html#cb714-40" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb714-41"><a href="Avtentikacija.html#cb714-41" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb714-42"><a href="Avtentikacija.html#cb714-42" tabindex="-1"></a><span class="co"> *        message: Not authorized to delete this comment.</span></span>
<span id="cb714-43"><a href="Avtentikacija.html#cb714-43" tabindex="-1"></a><span class="co"> *    &#39;404&#39;:</span></span>
<span id="cb714-44"><a href="Avtentikacija.html#cb714-44" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb714-45"><a href="Avtentikacija.html#cb714-45" tabindex="-1"></a><span class="co"> *    &#39;500&#39;:</span></span>
<span id="cb714-46"><a href="Avtentikacija.html#cb714-46" tabindex="-1"></a><span class="co"> *     ...</span></span>
<span id="cb714-47"><a href="Avtentikacija.html#cb714-47" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb714-48"><a href="Avtentikacija.html#cb714-48" tabindex="-1"></a><span class="kw">const</span> commentsDeleteOne <span class="op">=</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb714-49"><a href="Avtentikacija.html#cb714-49" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb714-50"><a href="Avtentikacija.html#cb714-50" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Sedaj moramo v okviru oznake <code>Authentication</code> še dodati OpenAPI dokumentacijo metod za registracijo (<code>register</code>) in prijavo (<code>login</code>).</p>
<p>Pri <strong>registraciji novega uporabnika</strong> v okviru metode <strong><code>register</code></strong> mora uporabnik vnesti vse zahtevane podatke in v primeru uspešne registracije pridobi žeton JWT.</p>
<p><code>api/controllers/authentication.js</code></p>
<div class="sourceCode" id="cb715"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb715-1"><a href="Avtentikacija.html#cb715-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb715-2"><a href="Avtentikacija.html#cb715-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb715-3"><a href="Avtentikacija.html#cb715-3" tabindex="-1"></a><span class="co"> * /register:</span></span>
<span id="cb715-4"><a href="Avtentikacija.html#cb715-4" tabindex="-1"></a><span class="co"> *  post:</span></span>
<span id="cb715-5"><a href="Avtentikacija.html#cb715-5" tabindex="-1"></a><span class="co"> *   summary: Register a new user</span></span>
<span id="cb715-6"><a href="Avtentikacija.html#cb715-6" tabindex="-1"></a><span class="co"> *   description: </span><span class="kw">&lt;b&gt;</span><span class="co">Register a new user</span><span class="kw">&lt;/b&gt;</span><span class="co"> with name, email and password.</span></span>
<span id="cb715-7"><a href="Avtentikacija.html#cb715-7" tabindex="-1"></a><span class="co"> *   tags: [Authentication]</span></span>
<span id="cb715-8"><a href="Avtentikacija.html#cb715-8" tabindex="-1"></a><span class="co"> *   requestBody:</span></span>
<span id="cb715-9"><a href="Avtentikacija.html#cb715-9" tabindex="-1"></a><span class="co"> *    description: User object</span></span>
<span id="cb715-10"><a href="Avtentikacija.html#cb715-10" tabindex="-1"></a><span class="co"> *    required: true</span></span>
<span id="cb715-11"><a href="Avtentikacija.html#cb715-11" tabindex="-1"></a><span class="co"> *    content:</span></span>
<span id="cb715-12"><a href="Avtentikacija.html#cb715-12" tabindex="-1"></a><span class="co"> *     application/x-www-form-urlencoded:</span></span>
<span id="cb715-13"><a href="Avtentikacija.html#cb715-13" tabindex="-1"></a><span class="co"> *      schema:</span></span>
<span id="cb715-14"><a href="Avtentikacija.html#cb715-14" tabindex="-1"></a><span class="co"> *       $ref: &#39;#/components/schemas/User&#39;</span></span>
<span id="cb715-15"><a href="Avtentikacija.html#cb715-15" tabindex="-1"></a><span class="co"> *   responses:</span></span>
<span id="cb715-16"><a href="Avtentikacija.html#cb715-16" tabindex="-1"></a><span class="co"> *    &#39;200&#39;:</span></span>
<span id="cb715-17"><a href="Avtentikacija.html#cb715-17" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">OK</span><span class="kw">&lt;/b&gt;</span><span class="co">, with JWT token.</span></span>
<span id="cb715-18"><a href="Avtentikacija.html#cb715-18" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb715-19"><a href="Avtentikacija.html#cb715-19" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb715-20"><a href="Avtentikacija.html#cb715-20" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb715-21"><a href="Avtentikacija.html#cb715-21" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/Authentication&#39;</span></span>
<span id="cb715-22"><a href="Avtentikacija.html#cb715-22" tabindex="-1"></a><span class="co"> *    &#39;400&#39;:</span></span>
<span id="cb715-23"><a href="Avtentikacija.html#cb715-23" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Bad Request</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb715-24"><a href="Avtentikacija.html#cb715-24" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb715-25"><a href="Avtentikacija.html#cb715-25" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb715-26"><a href="Avtentikacija.html#cb715-26" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb715-27"><a href="Avtentikacija.html#cb715-27" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb715-28"><a href="Avtentikacija.html#cb715-28" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb715-29"><a href="Avtentikacija.html#cb715-29" tabindex="-1"></a><span class="co"> *        message: All fields required.</span></span>
<span id="cb715-30"><a href="Avtentikacija.html#cb715-30" tabindex="-1"></a><span class="co"> *    &#39;500&#39;:</span></span>
<span id="cb715-31"><a href="Avtentikacija.html#cb715-31" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Internal Server Error</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb715-32"><a href="Avtentikacija.html#cb715-32" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb715-33"><a href="Avtentikacija.html#cb715-33" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb715-34"><a href="Avtentikacija.html#cb715-34" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb715-35"><a href="Avtentikacija.html#cb715-35" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb715-36"><a href="Avtentikacija.html#cb715-36" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb715-37"><a href="Avtentikacija.html#cb715-37" tabindex="-1"></a><span class="co"> *        message: Database not available.</span></span>
<span id="cb715-38"><a href="Avtentikacija.html#cb715-38" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb715-39"><a href="Avtentikacija.html#cb715-39" tabindex="-1"></a><span class="kw">const</span> register <span class="op">=</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb715-40"><a href="Avtentikacija.html#cb715-40" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb715-41"><a href="Avtentikacija.html#cb715-41" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Podobno pri <strong>prijavi obstoječega uporabnika</strong> v okviru metode <strong><code>login</code></strong> uporabnik vnese elektronski naslov in geslo ter v primeru uspešne prijave prejme žeton JWT.</p>
<p><code>api/controllers/authentication.js</code></p>
<div class="sourceCode" id="cb716"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb716-1"><a href="Avtentikacija.html#cb716-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb716-2"><a href="Avtentikacija.html#cb716-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb716-3"><a href="Avtentikacija.html#cb716-3" tabindex="-1"></a><span class="co"> * /login:</span></span>
<span id="cb716-4"><a href="Avtentikacija.html#cb716-4" tabindex="-1"></a><span class="co"> *  post:</span></span>
<span id="cb716-5"><a href="Avtentikacija.html#cb716-5" tabindex="-1"></a><span class="co"> *   summary: Login a user</span></span>
<span id="cb716-6"><a href="Avtentikacija.html#cb716-6" tabindex="-1"></a><span class="co"> *   description: </span><span class="kw">&lt;b&gt;</span><span class="co">Login an existing user</span><span class="kw">&lt;/b&gt;</span><span class="co"> with email and password.</span></span>
<span id="cb716-7"><a href="Avtentikacija.html#cb716-7" tabindex="-1"></a><span class="co"> *   tags: [Authentication]</span></span>
<span id="cb716-8"><a href="Avtentikacija.html#cb716-8" tabindex="-1"></a><span class="co"> *   requestBody:</span></span>
<span id="cb716-9"><a href="Avtentikacija.html#cb716-9" tabindex="-1"></a><span class="co"> *    description: User credentials</span></span>
<span id="cb716-10"><a href="Avtentikacija.html#cb716-10" tabindex="-1"></a><span class="co"> *    required: true</span></span>
<span id="cb716-11"><a href="Avtentikacija.html#cb716-11" tabindex="-1"></a><span class="co"> *    content:</span></span>
<span id="cb716-12"><a href="Avtentikacija.html#cb716-12" tabindex="-1"></a><span class="co"> *     application/x-www-form-urlencoded:</span></span>
<span id="cb716-13"><a href="Avtentikacija.html#cb716-13" tabindex="-1"></a><span class="co"> *      schema:</span></span>
<span id="cb716-14"><a href="Avtentikacija.html#cb716-14" tabindex="-1"></a><span class="co"> *       type: object</span></span>
<span id="cb716-15"><a href="Avtentikacija.html#cb716-15" tabindex="-1"></a><span class="co"> *       properties:</span></span>
<span id="cb716-16"><a href="Avtentikacija.html#cb716-16" tabindex="-1"></a><span class="co"> *        email:</span></span>
<span id="cb716-17"><a href="Avtentikacija.html#cb716-17" tabindex="-1"></a><span class="co"> *         type: string</span></span>
<span id="cb716-18"><a href="Avtentikacija.html#cb716-18" tabindex="-1"></a><span class="co"> *         format: email</span></span>
<span id="cb716-19"><a href="Avtentikacija.html#cb716-19" tabindex="-1"></a><span class="co"> *         description: email of the user</span></span>
<span id="cb716-20"><a href="Avtentikacija.html#cb716-20" tabindex="-1"></a><span class="co"> *         example: dejan</span><span class="an">@lavbic.net</span></span>
<span id="cb716-21"><a href="Avtentikacija.html#cb716-21" tabindex="-1"></a><span class="co"> *        password:</span></span>
<span id="cb716-22"><a href="Avtentikacija.html#cb716-22" tabindex="-1"></a><span class="co"> *         type: string</span></span>
<span id="cb716-23"><a href="Avtentikacija.html#cb716-23" tabindex="-1"></a><span class="co"> *         description: password of the user</span></span>
<span id="cb716-24"><a href="Avtentikacija.html#cb716-24" tabindex="-1"></a><span class="co"> *         example: test</span></span>
<span id="cb716-25"><a href="Avtentikacija.html#cb716-25" tabindex="-1"></a><span class="co"> *       required:</span></span>
<span id="cb716-26"><a href="Avtentikacija.html#cb716-26" tabindex="-1"></a><span class="co"> *        - email</span></span>
<span id="cb716-27"><a href="Avtentikacija.html#cb716-27" tabindex="-1"></a><span class="co"> *        - password</span></span>
<span id="cb716-28"><a href="Avtentikacija.html#cb716-28" tabindex="-1"></a><span class="co"> *   responses:</span></span>
<span id="cb716-29"><a href="Avtentikacija.html#cb716-29" tabindex="-1"></a><span class="co"> *    &#39;200&#39;:</span></span>
<span id="cb716-30"><a href="Avtentikacija.html#cb716-30" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">OK</span><span class="kw">&lt;/b&gt;</span><span class="co">, with JWT token.</span></span>
<span id="cb716-31"><a href="Avtentikacija.html#cb716-31" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb716-32"><a href="Avtentikacija.html#cb716-32" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb716-33"><a href="Avtentikacija.html#cb716-33" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb716-34"><a href="Avtentikacija.html#cb716-34" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/Authentication&#39;</span></span>
<span id="cb716-35"><a href="Avtentikacija.html#cb716-35" tabindex="-1"></a><span class="co"> *    &#39;400&#39;:</span></span>
<span id="cb716-36"><a href="Avtentikacija.html#cb716-36" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Bad Request</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb716-37"><a href="Avtentikacija.html#cb716-37" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb716-38"><a href="Avtentikacija.html#cb716-38" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb716-39"><a href="Avtentikacija.html#cb716-39" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb716-40"><a href="Avtentikacija.html#cb716-40" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb716-41"><a href="Avtentikacija.html#cb716-41" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb716-42"><a href="Avtentikacija.html#cb716-42" tabindex="-1"></a><span class="co"> *        message: All fields required.</span></span>
<span id="cb716-43"><a href="Avtentikacija.html#cb716-43" tabindex="-1"></a><span class="co"> *    &#39;401&#39;:</span></span>
<span id="cb716-44"><a href="Avtentikacija.html#cb716-44" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Unauthorized</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb716-45"><a href="Avtentikacija.html#cb716-45" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb716-46"><a href="Avtentikacija.html#cb716-46" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb716-47"><a href="Avtentikacija.html#cb716-47" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb716-48"><a href="Avtentikacija.html#cb716-48" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb716-49"><a href="Avtentikacija.html#cb716-49" tabindex="-1"></a><span class="co"> *       examples:</span></span>
<span id="cb716-50"><a href="Avtentikacija.html#cb716-50" tabindex="-1"></a><span class="co"> *        incorrect username:</span></span>
<span id="cb716-51"><a href="Avtentikacija.html#cb716-51" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb716-52"><a href="Avtentikacija.html#cb716-52" tabindex="-1"></a><span class="co"> *          message: Incorrect username.</span></span>
<span id="cb716-53"><a href="Avtentikacija.html#cb716-53" tabindex="-1"></a><span class="co"> *        incorrect password:</span></span>
<span id="cb716-54"><a href="Avtentikacija.html#cb716-54" tabindex="-1"></a><span class="co"> *         value:</span></span>
<span id="cb716-55"><a href="Avtentikacija.html#cb716-55" tabindex="-1"></a><span class="co"> *          message: Incorrect password.</span></span>
<span id="cb716-56"><a href="Avtentikacija.html#cb716-56" tabindex="-1"></a><span class="co"> *    &#39;500&#39;:</span></span>
<span id="cb716-57"><a href="Avtentikacija.html#cb716-57" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Internal Server Error</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb716-58"><a href="Avtentikacija.html#cb716-58" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb716-59"><a href="Avtentikacija.html#cb716-59" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb716-60"><a href="Avtentikacija.html#cb716-60" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb716-61"><a href="Avtentikacija.html#cb716-61" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb716-62"><a href="Avtentikacija.html#cb716-62" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb716-63"><a href="Avtentikacija.html#cb716-63" tabindex="-1"></a><span class="co"> *        message: Database not available.</span></span>
<span id="cb716-64"><a href="Avtentikacija.html#cb716-64" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb716-65"><a href="Avtentikacija.html#cb716-65" tabindex="-1"></a><span class="kw">const</span> login <span class="op">=</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb716-66"><a href="Avtentikacija.html#cb716-66" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb716-67"><a href="Avtentikacija.html#cb716-67" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(0)").markRegExp(/\* /, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(0)").markRegExp(/locations/, options_izbrisi);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(1)").markRegExp(/\/\*\*[\s\S]+?\//, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(2)").markRegExp(/,[^{}]+?{[^n]+?name: "Authentication"[\s\S]+?}/, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(3)").markRegExp(/\s+?securitySchemes[\s\S]+?},[\s\S]+?},/, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(4)").markRegExp(/\s+?\*\s+?security:[\s\S]+?\[\]/, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(4)").markRegExp(/\s+?\*\s+?author:[\s\S]+?Lavbič/, options_izbrisi);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(4)").markRegExp(/\s+?- author/, options_izbrisi);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(4)").markRegExp(/\s+?\*\s+?'401'[\s\S]+?not found\./, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(5)").markRegExp(/\s+?\*\s+?security:[\s\S]+?\[\]/, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(5)").markRegExp(/\s+?\*\s+?'401'[\s\S]+?this comment\./, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(6)").markRegExp(/\s+?\*\s+?security:[\s\S]+?\[\]/, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(6)").markRegExp(/\s+?\*\s+?'401'[\s\S]+?this comment\./, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(7)").markRegExp(/\/\*\*[\s\S]+?\*\//, options_dodaj);
    $("#podpora-avtentikaciji-pri-openapi-dokumentaciji code.javascript:eq(8)").markRegExp(/\/\*\*[\s\S]+?\*\//, options_dodaj);
  });
</script>
</div>
<div id="testiranje-varnosti-na-ravni-rest-api-metod" class="section level4 hasAnchor" number="10.4.3.2">
<h4><span class="header-section-number">10.4.3.2</span> Testiranje varnosti na ravni REST API metod<a href="Avtentikacija.html#testiranje-varnosti-na-ravni-rest-api-metod" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Najprej <strong>registrirajmo</strong> novega uporabnika <strong>Janez Kranjski</strong>.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb717-1"><a href="Avtentikacija.html#cb717-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb717-2"><a href="Avtentikacija.html#cb717-2" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/register&quot;</span> <span class="dt">\</span></span>
<span id="cb717-3"><a href="Avtentikacija.html#cb717-3" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb717-4"><a href="Avtentikacija.html#cb717-4" tabindex="-1"></a>    <span class="at">-d</span> <span class="st">&quot;email=janez%40kranjski.net&amp;name=Janez%20Kranjski&amp;password=test&quot;</span></span>
<span id="cb717-5"><a href="Avtentikacija.html#cb717-5" tabindex="-1"></a></span>
<span id="cb717-6"><a href="Avtentikacija.html#cb717-6" tabindex="-1"></a><span class="kw">{</span> <span class="st">&quot;token&quot;</span><span class="ex">:</span> <span class="st">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2Mzc3NzMyMmNmYTVlNGFiZmRkYjIzYzIiLCJlbWFpbCI6ImphbmV6QGtyYW5qc2tpLm5ldCIsIm5hbWUiOiJKYW5leiBLcmFuanNraSIsImV4cCI6MTY2OTM3NzQ0MiwiaWF0IjoxNjY4NzcyNjQyfQ.2M6QUo_lYGUy3X9zWjpen-mAdSb9Lq6Uzgz4AJONbc4&quot;</span> }</span></code></pre></div>
<p>Po uspešni registraciji pridobimo žeton JWT, ki ga lahko uporabimo za ostale zaščitene funkcionalnosti sistema.</p>
<p>Če poskusimo <strong>še enkrat registrirati istega uporabnika</strong>, nam sistem vrne napako, saj uporabnik že obstaja, kjer smo v shemi opredelili, da je atribut <code>email</code> enoličen.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb718-1"><a href="Avtentikacija.html#cb718-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-i</span> <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb718-2"><a href="Avtentikacija.html#cb718-2" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/register&quot;</span> <span class="dt">\</span></span>
<span id="cb718-3"><a href="Avtentikacija.html#cb718-3" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb718-4"><a href="Avtentikacija.html#cb718-4" tabindex="-1"></a>    <span class="at">-d</span> <span class="st">&quot;email=janez%40kranjski.net&amp;name=Janez%20Kranjski&amp;password=test&quot;</span></span>
<span id="cb718-5"><a href="Avtentikacija.html#cb718-5" tabindex="-1"></a></span>
<span id="cb718-6"><a href="Avtentikacija.html#cb718-6" tabindex="-1"></a><span class="ex">HTTP/1.1</span> 500 Internal Server Error</span>
<span id="cb718-7"><a href="Avtentikacija.html#cb718-7" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb718-8"><a href="Avtentikacija.html#cb718-8" tabindex="-1"></a><span class="kw">{</span> <span class="st">&quot;message&quot;</span><span class="ex">:</span> <span class="st">&quot;E11000 duplicate key error collection: Demo.Users index: email_1 dup key: { email: </span><span class="dt">\&quot;</span><span class="st">janez@kranjski.net</span><span class="dt">\&quot;</span><span class="st"> }&quot;</span> }</span></code></pre></div>
<p>Sistem nam omogoča <strong>prijavo uporabnika</strong>, kjer sta zahtevana elektronski naslov in geslo, kot rezultat pa <strong>pridobimo žeton JWT</strong>.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb719-1"><a href="Avtentikacija.html#cb719-1" tabindex="-1"></a><span class="ex">$</span> JWT_TOKEN_JANEZ=<span class="va">$(</span> <span class="dt">\</span></span>
<span id="cb719-2"><a href="Avtentikacija.html#cb719-2" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb719-3"><a href="Avtentikacija.html#cb719-3" tabindex="-1"></a>      <span class="st">&quot;http://localhost:3000/api/login&quot;</span> <span class="dt">\</span></span>
<span id="cb719-4"><a href="Avtentikacija.html#cb719-4" tabindex="-1"></a>      <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb719-5"><a href="Avtentikacija.html#cb719-5" tabindex="-1"></a>      <span class="at">-d</span> <span class="st">&quot;email=janez%40kranjski.net&amp;password=test&quot;</span> <span class="dt">\</span></span>
<span id="cb719-6"><a href="Avtentikacija.html#cb719-6" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/.*&quot;\(.*\)&quot;.*/\1/&#39;</span><span class="va">)</span></span>
<span id="cb719-7"><a href="Avtentikacija.html#cb719-7" tabindex="-1"></a></span>
<span id="cb719-8"><a href="Avtentikacija.html#cb719-8" tabindex="-1"></a><span class="ex">$</span> echo <span class="va">$JWT_TOKEN_JANEZ</span></span>
<span id="cb719-9"><a href="Avtentikacija.html#cb719-9" tabindex="-1"></a><span class="ex">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2Mzc3NzMyMmNmYTVlNGFiZmRkYjIzYzIiLCJlbWFpbCI6ImphbmV6QGtyYW5qc2tpLm5ldCIsIm5hbWUiOiJKYW5leiBLcmFuanNraSIsImV4cCI6MTY2OTM4MDU5OCwiaWF0IjoxNjY4Nzc1Nzk4fQ.bFagSjcf7R4GoeJJdU8lrTZ6zjQSx7tQCweDmLE9AWE</span></span></code></pre></div>
<p>Testirali bomo na lokaciji <code>Ljubljana - Viško pokopališče</code>, zato pridobimo <strong>enolični identifikator lokacije</strong> in ga shranimo v okoljsko spremenljivko.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb720-1"><a href="Avtentikacija.html#cb720-1" tabindex="-1"></a><span class="ex">$</span> LOCATION_ID=<span class="va">$(</span><span class="ex">docker</span> exec <span class="at">-it</span> sp-mongo-db bash <span class="at">-c</span> <span class="st">&quot;mongosh Demo --eval </span><span class="dt">\</span></span>
<span id="cb720-2"><a href="Avtentikacija.html#cb720-2" tabindex="-1"></a><span class="st">    &#39;db.Locations.findOne(</span><span class="dt">\</span></span>
<span id="cb720-3"><a href="Avtentikacija.html#cb720-3" tabindex="-1"></a><span class="st">      {</span><span class="dt">\&quot;</span><span class="st">name</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">Ljubljana - Viško pokopališče</span><span class="dt">\&quot;</span><span class="st">}, { _id: 1 })&#39;&quot;</span><span class="dt">\</span></span>
<span id="cb720-4"><a href="Avtentikacija.html#cb720-4" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&#39;ObjectId&#39;</span> <span class="dt">\</span></span>
<span id="cb720-5"><a href="Avtentikacija.html#cb720-5" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/.*&quot;\(.*\)&quot;.*/\1/&#39;</span><span class="va">)</span></span></code></pre></div>
<p>Sedaj zahtevamo <strong>dodajanje novega komentarja</strong> obstoječi lokaciji, kjer pri zahtevi dodamo žeton JWT, ki nas na strani strežnika identificira kot prijavljenega uporabnika. V odgovoru opazimo, da se pri dodajanju novega komentarja samodejno doda naziv prijavljenega uporabnika, kot avtorja komentarja.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb721-1"><a href="Avtentikacija.html#cb721-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb721-2"><a href="Avtentikacija.html#cb721-2" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments&quot;</span> <span class="dt">\</span></span>
<span id="cb721-3"><a href="Avtentikacija.html#cb721-3" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer </span><span class="va">${JWT_TOKEN_JANEZ}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb721-4"><a href="Avtentikacija.html#cb721-4" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb721-5"><a href="Avtentikacija.html#cb721-5" tabindex="-1"></a>    <span class="at">-d</span> <span class="st">&quot;rating=3&amp;comment=Srednja%20%C5%BEalost.&quot;</span></span>
<span id="cb721-6"><a href="Avtentikacija.html#cb721-6" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb721-7"><a href="Avtentikacija.html#cb721-7" tabindex="-1"></a>  <span class="st">&quot;author&quot;</span><span class="ex">:</span> <span class="st">&quot;Janez Kranjski&quot;</span>,</span>
<span id="cb721-8"><a href="Avtentikacija.html#cb721-8" tabindex="-1"></a>  <span class="st">&quot;rating&quot;</span><span class="ex">:</span> 3,</span>
<span id="cb721-9"><a href="Avtentikacija.html#cb721-9" tabindex="-1"></a>  <span class="st">&quot;comment&quot;</span><span class="ex">:</span> <span class="st">&quot;Srednja žalost.&quot;</span>,</span>
<span id="cb721-10"><a href="Avtentikacija.html#cb721-10" tabindex="-1"></a>  <span class="st">&quot;_id&quot;</span><span class="ex">:</span> <span class="st">&quot;6378e948cca751abdf91c10f&quot;</span>,</span>
<span id="cb721-11"><a href="Avtentikacija.html#cb721-11" tabindex="-1"></a>  <span class="st">&quot;createdOn&quot;</span><span class="ex">:</span> <span class="st">&quot;2022-11-19T14:33:44.616Z&quot;</span></span>
<span id="cb721-12"><a href="Avtentikacija.html#cb721-12" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Če želimo <strong>dodati nov komentar</strong>, kjer sicer dodamo <strong>žeton JWT</strong>, vendar le-ta <strong>ni ustrezen</strong>, nam strežnik vrne napako <code>401</code> z obvestilo <code>jwt mailformed</code>.</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb722-1"><a href="Avtentikacija.html#cb722-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-i</span> <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb722-2"><a href="Avtentikacija.html#cb722-2" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments&quot;</span> <span class="dt">\</span></span>
<span id="cb722-3"><a href="Avtentikacija.html#cb722-3" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer 123&quot;</span> <span class="dt">\</span></span>
<span id="cb722-4"><a href="Avtentikacija.html#cb722-4" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb722-5"><a href="Avtentikacija.html#cb722-5" tabindex="-1"></a>    <span class="at">-d</span> <span class="st">&quot;rating=3&amp;comment=Srednja%20%C5%BEalost.&quot;</span></span>
<span id="cb722-6"><a href="Avtentikacija.html#cb722-6" tabindex="-1"></a></span>
<span id="cb722-7"><a href="Avtentikacija.html#cb722-7" tabindex="-1"></a><span class="ex">HTTP/1.1</span> 401 Unauthorized</span>
<span id="cb722-8"><a href="Avtentikacija.html#cb722-8" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb722-9"><a href="Avtentikacija.html#cb722-9" tabindex="-1"></a><span class="kw">{</span> <span class="st">&quot;message&quot;</span><span class="ex">:</span> <span class="st">&quot;jwt malformed&quot;</span> }</span></code></pre></div>
<p>Uporabnik lahko tudi zahteva <strong>spreminjanje lastnega komentarja</strong>. Najprej pridobimo enolični identifikator ravno dodanega komentarja, nato zahtevamo spremembo, kjer dodamo tudi žeton avtorja komentarja. Operacija je uspešna, saj nam strežnik vrne posodobljen komentar z zahtevanimi spremembami.</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb723-1"><a href="Avtentikacija.html#cb723-1" tabindex="-1"></a><span class="ex">$</span> COMMENT_ID=<span class="va">$(</span><span class="ex">docker</span> exec <span class="at">-it</span> sp-mongo-db bash <span class="at">-c</span> <span class="st">&quot;mongosh Demo --eval </span><span class="dt">\</span></span>
<span id="cb723-2"><a href="Avtentikacija.html#cb723-2" tabindex="-1"></a><span class="st">    &#39;db.Locations.findOne(</span><span class="dt">\</span></span>
<span id="cb723-3"><a href="Avtentikacija.html#cb723-3" tabindex="-1"></a><span class="st">      {</span><span class="dt">\&quot;</span><span class="st">name</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">Ljubljana - Viško pokopališče</span><span class="dt">\&quot;</span><span class="st"> }, </span><span class="dt">\</span></span>
<span id="cb723-4"><a href="Avtentikacija.html#cb723-4" tabindex="-1"></a><span class="st">      { _id: 0, comments: { </span><span class="dt">\$</span><span class="st">elemMatch: { </span><span class="dt">\&quot;</span><span class="st">author</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">Janez Kranjski</span><span class="dt">\&quot;</span><span class="st"> }} })&#39;&quot;</span> <span class="dt">\</span></span>
<span id="cb723-5"><a href="Avtentikacija.html#cb723-5" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&#39;ObjectId&#39;</span> <span class="dt">\</span></span>
<span id="cb723-6"><a href="Avtentikacija.html#cb723-6" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/.*&quot;\(.*\)&quot;.*/\1/&#39;</span><span class="va">)</span></span>
<span id="cb723-7"><a href="Avtentikacija.html#cb723-7" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT <span class="dt">\</span></span>
<span id="cb723-8"><a href="Avtentikacija.html#cb723-8" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments/</span><span class="va">${COMMENT_ID}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb723-9"><a href="Avtentikacija.html#cb723-9" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer </span><span class="va">${JWT_TOKEN_JANEZ}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb723-10"><a href="Avtentikacija.html#cb723-10" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb723-11"><a href="Avtentikacija.html#cb723-11" tabindex="-1"></a>    <span class="at">-d</span> <span class="st">&quot;rating=1&amp;comment=Obup.&quot;</span></span>
<span id="cb723-12"><a href="Avtentikacija.html#cb723-12" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb723-13"><a href="Avtentikacija.html#cb723-13" tabindex="-1"></a>  <span class="st">&quot;author&quot;</span><span class="ex">:</span> <span class="st">&quot;Janez Kranjski&quot;</span>,</span>
<span id="cb723-14"><a href="Avtentikacija.html#cb723-14" tabindex="-1"></a>  <span class="st">&quot;rating&quot;</span><span class="ex">:</span> 1,</span>
<span id="cb723-15"><a href="Avtentikacija.html#cb723-15" tabindex="-1"></a>  <span class="st">&quot;comment&quot;</span><span class="ex">:</span> <span class="st">&quot;Obup.&quot;</span>,</span>
<span id="cb723-16"><a href="Avtentikacija.html#cb723-16" tabindex="-1"></a>  <span class="st">&quot;_id&quot;</span><span class="ex">:</span> <span class="st">&quot;6378e948cca751abdf91c10f&quot;</span>,</span>
<span id="cb723-17"><a href="Avtentikacija.html#cb723-17" tabindex="-1"></a>  <span class="st">&quot;createdOn&quot;</span><span class="ex">:</span> <span class="st">&quot;2022-11-19T14:33:44.616Z&quot;</span></span>
<span id="cb723-18"><a href="Avtentikacija.html#cb723-18" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Sedaj poskusimo <strong>spremeniti</strong> omenjeni <strong>komentar</strong>, vendar <strong>z drugim uporabnikom, ki ni prvotni avtor</strong>. Iz odgovora vidima, da operacija ni dovoljena, saj nam strežnik vrne napako <code>403</code>, kjer <strong>uporabnik nima pravice izvajati omenjene operacije</strong>.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb724-1"><a href="Avtentikacija.html#cb724-1" tabindex="-1"></a><span class="ex">$</span> JWT_TOKEN_DEJAN=<span class="va">$(</span> <span class="dt">\</span></span>
<span id="cb724-2"><a href="Avtentikacija.html#cb724-2" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-X</span> POST <span class="dt">\</span></span>
<span id="cb724-3"><a href="Avtentikacija.html#cb724-3" tabindex="-1"></a>      <span class="st">&quot;http://localhost:3000/api/login&quot;</span> <span class="dt">\</span></span>
<span id="cb724-4"><a href="Avtentikacija.html#cb724-4" tabindex="-1"></a>      <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb724-5"><a href="Avtentikacija.html#cb724-5" tabindex="-1"></a>      <span class="at">-d</span> <span class="st">&quot;email=dejan%40lavbic.net&amp;password=test&quot;</span> <span class="dt">\</span></span>
<span id="cb724-6"><a href="Avtentikacija.html#cb724-6" tabindex="-1"></a>    <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/.*&quot;\(.*\)&quot;.*/\1/&#39;</span><span class="va">)</span></span>
<span id="cb724-7"><a href="Avtentikacija.html#cb724-7" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-i</span> <span class="at">-X</span> PUT <span class="dt">\</span></span>
<span id="cb724-8"><a href="Avtentikacija.html#cb724-8" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments/</span><span class="va">${COMMENT_ID}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb724-9"><a href="Avtentikacija.html#cb724-9" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer </span><span class="va">${JWT_TOKEN_DEJAN}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb724-10"><a href="Avtentikacija.html#cb724-10" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> <span class="dt">\</span></span>
<span id="cb724-11"><a href="Avtentikacija.html#cb724-11" tabindex="-1"></a>    <span class="at">-d</span> <span class="st">&quot;rating=5&amp;comment=Super%20lokacija.&quot;</span></span>
<span id="cb724-12"><a href="Avtentikacija.html#cb724-12" tabindex="-1"></a></span>
<span id="cb724-13"><a href="Avtentikacija.html#cb724-13" tabindex="-1"></a><span class="ex">HTTP/1.1</span> 403 Forbidden</span>
<span id="cb724-14"><a href="Avtentikacija.html#cb724-14" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb724-15"><a href="Avtentikacija.html#cb724-15" tabindex="-1"></a><span class="kw">{</span> <span class="st">&quot;message&quot;</span><span class="ex">:</span> <span class="st">&quot;Not authorized to update this comment.&quot;</span> }</span></code></pre></div>
<p>Sedaj poskusimo še z istim <strong>uporabnikom</strong>, ki <strong>ni avtor komentarja</strong>, le-tega <strong>izbrisati</strong>. Podobno kot v prejšnjem primeru operacija ni dovoljena, kar strežnik tudi sporoči kot napako <code>403</code>.</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb725-1"><a href="Avtentikacija.html#cb725-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-i</span> <span class="at">-X</span> DELETE <span class="dt">\</span></span>
<span id="cb725-2"><a href="Avtentikacija.html#cb725-2" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments/</span><span class="va">${COMMENT_ID}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb725-3"><a href="Avtentikacija.html#cb725-3" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer </span><span class="va">${JWT_TOKEN_DEJAN}</span><span class="st">&quot;</span></span>
<span id="cb725-4"><a href="Avtentikacija.html#cb725-4" tabindex="-1"></a></span>
<span id="cb725-5"><a href="Avtentikacija.html#cb725-5" tabindex="-1"></a><span class="ex">HTTP/1.1</span> 403 Forbidden</span>
<span id="cb725-6"><a href="Avtentikacija.html#cb725-6" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb725-7"><a href="Avtentikacija.html#cb725-7" tabindex="-1"></a><span class="kw">{</span> <span class="st">&quot;message&quot;</span><span class="ex">:</span> <span class="st">&quot;Not authorized to delete this comment.&quot;</span> }</span></code></pre></div>
<p>Ko pa <strong>brisanje</strong> zahteva <strong>avtor komentarja</strong>, je omenjena operacija dovoljena in vrne uspešno potrditev <code>204</code>.</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb726-1"><a href="Avtentikacija.html#cb726-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-i</span> <span class="at">-X</span> DELETE <span class="dt">\</span></span>
<span id="cb726-2"><a href="Avtentikacija.html#cb726-2" tabindex="-1"></a>    <span class="st">&quot;http://localhost:3000/api/locations/</span><span class="va">${LOCATION_ID}</span><span class="st">/comments/</span><span class="va">${COMMENT_ID}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb726-3"><a href="Avtentikacija.html#cb726-3" tabindex="-1"></a>    <span class="at">-H</span> <span class="st">&quot;Authorization: Bearer </span><span class="va">${JWT_TOKEN_JANEZ}</span><span class="st">&quot;</span></span>
<span id="cb726-4"><a href="Avtentikacija.html#cb726-4" tabindex="-1"></a></span>
<span id="cb726-5"><a href="Avtentikacija.html#cb726-5" tabindex="-1"></a><span class="ex">HTTP/1.1</span> 204 No Content</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(0)").markRegExp(/curl[\s\S]+?test"/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(1)").markRegExp(/curl[\s\S]+?test"/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(2)").markRegExp(/JWT_TOKEN_JANEZ=[\s\S]+?'\)/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(3)").markRegExp(/LOCATION_ID=[\s\S]+?'\)/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(4)").markRegExp(/curl[\s\S]+?lost."/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(4)").markRegExp(/Janez Kranjski/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(5)").markRegExp(/curl[\s\S]+?\."/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(5)").markRegExp(/401 Unauthorized|jwt malformed/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(6)").markRegExp(/COMMENT_ID=[\s\S]+?'\)/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(6)").markRegExp(/curl[\s\S]+?\."/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(7)").markRegExp(/JWT_TOKEN_DEJAN=[\s\S]+?'\)/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(7)").markRegExp(/curl -i -X PUT[\s\S]+?\."/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(7)").markRegExp(/403 Forbidden|Not.+?comment\./, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(8)").markRegExp(/curl[\s\S]+?DEJAN}"/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(8)").markRegExp(/403 Forbidden|Not.+?comment\./, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(9)").markRegExp(/curl[\s\S]+?JANEZ}"/, options_dodaj);
    $("#testiranje-varnosti-na-ravni-rest-api-metod code.bash:eq(9)").markRegExp(/204 No Content/, options_dodaj);
  });
</script>
</div>
</div>
</div>
<div id="Priprava-storitve-avtentikacije-v-Angular" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Priprava storitve avtentikacije v Angular<a href="Avtentikacija.html#Priprava-storitve-avtentikacije-v-Angular" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ker bomo <strong>avtentikacijo v Angular aplikaciji</strong> potrebovali <strong>na večih mestih</strong>, je smiselno funkcionalnost razviti v obliki storitve. Storitev bo skrbela za vse vidike povezane z avtentikacijo, kar vključuje shranjevanje in branje žetona JWT, vračanje informacij o trenutnem uporabniku in dostop do API dostopnih točk registracije in prijave.</p>
<div id="obvladovanje-seje-uporabnika-v-angular" class="section level3 hasAnchor" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> Obvladovanje seje uporabnika v Angular<a href="Avtentikacija.html#obvladovanje-seje-uporabnika-v-angular" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Tradicionalen pristop shranjevanja uporabniških podatkov je v obliki <strong>piškotkov</strong> <em>(angl. <a href="https://en.wikipedia.org/wiki/HTTP_cookie"><i class="fa-brands fa-wikipedia-w"></i>cookies</a>)</em> in tudi v našem primeru bi lahko izbrali to možnost. Vendar se moramo zavedati, da se piškotki uporabljajo predvsem zaradi strežniške aplikacije, kjer jih vključimo pri vsaki zahtevi v obliki podatka v HTTP glavi. Pri SPA aplikaciji na eni strani ne potrebujemo takšne podpore, saj so API dostopne točke brez stanja in ne nastavljajo oz. uporabljajo piškotkov.</p>
<p>Zato bomo v našem primeru uporabili <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><i class="fa-brands fa-square-js"></i><strong>lokalno shrambo</strong> podatkov</a>, ki smo jo že predstavili v enem izmed prejšnjih predavanj v okviru poglavja <a href="JavaScript.html#shranjevanje-podatkov-na-odjemalcu">4.18.9</a>.</p>
<p>Za ta namen bomo najprej z Angular CLI zahtevali kreiranje novega razreda <code>Storage</code>.</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb727-1"><a href="Avtentikacija.html#cb727-1" tabindex="-1"></a><span class="ex">$</span> ng generate class shared/classes/storage</span>
<span id="cb727-2"><a href="Avtentikacija.html#cb727-2" tabindex="-1"></a></span>
<span id="cb727-3"><a href="Avtentikacija.html#cb727-3" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/classes/storage.ts <span class="er">(</span><span class="ex">25</span> bytes<span class="kw">)</span></span></code></pre></div>
<p>V shrambi bomo opredelili spremenljivko <code>BROWSER_STORAGE</code>, ki bo povezana z lokalno shrambo podatkov v brskalniku in jo bomo kasneje uporabljali v komponentah Angular SPA aplikacije.</p>
<p><code>angular/src/app/shared/classes/storage.ts</code></p>
<div class="sourceCode" id="cb728"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb728-1"><a href="Avtentikacija.html#cb728-1" tabindex="-1"></a><span class="im">import</span> { InjectionToken } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb728-2"><a href="Avtentikacija.html#cb728-2" tabindex="-1"></a></span>
<span id="cb728-3"><a href="Avtentikacija.html#cb728-3" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> BROWSER_STORAGE <span class="op">=</span> <span class="kw">new</span> InjectionToken<span class="op">&lt;</span><span class="bu">Storage</span><span class="op">&gt;</span>(<span class="st">&quot;Browser storage&quot;</span><span class="op">,</span> {</span>
<span id="cb728-4"><a href="Avtentikacija.html#cb728-4" tabindex="-1"></a>  <span class="dt">providedIn</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb728-5"><a href="Avtentikacija.html#cb728-5" tabindex="-1"></a>  <span class="dt">factory</span><span class="op">:</span> () <span class="kw">=&gt;</span> localStorage<span class="op">,</span></span>
<span id="cb728-6"><a href="Avtentikacija.html#cb728-6" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb728-7"><a href="Avtentikacija.html#cb728-7" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> <span class="bu">Storage</span> {}</span></code></pre></div>
<p>Za shranjevanje in branje žetona JWT iz lokalne shrambe brskalnika bomo pripravili storitev za avtentikacijo, kjer bomo opredelili metodi <code>saveToken</code> in <code>getToken</code>. Funkcionalnosti bosta zelo preprosti, saj bosta zgolj shranili oz. brali vrednost <code>demo-token</code> iz shrambe, ki smo jo predhodno opredelili v razredu.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb729-1"><a href="Avtentikacija.html#cb729-1" tabindex="-1"></a><span class="ex">$</span> ng generate service shared/services/authentication</span>
<span id="cb729-2"><a href="Avtentikacija.html#cb729-2" tabindex="-1"></a></span>
<span id="cb729-3"><a href="Avtentikacija.html#cb729-3" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/services/authentication.service.ts <span class="er">(</span><span class="ex">143</span> bytes<span class="kw">)</span></span></code></pre></div>
<p><code>angular/src/app/shared/services/authentication.service.ts</code></p>
<div class="sourceCode" id="cb730"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb730-1"><a href="Avtentikacija.html#cb730-1" tabindex="-1"></a><span class="im">import</span> { Inject<span class="op">,</span> Injectable } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb730-2"><a href="Avtentikacija.html#cb730-2" tabindex="-1"></a><span class="im">import</span> { BROWSER_STORAGE } <span class="im">from</span> <span class="st">&quot;../classes/storage&quot;</span><span class="op">;</span></span>
<span id="cb730-3"><a href="Avtentikacija.html#cb730-3" tabindex="-1"></a></span>
<span id="cb730-4"><a href="Avtentikacija.html#cb730-4" tabindex="-1"></a>@<span class="fu">Injectable</span>({</span>
<span id="cb730-5"><a href="Avtentikacija.html#cb730-5" tabindex="-1"></a>  <span class="dt">providedIn</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb730-6"><a href="Avtentikacija.html#cb730-6" tabindex="-1"></a>})</span>
<span id="cb730-7"><a href="Avtentikacija.html#cb730-7" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> AuthenticationService {</span>
<span id="cb730-8"><a href="Avtentikacija.html#cb730-8" tabindex="-1"></a>  <span class="fu">constructor</span>(@<span class="fu">Inject</span>(BROWSER_STORAGE) <span class="kw">private</span> <span class="dt">storage</span><span class="op">:</span> <span class="bu">Storage</span>) {}</span>
<span id="cb730-9"><a href="Avtentikacija.html#cb730-9" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getToken</span>()<span class="op">:</span> string <span class="op">|</span> <span class="kw">null</span> {</span>
<span id="cb730-10"><a href="Avtentikacija.html#cb730-10" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="st">&quot;demo-token&quot;</span>)<span class="op">;</span></span>
<span id="cb730-11"><a href="Avtentikacija.html#cb730-11" tabindex="-1"></a>  }</span>
<span id="cb730-12"><a href="Avtentikacija.html#cb730-12" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">saveToken</span>(<span class="dt">token</span><span class="op">:</span> string)<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb730-13"><a href="Avtentikacija.html#cb730-13" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">setItem</span>(<span class="st">&quot;demo-token&quot;</span><span class="op">,</span> token)<span class="op">;</span></span>
<span id="cb730-14"><a href="Avtentikacija.html#cb730-14" tabindex="-1"></a>  }</span>
<span id="cb730-15"><a href="Avtentikacija.html#cb730-15" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#obvladovanje-seje-uporabnika-v-angular code.bash:eq(0)").markRegExp(/ng generate.+/, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code:eq(2)").markRegExp(/.+/, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code.javascript:eq(0)").markRegExp(/import[\s\S]+?\);/, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code.javascript:eq(0)").markRegExp(/export class[\s\S]+/, options_izbrisi);
    $("#obvladovanje-seje-uporabnika-v-angular code.bash:eq(1)").markRegExp(/ng generate.+/, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code.javascript:eq(1)").markRegExp(/Inject, /, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code.javascript:eq(1)").markRegExp(/import { BROWSER_STORAGE.+/, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code.javascript:eq(1)").markRegExp(/\@Inject.+?Storage/, options_dodaj);
    $("#obvladovanje-seje-uporabnika-v-angular code.javascript:eq(1)").markRegExp(/\s+?public[\s\S]+?}/, options_dodaj);
  });
</script>
</div>
<div id="omogočanje-registracije-prijave-in-odjave-uporabnikov" class="section level3 hasAnchor" number="10.5.2">
<h3><span class="header-section-number">10.5.2</span> Omogočanje registracije, prijave in odjave uporabnikov<a href="Avtentikacija.html#omogočanje-registracije-prijave-in-odjave-uporabnikov" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Za pomoč pri obvladovanju podatkov o uporabniku in njegovem JWT žetonu bomo pripravili dva nova razreda <code>User</code> in <code>AuthResponse</code>.</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb731-1"><a href="Avtentikacija.html#cb731-1" tabindex="-1"></a><span class="ex">$</span> ng generate class shared/classes/user</span>
<span id="cb731-2"><a href="Avtentikacija.html#cb731-2" tabindex="-1"></a></span>
<span id="cb731-3"><a href="Avtentikacija.html#cb731-3" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/classes/user.ts <span class="er">(</span><span class="ex">22</span> bytes<span class="kw">)</span></span>
<span id="cb731-4"><a href="Avtentikacija.html#cb731-4" tabindex="-1"></a></span>
<span id="cb731-5"><a href="Avtentikacija.html#cb731-5" tabindex="-1"></a><span class="ex">$</span> ng generate class shared/classes/auth-response</span>
<span id="cb731-6"><a href="Avtentikacija.html#cb731-6" tabindex="-1"></a></span>
<span id="cb731-7"><a href="Avtentikacija.html#cb731-7" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/classes/auth-response.ts <span class="er">(</span><span class="ex">30</span> bytes<span class="kw">)</span></span></code></pre></div>
<p>Pri uporabnikih bomo shranili njihovo <strong>ime</strong> (<code>name</code>), <strong>elektronski naslov</strong> (<code>email</code>) in opcijsko <strong>geslo</strong> (<code>password</code>), pri rezultatu avtentikacije pa JWT <strong>žeton</strong> (<code>token</code>).</p>
<p><code>angular/src/app/shared/classes/user.ts</code></p>
<div class="sourceCode" id="cb732"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb732-1"><a href="Avtentikacija.html#cb732-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> User {</span>
<span id="cb732-2"><a href="Avtentikacija.html#cb732-2" tabindex="-1"></a>  email<span class="op">!:</span> string<span class="op">;</span></span>
<span id="cb732-3"><a href="Avtentikacija.html#cb732-3" tabindex="-1"></a>  name<span class="op">!:</span> string<span class="op">;</span></span>
<span id="cb732-4"><a href="Avtentikacija.html#cb732-4" tabindex="-1"></a>  password<span class="op">?:</span> string</span>
<span id="cb732-5"><a href="Avtentikacija.html#cb732-5" tabindex="-1"></a>}</span></code></pre></div>
<p><code>angular/src/app/shared/classes/auth-response.ts</code></p>
<div class="sourceCode" id="cb733"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb733-1"><a href="Avtentikacija.html#cb733-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> AuthResponse {</span>
<span id="cb733-2"><a href="Avtentikacija.html#cb733-2" tabindex="-1"></a>  token<span class="op">!:</span> string<span class="op">;</span></span>
<span id="cb733-3"><a href="Avtentikacija.html#cb733-3" tabindex="-1"></a>}</span></code></pre></div>
<p>V obstoječo storitev <code>authentication</code> moramo dodati še druge metode, ki jih bomo uporabljali za <strong>registracijo</strong> (<code>register</code>), <strong>prijavo</strong> (<code>login</code>) in <strong>odjavo</strong> (<code>logout</code>).</p>
<p><code>angular/src/app/shared/services/authentication.service.ts</code></p>
<div class="sourceCode" id="cb734"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb734-1"><a href="Avtentikacija.html#cb734-1" tabindex="-1"></a><span class="im">import</span> { Inject<span class="op">,</span> Injectable } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb734-2"><a href="Avtentikacija.html#cb734-2" tabindex="-1"></a><span class="im">import</span> { BROWSER_STORAGE } <span class="im">from</span> <span class="st">&quot;../classes/storage&quot;</span><span class="op">;</span></span>
<span id="cb734-3"><a href="Avtentikacija.html#cb734-3" tabindex="-1"></a><span class="im">import</span> { Observable } <span class="im">from</span> <span class="st">&quot;rxjs&quot;</span><span class="op">;</span></span>
<span id="cb734-4"><a href="Avtentikacija.html#cb734-4" tabindex="-1"></a><span class="im">import</span> { tap } <span class="im">from</span> <span class="st">&quot;rxjs/operators&quot;</span><span class="op">;</span></span>
<span id="cb734-5"><a href="Avtentikacija.html#cb734-5" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb734-6"><a href="Avtentikacija.html#cb734-6" tabindex="-1"></a><span class="im">import</span> { AuthResponse } <span class="im">from</span> <span class="st">&quot;../classes/auth-response&quot;</span><span class="op">;</span></span>
<span id="cb734-7"><a href="Avtentikacija.html#cb734-7" tabindex="-1"></a><span class="im">import</span> { DemoDataService } <span class="im">from</span> <span class="st">&quot;./demo-data.service&quot;</span><span class="op">;</span></span>
<span id="cb734-8"><a href="Avtentikacija.html#cb734-8" tabindex="-1"></a></span>
<span id="cb734-9"><a href="Avtentikacija.html#cb734-9" tabindex="-1"></a>@<span class="fu">Injectable</span>({</span>
<span id="cb734-10"><a href="Avtentikacija.html#cb734-10" tabindex="-1"></a>  <span class="dt">providedIn</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb734-11"><a href="Avtentikacija.html#cb734-11" tabindex="-1"></a>})</span>
<span id="cb734-12"><a href="Avtentikacija.html#cb734-12" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> AuthenticationService {</span>
<span id="cb734-13"><a href="Avtentikacija.html#cb734-13" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb734-14"><a href="Avtentikacija.html#cb734-14" tabindex="-1"></a>    @<span class="fu">Inject</span>(BROWSER_STORAGE) <span class="kw">private</span> <span class="dt">storage</span><span class="op">:</span> <span class="bu">Storage</span><span class="op">,</span></span>
<span id="cb734-15"><a href="Avtentikacija.html#cb734-15" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">demoDataService</span><span class="op">:</span> DemoDataService</span>
<span id="cb734-16"><a href="Avtentikacija.html#cb734-16" tabindex="-1"></a>  ) {}</span>
<span id="cb734-17"><a href="Avtentikacija.html#cb734-17" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">login</span>(<span class="dt">user</span><span class="op">:</span> User)<span class="op">:</span> Observable<span class="op">&lt;</span>AuthResponse<span class="op">&gt;</span> {</span>
<span id="cb734-18"><a href="Avtentikacija.html#cb734-18" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">demoDataService</span><span class="op">.</span><span class="fu">login</span>(user)<span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb734-19"><a href="Avtentikacija.html#cb734-19" tabindex="-1"></a>      <span class="fu">tap</span>((<span class="dt">authResponse</span><span class="op">:</span> AuthResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb734-20"><a href="Avtentikacija.html#cb734-20" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">saveToken</span>(authResponse<span class="op">.</span><span class="at">token</span>)<span class="op">;</span></span>
<span id="cb734-21"><a href="Avtentikacija.html#cb734-21" tabindex="-1"></a>      })</span>
<span id="cb734-22"><a href="Avtentikacija.html#cb734-22" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb734-23"><a href="Avtentikacija.html#cb734-23" tabindex="-1"></a>  }</span>
<span id="cb734-24"><a href="Avtentikacija.html#cb734-24" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">register</span>(<span class="dt">user</span><span class="op">:</span> User)<span class="op">:</span> Observable<span class="op">&lt;</span>AuthResponse<span class="op">&gt;</span> {</span>
<span id="cb734-25"><a href="Avtentikacija.html#cb734-25" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">demoDataService</span><span class="op">.</span><span class="fu">register</span>(user)<span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb734-26"><a href="Avtentikacija.html#cb734-26" tabindex="-1"></a>      <span class="fu">tap</span>((<span class="dt">authResponse</span><span class="op">:</span> AuthResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb734-27"><a href="Avtentikacija.html#cb734-27" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">saveToken</span>(authResponse<span class="op">.</span><span class="at">token</span>)<span class="op">;</span></span>
<span id="cb734-28"><a href="Avtentikacija.html#cb734-28" tabindex="-1"></a>      })</span>
<span id="cb734-29"><a href="Avtentikacija.html#cb734-29" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb734-30"><a href="Avtentikacija.html#cb734-30" tabindex="-1"></a>  }</span>
<span id="cb734-31"><a href="Avtentikacija.html#cb734-31" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">logout</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb734-32"><a href="Avtentikacija.html#cb734-32" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&quot;demo-token&quot;</span>)<span class="op">;</span></span>
<span id="cb734-33"><a href="Avtentikacija.html#cb734-33" tabindex="-1"></a>  }</span>
<span id="cb734-34"><a href="Avtentikacija.html#cb734-34" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getToken</span>()<span class="op">:</span> string <span class="op">|</span> <span class="kw">null</span> {</span>
<span id="cb734-35"><a href="Avtentikacija.html#cb734-35" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="st">&quot;demo-token&quot;</span>)<span class="op">;</span></span>
<span id="cb734-36"><a href="Avtentikacija.html#cb734-36" tabindex="-1"></a>  }</span>
<span id="cb734-37"><a href="Avtentikacija.html#cb734-37" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">saveToken</span>(<span class="dt">token</span><span class="op">:</span> string)<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb734-38"><a href="Avtentikacija.html#cb734-38" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">setItem</span>(<span class="st">&quot;demo-token&quot;</span><span class="op">,</span> token)<span class="op">;</span></span>
<span id="cb734-39"><a href="Avtentikacija.html#cb734-39" tabindex="-1"></a>  }</span>
<span id="cb734-40"><a href="Avtentikacija.html#cb734-40" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p>V zgornjem primeru smo uporabili <a href="https://rxjs.dev/api/operators/tap"><i class="fa-brands fa-square-js"></i><code>tap</code></a>, ki iz odgovora REST API-ja izlušči žeton JWT in ga shrani v lokalno shrambo brskalnika.</p>
</blockquote>
<p>Pri registraciji in prijavi bo šlo zgolj za <strong>klic REST API storitev</strong>, ki jih moramo <strong>še implementirati v storitvi <code>demo-data</code></strong>, pri odjavi pa moramo zgolj zbrisati JWT žeton iz lokalne shrambe brskalnika.</p>
<p><code>angular/src/app/shared/services/demo-data.service.ts</code></p>
<div class="sourceCode" id="cb735"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb735-1"><a href="Avtentikacija.html#cb735-1" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb735-2"><a href="Avtentikacija.html#cb735-2" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb735-3"><a href="Avtentikacija.html#cb735-3" tabindex="-1"></a><span class="im">import</span> { AuthResponse } <span class="im">from</span> <span class="st">&quot;../classes/auth-response&quot;</span><span class="op">;</span></span>
<span id="cb735-4"><a href="Avtentikacija.html#cb735-4" tabindex="-1"></a></span>
<span id="cb735-5"><a href="Avtentikacija.html#cb735-5" tabindex="-1"></a>@<span class="fu">Injectable</span>({</span>
<span id="cb735-6"><a href="Avtentikacija.html#cb735-6" tabindex="-1"></a>  <span class="dt">providedIn</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb735-7"><a href="Avtentikacija.html#cb735-7" tabindex="-1"></a>})</span>
<span id="cb735-8"><a href="Avtentikacija.html#cb735-8" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> DemoDataService {</span>
<span id="cb735-9"><a href="Avtentikacija.html#cb735-9" tabindex="-1"></a>  <span class="fu">constructor</span>(<span class="kw">private</span> <span class="dt">http</span><span class="op">:</span> HttpClient) {}</span>
<span id="cb735-10"><a href="Avtentikacija.html#cb735-10" tabindex="-1"></a>  <span class="kw">private</span> apiUrl <span class="op">=</span> environment<span class="op">.</span><span class="at">apiUrl</span><span class="op">;</span></span>
<span id="cb735-11"><a href="Avtentikacija.html#cb735-11" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">login</span>(<span class="dt">user</span><span class="op">:</span> User)<span class="op">:</span> Observable<span class="op">&lt;</span>AuthResponse<span class="op">&gt;</span> {</span>
<span id="cb735-12"><a href="Avtentikacija.html#cb735-12" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">makeAuthApiCall</span>(<span class="st">&quot;login&quot;</span><span class="op">,</span> user)<span class="op">;</span></span>
<span id="cb735-13"><a href="Avtentikacija.html#cb735-13" tabindex="-1"></a>  }</span>
<span id="cb735-14"><a href="Avtentikacija.html#cb735-14" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">register</span>(<span class="dt">user</span><span class="op">:</span> User)<span class="op">:</span> Observable<span class="op">&lt;</span>AuthResponse<span class="op">&gt;</span> {</span>
<span id="cb735-15"><a href="Avtentikacija.html#cb735-15" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">makeAuthApiCall</span>(<span class="st">&quot;register&quot;</span><span class="op">,</span> user)<span class="op">;</span></span>
<span id="cb735-16"><a href="Avtentikacija.html#cb735-16" tabindex="-1"></a>  }</span>
<span id="cb735-17"><a href="Avtentikacija.html#cb735-17" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">makeAuthApiCall</span>(</span>
<span id="cb735-18"><a href="Avtentikacija.html#cb735-18" tabindex="-1"></a>    <span class="dt">urlPath</span><span class="op">:</span> string<span class="op">,</span></span>
<span id="cb735-19"><a href="Avtentikacija.html#cb735-19" tabindex="-1"></a>    <span class="dt">user</span><span class="op">:</span> User</span>
<span id="cb735-20"><a href="Avtentikacija.html#cb735-20" tabindex="-1"></a>  )<span class="op">:</span> Observable<span class="op">&lt;</span>AuthResponse<span class="op">&gt;</span> {</span>
<span id="cb735-21"><a href="Avtentikacija.html#cb735-21" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">url</span><span class="op">:</span> string <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>urlPath<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb735-22"><a href="Avtentikacija.html#cb735-22" tabindex="-1"></a>    <span class="kw">let</span> body <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpParams</span>()<span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;email&quot;</span><span class="op">,</span> user<span class="op">.</span><span class="at">email</span>)<span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;name&quot;</span><span class="op">,</span> user<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb735-23"><a href="Avtentikacija.html#cb735-23" tabindex="-1"></a>    <span class="cf">if</span> (user<span class="op">.</span><span class="at">password</span>) body <span class="op">=</span> body<span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;password&quot;</span><span class="op">,</span> user<span class="op">.</span><span class="at">password</span>)<span class="op">;</span></span>
<span id="cb735-24"><a href="Avtentikacija.html#cb735-24" tabindex="-1"></a>    <span class="kw">let</span> headers <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpHeaders</span>()<span class="op">.</span><span class="fu">set</span>(</span>
<span id="cb735-25"><a href="Avtentikacija.html#cb735-25" tabindex="-1"></a>      <span class="st">&quot;Content-Type&quot;</span><span class="op">,</span></span>
<span id="cb735-26"><a href="Avtentikacija.html#cb735-26" tabindex="-1"></a>      <span class="st">&quot;application/x-www-form-urlencoded&quot;</span></span>
<span id="cb735-27"><a href="Avtentikacija.html#cb735-27" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb735-28"><a href="Avtentikacija.html#cb735-28" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">http</span></span>
<span id="cb735-29"><a href="Avtentikacija.html#cb735-29" tabindex="-1"></a>      <span class="op">.</span><span class="at">post</span><span class="op">&lt;</span>AuthResponse<span class="op">&gt;</span>(url<span class="op">,</span> body<span class="op">,</span> { headers })</span>
<span id="cb735-30"><a href="Avtentikacija.html#cb735-30" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(<span class="fu">retry</span>(<span class="dv">1</span>)<span class="op">,</span> <span class="fu">catchError</span>(<span class="kw">this</span><span class="op">.</span><span class="at">handleError</span>))<span class="op">;</span></span>
<span id="cb735-31"><a href="Avtentikacija.html#cb735-31" tabindex="-1"></a>  }</span>
<span id="cb735-32"><a href="Avtentikacija.html#cb735-32" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb735-33"><a href="Avtentikacija.html#cb735-33" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.bash:eq(0)").markRegExp(/ng generate.+/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(0)").markRegExp(/.+?:.+/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(1)").markRegExp(/.+?:.+/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/import { (User|AuthResponse|DemoDataService|Observable|tap) }.+/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/,[\s|\n]+?private demoDataService: DemoDataService/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/\s+?public (login|register)[\s\S]+?\);[^\}]+?}[^\}]+?}/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/\s+?public logout[\s\S]+?}/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/import { (Uporabnik|RezultatAvtentikacije|EdugeocachePodatkiService|Observable|tap) }.+/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/,[\s|\n]+?private edugeocachePodatkiStoritev: EdugeocachePodatkiService/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/\s+?public (prijava|registracija)[\s\S]+?\);[^\}]+?}[^\}]+?}/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(2)").markRegExp(/\s+?public odjava[\s\S]+?}/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(3)").markRegExp(/import { (User|AuthResponse) }.+/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(3)").markRegExp(/\s+?public (login|register)[\s\S]+?}/, options_dodaj);
    $("#omogočanje-registracije-prijave-in-odjave-uporabnikov code.javascript:eq(3)").markRegExp(/\s+?private makeAuthApiCall[\s\S]+?catchError[\s\S]+?}/, options_dodaj);
  });
</script>
</div>
<div id="uporaba-podatkov-iz-jwt-v-angular-storitvi" class="section level3 hasAnchor" number="10.5.3">
<h3><span class="header-section-number">10.5.3</span> Uporaba podatkov iz JWT v Angular storitvi<a href="Avtentikacija.html#uporaba-podatkov-iz-jwt-v-angular-storitvi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>JWT žeton bo shranjen v lokalni shrambi brskalnika in ga bomo uporabljali za obvladovanje uporabniške seje. S pomočjo njegove vsebine bomo preverjali, ali je uporabnik prijavljen, aplikacija pa bo lahko pridobila tudi druge podrobnosti o uporabniku.</p>
<p>Najprej bomo med metode storitve <code>authentication</code> dodali <strong>preverjanje, ali je uporabnik že prijavljen</strong> <code>isLoggedIn</code>. Najprej je treba pridobiti žeton iz lokalne shrambe brskalnika, nato iz njega izluščimo koristno vsebino. Če žeton še ni potekel, potem je uporabnik prijavljen.</p>
<p><code>angular/src/app/shared/services/authentication.service.ts</code></p>
<div class="sourceCode" id="cb736"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb736-1"><a href="Avtentikacija.html#cb736-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> AuthenticationService {</span>
<span id="cb736-2"><a href="Avtentikacija.html#cb736-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb736-3"><a href="Avtentikacija.html#cb736-3" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">isLoggedIn</span>()<span class="op">:</span> boolean {</span>
<span id="cb736-4"><a href="Avtentikacija.html#cb736-4" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">token</span><span class="op">:</span> string <span class="op">|</span> <span class="kw">null</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getToken</span>()<span class="op">;</span></span>
<span id="cb736-5"><a href="Avtentikacija.html#cb736-5" tabindex="-1"></a>    <span class="cf">if</span> (token) {</span>
<span id="cb736-6"><a href="Avtentikacija.html#cb736-6" tabindex="-1"></a>      <span class="kw">const</span> payload <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">window</span><span class="op">.</span><span class="fu">atob</span>(token<span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;.&quot;</span>)[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb736-7"><a href="Avtentikacija.html#cb736-7" tabindex="-1"></a>      <span class="cf">return</span> payload<span class="op">.</span><span class="at">exp</span> <span class="op">&gt;</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span><span class="op">;</span></span>
<span id="cb736-8"><a href="Avtentikacija.html#cb736-8" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb736-9"><a href="Avtentikacija.html#cb736-9" tabindex="-1"></a>  }</span>
<span id="cb736-10"><a href="Avtentikacija.html#cb736-10" tabindex="-1"></a>}</span></code></pre></div>
<p>Naša aplikacija bo prav tako dostopala do <strong>elektronskega naslova</strong> (<code>email</code>) in <strong>polnega imena uporabnika</strong> (<code>name</code>), ki sta tudi shranjena v JWT. Za ta namen bomo implementirali metodo <code>getCurrentUser</code>, ki bo dostopala do žetona v lokalni shrambi brskalnika in iz njega izluščila omenjena podatka ter ju vrnila v rezultatu.</p>
<p><code>angular/src/app/shared/services/authentication.service.ts</code></p>
<div class="sourceCode" id="cb737"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb737-1"><a href="Avtentikacija.html#cb737-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> AuthenticationService {</span>
<span id="cb737-2"><a href="Avtentikacija.html#cb737-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb737-3"><a href="Avtentikacija.html#cb737-3" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getCurrentUser</span>()<span class="op">:</span> User <span class="op">|</span> <span class="kw">null</span> {</span>
<span id="cb737-4"><a href="Avtentikacija.html#cb737-4" tabindex="-1"></a>    <span class="kw">let</span> user<span class="op">!:</span> User<span class="op">;</span></span>
<span id="cb737-5"><a href="Avtentikacija.html#cb737-5" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">isLoggedIn</span>()) {</span>
<span id="cb737-6"><a href="Avtentikacija.html#cb737-6" tabindex="-1"></a>      <span class="kw">let</span> <span class="dt">token</span><span class="op">:</span> string <span class="op">|</span> <span class="kw">null</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getToken</span>()<span class="op">;</span></span>
<span id="cb737-7"><a href="Avtentikacija.html#cb737-7" tabindex="-1"></a>      <span class="cf">if</span> (token) {</span>
<span id="cb737-8"><a href="Avtentikacija.html#cb737-8" tabindex="-1"></a>        <span class="kw">let</span> { email<span class="op">,</span> name } <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">window</span><span class="op">.</span><span class="fu">atob</span>(token<span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;.&quot;</span>)[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb737-9"><a href="Avtentikacija.html#cb737-9" tabindex="-1"></a>        user <span class="op">=</span> { email<span class="op">,</span> name }<span class="op">;</span></span>
<span id="cb737-10"><a href="Avtentikacija.html#cb737-10" tabindex="-1"></a>      }</span>
<span id="cb737-11"><a href="Avtentikacija.html#cb737-11" tabindex="-1"></a>    }</span>
<span id="cb737-12"><a href="Avtentikacija.html#cb737-12" tabindex="-1"></a>    <span class="cf">return</span> user<span class="op">;</span></span>
<span id="cb737-13"><a href="Avtentikacija.html#cb737-13" tabindex="-1"></a>  }</span>
<span id="cb737-14"><a href="Avtentikacija.html#cb737-14" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#uporaba-podatkov-iz-jwt-v-angular-storitvi code.javascript:eq(0)").markRegExp(/\s+?public isLoggedIn[\s\S]+?return false;[\s|\n]+?}/, options_dodaj);
    $("#uporaba-podatkov-iz-jwt-v-angular-storitvi code.javascript:eq(1)").markRegExp(/\s+?public getCurrentUser[\s\S]+?return user;[\s|\n]+?}/, options_dodaj);
  });
</script>
</div>
</div>
<div id="Priprava-strani-za-registracijo-in-prijavo-uporabnika" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Priprava strani za registracijo in prijavo uporabnika<a href="Avtentikacija.html#Priprava-strani-za-registracijo-in-prijavo-uporabnika" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Funkcionalnost, ki smo jo implementirali do tega trenutka, je brez strani za registracijo in prijavo uporabnika neuporabna. Zato želimo v nadaljevanju razviti spletno stran, ki bo novim uporabnikom omogočala registracijo in prijavo v sistem za obstoječe uporabnike.</p>
<p>Po končani registraciji oz. prijavi bomo uporabnika preusmerili nazaj na stran, na kateri je bil pred začetkom registracije oz. prijave.</p>
<div id="priprava-strani-za-registracijo" class="section level3 hasAnchor" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Priprava strani za registracijo<a href="Avtentikacija.html#priprava-strani-za-registracijo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>S pomočjo Angular CLI kreirajmo novo komponento <code>register</code>.</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb738-1"><a href="Avtentikacija.html#cb738-1" tabindex="-1"></a><span class="ex">$</span> ng generate component shared/components/register</span>
<span id="cb738-2"><a href="Avtentikacija.html#cb738-2" tabindex="-1"></a></span>
<span id="cb738-3"><a href="Avtentikacija.html#cb738-3" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/components/register/register.component.ts <span class="er">(</span><span class="ex">198</span> bytes<span class="kw">)</span></span>
<span id="cb738-4"><a href="Avtentikacija.html#cb738-4" tabindex="-1"></a><span class="ex">UPDATE</span> src/app/app.module.ts <span class="er">(</span><span class="ex">2286</span> bytes<span class="kw">)</span></span></code></pre></div>
<p>Najprej posodobimo usmerjevalno tabelo v modulu <code>app-routing</code>, kjer bo komponenta <code>RegisterComponent</code> poskrbela za obvladovanje funkcionalnosti na URL naslovu <code>/register</code>.</p>
<p><code>angular/src/app/modules/app-routing/app-routing.module.ts</code></p>
<div class="sourceCode" id="cb739"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb739-1"><a href="Avtentikacija.html#cb739-1" tabindex="-1"></a><span class="im">import</span> { HomepageComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/homepage/homepage.component&quot;</span><span class="op">;</span></span>
<span id="cb739-2"><a href="Avtentikacija.html#cb739-2" tabindex="-1"></a><span class="im">import</span> { AboutComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/about/about.component&quot;</span><span class="op">;</span></span>
<span id="cb739-3"><a href="Avtentikacija.html#cb739-3" tabindex="-1"></a><span class="im">import</span> { DetailsPageComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/details-page/details-page.component&quot;</span><span class="op">;</span></span>
<span id="cb739-4"><a href="Avtentikacija.html#cb739-4" tabindex="-1"></a><span class="im">import</span> { RegisterComponent } <span class="im">from</span> <span class="st">&quot;src/app/shared/components/register/register.component&quot;</span><span class="op">;</span></span>
<span id="cb739-5"><a href="Avtentikacija.html#cb739-5" tabindex="-1"></a></span>
<span id="cb739-6"><a href="Avtentikacija.html#cb739-6" tabindex="-1"></a><span class="kw">const</span> routes<span class="op">:</span> Routes <span class="op">=</span> [</span>
<span id="cb739-7"><a href="Avtentikacija.html#cb739-7" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> HomepageComponent }<span class="op">,</span></span>
<span id="cb739-8"><a href="Avtentikacija.html#cb739-8" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;about&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> AboutComponent }<span class="op">,</span></span>
<span id="cb739-9"><a href="Avtentikacija.html#cb739-9" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;locations/:locationId&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> DetailsPageComponent }<span class="op">,</span></span>
<span id="cb739-10"><a href="Avtentikacija.html#cb739-10" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;register&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> RegisterComponent }<span class="op">,</span></span>
<span id="cb739-11"><a href="Avtentikacija.html#cb739-11" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div>
<p>Pri HTML predlogi bomo dodali <strong>spletni obrazec</strong> z vnosnimi polji <strong>imena</strong> in <strong>priimka</strong> (<code>name</code>), <strong>elektronskega naslova</strong> (<code>email</code>) ter <strong>gesla</strong> (<code>password</code>). Nad spletnim obrazcem bomo vključili tudi povezavo na prijavo, če gre za obstoječega uporabnika.</p>
<p>V krmilniku moramo poskrbeti za nastavitev osnovnih podatkov, ki jih pričakuje predloga pogleda. Pri tem bomo potrebovali tudi storitev <code>authentication</code>. Prijavne podatke uporabnika bomo hranili v spremenljivki <code>credentials</code> in jih bomo na začetku nastavili na prazne vrednosti.</p>
<p><code>angular/src/app/shared/components/register/register.component.ts</code></p>
<div class="sourceCode" id="cb740"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb740-1"><a href="Avtentikacija.html#cb740-1" tabindex="-1"></a><span class="im">import</span> { Component } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb740-2"><a href="Avtentikacija.html#cb740-2" tabindex="-1"></a><span class="im">import</span> { Router } <span class="im">from</span> <span class="st">&quot;@angular/router&quot;</span><span class="op">;</span></span>
<span id="cb740-3"><a href="Avtentikacija.html#cb740-3" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb740-4"><a href="Avtentikacija.html#cb740-4" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb740-5"><a href="Avtentikacija.html#cb740-5" tabindex="-1"></a></span>
<span id="cb740-6"><a href="Avtentikacija.html#cb740-6" tabindex="-1"></a>@<span class="fu">Component</span>({</span>
<span id="cb740-7"><a href="Avtentikacija.html#cb740-7" tabindex="-1"></a>  <span class="dt">selector</span><span class="op">:</span> <span class="st">&quot;app-register&quot;</span><span class="op">,</span></span>
<span id="cb740-8"><a href="Avtentikacija.html#cb740-8" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="vs">`&lt;p&gt;register works!&lt;/p&gt;</span></span>
<span id="cb740-9"><a href="Avtentikacija.html#cb740-9" tabindex="-1"></a><span class="vs">    &lt;app-header [content]=&quot;header&quot;&gt;&lt;/app-header&gt;</span></span>
<span id="cb740-10"><a href="Avtentikacija.html#cb740-10" tabindex="-1"></a><span class="vs">    &lt;div class=&quot;row&quot;&gt;</span></span>
<span id="cb740-11"><a href="Avtentikacija.html#cb740-11" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;col-12 col-md-8&quot;&gt;</span></span>
<span id="cb740-12"><a href="Avtentikacija.html#cb740-12" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span></span>
<span id="cb740-13"><a href="Avtentikacija.html#cb740-13" tabindex="-1"></a><span class="vs">          Already a member? Please</span></span>
<span id="cb740-14"><a href="Avtentikacija.html#cb740-14" tabindex="-1"></a><span class="vs">          &lt;a routerLink=&quot;/login&quot; class=&quot;link-primary&quot;&gt;login&lt;/a&gt; instead.</span></span>
<span id="cb740-15"><a href="Avtentikacija.html#cb740-15" tabindex="-1"></a><span class="vs">        &lt;/p&gt;</span></span>
<span id="cb740-16"><a href="Avtentikacija.html#cb740-16" tabindex="-1"></a><span class="vs">        &lt;form autocomplete=&quot;off&quot;&gt;</span></span>
<span id="cb740-17"><a href="Avtentikacija.html#cb740-17" tabindex="-1"></a><span class="vs">          &lt;div *ngIf=&quot;formError&quot; class=&quot;form-group&quot;&gt;</span></span>
<span id="cb740-18"><a href="Avtentikacija.html#cb740-18" tabindex="-1"></a><span class="vs">            &lt;div class=&quot;alert alert-dark p-2 mt-4&quot; role=&quot;alert&quot;&gt;</span></span>
<span id="cb740-19"><a href="Avtentikacija.html#cb740-19" tabindex="-1"></a><span class="vs">              &lt;i class=&quot;fas fa-exclamation-triangle pe-2&quot;&gt;&lt;/i&gt;{{ formError }}</span></span>
<span id="cb740-20"><a href="Avtentikacija.html#cb740-20" tabindex="-1"></a><span class="vs">            &lt;/div&gt;</span></span>
<span id="cb740-21"><a href="Avtentikacija.html#cb740-21" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb740-22"><a href="Avtentikacija.html#cb740-22" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group&quot;&gt;</span></span>
<span id="cb740-23"><a href="Avtentikacija.html#cb740-23" tabindex="-1"></a><span class="vs">            &lt;label for=&quot;name&quot; class=&quot;form-label mb-1&quot;&gt;Full name&lt;/label&gt;</span></span>
<span id="cb740-24"><a href="Avtentikacija.html#cb740-24" tabindex="-1"></a><span class="vs">            &lt;input</span></span>
<span id="cb740-25"><a href="Avtentikacija.html#cb740-25" tabindex="-1"></a><span class="vs">              type=&quot;text&quot;</span></span>
<span id="cb740-26"><a href="Avtentikacija.html#cb740-26" tabindex="-1"></a><span class="vs">              class=&quot;form-control form-control-sm&quot;</span></span>
<span id="cb740-27"><a href="Avtentikacija.html#cb740-27" tabindex="-1"></a><span class="vs">              id=&quot;name&quot;</span></span>
<span id="cb740-28"><a href="Avtentikacija.html#cb740-28" tabindex="-1"></a><span class="vs">              name=&quot;name&quot;</span></span>
<span id="cb740-29"><a href="Avtentikacija.html#cb740-29" tabindex="-1"></a><span class="vs">              placeholder=&quot;Enter your name&quot;</span></span>
<span id="cb740-30"><a href="Avtentikacija.html#cb740-30" tabindex="-1"></a><span class="vs">              [(ngModel)]=&quot;credentials.name&quot;</span></span>
<span id="cb740-31"><a href="Avtentikacija.html#cb740-31" tabindex="-1"></a><span class="vs">            /&gt;</span></span>
<span id="cb740-32"><a href="Avtentikacija.html#cb740-32" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb740-33"><a href="Avtentikacija.html#cb740-33" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group&quot;&gt;</span></span>
<span id="cb740-34"><a href="Avtentikacija.html#cb740-34" tabindex="-1"></a><span class="vs">            &lt;label for=&quot;email&quot; class=&quot;form-label mb-1 mt-3&quot;</span></span>
<span id="cb740-35"><a href="Avtentikacija.html#cb740-35" tabindex="-1"></a><span class="vs">              &gt;E-mail address&lt;/label</span></span>
<span id="cb740-36"><a href="Avtentikacija.html#cb740-36" tabindex="-1"></a><span class="vs">            &gt;</span></span>
<span id="cb740-37"><a href="Avtentikacija.html#cb740-37" tabindex="-1"></a><span class="vs">            &lt;input</span></span>
<span id="cb740-38"><a href="Avtentikacija.html#cb740-38" tabindex="-1"></a><span class="vs">              type=&quot;text&quot;</span></span>
<span id="cb740-39"><a href="Avtentikacija.html#cb740-39" tabindex="-1"></a><span class="vs">              class=&quot;form-control form-control-sm&quot;</span></span>
<span id="cb740-40"><a href="Avtentikacija.html#cb740-40" tabindex="-1"></a><span class="vs">              id=&quot;email&quot;</span></span>
<span id="cb740-41"><a href="Avtentikacija.html#cb740-41" tabindex="-1"></a><span class="vs">              name=&quot;email&quot;</span></span>
<span id="cb740-42"><a href="Avtentikacija.html#cb740-42" tabindex="-1"></a><span class="vs">              placeholder=&quot;Enter e-mail address&quot;</span></span>
<span id="cb740-43"><a href="Avtentikacija.html#cb740-43" tabindex="-1"></a><span class="vs">              [(ngModel)]=&quot;credentials.email&quot;</span></span>
<span id="cb740-44"><a href="Avtentikacija.html#cb740-44" tabindex="-1"></a><span class="vs">            /&gt;</span></span>
<span id="cb740-45"><a href="Avtentikacija.html#cb740-45" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb740-46"><a href="Avtentikacija.html#cb740-46" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group&quot;&gt;</span></span>
<span id="cb740-47"><a href="Avtentikacija.html#cb740-47" tabindex="-1"></a><span class="vs">            &lt;label for=&quot;password&quot; class=&quot;form-label mb-1 mt-3&quot;&gt;Password&lt;/label&gt;</span></span>
<span id="cb740-48"><a href="Avtentikacija.html#cb740-48" tabindex="-1"></a><span class="vs">            &lt;input</span></span>
<span id="cb740-49"><a href="Avtentikacija.html#cb740-49" tabindex="-1"></a><span class="vs">              type=&quot;password&quot;</span></span>
<span id="cb740-50"><a href="Avtentikacija.html#cb740-50" tabindex="-1"></a><span class="vs">              class=&quot;form-control form-control-sm&quot;</span></span>
<span id="cb740-51"><a href="Avtentikacija.html#cb740-51" tabindex="-1"></a><span class="vs">              id=&quot;password&quot;</span></span>
<span id="cb740-52"><a href="Avtentikacija.html#cb740-52" tabindex="-1"></a><span class="vs">              name=&quot;password&quot;</span></span>
<span id="cb740-53"><a href="Avtentikacija.html#cb740-53" tabindex="-1"></a><span class="vs">              placeholder=&quot;Enter password&quot;</span></span>
<span id="cb740-54"><a href="Avtentikacija.html#cb740-54" tabindex="-1"></a><span class="vs">              [(ngModel)]=&quot;credentials.password&quot;</span></span>
<span id="cb740-55"><a href="Avtentikacija.html#cb740-55" tabindex="-1"></a><span class="vs">            /&gt;</span></span>
<span id="cb740-56"><a href="Avtentikacija.html#cb740-56" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb740-57"><a href="Avtentikacija.html#cb740-57" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group mt-3&quot;&gt;</span></span>
<span id="cb740-58"><a href="Avtentikacija.html#cb740-58" tabindex="-1"></a><span class="vs">            &lt;button type=&quot;submit&quot; class=&quot;btn btn-sm btn-primary me-2&quot;&gt;</span></span>
<span id="cb740-59"><a href="Avtentikacija.html#cb740-59" tabindex="-1"></a><span class="vs">              &lt;i class=&quot;fa-regular fa-circle-check pe-2&quot;&gt;&lt;/i&gt;Register</span></span>
<span id="cb740-60"><a href="Avtentikacija.html#cb740-60" tabindex="-1"></a><span class="vs">            &lt;/button&gt;</span></span>
<span id="cb740-61"><a href="Avtentikacija.html#cb740-61" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb740-62"><a href="Avtentikacija.html#cb740-62" tabindex="-1"></a><span class="vs">        &lt;/form&gt;</span></span>
<span id="cb740-63"><a href="Avtentikacija.html#cb740-63" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb740-64"><a href="Avtentikacija.html#cb740-64" tabindex="-1"></a><span class="vs">      &lt;app-sidebar</span></span>
<span id="cb740-65"><a href="Avtentikacija.html#cb740-65" tabindex="-1"></a><span class="vs">        class=&quot;col-12 col-lg-3 mt-4&quot;</span></span>
<span id="cb740-66"><a href="Avtentikacija.html#cb740-66" tabindex="-1"></a><span class="vs">        [content]=&quot;header.sidebar&quot;</span></span>
<span id="cb740-67"><a href="Avtentikacija.html#cb740-67" tabindex="-1"></a><span class="vs">      &gt;&lt;/app-sidebar&gt;</span></span>
<span id="cb740-68"><a href="Avtentikacija.html#cb740-68" tabindex="-1"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb740-69"><a href="Avtentikacija.html#cb740-69" tabindex="-1"></a>  <span class="dt">styles</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb740-70"><a href="Avtentikacija.html#cb740-70" tabindex="-1"></a>})</span>
<span id="cb740-71"><a href="Avtentikacija.html#cb740-71" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> RegisterComponent {</span>
<span id="cb740-72"><a href="Avtentikacija.html#cb740-72" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb740-73"><a href="Avtentikacija.html#cb740-73" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">router</span><span class="op">:</span> Router<span class="op">,</span></span>
<span id="cb740-74"><a href="Avtentikacija.html#cb740-74" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService</span>
<span id="cb740-75"><a href="Avtentikacija.html#cb740-75" tabindex="-1"></a>  ) {}</span>
<span id="cb740-76"><a href="Avtentikacija.html#cb740-76" tabindex="-1"></a>  <span class="kw">protected</span> formError<span class="op">!:</span> string<span class="op">;</span></span>
<span id="cb740-77"><a href="Avtentikacija.html#cb740-77" tabindex="-1"></a>  <span class="kw">protected</span> <span class="dt">credentials</span><span class="op">:</span> User <span class="op">=</span> {</span>
<span id="cb740-78"><a href="Avtentikacija.html#cb740-78" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb740-79"><a href="Avtentikacija.html#cb740-79" tabindex="-1"></a>    <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb740-80"><a href="Avtentikacija.html#cb740-80" tabindex="-1"></a>    <span class="dt">password</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb740-81"><a href="Avtentikacija.html#cb740-81" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb740-82"><a href="Avtentikacija.html#cb740-82" tabindex="-1"></a>  <span class="kw">public</span> header <span class="op">=</span> {</span>
<span id="cb740-83"><a href="Avtentikacija.html#cb740-83" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Create a new account&quot;</span><span class="op">,</span></span>
<span id="cb740-84"><a href="Avtentikacija.html#cb740-84" tabindex="-1"></a>    <span class="dt">subtitle</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb740-85"><a href="Avtentikacija.html#cb740-85" tabindex="-1"></a>    <span class="dt">sidebar</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb740-86"><a href="Avtentikacija.html#cb740-86" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb740-87"><a href="Avtentikacija.html#cb740-87" tabindex="-1"></a>}</span></code></pre></div>
<p>Za <strong>posredovanje podatkov spletnega obrazca</strong> novega uporabnika do strežnika preko REST API dostopne točke bo poskrbela metoda <code>onRegisterSubmit</code>.</p>
<p>Če uporabnik ne vnese vseh zahtevanih podatkov, neustrezen elektronski naslov ali geslo, potem na strani prikažemo napako, sicer za nadaljnje obvladovanje posredovanja podatkov pokličemo metodo <code>doRegister</code>.</p>
<p>V okviru metode <code>doRegister</code> pokličemo metodo <code>register</code> storitve <code>authentication</code>. V primeru uspešnega klica uporabnika preusmerimo na začetno stran.</p>
<p><code>angular/src/app/shared/components/register/register.component.ts</code></p>
<div class="sourceCode" id="cb741"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb741-1"><a href="Avtentikacija.html#cb741-1" tabindex="-1"></a><span class="im">import</span> { Component } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb741-2"><a href="Avtentikacija.html#cb741-2" tabindex="-1"></a><span class="im">import</span> { Router } <span class="im">from</span> <span class="st">&quot;@angular/router&quot;</span><span class="op">;</span></span>
<span id="cb741-3"><a href="Avtentikacija.html#cb741-3" tabindex="-1"></a><span class="im">import</span> { HttpErrorResponse } <span class="im">from</span> <span class="st">&quot;@angular/common/http&quot;</span><span class="op">;</span></span>
<span id="cb741-4"><a href="Avtentikacija.html#cb741-4" tabindex="-1"></a><span class="im">import</span> { throwError } <span class="im">from</span> <span class="st">&quot;rxjs&quot;</span><span class="op">;</span></span>
<span id="cb741-5"><a href="Avtentikacija.html#cb741-5" tabindex="-1"></a><span class="im">import</span> { catchError } <span class="im">from</span> <span class="st">&quot;rxjs/operators&quot;</span><span class="op">;</span></span>
<span id="cb741-6"><a href="Avtentikacija.html#cb741-6" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb741-7"><a href="Avtentikacija.html#cb741-7" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb741-8"><a href="Avtentikacija.html#cb741-8" tabindex="-1"></a></span>
<span id="cb741-9"><a href="Avtentikacija.html#cb741-9" tabindex="-1"></a>@<span class="fu">Component</span>({</span>
<span id="cb741-10"><a href="Avtentikacija.html#cb741-10" tabindex="-1"></a>  <span class="dt">selector</span><span class="op">:</span> <span class="st">&quot;app-register&quot;</span><span class="op">,</span></span>
<span id="cb741-11"><a href="Avtentikacija.html#cb741-11" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="vs">`...</span></span>
<span id="cb741-12"><a href="Avtentikacija.html#cb741-12" tabindex="-1"></a><span class="vs">    &lt;div class=&quot;row&quot;&gt;</span></span>
<span id="cb741-13"><a href="Avtentikacija.html#cb741-13" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;col-12 col-md-8&quot;&gt;</span></span>
<span id="cb741-14"><a href="Avtentikacija.html#cb741-14" tabindex="-1"></a><span class="vs">        ...</span></span>
<span id="cb741-15"><a href="Avtentikacija.html#cb741-15" tabindex="-1"></a><span class="vs">        &lt;form (ngSubmit)=&quot;onRegisterSubmit()&quot; autocomplete=&quot;off&quot;&gt;</span></span>
<span id="cb741-16"><a href="Avtentikacija.html#cb741-16" tabindex="-1"></a><span class="vs">          ...</span></span>
<span id="cb741-17"><a href="Avtentikacija.html#cb741-17" tabindex="-1"></a><span class="vs">        &lt;/form&gt;</span></span>
<span id="cb741-18"><a href="Avtentikacija.html#cb741-18" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb741-19"><a href="Avtentikacija.html#cb741-19" tabindex="-1"></a><span class="vs">      ...</span></span>
<span id="cb741-20"><a href="Avtentikacija.html#cb741-20" tabindex="-1"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb741-21"><a href="Avtentikacija.html#cb741-21" tabindex="-1"></a>  <span class="dt">styles</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb741-22"><a href="Avtentikacija.html#cb741-22" tabindex="-1"></a>})</span>
<span id="cb741-23"><a href="Avtentikacija.html#cb741-23" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> RegisterComponent {</span>
<span id="cb741-24"><a href="Avtentikacija.html#cb741-24" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb741-25"><a href="Avtentikacija.html#cb741-25" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">onRegisterSubmit</span>() {</span>
<span id="cb741-26"><a href="Avtentikacija.html#cb741-26" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb741-27"><a href="Avtentikacija.html#cb741-27" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb741-28"><a href="Avtentikacija.html#cb741-28" tabindex="-1"></a>      <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">name</span> <span class="op">||</span></span>
<span id="cb741-29"><a href="Avtentikacija.html#cb741-29" tabindex="-1"></a>      <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">email</span> <span class="op">||</span></span>
<span id="cb741-30"><a href="Avtentikacija.html#cb741-30" tabindex="-1"></a>      <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">password</span></span>
<span id="cb741-31"><a href="Avtentikacija.html#cb741-31" tabindex="-1"></a>    )</span>
<span id="cb741-32"><a href="Avtentikacija.html#cb741-32" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;All fields are required, please try again.&quot;</span><span class="op">;</span></span>
<span id="cb741-33"><a href="Avtentikacija.html#cb741-33" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb741-34"><a href="Avtentikacija.html#cb741-34" tabindex="-1"></a>      <span class="op">!</span><span class="ss">/</span><span class="sc">^\w+([\.-]?\w+)*</span><span class="ss">@</span><span class="sc">\w+([\.-]?\w+)*(\.\w{2,3})+$</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(</span>
<span id="cb741-35"><a href="Avtentikacija.html#cb741-35" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">email</span></span>
<span id="cb741-36"><a href="Avtentikacija.html#cb741-36" tabindex="-1"></a>      )</span>
<span id="cb741-37"><a href="Avtentikacija.html#cb741-37" tabindex="-1"></a>    )</span>
<span id="cb741-38"><a href="Avtentikacija.html#cb741-38" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;Please enter a valid e-mail address.&quot;</span><span class="op">;</span></span>
<span id="cb741-39"><a href="Avtentikacija.html#cb741-39" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">password</span><span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">3</span>)</span>
<span id="cb741-40"><a href="Avtentikacija.html#cb741-40" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;Password must be at least 3 characters long.&quot;</span><span class="op">;</span></span>
<span id="cb741-41"><a href="Avtentikacija.html#cb741-41" tabindex="-1"></a>    <span class="cf">else</span> <span class="kw">this</span><span class="op">.</span><span class="fu">doRegister</span>()<span class="op">;</span></span>
<span id="cb741-42"><a href="Avtentikacija.html#cb741-42" tabindex="-1"></a>  }</span>
<span id="cb741-43"><a href="Avtentikacija.html#cb741-43" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">doRegister</span>() {</span>
<span id="cb741-44"><a href="Avtentikacija.html#cb741-44" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span></span>
<span id="cb741-45"><a href="Avtentikacija.html#cb741-45" tabindex="-1"></a>      <span class="op">.</span><span class="fu">register</span>(<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span>)</span>
<span id="cb741-46"><a href="Avtentikacija.html#cb741-46" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb741-47"><a href="Avtentikacija.html#cb741-47" tabindex="-1"></a>        <span class="fu">catchError</span>((<span class="dt">error</span><span class="op">:</span> HttpErrorResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb741-48"><a href="Avtentikacija.html#cb741-48" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> error<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb741-49"><a href="Avtentikacija.html#cb741-49" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">throwError</span>(() <span class="kw">=&gt;</span> error)<span class="op">;</span></span>
<span id="cb741-50"><a href="Avtentikacija.html#cb741-50" tabindex="-1"></a>        })</span>
<span id="cb741-51"><a href="Avtentikacija.html#cb741-51" tabindex="-1"></a>      )</span>
<span id="cb741-52"><a href="Avtentikacija.html#cb741-52" tabindex="-1"></a>      <span class="op">.</span><span class="fu">subscribe</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb741-53"><a href="Avtentikacija.html#cb741-53" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigateByUrl</span>(<span class="st">&quot;/&quot;</span>)<span class="op">;</span></span>
<span id="cb741-54"><a href="Avtentikacija.html#cb741-54" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb741-55"><a href="Avtentikacija.html#cb741-55" tabindex="-1"></a>  }</span>
<span id="cb741-56"><a href="Avtentikacija.html#cb741-56" tabindex="-1"></a>}</span></code></pre></div>
<p>Delovanje obstoječe funkcionalnosti registracije novega uporabnika preverimo tako, da obiščemo spletno stran <code>/register</code> in izpolnimo potrebne podatke (glej sliko <a href="Avtentikacija.html#fig:slika-obrazec-registracija">10.9</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-obrazec-registracija"></span>
<img src="assets/img/Obrazec_registracija.png" alt="Obrazec za registracijo uporabnika" width="500" />
<p class="caption">
Slika 10.9: Obrazec za registracijo uporabnika
</p>
</div>
<p>Ker smo uporabnika z elektronskim naslovom <code>dejan@lavbic.net</code> predhodno že kreirali in le-ta obstaja, nam strežnik vrne napako <code>There was a 500 error 'E11000 duplicate key error collection: Demo.Users index: email_1 dup key: { email: "dejan@lavbic.net" }'</code>. Obvestilo o napaki za uporabnika vsebuje preveč tehničnih podrobnosti, zato bomo na strani strežnika poskrbeli za manj podroben odgovor, prav tako bomo tudi nastavil ustrezno kodo odgovora, in sicer <code>409</code>.</p>
<p><code>api/controllers/authentication.js</code></p>
<div class="sourceCode" id="cb742"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb742-1"><a href="Avtentikacija.html#cb742-1" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb742-2"><a href="Avtentikacija.html#cb742-2" tabindex="-1"></a><span class="co"> * </span><span class="an">@openapi</span></span>
<span id="cb742-3"><a href="Avtentikacija.html#cb742-3" tabindex="-1"></a><span class="co"> * /register:</span></span>
<span id="cb742-4"><a href="Avtentikacija.html#cb742-4" tabindex="-1"></a><span class="co"> *  post:</span></span>
<span id="cb742-5"><a href="Avtentikacija.html#cb742-5" tabindex="-1"></a><span class="co"> *   ...</span></span>
<span id="cb742-6"><a href="Avtentikacija.html#cb742-6" tabindex="-1"></a><span class="co"> *   responses:</span></span>
<span id="cb742-7"><a href="Avtentikacija.html#cb742-7" tabindex="-1"></a><span class="co"> *    ...</span></span>
<span id="cb742-8"><a href="Avtentikacija.html#cb742-8" tabindex="-1"></a><span class="co"> *    &#39;409&#39;:</span></span>
<span id="cb742-9"><a href="Avtentikacija.html#cb742-9" tabindex="-1"></a><span class="co"> *     description: </span><span class="kw">&lt;b&gt;</span><span class="co">Conflict</span><span class="kw">&lt;/b&gt;</span><span class="co">, with error message.</span></span>
<span id="cb742-10"><a href="Avtentikacija.html#cb742-10" tabindex="-1"></a><span class="co"> *     content:</span></span>
<span id="cb742-11"><a href="Avtentikacija.html#cb742-11" tabindex="-1"></a><span class="co"> *      application/json:</span></span>
<span id="cb742-12"><a href="Avtentikacija.html#cb742-12" tabindex="-1"></a><span class="co"> *       schema:</span></span>
<span id="cb742-13"><a href="Avtentikacija.html#cb742-13" tabindex="-1"></a><span class="co"> *        $ref: &#39;#/components/schemas/ErrorMessage&#39;</span></span>
<span id="cb742-14"><a href="Avtentikacija.html#cb742-14" tabindex="-1"></a><span class="co"> *       example:</span></span>
<span id="cb742-15"><a href="Avtentikacija.html#cb742-15" tabindex="-1"></a><span class="co"> *        message: User with given e-mail address already registered.</span></span>
<span id="cb742-16"><a href="Avtentikacija.html#cb742-16" tabindex="-1"></a><span class="co"> *    ...</span></span>
<span id="cb742-17"><a href="Avtentikacija.html#cb742-17" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb742-18"><a href="Avtentikacija.html#cb742-18" tabindex="-1"></a><span class="kw">const</span> register <span class="op">=</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb742-19"><a href="Avtentikacija.html#cb742-19" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">email</span> <span class="op">||</span> <span class="op">!</span>req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">password</span>)</span>
<span id="cb742-20"><a href="Avtentikacija.html#cb742-20" tabindex="-1"></a>    <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">400</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;All fields required.&quot;</span> })<span class="op">;</span></span>
<span id="cb742-21"><a href="Avtentikacija.html#cb742-21" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="kw">new</span> <span class="fu">User</span>()<span class="op">;</span></span>
<span id="cb742-22"><a href="Avtentikacija.html#cb742-22" tabindex="-1"></a>  user<span class="op">.</span><span class="at">name</span> <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb742-23"><a href="Avtentikacija.html#cb742-23" tabindex="-1"></a>  user<span class="op">.</span><span class="at">email</span> <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">email</span><span class="op">;</span></span>
<span id="cb742-24"><a href="Avtentikacija.html#cb742-24" tabindex="-1"></a>  user<span class="op">.</span><span class="fu">setPassword</span>(req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">password</span>)<span class="op">;</span></span>
<span id="cb742-25"><a href="Avtentikacija.html#cb742-25" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb742-26"><a href="Avtentikacija.html#cb742-26" tabindex="-1"></a>    <span class="cf">await</span> user<span class="op">.</span><span class="fu">save</span>()<span class="op">;</span></span>
<span id="cb742-27"><a href="Avtentikacija.html#cb742-27" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">token</span><span class="op">:</span> user<span class="op">.</span><span class="fu">generateJwt</span>() })<span class="op">;</span></span>
<span id="cb742-28"><a href="Avtentikacija.html#cb742-28" tabindex="-1"></a>  } <span class="cf">catch</span> (err) {</span>
<span id="cb742-29"><a href="Avtentikacija.html#cb742-29" tabindex="-1"></a>    <span class="cf">if</span> (err<span class="op">.</span><span class="at">code</span> <span class="op">===</span> <span class="dv">11000</span>)</span>
<span id="cb742-30"><a href="Avtentikacija.html#cb742-30" tabindex="-1"></a>      res<span class="op">.</span><span class="fu">status</span>(<span class="dv">409</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb742-31"><a href="Avtentikacija.html#cb742-31" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">&quot;User with given e-mail address already registered.&quot;</span><span class="op">,</span></span>
<span id="cb742-32"><a href="Avtentikacija.html#cb742-32" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb742-33"><a href="Avtentikacija.html#cb742-33" tabindex="-1"></a>    <span class="cf">else</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">500</span>)<span class="op">.</span><span class="fu">json</span>({ <span class="dt">message</span><span class="op">:</span> err<span class="op">.</span><span class="at">message</span> })<span class="op">;</span></span>
<span id="cb742-34"><a href="Avtentikacija.html#cb742-34" tabindex="-1"></a>  }</span>
<span id="cb742-35"><a href="Avtentikacija.html#cb742-35" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p>Spletna aplikacija bo nato poskrbela za kreiranje JWT žetona in shranjevanje le-tega v lokalno shrambo brskalnika, kot to prikazuje slika <a href="Avtentikacija.html#fig:slika-Edugeocache-zeton-localStorage">10.10</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Edugeocache-zeton-localStorage"></span>
<img src="assets/img/Zeton_localStorage.png" alt="JWT žeton, shranjen v `localStorage` brskalnika, po registraciji uporabnika" width="500" />
<p class="caption">
Slika 10.10: JWT žeton, shranjen v <code>localStorage</code> brskalnika, po registraciji uporabnika
</p>
</div>
<blockquote>
<p><strong>Namig</strong>: Do <i class="fa-solid fa-database"></i><strong>lokalne shrambe</strong> brskalnika <i class="fa-brands fa-chrome"></i><strong>Chrome</strong> lahko dostopate preko <strong>JavaScript razvijalske <i class="fa-solid fa-terminal"></i>konzole</strong> s pomočjo naslednjega zaporedja ukazov: <code>View</code> → <code>Developer</code> → <code>JavaScript Console</code> → <code>Application</code> → <code>Storage</code> → <code>Local Storage</code>.</p>
</blockquote>
<script>
  $(document).ready(function() {
    $("#priprava-strani-za-registracijo code.bash:eq(0)").markRegExp(/ng generate.+/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(0)").markRegExp(/import { RegisterComponent }.+/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(0)").markRegExp(/\s+?{ path: "register".+/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(1)").markRegExp(/import { (Router|AuthenticationService|User) }.+/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(1)").markRegExp(/<p>.+?<\/p>/, options_izbrisi);
    $("#priprava-strani-za-registracijo code.javascript:eq(1)").markRegExp(/\s+?<app-header[\s\S]+?<\/app-sidebar>[\s\S]+?<\/div>/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(1)").markRegExp(/\s+?protected (formError|credentials)[\s\S]+?(;|})/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(1)").markRegExp(/\s+?public header [\s\S]+?};/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(1)").markRegExp(/\s+?constructor[\s\S]+?{}/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(2)").markRegExp(/import { (HttpErrorResponse|catchError|throwError) }.+/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(2)").markRegExp(/\(ngSubmit\)=".+?" /, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(2)").markRegExp(/\s+?public onRegisterSubmit[\s\S]+?doRegister[\s\S]+?navigateByUrl[\s\S]+?}\);[^}]+?}/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(2)").markRegExp(/\s+?private izvediRegistracijo[\s\S]+?}/, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(3)").markRegExp(/[\s\*]+?'409'[\s\S]+?registered\./, options_dodaj);
    $("#priprava-strani-za-registracijo code.javascript:eq(3)").markRegExp(/\s+?if \(err\.code === 11000\)[\s\S]+?else /, options_dodaj);
  });
</script>
</div>
<div id="priprava-strani-za-prijavo" class="section level3 hasAnchor" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> Priprava strani za prijavo<a href="Avtentikacija.html#priprava-strani-za-prijavo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podobno kot pri registraciji je tudi pri prijavi najprej treba s pomočjo Angular CLI kreirati novo komponento v <code>login</code>.</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb743-1"><a href="Avtentikacija.html#cb743-1" tabindex="-1"></a><span class="ex">$</span> ng generate component shared/components/login</span>
<span id="cb743-2"><a href="Avtentikacija.html#cb743-2" tabindex="-1"></a></span>
<span id="cb743-3"><a href="Avtentikacija.html#cb743-3" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/components/login/login.component.ts <span class="er">(</span><span class="ex">189</span> bytes<span class="kw">)</span></span>
<span id="cb743-4"><a href="Avtentikacija.html#cb743-4" tabindex="-1"></a><span class="ex">UPDATE</span> src/app/app.module.ts <span class="er">(</span><span class="ex">2382</span> bytes<span class="kw">)</span></span></code></pre></div>
<p>Sedaj posodobimo usmerjevalno tabelo v modulu <code>app-routing</code>, kjer bo komponenta <code>LoginComponent</code> poskrbela za obvladovanje funkcionalnosti na URL naslovu <code>/login</code>.</p>
<p><code>angular/src/app/modules/app-routing/app-routing.module.ts</code></p>
<div class="sourceCode" id="cb744"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb744-1"><a href="Avtentikacija.html#cb744-1" tabindex="-1"></a><span class="im">import</span> { HomepageComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/homepage/homepage.component&quot;</span><span class="op">;</span></span>
<span id="cb744-2"><a href="Avtentikacija.html#cb744-2" tabindex="-1"></a><span class="im">import</span> { AboutComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/about/about.component&quot;</span><span class="op">;</span></span>
<span id="cb744-3"><a href="Avtentikacija.html#cb744-3" tabindex="-1"></a><span class="im">import</span> { DetailsPageComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/details-page/details-page.component&quot;</span><span class="op">;</span></span>
<span id="cb744-4"><a href="Avtentikacija.html#cb744-4" tabindex="-1"></a><span class="im">import</span> { RegisterComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/register/register.component&quot;</span><span class="op">;</span></span>
<span id="cb744-5"><a href="Avtentikacija.html#cb744-5" tabindex="-1"></a><span class="im">import</span> { LoginComponent } <span class="im">from</span> <span class="st">&quot;../../shared/components/login/login.component&quot;</span><span class="op">;</span></span>
<span id="cb744-6"><a href="Avtentikacija.html#cb744-6" tabindex="-1"></a></span>
<span id="cb744-7"><a href="Avtentikacija.html#cb744-7" tabindex="-1"></a><span class="kw">const</span> routes<span class="op">:</span> Routes <span class="op">=</span> [</span>
<span id="cb744-8"><a href="Avtentikacija.html#cb744-8" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> HomepageComponent }<span class="op">,</span></span>
<span id="cb744-9"><a href="Avtentikacija.html#cb744-9" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;about&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> AboutComponent }<span class="op">,</span></span>
<span id="cb744-10"><a href="Avtentikacija.html#cb744-10" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;locations/:locationId&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> DetailsPageComponent }<span class="op">,</span></span>
<span id="cb744-11"><a href="Avtentikacija.html#cb744-11" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;register&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> RegisterComponent }<span class="op">,</span></span>
<span id="cb744-12"><a href="Avtentikacija.html#cb744-12" tabindex="-1"></a>  { <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;login&quot;</span><span class="op">,</span> <span class="dt">component</span><span class="op">:</span> LoginComponent }<span class="op">,</span></span>
<span id="cb744-13"><a href="Avtentikacija.html#cb744-13" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div>
<p>Predloga pogleda prijave uporabnika je skoraj enaka predlogi pogleda registracije s to razliko, da ne potrebujemo vnosnega polja za polno ime uporabnika ter povezave na registracijo uporabnika, če le-ta še nima uporabniškega imena.</p>
<p>Tudi izvorna koda krmilnika za obvladovanje prijave uporabnika je zelo podobna izvorni kodi krmilnika za obvladovanje registracije. Pri pošiljanju podatkov v okviru metode <code>onLoginSubmit</code> ne preverjamo več polnega imena uporabnika, ostala funkcionalnost pa se izvede podobno.</p>
<p><code>angular/src/app/shared/components/login/login.component.ts</code></p>
<div class="sourceCode" id="cb745"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb745-1"><a href="Avtentikacija.html#cb745-1" tabindex="-1"></a><span class="im">import</span> { Component } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb745-2"><a href="Avtentikacija.html#cb745-2" tabindex="-1"></a><span class="im">import</span> { Router } <span class="im">from</span> <span class="st">&quot;@angular/router&quot;</span><span class="op">;</span></span>
<span id="cb745-3"><a href="Avtentikacija.html#cb745-3" tabindex="-1"></a><span class="im">import</span> { HttpErrorResponse } <span class="im">from</span> <span class="st">&quot;@angular/common/http&quot;</span><span class="op">;</span></span>
<span id="cb745-4"><a href="Avtentikacija.html#cb745-4" tabindex="-1"></a><span class="im">import</span> { throwError } <span class="im">from</span> <span class="st">&quot;rxjs&quot;</span><span class="op">;</span></span>
<span id="cb745-5"><a href="Avtentikacija.html#cb745-5" tabindex="-1"></a><span class="im">import</span> { catchError } <span class="im">from</span> <span class="st">&quot;rxjs/operators&quot;</span><span class="op">;</span></span>
<span id="cb745-6"><a href="Avtentikacija.html#cb745-6" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb745-7"><a href="Avtentikacija.html#cb745-7" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb745-8"><a href="Avtentikacija.html#cb745-8" tabindex="-1"></a></span>
<span id="cb745-9"><a href="Avtentikacija.html#cb745-9" tabindex="-1"></a>@<span class="fu">Component</span>({</span>
<span id="cb745-10"><a href="Avtentikacija.html#cb745-10" tabindex="-1"></a>  <span class="dt">selector</span><span class="op">:</span> <span class="st">&quot;app-login&quot;</span><span class="op">,</span></span>
<span id="cb745-11"><a href="Avtentikacija.html#cb745-11" tabindex="-1"></a>  <span class="dt">template</span><span class="op">:</span> <span class="vs">`&lt;p&gt;login works!&lt;/p&gt;</span></span>
<span id="cb745-12"><a href="Avtentikacija.html#cb745-12" tabindex="-1"></a><span class="vs">    &lt;app-header [content]=&quot;header&quot;&gt;&lt;/app-header&gt;</span></span>
<span id="cb745-13"><a href="Avtentikacija.html#cb745-13" tabindex="-1"></a><span class="vs">    &lt;div class=&quot;row&quot;&gt;</span></span>
<span id="cb745-14"><a href="Avtentikacija.html#cb745-14" tabindex="-1"></a><span class="vs">      &lt;div class=&quot;col-12 col-md-8&quot;&gt;</span></span>
<span id="cb745-15"><a href="Avtentikacija.html#cb745-15" tabindex="-1"></a><span class="vs">        &lt;p&gt;</span></span>
<span id="cb745-16"><a href="Avtentikacija.html#cb745-16" tabindex="-1"></a><span class="vs">          Not a member? Please</span></span>
<span id="cb745-17"><a href="Avtentikacija.html#cb745-17" tabindex="-1"></a><span class="vs">          &lt;a routerLink=&quot;/register&quot; class=&quot;link-primary&quot;&gt;register&lt;/a&gt; first.</span></span>
<span id="cb745-18"><a href="Avtentikacija.html#cb745-18" tabindex="-1"></a><span class="vs">        &lt;/p&gt;</span></span>
<span id="cb745-19"><a href="Avtentikacija.html#cb745-19" tabindex="-1"></a><span class="vs">        &lt;form (ngSubmit)=&quot;onLoginSubmit()&quot; autocomplete=&quot;off&quot;&gt;</span></span>
<span id="cb745-20"><a href="Avtentikacija.html#cb745-20" tabindex="-1"></a><span class="vs">          &lt;div *ngIf=&quot;formError&quot; class=&quot;form-group&quot;&gt;</span></span>
<span id="cb745-21"><a href="Avtentikacija.html#cb745-21" tabindex="-1"></a><span class="vs">            &lt;div class=&quot;alert alert-dark p-2 mt-4&quot; role=&quot;alert&quot;&gt;</span></span>
<span id="cb745-22"><a href="Avtentikacija.html#cb745-22" tabindex="-1"></a><span class="vs">              &lt;i class=&quot;fas fa-exclamation-triangle pe-2&quot;&gt;&lt;/i&gt;{{ formError }}</span></span>
<span id="cb745-23"><a href="Avtentikacija.html#cb745-23" tabindex="-1"></a><span class="vs">            &lt;/div&gt;</span></span>
<span id="cb745-24"><a href="Avtentikacija.html#cb745-24" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb745-25"><a href="Avtentikacija.html#cb745-25" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group&quot;&gt;</span></span>
<span id="cb745-26"><a href="Avtentikacija.html#cb745-26" tabindex="-1"></a><span class="vs">            &lt;label for=&quot;email&quot; class=&quot;form-label mb-1 mt-3&quot;</span></span>
<span id="cb745-27"><a href="Avtentikacija.html#cb745-27" tabindex="-1"></a><span class="vs">              &gt;E-mail address&lt;/label</span></span>
<span id="cb745-28"><a href="Avtentikacija.html#cb745-28" tabindex="-1"></a><span class="vs">            &gt;</span></span>
<span id="cb745-29"><a href="Avtentikacija.html#cb745-29" tabindex="-1"></a><span class="vs">            &lt;input</span></span>
<span id="cb745-30"><a href="Avtentikacija.html#cb745-30" tabindex="-1"></a><span class="vs">              type=&quot;text&quot;</span></span>
<span id="cb745-31"><a href="Avtentikacija.html#cb745-31" tabindex="-1"></a><span class="vs">              class=&quot;form-control form-control-sm&quot;</span></span>
<span id="cb745-32"><a href="Avtentikacija.html#cb745-32" tabindex="-1"></a><span class="vs">              id=&quot;email&quot;</span></span>
<span id="cb745-33"><a href="Avtentikacija.html#cb745-33" tabindex="-1"></a><span class="vs">              name=&quot;email&quot;</span></span>
<span id="cb745-34"><a href="Avtentikacija.html#cb745-34" tabindex="-1"></a><span class="vs">              placeholder=&quot;Enter e-mail address&quot;</span></span>
<span id="cb745-35"><a href="Avtentikacija.html#cb745-35" tabindex="-1"></a><span class="vs">              [(ngModel)]=&quot;credentials.email&quot;</span></span>
<span id="cb745-36"><a href="Avtentikacija.html#cb745-36" tabindex="-1"></a><span class="vs">            /&gt;</span></span>
<span id="cb745-37"><a href="Avtentikacija.html#cb745-37" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb745-38"><a href="Avtentikacija.html#cb745-38" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group&quot;&gt;</span></span>
<span id="cb745-39"><a href="Avtentikacija.html#cb745-39" tabindex="-1"></a><span class="vs">            &lt;label for=&quot;password&quot; class=&quot;form-label mb-1 mt-3&quot;&gt;Password&lt;/label&gt;</span></span>
<span id="cb745-40"><a href="Avtentikacija.html#cb745-40" tabindex="-1"></a><span class="vs">            &lt;input</span></span>
<span id="cb745-41"><a href="Avtentikacija.html#cb745-41" tabindex="-1"></a><span class="vs">              type=&quot;password&quot;</span></span>
<span id="cb745-42"><a href="Avtentikacija.html#cb745-42" tabindex="-1"></a><span class="vs">              class=&quot;form-control form-control-sm&quot;</span></span>
<span id="cb745-43"><a href="Avtentikacija.html#cb745-43" tabindex="-1"></a><span class="vs">              id=&quot;password&quot;</span></span>
<span id="cb745-44"><a href="Avtentikacija.html#cb745-44" tabindex="-1"></a><span class="vs">              name=&quot;password&quot;</span></span>
<span id="cb745-45"><a href="Avtentikacija.html#cb745-45" tabindex="-1"></a><span class="vs">              placeholder=&quot;Enter password&quot;</span></span>
<span id="cb745-46"><a href="Avtentikacija.html#cb745-46" tabindex="-1"></a><span class="vs">              [(ngModel)]=&quot;credentials.password&quot;</span></span>
<span id="cb745-47"><a href="Avtentikacija.html#cb745-47" tabindex="-1"></a><span class="vs">            /&gt;</span></span>
<span id="cb745-48"><a href="Avtentikacija.html#cb745-48" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb745-49"><a href="Avtentikacija.html#cb745-49" tabindex="-1"></a><span class="vs">          &lt;div class=&quot;form-group mt-3&quot;&gt;</span></span>
<span id="cb745-50"><a href="Avtentikacija.html#cb745-50" tabindex="-1"></a><span class="vs">            &lt;button type=&quot;submit&quot; class=&quot;btn btn-sm btn-primary me-2&quot;&gt;</span></span>
<span id="cb745-51"><a href="Avtentikacija.html#cb745-51" tabindex="-1"></a><span class="vs">              &lt;i class=&quot;fa-regular fa-circle-check pe-2&quot;&gt;&lt;/i&gt;Login</span></span>
<span id="cb745-52"><a href="Avtentikacija.html#cb745-52" tabindex="-1"></a><span class="vs">            &lt;/button&gt;</span></span>
<span id="cb745-53"><a href="Avtentikacija.html#cb745-53" tabindex="-1"></a><span class="vs">          &lt;/div&gt;</span></span>
<span id="cb745-54"><a href="Avtentikacija.html#cb745-54" tabindex="-1"></a><span class="vs">        &lt;/form&gt;</span></span>
<span id="cb745-55"><a href="Avtentikacija.html#cb745-55" tabindex="-1"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb745-56"><a href="Avtentikacija.html#cb745-56" tabindex="-1"></a><span class="vs">      &lt;app-sidebar</span></span>
<span id="cb745-57"><a href="Avtentikacija.html#cb745-57" tabindex="-1"></a><span class="vs">        class=&quot;col-12 col-lg-3 mt-4&quot;</span></span>
<span id="cb745-58"><a href="Avtentikacija.html#cb745-58" tabindex="-1"></a><span class="vs">        [content]=&quot;header.sidebar&quot;</span></span>
<span id="cb745-59"><a href="Avtentikacija.html#cb745-59" tabindex="-1"></a><span class="vs">      &gt;&lt;/app-sidebar&gt;</span></span>
<span id="cb745-60"><a href="Avtentikacija.html#cb745-60" tabindex="-1"></a><span class="vs">    &lt;/div&gt;`</span><span class="op">,</span></span>
<span id="cb745-61"><a href="Avtentikacija.html#cb745-61" tabindex="-1"></a>  <span class="dt">styles</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb745-62"><a href="Avtentikacija.html#cb745-62" tabindex="-1"></a>})</span>
<span id="cb745-63"><a href="Avtentikacija.html#cb745-63" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> LoginComponent {</span>
<span id="cb745-64"><a href="Avtentikacija.html#cb745-64" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb745-65"><a href="Avtentikacija.html#cb745-65" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">router</span><span class="op">:</span> Router<span class="op">,</span></span>
<span id="cb745-66"><a href="Avtentikacija.html#cb745-66" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService</span>
<span id="cb745-67"><a href="Avtentikacija.html#cb745-67" tabindex="-1"></a>  ) {}</span>
<span id="cb745-68"><a href="Avtentikacija.html#cb745-68" tabindex="-1"></a>  <span class="kw">protected</span> formError<span class="op">!:</span> string<span class="op">;</span></span>
<span id="cb745-69"><a href="Avtentikacija.html#cb745-69" tabindex="-1"></a>  <span class="kw">protected</span> <span class="dt">credentials</span><span class="op">:</span> User <span class="op">=</span> {</span>
<span id="cb745-70"><a href="Avtentikacija.html#cb745-70" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb745-71"><a href="Avtentikacija.html#cb745-71" tabindex="-1"></a>    <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb745-72"><a href="Avtentikacija.html#cb745-72" tabindex="-1"></a>    <span class="dt">password</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb745-73"><a href="Avtentikacija.html#cb745-73" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb745-74"><a href="Avtentikacija.html#cb745-74" tabindex="-1"></a>  <span class="kw">public</span> header <span class="op">=</span> {</span>
<span id="cb745-75"><a href="Avtentikacija.html#cb745-75" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Sign in&quot;</span><span class="op">,</span></span>
<span id="cb745-76"><a href="Avtentikacija.html#cb745-76" tabindex="-1"></a>    <span class="dt">subtitle</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb745-77"><a href="Avtentikacija.html#cb745-77" tabindex="-1"></a>    <span class="dt">sidebar</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></span>
<span id="cb745-78"><a href="Avtentikacija.html#cb745-78" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb745-79"><a href="Avtentikacija.html#cb745-79" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">onLoginSubmit</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb745-80"><a href="Avtentikacija.html#cb745-80" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb745-81"><a href="Avtentikacija.html#cb745-81" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb745-82"><a href="Avtentikacija.html#cb745-82" tabindex="-1"></a>      <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">email</span> <span class="op">||</span></span>
<span id="cb745-83"><a href="Avtentikacija.html#cb745-83" tabindex="-1"></a>      <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">password</span></span>
<span id="cb745-84"><a href="Avtentikacija.html#cb745-84" tabindex="-1"></a>    )</span>
<span id="cb745-85"><a href="Avtentikacija.html#cb745-85" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;All fields are required, please try again.&quot;</span><span class="op">;</span></span>
<span id="cb745-86"><a href="Avtentikacija.html#cb745-86" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb745-87"><a href="Avtentikacija.html#cb745-87" tabindex="-1"></a>      <span class="op">!</span><span class="ss">/</span><span class="sc">^\w+([\.-]?\w+)*</span><span class="ss">@</span><span class="sc">\w+([\.-]?\w+)*(\.\w{2,3})+$</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(</span>
<span id="cb745-88"><a href="Avtentikacija.html#cb745-88" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">email</span></span>
<span id="cb745-89"><a href="Avtentikacija.html#cb745-89" tabindex="-1"></a>      )</span>
<span id="cb745-90"><a href="Avtentikacija.html#cb745-90" tabindex="-1"></a>    )</span>
<span id="cb745-91"><a href="Avtentikacija.html#cb745-91" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;Please enter a valid e-mail address.&quot;</span><span class="op">;</span></span>
<span id="cb745-92"><a href="Avtentikacija.html#cb745-92" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span><span class="op">.</span><span class="at">password</span><span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">3</span>)</span>
<span id="cb745-93"><a href="Avtentikacija.html#cb745-93" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> <span class="st">&quot;Password must be at least 3 characters long.&quot;</span><span class="op">;</span></span>
<span id="cb745-94"><a href="Avtentikacija.html#cb745-94" tabindex="-1"></a>    <span class="cf">else</span> <span class="kw">this</span><span class="op">.</span><span class="fu">doLogin</span>()<span class="op">;</span></span>
<span id="cb745-95"><a href="Avtentikacija.html#cb745-95" tabindex="-1"></a>  }</span>
<span id="cb745-96"><a href="Avtentikacija.html#cb745-96" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">doLogin</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb745-97"><a href="Avtentikacija.html#cb745-97" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span></span>
<span id="cb745-98"><a href="Avtentikacija.html#cb745-98" tabindex="-1"></a>      <span class="op">.</span><span class="fu">login</span>(<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span>)</span>
<span id="cb745-99"><a href="Avtentikacija.html#cb745-99" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb745-100"><a href="Avtentikacija.html#cb745-100" tabindex="-1"></a>        <span class="fu">catchError</span>((<span class="dt">error</span><span class="op">:</span> HttpErrorResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb745-101"><a href="Avtentikacija.html#cb745-101" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> error<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb745-102"><a href="Avtentikacija.html#cb745-102" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">throwError</span>(() <span class="kw">=&gt;</span> error)<span class="op">;</span></span>
<span id="cb745-103"><a href="Avtentikacija.html#cb745-103" tabindex="-1"></a>        })</span>
<span id="cb745-104"><a href="Avtentikacija.html#cb745-104" tabindex="-1"></a>      )</span>
<span id="cb745-105"><a href="Avtentikacija.html#cb745-105" tabindex="-1"></a>      <span class="op">.</span><span class="fu">subscribe</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb745-106"><a href="Avtentikacija.html#cb745-106" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigateByUrl</span>(<span class="st">&quot;/&quot;</span>)<span class="op">;</span></span>
<span id="cb745-107"><a href="Avtentikacija.html#cb745-107" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb745-108"><a href="Avtentikacija.html#cb745-108" tabindex="-1"></a>  }</span>
<span id="cb745-109"><a href="Avtentikacija.html#cb745-109" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#priprava-strani-za-prijavo code.bash:eq(0)").markRegExp(/ng generate.+/, options_dodaj);
    $("#priprava-strani-za-prijavo code.javascript:eq(0)").markRegExp(/import { LoginComponent }.+/, options_dodaj);
    $("#priprava-strani-za-prijavo code.javascript:eq(0)").markRegExp(/\s+?{ path: "login".+/, options_dodaj);
    $("#priprava-strani-za-prijavo code.javascript:eq(1)").markRegExp(/import { (Router|HttpErrorResponse|throwError|catchError|User|AuthenticationService).+/, options_dodaj);
    $("#priprava-strani-za-prijavo code.javascript:eq(1)").markRegExp(/<p>.+?<\/p>/, options_izbrisi);
    $("#priprava-strani-za-prijavo code.javascript:eq(1)").markRegExp(/\s+?<app-header[\s\S]+?<\/app-sidebar>[\s\S]+?<\/div>/, options_dodaj);
    $("#priprava-strani-za-prijavo code.javascript:eq(1)").markRegExp(/\s+?constructor[\s\S]+?{}/, options_dodaj);
    $("#priprava-strani-za-prijavo code.javascript:eq(1)").markRegExp(/\s+?protected[\s\S]+?navigateByUrl[\s\S]+?}\);[\s\S]+?}/, options_dodaj);
  });
</script>
</div>
</div>
<div id="uporaba-avtentikacije-v-angular-aplikaciji" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">10.7</span> Uporaba avtentikacije v Angular aplikaciji<a href="Avtentikacija.html#uporaba-avtentikacije-v-angular-aplikaciji" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ko imamo podprto funkcionalnost avtentikacije uporabnikov, lahko v nadaljevanju te podatke uporabimo v aplikaciji. Z vidika funkcionalnosti bomo podprli:</p>
<ul>
<li><strong>posodobitev navigacije</strong> glede na to, ali je uporabnik prijavljen (glej poglavje <a href="Avtentikacija.html#posodobitev-navigacije">10.7.1</a>),</li>
<li>podporo <strong>zgodovini brskanja</strong> (glej poglavje <a href="Avtentikacija.html#podpora-zgodovini-brskanja">10.7.2</a>),</li>
<li><strong>uporabo imena uporabnika pri dodajanju komentarjev</strong> (glej poglavje <a href="Avtentikacija.html#dodajanje-uporabnika-v-komentar">10.7.3</a>),</li>
<li>omogočeno <strong>brisanje lastnih komentarjev</strong> (glej poglavje <a href="Avtentikacija.html#brisanje-lastnih-komentarjev">10.7.4</a>).</li>
</ul>
<div id="posodobitev-navigacije" class="section level3 hasAnchor" number="10.7.1">
<h3><span class="header-section-number">10.7.1</span> Posodobitev navigacije<a href="Avtentikacija.html#posodobitev-navigacije" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Trenutno v naši aplikaciji manjka <strong>povezava na prijavo uporabnika</strong>, zato jo bomo dodali v predlogo pogleda <code>framework.component.html</code> v zgornji del zaslona na območje navigacije.</p>
<p><code>angular/src/app/shared/components/framework/framework.component.html</code></p>
<div class="sourceCode" id="cb746"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb746-1"><a href="Avtentikacija.html#cb746-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">nav</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;navbar navbar-expand-md navbar-dark bg-primary&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-2"><a href="Avtentikacija.html#cb746-2" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;container-fluid&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-3"><a href="Avtentikacija.html#cb746-3" tabindex="-1"></a>    ...</span>
<span id="cb746-4"><a href="Avtentikacija.html#cb746-4" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;collapse navbar-collapse&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;navbarContent&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-5"><a href="Avtentikacija.html#cb746-5" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;navbar-nav me-auto&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-6"><a href="Avtentikacija.html#cb746-6" tabindex="-1"></a>        ...</span>
<span id="cb746-7"><a href="Avtentikacija.html#cb746-7" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb746-8"><a href="Avtentikacija.html#cb746-8" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;navbar-nav justify-content-end&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-9"><a href="Avtentikacija.html#cb746-9" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;nav-item dropdown&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-10"><a href="Avtentikacija.html#cb746-10" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">a</span></span>
<span id="cb746-11"><a href="Avtentikacija.html#cb746-11" tabindex="-1"></a><span class="ot">            class</span><span class="op">=</span><span class="st">&quot;nav-link dropdown-toggle&quot;</span></span>
<span id="cb746-12"><a href="Avtentikacija.html#cb746-12" tabindex="-1"></a><span class="ot">            data-bs-toggle</span><span class="op">=</span><span class="st">&quot;dropdown&quot;</span></span>
<span id="cb746-13"><a href="Avtentikacija.html#cb746-13" tabindex="-1"></a><span class="ot">            role</span><span class="op">=</span><span class="st">&quot;button&quot;</span></span>
<span id="cb746-14"><a href="Avtentikacija.html#cb746-14" tabindex="-1"></a><span class="ot">            aria-haspopup</span><span class="op">=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb746-15"><a href="Avtentikacija.html#cb746-15" tabindex="-1"></a><span class="ot">            aria-expanded</span><span class="op">=</span><span class="st">&quot;false&quot;</span></span>
<span id="cb746-16"><a href="Avtentikacija.html#cb746-16" tabindex="-1"></a><span class="ot">            </span><span class="dt">&gt;</span>User</span>
<span id="cb746-17"><a href="Avtentikacija.html#cb746-17" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb746-18"><a href="Avtentikacija.html#cb746-18" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;dropdown-menu dropdown-menu-end&quot;</span><span class="dt">&gt;</span></span>
<span id="cb746-19"><a href="Avtentikacija.html#cb746-19" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;dropdown-item show-pointer&quot;</span><span class="dt">&gt;</span>Login<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb746-20"><a href="Avtentikacija.html#cb746-20" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">a</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;dropdown-item show-pointer&quot;</span><span class="dt">&gt;</span>Logout<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb746-21"><a href="Avtentikacija.html#cb746-21" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb746-22"><a href="Avtentikacija.html#cb746-22" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb746-23"><a href="Avtentikacija.html#cb746-23" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb746-24"><a href="Avtentikacija.html#cb746-24" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb746-25"><a href="Avtentikacija.html#cb746-25" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb746-26"><a href="Avtentikacija.html#cb746-26" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">nav</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Prijavo in odjavo v okviru komponente <code>framework</code> bomo omogočili z <strong>uporabo storitve <code>authentication</code></strong>.</p>
<p><code>angular/src/app/shared/components/framework/framework.component.ts</code></p>
<div class="sourceCode" id="cb747"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb747-1"><a href="Avtentikacija.html#cb747-1" tabindex="-1"></a><span class="im">import</span> { Component } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb747-2"><a href="Avtentikacija.html#cb747-2" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb747-3"><a href="Avtentikacija.html#cb747-3" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb747-4"><a href="Avtentikacija.html#cb747-4" tabindex="-1"></a></span>
<span id="cb747-5"><a href="Avtentikacija.html#cb747-5" tabindex="-1"></a>@<span class="fu">Component</span>({</span>
<span id="cb747-6"><a href="Avtentikacija.html#cb747-6" tabindex="-1"></a>  <span class="dt">selector</span><span class="op">:</span> <span class="st">&quot;app-framework&quot;</span><span class="op">,</span></span>
<span id="cb747-7"><a href="Avtentikacija.html#cb747-7" tabindex="-1"></a>  <span class="dt">templateUrl</span><span class="op">:</span> <span class="st">&quot;framework.component.html&quot;</span><span class="op">,</span></span>
<span id="cb747-8"><a href="Avtentikacija.html#cb747-8" tabindex="-1"></a>  <span class="dt">styles</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb747-9"><a href="Avtentikacija.html#cb747-9" tabindex="-1"></a>})</span>
<span id="cb747-10"><a href="Avtentikacija.html#cb747-10" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> FrameworkComponent {</span>
<span id="cb747-11"><a href="Avtentikacija.html#cb747-11" tabindex="-1"></a>  <span class="fu">constructor</span>(<span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService) {}</span>
<span id="cb747-12"><a href="Avtentikacija.html#cb747-12" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">logout</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb747-13"><a href="Avtentikacija.html#cb747-13" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span><span class="op">.</span><span class="fu">logout</span>()<span class="op">;</span></span>
<span id="cb747-14"><a href="Avtentikacija.html#cb747-14" tabindex="-1"></a>  }</span>
<span id="cb747-15"><a href="Avtentikacija.html#cb747-15" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">isLoggedIn</span>()<span class="op">:</span> boolean {</span>
<span id="cb747-16"><a href="Avtentikacija.html#cb747-16" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span><span class="op">.</span><span class="fu">isLoggedIn</span>()<span class="op">;</span></span>
<span id="cb747-17"><a href="Avtentikacija.html#cb747-17" tabindex="-1"></a>  }</span>
<span id="cb747-18"><a href="Avtentikacija.html#cb747-18" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getCurrentUser</span>()<span class="op">:</span> string {</span>
<span id="cb747-19"><a href="Avtentikacija.html#cb747-19" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">user</span><span class="op">:</span> User <span class="op">|</span> <span class="kw">null</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span><span class="op">.</span><span class="fu">getCurrentUser</span>()<span class="op">;</span></span>
<span id="cb747-20"><a href="Avtentikacija.html#cb747-20" tabindex="-1"></a>    <span class="cf">return</span> user <span class="op">?</span> user<span class="op">.</span><span class="at">name</span> <span class="op">:</span> <span class="st">&quot;Guest&quot;</span><span class="op">;</span></span>
<span id="cb747-21"><a href="Avtentikacija.html#cb747-21" tabindex="-1"></a>  }</span>
<span id="cb747-22"><a href="Avtentikacija.html#cb747-22" tabindex="-1"></a>}</span></code></pre></div>
<p>Sedaj lahko <strong>upoštevamo status prijavljenega uporabnika</strong> tudi na HTML predlogi <code>framework.component.html</code>, kjer bomo s pomočjo <a href="https://angular.io/api/common/NgIf"><i class="fa-brands fa-angular"></i><code>*ngIf</code></a> poskrbeli za prikazovanje in skrivanje ustreznih HTML gradnikov.</p>
<p><code>angular/src/app/shared/components/framework/framework.component.html</code></p>
<div class="sourceCode" id="cb748"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb748-1"><a href="Avtentikacija.html#cb748-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">nav</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;navbar navbar-expand-md navbar-dark bg-primary&quot;</span><span class="dt">&gt;</span></span>
<span id="cb748-2"><a href="Avtentikacija.html#cb748-2" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;container-fluid&quot;</span><span class="dt">&gt;</span></span>
<span id="cb748-3"><a href="Avtentikacija.html#cb748-3" tabindex="-1"></a>    ...</span>
<span id="cb748-4"><a href="Avtentikacija.html#cb748-4" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;collapse navbar-collapse&quot;</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;navbarContent&quot;</span><span class="dt">&gt;</span></span>
<span id="cb748-5"><a href="Avtentikacija.html#cb748-5" tabindex="-1"></a>      ...</span>
<span id="cb748-6"><a href="Avtentikacija.html#cb748-6" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">ul</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;navbar-nav justify-content-end&quot;</span><span class="dt">&gt;</span></span>
<span id="cb748-7"><a href="Avtentikacija.html#cb748-7" tabindex="-1"></a>        <span class="dt">&lt;</span><span class="kw">li</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;nav-item dropdown&quot;</span><span class="dt">&gt;</span></span>
<span id="cb748-8"><a href="Avtentikacija.html#cb748-8" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">a</span></span>
<span id="cb748-9"><a href="Avtentikacija.html#cb748-9" tabindex="-1"></a><span class="ot">            class</span><span class="op">=</span><span class="st">&quot;nav-link dropdown-toggle&quot;</span></span>
<span id="cb748-10"><a href="Avtentikacija.html#cb748-10" tabindex="-1"></a><span class="ot">            data-bs-toggle</span><span class="op">=</span><span class="st">&quot;dropdown&quot;</span></span>
<span id="cb748-11"><a href="Avtentikacija.html#cb748-11" tabindex="-1"></a><span class="ot">            role</span><span class="op">=</span><span class="st">&quot;button&quot;</span></span>
<span id="cb748-12"><a href="Avtentikacija.html#cb748-12" tabindex="-1"></a><span class="ot">            aria-haspopup</span><span class="op">=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb748-13"><a href="Avtentikacija.html#cb748-13" tabindex="-1"></a><span class="ot">            aria-expanded</span><span class="op">=</span><span class="st">&quot;false&quot;</span></span>
<span id="cb748-14"><a href="Avtentikacija.html#cb748-14" tabindex="-1"></a><span class="ot">            </span><span class="dt">&gt;</span>User <span class="dt">&lt;</span><span class="kw">i</span></span>
<span id="cb748-15"><a href="Avtentikacija.html#cb748-15" tabindex="-1"></a><span class="ot">              class</span><span class="op">=</span><span class="st">&quot;fa-solid me-1&quot;</span></span>
<span id="cb748-16"><a href="Avtentikacija.html#cb748-16" tabindex="-1"></a><span class="ot">              [ngClass]</span><span class="op">=</span><span class="st">&quot;{</span></span>
<span id="cb748-17"><a href="Avtentikacija.html#cb748-17" tabindex="-1"></a><span class="st">                &#39;fa-user-ninja&#39;: !isLoggedIn(),</span></span>
<span id="cb748-18"><a href="Avtentikacija.html#cb748-18" tabindex="-1"></a><span class="st">                &#39;fa-user-shield&#39;: isLoggedIn()</span></span>
<span id="cb748-19"><a href="Avtentikacija.html#cb748-19" tabindex="-1"></a><span class="st">              }&quot;</span></span>
<span id="cb748-20"><a href="Avtentikacija.html#cb748-20" tabindex="-1"></a><span class="ot">            </span><span class="dt">&gt;&lt;/</span><span class="kw">i</span></span>
<span id="cb748-21"><a href="Avtentikacija.html#cb748-21" tabindex="-1"></a>            <span class="dt">&gt;</span>{{ getCurrentUser() }}</span>
<span id="cb748-22"><a href="Avtentikacija.html#cb748-22" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb748-23"><a href="Avtentikacija.html#cb748-23" tabindex="-1"></a>          <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;dropdown-menu dropdown-menu-end&quot;</span><span class="dt">&gt;</span></span>
<span id="cb748-24"><a href="Avtentikacija.html#cb748-24" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">a</span></span>
<span id="cb748-25"><a href="Avtentikacija.html#cb748-25" tabindex="-1"></a><span class="ot">              routerLink</span><span class="op">=</span><span class="st">&quot;login&quot;</span></span>
<span id="cb748-26"><a href="Avtentikacija.html#cb748-26" tabindex="-1"></a><span class="ot">              *ngIf</span><span class="op">=</span><span class="st">&quot;!isLoggedIn()&quot;</span></span>
<span id="cb748-27"><a href="Avtentikacija.html#cb748-27" tabindex="-1"></a><span class="ot">              class</span><span class="op">=</span><span class="st">&quot;dropdown-item&quot;</span></span>
<span id="cb748-28"><a href="Avtentikacija.html#cb748-28" tabindex="-1"></a><span class="ot">              </span><span class="dt">&gt;</span>Login<span class="dt">&lt;/</span><span class="kw">a</span></span>
<span id="cb748-29"><a href="Avtentikacija.html#cb748-29" tabindex="-1"></a>            <span class="dt">&gt;</span></span>
<span id="cb748-30"><a href="Avtentikacija.html#cb748-30" tabindex="-1"></a>            <span class="dt">&lt;</span><span class="kw">a</span></span>
<span id="cb748-31"><a href="Avtentikacija.html#cb748-31" tabindex="-1"></a><span class="ot">              *ngIf</span><span class="op">=</span><span class="st">&quot;isLoggedIn()&quot;</span></span>
<span id="cb748-32"><a href="Avtentikacija.html#cb748-32" tabindex="-1"></a><span class="ot">              (click)</span><span class="op">=</span><span class="st">&quot;logout()&quot;</span></span>
<span id="cb748-33"><a href="Avtentikacija.html#cb748-33" tabindex="-1"></a><span class="ot">              class</span><span class="op">=</span><span class="st">&quot;dropdown-item&quot;</span></span>
<span id="cb748-34"><a href="Avtentikacija.html#cb748-34" tabindex="-1"></a><span class="ot">              </span><span class="dt">&gt;</span>Logout<span class="dt">&lt;/</span><span class="kw">a</span></span>
<span id="cb748-35"><a href="Avtentikacija.html#cb748-35" tabindex="-1"></a>            <span class="dt">&gt;</span></span>
<span id="cb748-36"><a href="Avtentikacija.html#cb748-36" tabindex="-1"></a>          <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb748-37"><a href="Avtentikacija.html#cb748-37" tabindex="-1"></a>        <span class="dt">&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb748-38"><a href="Avtentikacija.html#cb748-38" tabindex="-1"></a>      <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb748-39"><a href="Avtentikacija.html#cb748-39" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb748-40"><a href="Avtentikacija.html#cb748-40" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb748-41"><a href="Avtentikacija.html#cb748-41" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">nav</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Pri testiranju razvite funkcionalnosti lahko opazimo, da ima naša aplikacija <strong>težavo z UTF-8 kodiranjem</strong> (npr. napačno prikazovanje šumnikov), zato <strong>bomo</strong> z manjšim popravkom to napako <strong>odpravili</strong>.</p>
<p><code>angular/src/app/shared/services/authentication.service.ts</code></p>
<div class="sourceCode" id="cb749"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb749-1"><a href="Avtentikacija.html#cb749-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> AuthenticationService {</span>
<span id="cb749-2"><a href="Avtentikacija.html#cb749-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb749-3"><a href="Avtentikacija.html#cb749-3" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">b64Utf8</span>(<span class="dt">input</span><span class="op">:</span> string)<span class="op">:</span> string {</span>
<span id="cb749-4"><a href="Avtentikacija.html#cb749-4" tabindex="-1"></a>    <span class="cf">return</span> <span class="pp">decodeURIComponent</span>(</span>
<span id="cb749-5"><a href="Avtentikacija.html#cb749-5" tabindex="-1"></a>      <span class="bu">Array</span><span class="op">.</span><span class="at">prototype</span><span class="op">.</span><span class="at">map</span></span>
<span id="cb749-6"><a href="Avtentikacija.html#cb749-6" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(<span class="bu">window</span><span class="op">.</span><span class="fu">atob</span>(input)<span class="op">,</span> (<span class="dt">character</span><span class="op">:</span> string) <span class="kw">=&gt;</span> {</span>
<span id="cb749-7"><a href="Avtentikacija.html#cb749-7" tabindex="-1"></a>          <span class="cf">return</span> <span class="st">&quot;%&quot;</span> <span class="op">+</span> (<span class="st">&quot;00&quot;</span> <span class="op">+</span> character<span class="op">.</span><span class="fu">charCodeAt</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">toString</span>(<span class="dv">16</span>))<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb749-8"><a href="Avtentikacija.html#cb749-8" tabindex="-1"></a>        })</span>
<span id="cb749-9"><a href="Avtentikacija.html#cb749-9" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb749-10"><a href="Avtentikacija.html#cb749-10" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb749-11"><a href="Avtentikacija.html#cb749-11" tabindex="-1"></a>  }</span>
<span id="cb749-12"><a href="Avtentikacija.html#cb749-12" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">isLoggedIn</span>()<span class="op">:</span> boolean {</span>
<span id="cb749-13"><a href="Avtentikacija.html#cb749-13" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">token</span><span class="op">:</span> string <span class="op">|</span> <span class="kw">null</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getToken</span>()<span class="op">;</span></span>
<span id="cb749-14"><a href="Avtentikacija.html#cb749-14" tabindex="-1"></a>    <span class="cf">if</span> (token) {</span>
<span id="cb749-15"><a href="Avtentikacija.html#cb749-15" tabindex="-1"></a>      <span class="kw">const</span> payload <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="kw">this</span><span class="op">.</span><span class="at">b64Utf8window</span><span class="op">.</span><span class="fu">atob</span> (token<span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;.&quot;</span>)[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb749-16"><a href="Avtentikacija.html#cb749-16" tabindex="-1"></a>      <span class="cf">return</span> payload<span class="op">.</span><span class="at">exp</span> <span class="op">&gt;</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span><span class="op">;</span></span>
<span id="cb749-17"><a href="Avtentikacija.html#cb749-17" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb749-18"><a href="Avtentikacija.html#cb749-18" tabindex="-1"></a>  }</span>
<span id="cb749-19"><a href="Avtentikacija.html#cb749-19" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getCurrentUser</span>()<span class="op">:</span> User <span class="op">|</span> <span class="kw">null</span> {</span>
<span id="cb749-20"><a href="Avtentikacija.html#cb749-20" tabindex="-1"></a>    <span class="kw">let</span> user<span class="op">!:</span> User<span class="op">;</span></span>
<span id="cb749-21"><a href="Avtentikacija.html#cb749-21" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">isLoggedIn</span>()) {</span>
<span id="cb749-22"><a href="Avtentikacija.html#cb749-22" tabindex="-1"></a>      <span class="kw">let</span> <span class="dt">token</span><span class="op">:</span> string <span class="op">|</span> <span class="kw">null</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getToken</span>()<span class="op">;</span></span>
<span id="cb749-23"><a href="Avtentikacija.html#cb749-23" tabindex="-1"></a>      <span class="cf">if</span> (token) {</span>
<span id="cb749-24"><a href="Avtentikacija.html#cb749-24" tabindex="-1"></a>        <span class="kw">let</span> { email<span class="op">,</span> name } <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="kw">this</span><span class="op">.</span><span class="at">b64Utf8window</span><span class="op">.</span><span class="fu">atob</span> (token<span class="op">.</span><span class="fu">split</span>(<span class="st">&quot;.&quot;</span>)[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb749-25"><a href="Avtentikacija.html#cb749-25" tabindex="-1"></a>        user <span class="op">=</span> { email<span class="op">,</span> name }<span class="op">;</span></span>
<span id="cb749-26"><a href="Avtentikacija.html#cb749-26" tabindex="-1"></a>      }</span>
<span id="cb749-27"><a href="Avtentikacija.html#cb749-27" tabindex="-1"></a>    }</span>
<span id="cb749-28"><a href="Avtentikacija.html#cb749-28" tabindex="-1"></a>    <span class="cf">return</span> user<span class="op">;</span></span>
<span id="cb749-29"><a href="Avtentikacija.html#cb749-29" tabindex="-1"></a>  }</span>
<span id="cb749-30"><a href="Avtentikacija.html#cb749-30" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#posodobitev-navigacije code.html:eq(0)").markRegExp(/\s+?\<ul class="navbar-nav justify-content-end"\>[\s\S]+?\<\/ul\>/, options_dodaj);
    $("#posodobitev-navigacije code.javascript:eq(0)").markRegExp(/import { (AuthenticationService|User).+/, options_dodaj);
    $("#posodobitev-navigacije code.javascript:eq(0)").markRegExp(/\s+?constructor.+/, options_dodaj);
    $("#posodobitev-navigacije code.javascript:eq(0)").markRegExp(/\s+?public (logout|isLoggedIn|getCurrentUser)[\s\S]+?}/, options_dodaj);
    $("#posodobitev-navigacije code.html:eq(1)").markRegExp(/User /, options_izbrisi);
    $("#posodobitev-navigacije code.html:eq(1)").markRegExp(/<i[\s\S]+?getCurrentUser\(\) }}/, options_dodaj);
    $("#posodobitev-navigacije code.html:eq(1)").markRegExp(/.+?(ngIf|routerLink|\(click\)).+/, options_dodaj);
    $("#posodobitev-navigacije code.javascript:eq(1)").markRegExp(/\s+?private b64Utf8[\s\S]+?join[\s\S]+?}/, options_dodaj);
    $("#posodobitev-navigacije code.javascript:eq(1)").markRegExp(/this\.b64Utf8/, options_dodaj);
    $("#posodobitev-navigacije code.javascript:eq(1)").markRegExp(/window\.atob /, options_izbrisi);
  });
</script>
</div>
<div id="podpora-zgodovini-brskanja" class="section level3 hasAnchor" number="10.7.2">
<h3><span class="header-section-number">10.7.2</span> Podpora zgodovini brskanja<a href="Avtentikacija.html#podpora-zgodovini-brskanja" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Funkcionalnost prijave in odjave v tem trenutku deluje, vendar bi želeli našo Angular SPA aplikacijo izboljšati z vidika uporabniške izkušnje. Trenutno delovanje ob uspešni prijavi in registraciji uporabnika preusmeri na začetno stran naše aplikacije, kar ni najbolj primerno, saj bi ga želeli vrniti nazaj na mesto, kjer je bil pred poskusom prijave oz. registracije.</p>
<p>Za <strong>obvladovanje zgodovine brskanja uporabnika</strong> bomo s pomočjo Angular CLI kreirali novo storitev <code>history</code>.</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb750-1"><a href="Avtentikacija.html#cb750-1" tabindex="-1"></a><span class="ex">$</span> ng generate service shared/services/history</span>
<span id="cb750-2"><a href="Avtentikacija.html#cb750-2" tabindex="-1"></a></span>
<span id="cb750-3"><a href="Avtentikacija.html#cb750-3" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/services/history.service.ts <span class="er">(</span><span class="ex">136</span> bytes<span class="kw">)</span></span></code></pre></div>
<p>Storitev <code>history</code> vključimo v obstoječo komponento <code>framework</code>.</p>
<p><code>angular/src/app/shared/components/framework/framework.component.ts</code></p>
<div class="sourceCode" id="cb751"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb751-1"><a href="Avtentikacija.html#cb751-1" tabindex="-1"></a><span class="im">import</span> { Component } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb751-2"><a href="Avtentikacija.html#cb751-2" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb751-3"><a href="Avtentikacija.html#cb751-3" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb751-4"><a href="Avtentikacija.html#cb751-4" tabindex="-1"></a><span class="im">import</span> { HistoryService } <span class="im">from</span> <span class="st">&quot;../../services/history.service&quot;</span><span class="op">;</span></span>
<span id="cb751-5"><a href="Avtentikacija.html#cb751-5" tabindex="-1"></a></span>
<span id="cb751-6"><a href="Avtentikacija.html#cb751-6" tabindex="-1"></a>@<span class="fu">Component</span>({</span>
<span id="cb751-7"><a href="Avtentikacija.html#cb751-7" tabindex="-1"></a>  <span class="dt">selector</span><span class="op">:</span> <span class="st">&quot;app-framework&quot;</span><span class="op">,</span></span>
<span id="cb751-8"><a href="Avtentikacija.html#cb751-8" tabindex="-1"></a>  <span class="dt">templateUrl</span><span class="op">:</span> <span class="st">&quot;framework.component.html&quot;</span><span class="op">,</span></span>
<span id="cb751-9"><a href="Avtentikacija.html#cb751-9" tabindex="-1"></a>  <span class="dt">styles</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb751-10"><a href="Avtentikacija.html#cb751-10" tabindex="-1"></a>})</span>
<span id="cb751-11"><a href="Avtentikacija.html#cb751-11" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> FrameworkComponent {</span>
<span id="cb751-12"><a href="Avtentikacija.html#cb751-12" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb751-13"><a href="Avtentikacija.html#cb751-13" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService<span class="op">,</span></span>
<span id="cb751-14"><a href="Avtentikacija.html#cb751-14" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">historyService</span><span class="op">:</span> HistoryService</span>
<span id="cb751-15"><a href="Avtentikacija.html#cb751-15" tabindex="-1"></a>  ) {}</span>
<span id="cb751-16"><a href="Avtentikacija.html#cb751-16" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb751-17"><a href="Avtentikacija.html#cb751-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Nato poskrbimo za <strong>delovanje storitve <code>history</code></strong>, kjer bomo uporabili sistemski <code>Router</code> modul, se <strong>prijavili na dogodke usmerjevalnika</strong> in pripravili metodo <code>getPreviousUrl</code>, s katero bomo dostopali do zgodovine brskanja.</p>
<p>Metoda <code>events</code> v okviru usmerjevalnika vrača številne dogodke, vendar nas v primeru zgodovine zanimajo zgolj <a href="https://angular.io/api/router/NavigationEnd"><span class="skupaj"><i class="fa-brands fa-angular"></i><code>NavigationEnd</code></span></a> dogodki. S <code>subscribe</code> se prijavimo na vse takšne dogodke in v povratnem klicu posodabljamo seznam obiskanih URL naslovov v <code>urls</code>.</p>
<p><code>angular/src/app/shared/services/history.service.ts</code></p>
<div class="sourceCode" id="cb752"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb752-1"><a href="Avtentikacija.html#cb752-1" tabindex="-1"></a><span class="im">import</span> { Injectable } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb752-2"><a href="Avtentikacija.html#cb752-2" tabindex="-1"></a><span class="im">import</span> { Router<span class="op">,</span> NavigationEnd } <span class="im">from</span> <span class="st">&quot;@angular/router&quot;</span><span class="op">;</span></span>
<span id="cb752-3"><a href="Avtentikacija.html#cb752-3" tabindex="-1"></a></span>
<span id="cb752-4"><a href="Avtentikacija.html#cb752-4" tabindex="-1"></a>@<span class="fu">Injectable</span>({</span>
<span id="cb752-5"><a href="Avtentikacija.html#cb752-5" tabindex="-1"></a>  <span class="dt">providedIn</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb752-6"><a href="Avtentikacija.html#cb752-6" tabindex="-1"></a>})</span>
<span id="cb752-7"><a href="Avtentikacija.html#cb752-7" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> HistoryService {</span>
<span id="cb752-8"><a href="Avtentikacija.html#cb752-8" tabindex="-1"></a>  <span class="kw">private</span> <span class="dt">urls</span><span class="op">:</span> string[] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb752-9"><a href="Avtentikacija.html#cb752-9" tabindex="-1"></a>  <span class="fu">constructor</span>(<span class="kw">private</span> <span class="dt">router</span><span class="op">:</span> Router) {</span>
<span id="cb752-10"><a href="Avtentikacija.html#cb752-10" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="at">events</span><span class="op">.</span><span class="fu">subscribe</span>((routerEvent) <span class="kw">=&gt;</span> {</span>
<span id="cb752-11"><a href="Avtentikacija.html#cb752-11" tabindex="-1"></a>      <span class="cf">if</span> (routerEvent <span class="kw">instanceof</span> NavigationEnd)</span>
<span id="cb752-12"><a href="Avtentikacija.html#cb752-12" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">urls</span><span class="op">.</span><span class="fu">push</span>(routerEvent<span class="op">.</span><span class="at">urlAfterRedirects</span>)<span class="op">;</span></span>
<span id="cb752-13"><a href="Avtentikacija.html#cb752-13" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb752-14"><a href="Avtentikacija.html#cb752-14" tabindex="-1"></a>  }</span>
<span id="cb752-15"><a href="Avtentikacija.html#cb752-15" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getPreviousUrl</span>()<span class="op">:</span> string {</span>
<span id="cb752-16"><a href="Avtentikacija.html#cb752-16" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">urls</span><span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb752-17"><a href="Avtentikacija.html#cb752-17" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">urls</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">urls</span><span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb752-18"><a href="Avtentikacija.html#cb752-18" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> <span class="st">&quot;/&quot;</span><span class="op">;</span></span>
<span id="cb752-19"><a href="Avtentikacija.html#cb752-19" tabindex="-1"></a>  }</span>
<span id="cb752-20"><a href="Avtentikacija.html#cb752-20" tabindex="-1"></a>}</span></code></pre></div>
<p>Storitev <code>history</code> sedaj <strong>vključimo v komponento <code>register</code></strong>.</p>
<p><code>angular/src/app/shared/components/register/register.component.ts</code></p>
<div class="sourceCode" id="cb753"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb753-1"><a href="Avtentikacija.html#cb753-1" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb753-2"><a href="Avtentikacija.html#cb753-2" tabindex="-1"></a><span class="im">import</span> { HistoryService } <span class="im">from</span> <span class="st">&quot;../../services/history.service&quot;</span><span class="op">;</span></span>
<span id="cb753-3"><a href="Avtentikacija.html#cb753-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb753-4"><a href="Avtentikacija.html#cb753-4" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> RegisterComponent <span class="kw">implements</span> OnInit {</span>
<span id="cb753-5"><a href="Avtentikacija.html#cb753-5" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb753-6"><a href="Avtentikacija.html#cb753-6" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">router</span><span class="op">:</span> Router<span class="op">,</span></span>
<span id="cb753-7"><a href="Avtentikacija.html#cb753-7" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService<span class="op">,</span></span>
<span id="cb753-8"><a href="Avtentikacija.html#cb753-8" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">historyService</span><span class="op">:</span> HistoryService</span>
<span id="cb753-9"><a href="Avtentikacija.html#cb753-9" tabindex="-1"></a>  ) {}</span>
<span id="cb753-10"><a href="Avtentikacija.html#cb753-10" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb753-11"><a href="Avtentikacija.html#cb753-11" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">doRegister</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb753-12"><a href="Avtentikacija.html#cb753-12" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span></span>
<span id="cb753-13"><a href="Avtentikacija.html#cb753-13" tabindex="-1"></a>      <span class="op">.</span><span class="fu">register</span>(<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span>)</span>
<span id="cb753-14"><a href="Avtentikacija.html#cb753-14" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb753-15"><a href="Avtentikacija.html#cb753-15" tabindex="-1"></a>        <span class="fu">catchError</span>((<span class="dt">error</span><span class="op">:</span> HttpErrorResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb753-16"><a href="Avtentikacija.html#cb753-16" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> error<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb753-17"><a href="Avtentikacija.html#cb753-17" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">throwError</span>(() <span class="kw">=&gt;</span> error)<span class="op">;</span></span>
<span id="cb753-18"><a href="Avtentikacija.html#cb753-18" tabindex="-1"></a>        })</span>
<span id="cb753-19"><a href="Avtentikacija.html#cb753-19" tabindex="-1"></a>      )</span>
<span id="cb753-20"><a href="Avtentikacija.html#cb753-20" tabindex="-1"></a>      <span class="op">.</span><span class="fu">subscribe</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb753-21"><a href="Avtentikacija.html#cb753-21" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigateByUrl</span>(<span class="kw">this</span><span class="op">.</span><span class="at">historyService</span><span class="op">.</span><span class="fu">getPreviousUrl</span>()<span class="st">&quot;/&quot;</span>)<span class="op">;</span></span>
<span id="cb753-22"><a href="Avtentikacija.html#cb753-22" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb753-23"><a href="Avtentikacija.html#cb753-23" tabindex="-1"></a>  }</span>
<span id="cb753-24"><a href="Avtentikacija.html#cb753-24" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb753-25"><a href="Avtentikacija.html#cb753-25" tabindex="-1"></a>}</span></code></pre></div>
<p>Po testiranju funkcionalnosti ugotovimo, da nas Angular SPA po uspešni registraciji preusmeri nazaj na stran s prijavo. To delovanje je pravilno, zato bomo pripravili novo metodo <code>getLastNonLoginUrl</code>, ki bo vračala zgodovino brskanja, vendar brez <code>/login</code> in <code>/register</code>.</p>
<p><code>angular/src/app/shared/services/history.service.ts</code></p>
<div class="sourceCode" id="cb754"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb754-1"><a href="Avtentikacija.html#cb754-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> HistoryService {</span>
<span id="cb754-2"><a href="Avtentikacija.html#cb754-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb754-3"><a href="Avtentikacija.html#cb754-3" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getLastNonLoginUrl</span>()<span class="op">:</span> string {</span>
<span id="cb754-4"><a href="Avtentikacija.html#cb754-4" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">exclude</span><span class="op">:</span> string[] <span class="op">=</span> [<span class="st">&quot;/register&quot;</span><span class="op">,</span> <span class="st">&quot;/login&quot;</span>]<span class="op">;</span></span>
<span id="cb754-5"><a href="Avtentikacija.html#cb754-5" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">urls</span><span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb754-6"><a href="Avtentikacija.html#cb754-6" tabindex="-1"></a>    <span class="kw">const</span> filtererd <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">urls</span><span class="op">.</span><span class="fu">filter</span>((url) <span class="kw">=&gt;</span> <span class="op">!</span>exclude<span class="op">.</span><span class="fu">includes</span>(url))<span class="op">;</span></span>
<span id="cb754-7"><a href="Avtentikacija.html#cb754-7" tabindex="-1"></a>    <span class="cf">if</span> (filtererd<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="cf">return</span> filtererd<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb754-8"><a href="Avtentikacija.html#cb754-8" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> <span class="st">&quot;/&quot;</span><span class="op">;</span></span>
<span id="cb754-9"><a href="Avtentikacija.html#cb754-9" tabindex="-1"></a>  }</span>
<span id="cb754-10"><a href="Avtentikacija.html#cb754-10" tabindex="-1"></a>}</span></code></pre></div>
<p>Sedaj to <strong>novo metodo</strong> tudi vključimo <strong>pri uspešno zaključeni registraciji</strong>.</p>
<p><code>angular/src/app/shared/components/register/register.component.ts</code></p>
<div class="sourceCode" id="cb755"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb755-1"><a href="Avtentikacija.html#cb755-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> RegisterComponent {</span>
<span id="cb755-2"><a href="Avtentikacija.html#cb755-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb755-3"><a href="Avtentikacija.html#cb755-3" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">doRegister</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb755-4"><a href="Avtentikacija.html#cb755-4" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span></span>
<span id="cb755-5"><a href="Avtentikacija.html#cb755-5" tabindex="-1"></a>      <span class="op">.</span><span class="fu">register</span>(<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span>)</span>
<span id="cb755-6"><a href="Avtentikacija.html#cb755-6" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb755-7"><a href="Avtentikacija.html#cb755-7" tabindex="-1"></a>        <span class="fu">catchError</span>((<span class="dt">error</span><span class="op">:</span> HttpErrorResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb755-8"><a href="Avtentikacija.html#cb755-8" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> error<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb755-9"><a href="Avtentikacija.html#cb755-9" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">throwError</span>(() <span class="kw">=&gt;</span> error)<span class="op">;</span></span>
<span id="cb755-10"><a href="Avtentikacija.html#cb755-10" tabindex="-1"></a>        })</span>
<span id="cb755-11"><a href="Avtentikacija.html#cb755-11" tabindex="-1"></a>      )</span>
<span id="cb755-12"><a href="Avtentikacija.html#cb755-12" tabindex="-1"></a>      <span class="op">.</span><span class="fu">subscribe</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb755-13"><a href="Avtentikacija.html#cb755-13" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigateByUrl</span>(<span class="kw">this</span><span class="op">.</span><span class="at">historyService</span><span class="op">.</span><span class="fu">getPreviousUrlgetLastNonLoginUrl</span>())<span class="op">;</span></span>
<span id="cb755-14"><a href="Avtentikacija.html#cb755-14" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb755-15"><a href="Avtentikacija.html#cb755-15" tabindex="-1"></a>  }</span>
<span id="cb755-16"><a href="Avtentikacija.html#cb755-16" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb755-17"><a href="Avtentikacija.html#cb755-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Podobno kot pri registraciji, <strong>storitev <code>history</code> vključimo še pri komponenti <code>login</code></strong>.</p>
<p><code>angular/src/app/shared/components/login/login.component.ts</code></p>
<div class="sourceCode" id="cb756"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb756-1"><a href="Avtentikacija.html#cb756-1" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb756-2"><a href="Avtentikacija.html#cb756-2" tabindex="-1"></a><span class="im">import</span> { HistoryService } <span class="im">from</span> <span class="st">&quot;../../services/history.service&quot;</span><span class="op">;</span></span>
<span id="cb756-3"><a href="Avtentikacija.html#cb756-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb756-4"><a href="Avtentikacija.html#cb756-4" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> LoginComponent {</span>
<span id="cb756-5"><a href="Avtentikacija.html#cb756-5" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb756-6"><a href="Avtentikacija.html#cb756-6" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">router</span><span class="op">:</span> Router<span class="op">,</span></span>
<span id="cb756-7"><a href="Avtentikacija.html#cb756-7" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService<span class="op">,</span></span>
<span id="cb756-8"><a href="Avtentikacija.html#cb756-8" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">historyService</span><span class="op">:</span> HistoryService</span>
<span id="cb756-9"><a href="Avtentikacija.html#cb756-9" tabindex="-1"></a>  ) {}</span>
<span id="cb756-10"><a href="Avtentikacija.html#cb756-10" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb756-11"><a href="Avtentikacija.html#cb756-11" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">doLogin</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb756-12"><a href="Avtentikacija.html#cb756-12" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span></span>
<span id="cb756-13"><a href="Avtentikacija.html#cb756-13" tabindex="-1"></a>      <span class="op">.</span><span class="fu">login</span>(<span class="kw">this</span><span class="op">.</span><span class="at">credentials</span>)</span>
<span id="cb756-14"><a href="Avtentikacija.html#cb756-14" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(</span>
<span id="cb756-15"><a href="Avtentikacija.html#cb756-15" tabindex="-1"></a>        <span class="fu">catchError</span>((<span class="dt">error</span><span class="op">:</span> HttpErrorResponse) <span class="kw">=&gt;</span> {</span>
<span id="cb756-16"><a href="Avtentikacija.html#cb756-16" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">formError</span> <span class="op">=</span> error<span class="op">.</span><span class="fu">toString</span>()<span class="op">;</span></span>
<span id="cb756-17"><a href="Avtentikacija.html#cb756-17" tabindex="-1"></a>          <span class="cf">return</span> <span class="fu">throwError</span>(() <span class="kw">=&gt;</span> error)<span class="op">;</span></span>
<span id="cb756-18"><a href="Avtentikacija.html#cb756-18" tabindex="-1"></a>        })</span>
<span id="cb756-19"><a href="Avtentikacija.html#cb756-19" tabindex="-1"></a>      )</span>
<span id="cb756-20"><a href="Avtentikacija.html#cb756-20" tabindex="-1"></a>      <span class="op">.</span><span class="fu">subscribe</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb756-21"><a href="Avtentikacija.html#cb756-21" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">router</span><span class="op">.</span><span class="fu">navigateByUrl</span>(<span class="st">&quot;/&quot;</span>this<span class="op">.</span><span class="at">historyService</span><span class="op">.</span><span class="fu">getLastNonLoginUrl</span>())<span class="op">;</span></span>
<span id="cb756-22"><a href="Avtentikacija.html#cb756-22" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb756-23"><a href="Avtentikacija.html#cb756-23" tabindex="-1"></a>  }</span>
<span id="cb756-24"><a href="Avtentikacija.html#cb756-24" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb756-25"><a href="Avtentikacija.html#cb756-25" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#podpora-zgodovini-brskanja code.bash:eq(0)").markRegExp(/ng generate.+/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(0)").markRegExp(/import { HistoryService.+/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(0)").markRegExp(/,[\s|\n]+?private historyService: HistoryService/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(1)").markRegExp(/import { (Router).+/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(1)").markRegExp(/\s+?private urls.+/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(1)").markRegExp(/private router: Router/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(1)").markRegExp(/\s+?this\.router\.events[\s\S]+?}\);/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(1)").markRegExp(/\s+?public getPreviousUrl[\s\S]+?}/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(2)").markRegExp(/import { HistoryService.+/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(2)").markRegExp(/,[\s|\n]+?private historyService: HistoryService/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(2)").markRegExp(/this\.historyService\.getPreviousUrl\(\)/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(2)").markRegExp(/"\/"/, options_izbrisi);
    $("#podpora-zgodovini-brskanja code.javascript:eq(3)").markRegExp(/\s+?public get[\s\S]+?}/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(4)").markRegExp(/getLastNonLoginUrl/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(4)").markRegExp(/getPreviousUrl/, options_izbrisi);
    $("#podpora-zgodovini-brskanja code.javascript:eq(5)").markRegExp(/import { HistoryService.+/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(5)").markRegExp(/,[\s|\n]+?private historyService: HistoryService/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(5)").markRegExp(/this\.historyService\.getLastNonLoginUrl\(\)/, options_dodaj);
    $("#podpora-zgodovini-brskanja code.javascript:eq(5)").markRegExp(/"\/"/, options_izbrisi);
  });
</script>
</div>
<div id="dodajanje-uporabnika-v-komentar" class="section level3 hasAnchor" number="10.7.3">
<h3><span class="header-section-number">10.7.3</span> Dodajanje uporabniških podatkov v komentar<a href="Avtentikacija.html#dodajanje-uporabnika-v-komentar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ključna dodana vrednost vpeljave avtentikacije v aplikacijo je sposobnost dodajanja komentarjev lokacij zgolj za registrirane in prijavljene uporabnike. Omenjena funkcionalnost se nahaja <strong>v okviru komponente <code>location-details</code></strong>, zato bomo najprej <strong>dodali odvisnost od storitve <code>authentication</code></strong> in poskrbeli za <strong>metodi <code>isLoggedIn</code></strong> ter <strong><code>getCurrentUser</code></strong>.</p>
<p><code>angular/src/app/shared/components/location-details/location-details.component.ts</code></p>
<div class="sourceCode" id="cb757"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb757-1"><a href="Avtentikacija.html#cb757-1" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb757-2"><a href="Avtentikacija.html#cb757-2" tabindex="-1"></a><span class="im">import</span> { User } <span class="im">from</span> <span class="st">&quot;../../classes/user&quot;</span><span class="op">;</span></span>
<span id="cb757-3"><a href="Avtentikacija.html#cb757-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb757-4"><a href="Avtentikacija.html#cb757-4" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> LocationDetailsComponent {</span>
<span id="cb757-5"><a href="Avtentikacija.html#cb757-5" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb757-6"><a href="Avtentikacija.html#cb757-6" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb757-7"><a href="Avtentikacija.html#cb757-7" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">modalService</span><span class="op">:</span> BsModalService<span class="op">,</span></span>
<span id="cb757-8"><a href="Avtentikacija.html#cb757-8" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">demoDataService</span><span class="op">:</span> DemoDataService<span class="op">,</span></span>
<span id="cb757-9"><a href="Avtentikacija.html#cb757-9" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">authenticationService</span><span class="op">:</span> AuthenticationService</span>
<span id="cb757-10"><a href="Avtentikacija.html#cb757-10" tabindex="-1"></a>  ) {}</span>
<span id="cb757-11"><a href="Avtentikacija.html#cb757-11" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb757-12"><a href="Avtentikacija.html#cb757-12" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">isLoggedIn</span>()<span class="op">:</span> boolean {</span>
<span id="cb757-13"><a href="Avtentikacija.html#cb757-13" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span><span class="op">.</span><span class="fu">isLoggedIn</span>()<span class="op">;</span></span>
<span id="cb757-14"><a href="Avtentikacija.html#cb757-14" tabindex="-1"></a>  }</span>
<span id="cb757-15"><a href="Avtentikacija.html#cb757-15" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">getCurrentUser</span>()<span class="op">:</span> string {</span>
<span id="cb757-16"><a href="Avtentikacija.html#cb757-16" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">user</span><span class="op">:</span> User <span class="op">|</span> <span class="kw">null</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">authenticationService</span><span class="op">.</span><span class="fu">getCurrentUser</span>()<span class="op">;</span></span>
<span id="cb757-17"><a href="Avtentikacija.html#cb757-17" tabindex="-1"></a>    <span class="cf">return</span> user <span class="op">?</span> user<span class="op">.</span><span class="at">name</span> <span class="op">:</span> <span class="st">&quot;Guest&quot;</span><span class="op">;</span></span>
<span id="cb757-18"><a href="Avtentikacija.html#cb757-18" tabindex="-1"></a>  }</span>
<span id="cb757-19"><a href="Avtentikacija.html#cb757-19" tabindex="-1"></a>}</span></code></pre></div>
<p>Glede na to ali je uporabnik prijavljen, želimo vplivati na <strong>prikaz gumba za dodajanje komentarjev</strong>, kot to prikazuje slika <a href="Avtentikacija.html#fig:slika-Prijava-za-komentiranje-dodaj-komentar">10.11</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Prijava-za-komentiranje-dodaj-komentar"></span>
<img src="assets/img/Prijava_za_komentiranje_dodaj_komentar.png" alt="Različni stanji gumba za dodajanje komentarja, ki sta odvisni od tega, ali je uporabnik prijavljen ali ne" width="500" />
<p class="caption">
Slika 10.11: Različni stanji gumba za dodajanje komentarja, ki sta odvisni od tega, ali je uporabnik prijavljen ali ne
</p>
</div>
<p>Na predlogo pogleda <code>location-details.component.html</code> dodamo gumb <code>Login to post comment</code>, če uporabnik ni prijavljen, sicer ostane gumb <code>Add comment</code>.</p>
<p><code>angular/src/app/shared/components/location-details/location-details.component.html</code></p>
<div class="sourceCode" id="cb758"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb758-1"><a href="Avtentikacija.html#cb758-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> [ngSwitch]</span><span class="op">=</span><span class="st">&quot;isLoggedIn()&quot;</span><span class="dt">&gt;</span></span>
<span id="cb758-2"><a href="Avtentikacija.html#cb758-2" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">a</span></span>
<span id="cb758-3"><a href="Avtentikacija.html#cb758-3" tabindex="-1"></a><span class="ot">    *ngSwitchCase</span><span class="op">=</span><span class="st">&quot;true&quot;</span></span>
<span id="cb758-4"><a href="Avtentikacija.html#cb758-4" tabindex="-1"></a><span class="ot">    class</span><span class="op">=</span><span class="st">&quot;btn btn-primary btn-sm&quot;</span></span>
<span id="cb758-5"><a href="Avtentikacija.html#cb758-5" tabindex="-1"></a><span class="ot">    (click)</span><span class="op">=</span><span class="st">&quot;openModal(commentForm)&quot;</span></span>
<span id="cb758-6"><a href="Avtentikacija.html#cb758-6" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;</span><span class="kw">i</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;fa-regular fa-comment-dots pe-2&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">i</span></span>
<span id="cb758-7"><a href="Avtentikacija.html#cb758-7" tabindex="-1"></a>    <span class="dt">&gt;&lt;</span><span class="kw">span</span><span class="dt">&gt;</span>Add comment<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;&lt;/</span><span class="kw">a</span></span>
<span id="cb758-8"><a href="Avtentikacija.html#cb758-8" tabindex="-1"></a>  <span class="dt">&gt;</span></span>
<span id="cb758-9"><a href="Avtentikacija.html#cb758-9" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">a</span></span>
<span id="cb758-10"><a href="Avtentikacija.html#cb758-10" tabindex="-1"></a><span class="ot">    *ngSwitchDefault</span></span>
<span id="cb758-11"><a href="Avtentikacija.html#cb758-11" tabindex="-1"></a><span class="ot">    routerLink</span><span class="op">=</span><span class="st">&quot;/login&quot;</span></span>
<span id="cb758-12"><a href="Avtentikacija.html#cb758-12" tabindex="-1"></a><span class="ot">    class</span><span class="op">=</span><span class="st">&quot;btn btn-primary btn-sm&quot;</span></span>
<span id="cb758-13"><a href="Avtentikacija.html#cb758-13" tabindex="-1"></a><span class="ot">    </span><span class="dt">&gt;&lt;</span><span class="kw">i</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;fa-solid fa-right-to-bracket pe-2&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">i</span><span class="dt">&gt;</span>Login to post</span>
<span id="cb758-14"><a href="Avtentikacija.html#cb758-14" tabindex="-1"></a>    comment<span class="dt">&lt;/</span><span class="kw">a</span></span>
<span id="cb758-15"><a href="Avtentikacija.html#cb758-15" tabindex="-1"></a>  <span class="dt">&gt;</span></span>
<span id="cb758-16"><a href="Avtentikacija.html#cb758-16" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Z vsemi spremembami imamo sedaj delujočo funkcionalnost dinamičnega gumba, ki se spreminja glede na to, ali je uporabnik prijavljen v našo aplikacijo (glej sliko <a href="Avtentikacija.html#fig:slika-Prijava-za-komentiranje-dodaj-komentar">10.11</a>).</p>
<p>Sedaj moramo poskrbeti še za <strong>odstranjevanje vnosnega polja imena na obrazcu za dodajanje komentarjev</strong> na pogledu <code>location-details.component.html</code>, saj bomo ta podatek pridobili iz žetona JWT in ga samodejno vključili pri shranjevanju komentarja.</p>
<p><code>angular/src/app/shared/components/location-details/location-details.component.html</code></p>
<div class="sourceCode" id="cb759"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb759-1"><a href="Avtentikacija.html#cb759-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">ng-template</span><span class="ot"> #commentForm</span><span class="dt">&gt;</span></span>
<span id="cb759-2"><a href="Avtentikacija.html#cb759-2" tabindex="-1"></a>  ...</span>
<span id="cb759-3"><a href="Avtentikacija.html#cb759-3" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;modal-body&quot;</span><span class="dt">&gt;</span></span>
<span id="cb759-4"><a href="Avtentikacija.html#cb759-4" tabindex="-1"></a>    ...</span>
<span id="cb759-5"><a href="Avtentikacija.html#cb759-5" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;form-group&quot;</span><span class="dt">&gt;</span></span>
<span id="cb759-6"><a href="Avtentikacija.html#cb759-6" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">&quot;name&quot;</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;form-label mb-1 mt-2&quot;</span><span class="dt">&gt;</span>Name<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb759-7"><a href="Avtentikacija.html#cb759-7" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span></span>
<span id="cb759-8"><a href="Avtentikacija.html#cb759-8" tabindex="-1"></a><span class="ot">        type</span><span class="op">=</span><span class="st">&quot;text&quot;</span></span>
<span id="cb759-9"><a href="Avtentikacija.html#cb759-9" tabindex="-1"></a><span class="ot">        id</span><span class="op">=</span><span class="st">&quot;name&quot;</span></span>
<span id="cb759-10"><a href="Avtentikacija.html#cb759-10" tabindex="-1"></a><span class="ot">        [(ngModel)]</span><span class="op">=</span><span class="st">&quot;newComment.author&quot;</span></span>
<span id="cb759-11"><a href="Avtentikacija.html#cb759-11" tabindex="-1"></a><span class="ot">        class</span><span class="op">=</span><span class="st">&quot;form-control form-control-sm&quot;</span></span>
<span id="cb759-12"><a href="Avtentikacija.html#cb759-12" tabindex="-1"></a><span class="ot">        placeholder</span><span class="op">=</span><span class="st">&quot;Enter author&#39;s name&quot;</span></span>
<span id="cb759-13"><a href="Avtentikacija.html#cb759-13" tabindex="-1"></a><span class="ot">      </span><span class="dt">/&gt;</span></span>
<span id="cb759-14"><a href="Avtentikacija.html#cb759-14" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb759-15"><a href="Avtentikacija.html#cb759-15" tabindex="-1"></a>    ...</span>
<span id="cb759-16"><a href="Avtentikacija.html#cb759-16" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb759-17"><a href="Avtentikacija.html#cb759-17" tabindex="-1"></a>  ...</span>
<span id="cb759-18"><a href="Avtentikacija.html#cb759-18" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">ng-template</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Brez omenjenega vnosnega polja je potrebna tudi manjša posodobitev krmilnika <code>location-details.component.ts</code>.</p>
<p><code>angular/src/app/shared/components/location-details/location-details.component.ts</code></p>
<div class="sourceCode" id="cb760"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb760-1"><a href="Avtentikacija.html#cb760-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> LocationDetailsComponent {</span>
<span id="cb760-2"><a href="Avtentikacija.html#cb760-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb760-3"><a href="Avtentikacija.html#cb760-3" tabindex="-1"></a>  <span class="kw">protected</span> <span class="fu">addNewComment</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb760-4"><a href="Avtentikacija.html#cb760-4" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">formDataError</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb760-5"><a href="Avtentikacija.html#cb760-5" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">newComment</span><span class="op">.</span><span class="at">author</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getCurrentUser</span>()<span class="op">;</span></span>
<span id="cb760-6"><a href="Avtentikacija.html#cb760-6" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="fu">isFormDataValid</span>()) {</span>
<span id="cb760-7"><a href="Avtentikacija.html#cb760-7" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">demoDataService</span></span>
<span id="cb760-8"><a href="Avtentikacija.html#cb760-8" tabindex="-1"></a>        <span class="op">.</span><span class="fu">addCommentToLocation</span>(<span class="kw">this</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">_id</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">newComment</span>)</span>
<span id="cb760-9"><a href="Avtentikacija.html#cb760-9" tabindex="-1"></a>        <span class="op">.</span><span class="fu">subscribe</span>({</span>
<span id="cb760-10"><a href="Avtentikacija.html#cb760-10" tabindex="-1"></a>          <span class="dt">next</span><span class="op">:</span> (<span class="dt">comment</span><span class="op">:</span> <span class="bu">Comment</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb760-11"><a href="Avtentikacija.html#cb760-11" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="at">location</span><span class="op">?.</span><span class="at">comments</span><span class="op">?.</span><span class="fu">unshift</span>(comment)<span class="op">;</span></span>
<span id="cb760-12"><a href="Avtentikacija.html#cb760-12" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">updateAverageRating</span>()<span class="op">;</span></span>
<span id="cb760-13"><a href="Avtentikacija.html#cb760-13" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">closeModal</span>()<span class="op">;</span></span>
<span id="cb760-14"><a href="Avtentikacija.html#cb760-14" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb760-15"><a href="Avtentikacija.html#cb760-15" tabindex="-1"></a>          <span class="dt">error</span><span class="op">:</span> (err) <span class="kw">=&gt;</span> {</span>
<span id="cb760-16"><a href="Avtentikacija.html#cb760-16" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="at">formDataError</span> <span class="op">=</span> err <span class="op">||</span> <span class="st">&quot;Error adding comment.&quot;</span><span class="op">;</span></span>
<span id="cb760-17"><a href="Avtentikacija.html#cb760-17" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb760-18"><a href="Avtentikacija.html#cb760-18" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb760-19"><a href="Avtentikacija.html#cb760-19" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb760-20"><a href="Avtentikacija.html#cb760-20" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">formDataError</span> <span class="op">=</span></span>
<span id="cb760-21"><a href="Avtentikacija.html#cb760-21" tabindex="-1"></a>        <span class="st">&quot;All fields required, including rating between 1 and 5.&quot;</span><span class="op">;</span></span>
<span id="cb760-22"><a href="Avtentikacija.html#cb760-22" tabindex="-1"></a>    }</span>
<span id="cb760-23"><a href="Avtentikacija.html#cb760-23" tabindex="-1"></a>  }</span>
<span id="cb760-24"><a href="Avtentikacija.html#cb760-24" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb760-25"><a href="Avtentikacija.html#cb760-25" tabindex="-1"></a>}</span></code></pre></div>
<p>Končna različica spletnega obrazca za dodajanje komentarja prijavljenega uporabnika je prikazana na sliki <a href="Avtentikacija.html#fig:slika-Dodajanje-komentarja-prijavljenega-uporabnika">10.12</a>. Razvidno je, da ni več vnosnega polja za vnos polnega imena uporabnika, ki se bo sedaj prenesel iz JWT žetona.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:slika-Dodajanje-komentarja-prijavljenega-uporabnika"></span>
<img src="assets/img/Dodajanje_komentarja_prijavljenega_uporabnika.png" alt="Posodobljen obrazec za dodajanje komentarjev prijavljenega uporabnika brez vnosnega polja za polno ime, ki se sedaj samodejno izpolni s podatki prijavljenega uporabnika (polno ime uporabnika desno zgoraj v navigacijski vrstici)" width="350" />
<p class="caption">
Slika 10.12: Posodobljen obrazec za dodajanje komentarjev prijavljenega uporabnika brez vnosnega polja za polno ime, ki se sedaj samodejno izpolni s podatki prijavljenega uporabnika (polno ime uporabnika desno zgoraj v navigacijski vrstici)
</p>
</div>
<p>Če poskušamo dodati komentar, to še vedno ni mogoče, ker pride do napake <code>401 Unauthorized</code> pri klicu REST API-ja. To stanje je pričakovano, saj smo nekatere (<code>POST</code>, <code>PUT</code> in <code>DELETE</code>) REST API dostopne točke na strani strežnika zaščitili tako, da lahko do njih dostopajo zgolj prijavljeni uporabniki.</p>
<p>Najprej moramo poskrbeti, da se v okviru <code>POST</code> zahteve na REST API dostopno točko zraven <strong>posreduje</strong> tudi <strong>HTTP glava <code>Authorization</code></strong> z vsebino <code>Bearer &lt;JWT&gt;</code>. To funkcionalnost bomo implementirali kar v storitvi pridobivanja podatkov <code>demo-data.service.ts</code>, kjer najprej dodamo potrebne odvisnosti in nato v okviru metode <code>addCommentToLocation</code> pri posredovanju <code>POST</code> zahteve dodamo še HTTP glavo <code>Authorization</code>.</p>
<p><code>angular/src/app/shared/services/demo-data.service.ts</code></p>
<div class="sourceCode" id="cb761"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb761-1"><a href="Avtentikacija.html#cb761-1" tabindex="-1"></a><span class="im">import</span> { Inject<span class="op">,</span> Injectable } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb761-2"><a href="Avtentikacija.html#cb761-2" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb761-3"><a href="Avtentikacija.html#cb761-3" tabindex="-1"></a><span class="im">import</span> { BROWSER_STORAGE } <span class="im">from</span> <span class="st">&quot;../classes/storage&quot;</span><span class="op">;</span></span>
<span id="cb761-4"><a href="Avtentikacija.html#cb761-4" tabindex="-1"></a></span>
<span id="cb761-5"><a href="Avtentikacija.html#cb761-5" tabindex="-1"></a>@<span class="fu">Injectable</span>({</span>
<span id="cb761-6"><a href="Avtentikacija.html#cb761-6" tabindex="-1"></a>  <span class="dt">providedIn</span><span class="op">:</span> <span class="st">&quot;root&quot;</span><span class="op">,</span></span>
<span id="cb761-7"><a href="Avtentikacija.html#cb761-7" tabindex="-1"></a>})</span>
<span id="cb761-8"><a href="Avtentikacija.html#cb761-8" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> DemoDataService {</span>
<span id="cb761-9"><a href="Avtentikacija.html#cb761-9" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb761-10"><a href="Avtentikacija.html#cb761-10" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">http</span><span class="op">:</span> HttpClient<span class="op">,</span></span>
<span id="cb761-11"><a href="Avtentikacija.html#cb761-11" tabindex="-1"></a>    @<span class="fu">Inject</span>(BROWSER_STORAGE) <span class="kw">private</span> <span class="dt">storage</span><span class="op">:</span> <span class="bu">Storage</span></span>
<span id="cb761-12"><a href="Avtentikacija.html#cb761-12" tabindex="-1"></a>  ) {}</span>
<span id="cb761-13"><a href="Avtentikacija.html#cb761-13" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb761-14"><a href="Avtentikacija.html#cb761-14" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">addCommentToLocation</span>(</span>
<span id="cb761-15"><a href="Avtentikacija.html#cb761-15" tabindex="-1"></a>    <span class="dt">locationId</span><span class="op">:</span> string<span class="op">,</span></span>
<span id="cb761-16"><a href="Avtentikacija.html#cb761-16" tabindex="-1"></a>    <span class="dt">comment</span><span class="op">:</span> <span class="bu">Comment</span></span>
<span id="cb761-17"><a href="Avtentikacija.html#cb761-17" tabindex="-1"></a>  )<span class="op">:</span> Observable<span class="op">&lt;</span><span class="bu">Comment</span><span class="op">&gt;</span> {</span>
<span id="cb761-18"><a href="Avtentikacija.html#cb761-18" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">url</span><span class="op">:</span> string <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/locations/</span><span class="sc">${</span>locationId<span class="sc">}</span><span class="vs">/comments`</span><span class="op">;</span></span>
<span id="cb761-19"><a href="Avtentikacija.html#cb761-19" tabindex="-1"></a>    <span class="kw">let</span> body <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpParams</span>()</span>
<span id="cb761-20"><a href="Avtentikacija.html#cb761-20" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;author&quot;</span><span class="op">,</span> comment<span class="op">.</span><span class="at">author</span>)</span>
<span id="cb761-21"><a href="Avtentikacija.html#cb761-21" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;rating&quot;</span><span class="op">,</span> comment<span class="op">.</span><span class="at">rating</span>)</span>
<span id="cb761-22"><a href="Avtentikacija.html#cb761-22" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;comment&quot;</span><span class="op">,</span> comment<span class="op">.</span><span class="at">comment</span>)<span class="op">;</span></span>
<span id="cb761-23"><a href="Avtentikacija.html#cb761-23" tabindex="-1"></a>    <span class="kw">let</span> headers <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpHeaders</span>()</span>
<span id="cb761-24"><a href="Avtentikacija.html#cb761-24" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;Content-Type&quot;</span><span class="op">,</span> <span class="st">&quot;application/x-www-form-urlencoded&quot;</span>)</span>
<span id="cb761-25"><a href="Avtentikacija.html#cb761-25" tabindex="-1"></a>      <span class="op">.</span><span class="fu">set</span>(<span class="st">&quot;Authorization&quot;</span><span class="op">,</span> <span class="vs">`Bearer </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="st">&quot;demo-token&quot;</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb761-26"><a href="Avtentikacija.html#cb761-26" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">http</span></span>
<span id="cb761-27"><a href="Avtentikacija.html#cb761-27" tabindex="-1"></a>      <span class="op">.</span><span class="at">post</span><span class="op">&lt;</span><span class="bu">Comment</span><span class="op">&gt;</span>(url<span class="op">,</span> body<span class="op">,</span> { headers })</span>
<span id="cb761-28"><a href="Avtentikacija.html#cb761-28" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(<span class="fu">retry</span>(<span class="dv">1</span>)<span class="op">,</span> <span class="fu">catchError</span>(<span class="kw">this</span><span class="op">.</span><span class="at">handleError</span>))<span class="op">;</span></span>
<span id="cb761-29"><a href="Avtentikacija.html#cb761-29" tabindex="-1"></a>  }</span>
<span id="cb761-30"><a href="Avtentikacija.html#cb761-30" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb761-31"><a href="Avtentikacija.html#cb761-31" tabindex="-1"></a>}</span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(0)").markRegExp(/import { (Authentication|User).+/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(0)").markRegExp(/,[\s|\n]+?private authenticationService: AuthenticationService/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(0)").markRegExp(/\s+?public (isLoggedIn|getCurrentUser)[\s\S]+?;[\s|\n]+?}/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.html:eq(0)").markRegExp(/ \[ngSwitch\]=".+?"/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.html:eq(0)").markRegExp(/ \s*?\*ngSwitchCase=".+?"/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.html:eq(0)").markRegExp(/\s+?\<a[^<]+?\*ngSwitchDefault[\s\S]+?<\/a[^>]+?>/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.html:eq(1)").markRegExp(/\s+?\<div class="form-group row"\>[\s|\n]+?\<label class=".+?" for="naziv"[\s\S]+?\<\/div\>[\s|\n]+?\<\/div\>/, options_izbrisi);
    $("#dodajanje-uporabnika-v-komentar code.html:eq(1)").markRegExp(/\s+?\<div class="form-group"\>[^\.]+?ngModel[\s\S]+?<\/div>/, options_izbrisi);
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(1)").markRegExp(/\s+?this\.newComment\.author.+/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(2)").markRegExp(/Inject, /, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(2)").markRegExp(/.+?BROWSER_STORAGE.+/, options_dodaj);
    $("#dodajanje-uporabnika-v-komentar code.javascript:eq(2)").markRegExp(/\s+?\.set\("Authorization", .+?\).+?\)/, options_dodaj);
  });
</script>
</div>
<div id="brisanje-lastnih-komentarjev" class="section level3 hasAnchor" number="10.7.4">
<h3><span class="header-section-number">10.7.4</span> Brisanje lastnih komentarjev<a href="Avtentikacija.html#brisanje-lastnih-komentarjev" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Trenutno brisanje komentarjev preko spletne aplikacije ne deluje, saj pri REST API zahtevi ne vključimo žetona JWT, zato to dopolnimo.</p>
<p><code>angular/src/app/shared/services/demo-data.service.ts</code></p>
<div class="sourceCode" id="cb762"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb762-1"><a href="Avtentikacija.html#cb762-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> DemoDataService {</span>
<span id="cb762-2"><a href="Avtentikacija.html#cb762-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb762-3"><a href="Avtentikacija.html#cb762-3" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">deleteCommentFromLocation</span>(</span>
<span id="cb762-4"><a href="Avtentikacija.html#cb762-4" tabindex="-1"></a>    <span class="dt">locationId</span><span class="op">:</span> string<span class="op">,</span></span>
<span id="cb762-5"><a href="Avtentikacija.html#cb762-5" tabindex="-1"></a>    <span class="dt">commentId</span><span class="op">:</span> string</span>
<span id="cb762-6"><a href="Avtentikacija.html#cb762-6" tabindex="-1"></a>  )<span class="op">:</span> Observable<span class="op">&lt;</span>any<span class="op">&gt;</span> {</span>
<span id="cb762-7"><a href="Avtentikacija.html#cb762-7" tabindex="-1"></a>    <span class="kw">const</span> <span class="dt">url</span><span class="op">:</span> string <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">apiUrl</span><span class="sc">}</span><span class="vs">/locations/</span><span class="sc">${</span>locationId<span class="sc">}</span><span class="vs">/comments/</span><span class="sc">${</span>commentId<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb762-8"><a href="Avtentikacija.html#cb762-8" tabindex="-1"></a>    <span class="kw">let</span> headers <span class="op">=</span> <span class="kw">new</span> <span class="fu">HttpHeaders</span>()<span class="op">.</span><span class="fu">set</span>(</span>
<span id="cb762-9"><a href="Avtentikacija.html#cb762-9" tabindex="-1"></a>      <span class="st">&quot;Authorization&quot;</span><span class="op">,</span></span>
<span id="cb762-10"><a href="Avtentikacija.html#cb762-10" tabindex="-1"></a>      <span class="vs">`Bearer </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="st">&quot;demo-token&quot;</span>)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb762-11"><a href="Avtentikacija.html#cb762-11" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb762-12"><a href="Avtentikacija.html#cb762-12" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">http</span></span>
<span id="cb762-13"><a href="Avtentikacija.html#cb762-13" tabindex="-1"></a>      <span class="op">.</span><span class="fu">delete</span>(url<span class="op">,</span> { headers })</span>
<span id="cb762-14"><a href="Avtentikacija.html#cb762-14" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pipe</span>(<span class="fu">retry</span>(<span class="dv">1</span>)<span class="op">,</span> <span class="fu">catchError</span>(<span class="kw">this</span><span class="op">.</span><span class="at">handleError</span>))<span class="op">;</span></span>
<span id="cb762-15"><a href="Avtentikacija.html#cb762-15" tabindex="-1"></a>  }</span>
<span id="cb762-16"><a href="Avtentikacija.html#cb762-16" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb762-17"><a href="Avtentikacija.html#cb762-17" tabindex="-1"></a>}</span></code></pre></div>
<p>Ikono za brisanje <i class="fa-solid fa-trash-can"></i> posameznega komentarja bomo prikazali zgolj pri tistih komentarjih, katerih avtor je prijavljeni uporabnik. Za ta namen pripravimo metodo <code>canDeleteComment</code>, ki jo nato vključimo v HTML predlogo preko <code>*ngIf</code>.</p>
<p><code>angular/src/app/shared/components/location-details/location-details.component.ts</code></p>
<div class="sourceCode" id="cb763"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb763-1"><a href="Avtentikacija.html#cb763-1" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> LocationDetailsComponent {</span>
<span id="cb763-2"><a href="Avtentikacija.html#cb763-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb763-3"><a href="Avtentikacija.html#cb763-3" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">canDeleteComment</span>(<span class="dt">comment</span><span class="op">:</span> <span class="bu">Comment</span>)<span class="op">:</span> boolean {</span>
<span id="cb763-4"><a href="Avtentikacija.html#cb763-4" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="fu">isLoggedIn</span>() <span class="op">&amp;&amp;</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getCurrentUser</span>() <span class="op">===</span> comment<span class="op">.</span><span class="at">author</span><span class="op">;</span></span>
<span id="cb763-5"><a href="Avtentikacija.html#cb763-5" tabindex="-1"></a>  }</span>
<span id="cb763-6"><a href="Avtentikacija.html#cb763-6" tabindex="-1"></a>}</span></code></pre></div>
<p><code>angular/src/app/shared/components/location-details/location-details.component.html</code></p>
<div class="sourceCode" id="cb764"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb764-1"><a href="Avtentikacija.html#cb764-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">i</span></span>
<span id="cb764-2"><a href="Avtentikacija.html#cb764-2" tabindex="-1"></a><span class="ot">  *ngIf</span><span class="op">=</span><span class="st">&quot;canDeleteComment(comment)&quot;</span></span>
<span id="cb764-3"><a href="Avtentikacija.html#cb764-3" tabindex="-1"></a><span class="ot">  class</span><span class="op">=</span><span class="st">&quot;fa-solid fa-trash-can text-primary show-pointer ms-4&quot;</span></span>
<span id="cb764-4"><a href="Avtentikacija.html#cb764-4" tabindex="-1"></a><span class="ot">  (click)</span><span class="op">=</span><span class="st">&quot;deleteComment(comment._id)&quot;</span></span>
<span id="cb764-5"><a href="Avtentikacija.html#cb764-5" tabindex="-1"></a><span class="dt">&gt;&lt;/</span><span class="kw">i</span><span class="dt">&gt;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#brisanje-lastnih-komentarjev code.javascript:eq(0)").markRegExp(/\s+?let header[\s\S]+?\);/, options_dodaj);
    $("#brisanje-lastnih-komentarjev code.javascript:eq(0)").markRegExp(/, { headers }/, options_dodaj);
    $("#brisanje-lastnih-komentarjev code.javascript:eq(1)").markRegExp(/\s+?public canDeleteComment[\s\S]+?}/, options_dodaj);
    $("#brisanje-lastnih-komentarjev code.html:eq(0)").markRegExp(/.+?ngIf.+/, options_dodaj);
  });
</script>
</div>
</div>
<div id="nastavitve-v-brskalniku" class="section level2 hasAnchor" number="10.8">
<h2><span class="header-section-number">10.8</span> Shranjevanje uporabniških nastavitev v brskalniku<a href="Avtentikacija.html#nastavitve-v-brskalniku" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Za boljšo uporabniško izkušnjo si uporabniki pogosto želijo nastaviti določene parametre aplikacije, ki bi ostali nastavljeni tudi ob njihovem naslednjem obisku. Za ta namen lahko uporabimo <strong>lokalno shrambo <i class="fa-solid fa-database"></i><code>localStorage</code></strong> podatkov v brskalniku.</p>
<p>Funkcionalnost, ki bi jo želeli shraniti, je <strong>uporaba geolokacije</strong> oz. <strong>vnaprej določene lokacije</strong> UL FRI.</p>
<p><code>angular/src/app/shared/components/location-list/location-list.component.ts</code></p>
<div class="sourceCode" id="cb765"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb765-1"><a href="Avtentikacija.html#cb765-1" tabindex="-1"></a><span class="im">import</span> { Component<span class="op">,</span> OnInit<span class="op">,</span> Output<span class="op">,</span> <span class="bu">EventEmitter</span><span class="op">,</span> Inject } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb765-2"><a href="Avtentikacija.html#cb765-2" tabindex="-1"></a><span class="im">import</span> { DemoDataService } <span class="im">from</span> <span class="st">&quot;../../services/demo-data.service&quot;</span><span class="op">;</span></span>
<span id="cb765-3"><a href="Avtentikacija.html#cb765-3" tabindex="-1"></a><span class="im">import</span> { GeolocationService } <span class="im">from</span> <span class="st">&quot;../../services/geolocation.service&quot;</span><span class="op">;</span></span>
<span id="cb765-4"><a href="Avtentikacija.html#cb765-4" tabindex="-1"></a><span class="im">import</span> { TeachingDataService } <span class="im">from</span> <span class="st">&quot;../../services/teaching-data.service&quot;</span><span class="op">;</span></span>
<span id="cb765-5"><a href="Avtentikacija.html#cb765-5" tabindex="-1"></a><span class="im">import</span> { <span class="bu">Location</span> } <span class="im">from</span> <span class="st">&quot;../../classes/location&quot;</span><span class="op">;</span></span>
<span id="cb765-6"><a href="Avtentikacija.html#cb765-6" tabindex="-1"></a><span class="im">import</span> { BROWSER_STORAGE } <span class="im">from</span> <span class="st">&quot;../../classes/storage&quot;</span><span class="op">;</span></span>
<span id="cb765-7"><a href="Avtentikacija.html#cb765-7" tabindex="-1"></a></span>
<span id="cb765-8"><a href="Avtentikacija.html#cb765-8" tabindex="-1"></a>@<span class="fu">Component</span>({</span>
<span id="cb765-9"><a href="Avtentikacija.html#cb765-9" tabindex="-1"></a>  <span class="dt">selector</span><span class="op">:</span> <span class="st">&quot;app-location-list&quot;</span><span class="op">,</span></span>
<span id="cb765-10"><a href="Avtentikacija.html#cb765-10" tabindex="-1"></a>  <span class="dt">templateUrl</span><span class="op">:</span> <span class="st">&quot;./location-list.component.html&quot;</span><span class="op">,</span></span>
<span id="cb765-11"><a href="Avtentikacija.html#cb765-11" tabindex="-1"></a>  <span class="dt">styles</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb765-12"><a href="Avtentikacija.html#cb765-12" tabindex="-1"></a>})</span>
<span id="cb765-13"><a href="Avtentikacija.html#cb765-13" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> LocationListComponent <span class="kw">implements</span> OnInit {</span>
<span id="cb765-14"><a href="Avtentikacija.html#cb765-14" tabindex="-1"></a>  <span class="fu">constructor</span>(</span>
<span id="cb765-15"><a href="Avtentikacija.html#cb765-15" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">demoDataService</span><span class="op">:</span> DemoDataService<span class="op">,</span></span>
<span id="cb765-16"><a href="Avtentikacija.html#cb765-16" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">teachingDataService</span><span class="op">:</span> TeachingDataService<span class="op">,</span></span>
<span id="cb765-17"><a href="Avtentikacija.html#cb765-17" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">geoLocationService</span><span class="op">:</span> GeolocationService<span class="op">,</span></span>
<span id="cb765-18"><a href="Avtentikacija.html#cb765-18" tabindex="-1"></a>    @<span class="fu">Inject</span>(BROWSER_STORAGE) <span class="kw">private</span> <span class="dt">storage</span><span class="op">:</span> <span class="bu">Storage</span></span>
<span id="cb765-19"><a href="Avtentikacija.html#cb765-19" tabindex="-1"></a>  ) {}</span>
<span id="cb765-20"><a href="Avtentikacija.html#cb765-20" tabindex="-1"></a>  <span class="fu">ngOnInit</span>() {</span>
<span id="cb765-21"><a href="Avtentikacija.html#cb765-21" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="st">&quot;use-geolocation&quot;</span>))</span>
<span id="cb765-22"><a href="Avtentikacija.html#cb765-22" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">setItem</span>(<span class="st">&quot;use-geolocation&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">useGeolocation</span><span class="op">.</span><span class="fu">toString</span>())<span class="op">;</span></span>
<span id="cb765-23"><a href="Avtentikacija.html#cb765-23" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb765-24"><a href="Avtentikacija.html#cb765-24" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">useGeolocation</span> <span class="op">=</span></span>
<span id="cb765-25"><a href="Avtentikacija.html#cb765-25" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">getItem</span>(<span class="st">&quot;use-geolocation&quot;</span>) <span class="op">===</span> <span class="st">&quot;true&quot;</span> <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb765-26"><a href="Avtentikacija.html#cb765-26" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">getCurrentLocation</span>()<span class="op">;</span></span>
<span id="cb765-27"><a href="Avtentikacija.html#cb765-27" tabindex="-1"></a>  }</span>
<span id="cb765-28"><a href="Avtentikacija.html#cb765-28" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb765-29"><a href="Avtentikacija.html#cb765-29" tabindex="-1"></a>  <span class="kw">protected</span> <span class="fu">toggleGeolocation</span>()<span class="op">:</span> <span class="kw">void</span> {</span>
<span id="cb765-30"><a href="Avtentikacija.html#cb765-30" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">useGeolocation</span> <span class="op">=</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">useGeolocation</span><span class="op">;</span></span>
<span id="cb765-31"><a href="Avtentikacija.html#cb765-31" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">useGeolocation</span>) <span class="kw">this</span><span class="op">.</span><span class="at">currentLocation</span> <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">ULFRILocation</span><span class="op">;</span></span>
<span id="cb765-32"><a href="Avtentikacija.html#cb765-32" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">storage</span><span class="op">.</span><span class="fu">setItem</span>(<span class="st">&quot;use-geolocation&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">useGeolocation</span><span class="op">.</span><span class="fu">toString</span>())<span class="op">;</span></span>
<span id="cb765-33"><a href="Avtentikacija.html#cb765-33" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">getCurrentLocation</span>()<span class="op">;</span></span>
<span id="cb765-34"><a href="Avtentikacija.html#cb765-34" tabindex="-1"></a>  }</span>
<span id="cb765-35"><a href="Avtentikacija.html#cb765-35" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb765-36"><a href="Avtentikacija.html#cb765-36" tabindex="-1"></a>}</span></code></pre></div>
<p>Sedaj se ob vsakem ponovnem obisku strani nastavitev uporabe geolokacije prebere iz lokalne shrambe, če le-ta obstaja, sicer se jo nastavi.</p>
<script>
  $(document).ready(function() {
    $("#nastavitve-v-brskalniku code.javascript:eq(0)").markRegExp(/, Inject/, options_dodaj);
    $("#nastavitve-v-brskalniku code.javascript:eq(0)").markRegExp(/import { BROWSER_STORAGE.+/, options_dodaj);
    $("#nastavitve-v-brskalniku code.javascript:eq(0)").markRegExp(/,[\s\n]+?@Inject.+/, options_dodaj);
    $("#nastavitve-v-brskalniku code.javascript:eq(0)").markRegExp(/\s+?if \(\!this\.storage\.getItem\("use-geolocation"\)\)[\s\S]+?false;/, options_dodaj);
    $("#nastavitve-v-brskalniku code.javascript:eq(0)").markRegExp(/\s+?this\.storage.+;/, options_dodaj);
  });
</script>
</div>
<div id="auth-guard" class="section level2 hasAnchor" number="10.9">
<h2><span class="header-section-number">10.9</span> Auth Guard<a href="Avtentikacija.html#auth-guard" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Funkcionalnost <strong><i class="fa-brands fa-angular"></i>Auth Guard</strong>, ki je na voljo v ogrodju Angular, se uporablja za zaščito poti na podlagi stanja istovetnosti uporabnika. S pomočjo tega gradnika lažje upravljamo različne ravni dostopa med avtenticiranimi in neavtenticiranimi uporabniki. Ko uporabnik dostopa do določene poti v Angular aplikaciji, lahko Auth Guard preveri ali je uporabnik overjen in ima pooblastilo za dostop do določene poti. V primeru, da je uporabnik overjen, Auth Guard omogoči nadaljnjo navigacijo, sicer pa nas preusmeri na stran za prijavo ali drugo pot ter prepreči dostop do zaščitene vsebine.</p>
<div id="vrste" class="section level3 hasAnchor" number="10.9.1">
<h3><span class="header-section-number">10.9.1</span> Vrste<a href="Avtentikacija.html#vrste" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Poznamo več načinov preverjanja pristnosti, ki jih lahko uporabimo za zaščito poti, in sicer:</p>
<ul>
<li><a href="https://angular.io/api/router/CanActivateFn"><i class="fa-brands fa-angular"></i><code>CanActivateFn</code></a> se uporablja najbolj pogosto in opredeljuje, ali je uporabniku dovoljena navigacija po določeni poti,</li>
<li><a href="https://angular.io/api/router/CanActivateChildFn"><i class="fa-brands fa-angular"></i><code>CanActivateChildFn</code></a> je podoben <i class="fa-brands fa-angular"></i><code>CanActivateFn</code>, s to razliko, da se uporablja za zaščito podrejenih poti določene poti,</li>
<li><a href="https://angular.io/api/router/CanDeactivateFn"><i class="fa-brands fa-angular"></i><code>CanDeactive</code></a> omogoča nadzor nad tem ali je uporabniku dovoljeno zapustiti določeno pot in</li>
<li><a href="https://angular.io/api/router/CanMatchFn"><i class="fa-brands fa-angular"></i><code>CanMatch</code></a> se uporablja pri preprečevanju lenega nalaganja modulov za uporabnike, ki niso overjeni.</li>
</ul>
<p>V nadaljevanju si bomo pogledali enostaven primer onemogočenja registracije prijavljenim uporabnikom s pomočjo <i class="fa-brands fa-angular"></i><code>CanActivateFn</code>.</p>
</div>
<div id="canRegister" class="section level3 hasAnchor" number="10.9.2">
<h3><span class="header-section-number">10.9.2</span> Onemogočenje registracije prijavljenim uporabnikom<a href="Avtentikacija.html#canRegister" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Če bi želeli prijavljenim uporabnikom onemogočiti funkcionalnost registracije, lahko za to uporabimo Auth Guard tipa <code>CanActivate</code>. Najprej zahtevamo kreiranje novega gradnika <code>canRegister</code> in izberemo željen tip.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb766-1"><a href="Avtentikacija.html#cb766-1" tabindex="-1"></a><span class="ex">$</span> ng generate guard shared/guards/canRegister</span>
<span id="cb766-2"><a href="Avtentikacija.html#cb766-2" tabindex="-1"></a></span>
<span id="cb766-3"><a href="Avtentikacija.html#cb766-3" tabindex="-1"></a><span class="ex">?</span> Which type of guard would you like to create<span class="pp">?</span> <span class="er">(</span><span class="ex">Press</span> <span class="op">&lt;</span>space<span class="op">&gt;</span> to select, <span class="op">&lt;</span>a<span class="op">&gt;</span> to toggle all, <span class="op">&lt;</span>i<span class="op">&gt;</span> to </span>
<span id="cb766-4"><a href="Avtentikacija.html#cb766-4" tabindex="-1"></a><span class="ex">invert</span> selection, and <span class="op">&lt;</span>enter<span class="op">&gt;</span> to proceed<span class="kw">)</span></span>
<span id="cb766-5"><a href="Avtentikacija.html#cb766-5" tabindex="-1"></a><span class="ex">❯◉</span> CanActivate</span>
<span id="cb766-6"><a href="Avtentikacija.html#cb766-6" tabindex="-1"></a> <span class="ex">◯</span> CanActivateChild</span>
<span id="cb766-7"><a href="Avtentikacija.html#cb766-7" tabindex="-1"></a> <span class="ex">◯</span> CanDeactivate</span>
<span id="cb766-8"><a href="Avtentikacija.html#cb766-8" tabindex="-1"></a> <span class="ex">◯</span> CanMatch</span>
<span id="cb766-9"><a href="Avtentikacija.html#cb766-9" tabindex="-1"></a></span>
<span id="cb766-10"><a href="Avtentikacija.html#cb766-10" tabindex="-1"></a><span class="ex">CREATE</span> src/app/shared/guards/can-register.guard.ts <span class="er">(</span><span class="ex">128</span> bytes<span class="kw">)</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#canRegister code.bash:eq(0)").markRegExp(/ng generat.+/, options_dodaj);
    $("#canRegister code.bash:eq(0)").markRegExp(/can-register\.guard\.ts/, options_dodaj);
  });
</script>
<p>V novo kreirani datoteki <code>can-register.guard.ts</code> dopolnimo metodo <code>canRegisterGuard</code> tako. Uporabimo metodo <code>isLoggedIn()</code> storitve <code>AuthenticationService</code> in preverimo ali je uporabnik prijavljen v aplikacijo. Če je prijavljen, bomo dostop dovolili, sicer pa ga preusmerimo na začetno stran naše aplikacije.</p>
<p><code>angular/src/app/shared/guards/can-register.guard.ts</code></p>
<div class="sourceCode" id="cb767"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb767-1"><a href="Avtentikacija.html#cb767-1" tabindex="-1"></a><span class="im">import</span> { CanActivateFn<span class="op">,</span> Router } <span class="im">from</span> <span class="st">&quot;@angular/router&quot;</span><span class="op">;</span></span>
<span id="cb767-2"><a href="Avtentikacija.html#cb767-2" tabindex="-1"></a><span class="im">import</span> { AuthenticationService } <span class="im">from</span> <span class="st">&quot;../services/authentication.service&quot;</span><span class="op">;</span></span>
<span id="cb767-3"><a href="Avtentikacija.html#cb767-3" tabindex="-1"></a><span class="im">import</span> { inject } <span class="im">from</span> <span class="st">&quot;@angular/core&quot;</span><span class="op">;</span></span>
<span id="cb767-4"><a href="Avtentikacija.html#cb767-4" tabindex="-1"></a></span>
<span id="cb767-5"><a href="Avtentikacija.html#cb767-5" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> canRegisterGuard<span class="op">:</span> CanActivateFn <span class="op">=</span> (route<span class="op">,</span> state) <span class="kw">=&gt;</span> {</span>
<span id="cb767-6"><a href="Avtentikacija.html#cb767-6" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">!</span><span class="fu">inject</span>(AuthenticationService)<span class="op">.</span><span class="fu">isLoggedIn</span>()</span>
<span id="cb767-7"><a href="Avtentikacija.html#cb767-7" tabindex="-1"></a>    <span class="op">?</span> <span class="kw">true</span></span>
<span id="cb767-8"><a href="Avtentikacija.html#cb767-8" tabindex="-1"></a>    <span class="op">:</span> <span class="fu">inject</span>(Router)<span class="op">.</span><span class="fu">createUrlTree</span>([<span class="st">&quot;/&quot;</span>])<span class="op">;</span></span>
<span id="cb767-9"><a href="Avtentikacija.html#cb767-9" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#canRegister code.javascript:eq(0)").markRegExp(/, Router/, options_dodaj);
    $("#canRegister code.javascript:eq(0)").markRegExp(/import { (AuthenticationService|inject).+/, options_dodaj);
    $("#canRegister code.javascript:eq(0)").markRegExp(/\!inject.+/, options_dodaj);
    $("#canRegister code.javascript:eq(0)").markRegExp(/\s+?\? /, options_dodaj);
    $("#canRegister code.javascript:eq(0)").markRegExp(/\s+?: .+?\]\)/, options_dodaj);
  });
</script>
<p>Funkcionalnost omogočimo v usmerjevalni tabeli, kjer za željeno pot <code>register</code> dodamo tip omejitve <code>canActivate</code>, kot vrednost pa določimo prej ustvarjen <code>canRegisterGuard</code>.</p>
<p><code>angular/src/app/modules/app-routing/app-routing.module.ts</code></p>
<div class="sourceCode" id="cb768"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb768-1"><a href="Avtentikacija.html#cb768-1" tabindex="-1"></a><span class="im">import</span> { canRegisterGuard } <span class="im">from</span> <span class="st">&quot;src/app/shared/guards/can-register.guard&quot;</span><span class="op">;</span></span>
<span id="cb768-2"><a href="Avtentikacija.html#cb768-2" tabindex="-1"></a><span class="kw">const</span> routes<span class="op">:</span> Routes <span class="op">=</span> [</span>
<span id="cb768-3"><a href="Avtentikacija.html#cb768-3" tabindex="-1"></a>  <span class="op">...,</span></span>
<span id="cb768-4"><a href="Avtentikacija.html#cb768-4" tabindex="-1"></a>  {</span>
<span id="cb768-5"><a href="Avtentikacija.html#cb768-5" tabindex="-1"></a>    <span class="dt">path</span><span class="op">:</span> <span class="st">&quot;register&quot;</span><span class="op">,</span></span>
<span id="cb768-6"><a href="Avtentikacija.html#cb768-6" tabindex="-1"></a>    <span class="dt">component</span><span class="op">:</span> RegisterComponent<span class="op">,</span></span>
<span id="cb768-7"><a href="Avtentikacija.html#cb768-7" tabindex="-1"></a>    <span class="dt">canActivate</span><span class="op">:</span> [canRegisterGuard]<span class="op">,</span></span>
<span id="cb768-8"><a href="Avtentikacija.html#cb768-8" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb768-9"><a href="Avtentikacija.html#cb768-9" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb768-10"><a href="Avtentikacija.html#cb768-10" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div>
<script>
  $(document).ready(function() {
    $("#canRegister code.javascript:eq(1)").markRegExp(/import.+/, options_dodaj);
    $("#canRegister code.javascript:eq(1)").markRegExp(/\s+?canActivate.+/, options_dodaj);
  });
</script>
<h3>
Dodatno gradivo
</h3>
<table class="dodatnoGradivo">
<tr>
<td>
<p><img src="assets/img/Holmes_2019.jpg" width="200" style="display: block; margin: auto;" /></p>
</td>
<td>
<ul>
<li><strong>Getting MEAN with Mongo, Express, Angular, and Node</strong> <span class="citation">(<a href="literatura.html#ref-holmes2019">Holmes and Herber 2019</a>)</span>
<ul>
<li><strong>Part 2</strong>: Building a Node web application
<ul>
<li><strong>Chapter 11</strong>: Authenticating users, managing sessions, and securing APIs</li>
<li><strong>Chapter 12</strong>: Using an authentication API in Angular applications</li>
</ul></li>
</ul></li>
</ul>
</td>
</tr>
</table>

</div>
</div>
</div>



<div class="footnotes">
<hr />
<ol start="139">
<li id="fn139"><p>angl. header<a href="Avtentikacija.html#fnref139" class="footnote-back">↩︎</a></p></li>
<li id="fn140"><p>angl. payload<a href="Avtentikacija.html#fnref140" class="footnote-back">↩︎</a></p></li>
<li id="fn141"><p>angl. signature<a href="Avtentikacija.html#fnref141" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script type="text/javascript">
  $(document).ready(function() {
    
    $("a").click(function(e) {
      if (
        $(this).has(".fa-solid").length == 1 || 
        $(this).has(".fa-brands").length == 1 || 
        $(this).has(".fa-regular").length == 1 || 
        $(this).has("img.git").length == 1
      ) {
        e.preventDefault();
        window.open($(this).attr("href"), '_blank');
      }
    });
  });
</script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q6109Y2092"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q6109Y2092');
</script>
<h3><i class="fas fa-globe-europe" style="padding-right:5px"></i>Choose your language</h3>

<p>Students whose mother tongue is not Slovene can choose to <a onclick="loadGoogleTranslate()" class="google-translate-povezava"><i class="fas fa-sync-alt" style="padding-right:3px"></i>translate the contents of the script</a> into the selected language.</p>

<div id="google_translate_element"></div>

<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'sl', 
      includedLanguages: 'en,mk', 
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE, 
      multilanguagePage: true
    }, 'google_translate_element');
  }
  
  function loadGoogleTranslate() {
    if ($("script[src='//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit']").length == 0) {
      var googleTranslateScript = document.createElement('script');
      googleTranslateScript.type = 'text/javascript';
      googleTranslateScript.async = true;
      googleTranslateScript.src = '//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild(googleTranslateScript);    
    }
  }
  
  $(document).ready(function() {
    // Če gre za administrativno stran, potem skrij obrazec za komentarje
    $("h1:contains('Administracija'),h1:contains('Komentarji'),h1:contains('Analiza začetnega vprašalnika'),h1:contains('Lastni projekt'),h1:contains('pisni izpit'),h1:contains('Pisni izpiti')").filter(function() {
      $("h3:contains('Choose your language')").next().hide();
      $("h3:contains('Choose your language')").hide();
    });
  });
</script>
            </section>

          </div>
        </div>
      </div>
<a href="Angular-SPA.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="DApps-pametne-pogodbe.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/lib/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/lib/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
